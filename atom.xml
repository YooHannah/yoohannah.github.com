<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>My Little World</title>
  <subtitle>learn and share</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoohannah.github.io/"/>
  <updated>2020-04-11T14:58:28.543Z</updated>
  <id>http://yoohannah.github.io/</id>
  
  <author>
    <name>YooHannah</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vue æºç å­¦ä¹ å››ã€æ•°æ®åŒå‘ç»‘å®šã€‘</title>
    <link href="http://yoohannah.github.io/post/vue/src4.html"/>
    <id>http://yoohannah.github.io/post/vue/src4.html</id>
    <published>2020-04-11T14:58:15.000Z</published>
    <updated>2020-04-11T14:58:28.543Z</updated>
    
    <content type="html"><![CDATA[<p>vueåŒå‘ç»‘å®šåŸç†ï¼Œä¾èµ–æ”¶é›†æ˜¯<br>åœ¨createdå£°æ˜å‘¨æœŸä¹‹å‰ï¼Œ<br>renderç”Ÿæˆè™šæ‹Ÿdomçš„æ—¶å€™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._init = function (options) &#123;</div><div class="line">  vm.$options = mergeOptions(</div><div class="line">    resolveConstructorOptions(vm.constructor),</div><div class="line">    options || &#123;&#125;,</div><div class="line">    vm</div><div class="line">  );</div><div class="line">  callHook(vm, &apos;beforeCreate&apos;);//è¿è¡Œè®¢é˜…äº†beforecreateé’©å­çš„ç›¸å…³æ–¹æ³•</div><div class="line">  initState(vm);//å¤„ç†æ•°æ®</div><div class="line">  callHook(vm, &apos;created&apos;);</div></pre></td></tr></table></figure></p>
<h1 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h1><p>è½¬æ¢æˆå†…ç½®å‡½æ•°mergedInstanceDataFn<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">function mergeOptions (</div><div class="line">   parent,</div><div class="line">   child,</div><div class="line">   vm</div><div class="line"> ) &#123;</div><div class="line">   &#123;</div><div class="line">     checkComponents(child);</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   if (typeof child === &apos;function&apos;) &#123;</div><div class="line">     child = child.options;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   // ... normalizeProps, normalizeInject, normalizeDirectives</div><div class="line"></div><div class="line">   if (!child._base) &#123;</div><div class="line">     if (child.extends) &#123;</div><div class="line">       parent = mergeOptions(parent, child.extends, vm);</div><div class="line">     &#125;</div><div class="line">     if (child.mixins) &#123;</div><div class="line">       for (var i = 0, l = child.mixins.length; i &lt; l; i++) &#123;</div><div class="line">         parent = mergeOptions(parent, child.mixins[i], vm);</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   var options = &#123;&#125;;</div><div class="line">   var key;</div><div class="line">   for (key in parent) &#123;</div><div class="line">     mergeField(key);</div><div class="line">   &#125;</div><div class="line">   for (key in child) &#123;</div><div class="line">     if (!hasOwn(parent, key)) &#123;</div><div class="line">       mergeField(key);</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line">   //åœ¨ä¸Šé¢çš„å¾ªç¯ä¸­ä¼šéå†åˆ°é…ç½®çš„optionså‚æ•°é‡Œçš„dataå±æ€§ï¼Œåˆ™ä¼šè°ƒç”¨åˆ°strats.data</div><div class="line">   function mergeField (key) &#123; </div><div class="line">     var strat = strats[key] || defaultStrat;</div><div class="line">     options[key] = strat(parent[key], child[key], vm, key);</div><div class="line">   &#125;</div><div class="line">   return options</div><div class="line"> &#125;</div><div class="line"> //</div><div class="line"> strats.data = function (</div><div class="line">   parentVal,</div><div class="line">   childVal,</div><div class="line">   vm</div><div class="line"> ) &#123;</div><div class="line">   if (!vm) &#123;</div><div class="line">     //...vmå°±æ˜¯VUEå®ä¾‹ï¼Œæ‰€ä»¥ä¸ä¼šèµ°è¿™é‡Œ</div><div class="line">     return mergeDataOrFn(parentVal, childVal)</div><div class="line">   &#125;</div><div class="line">   return mergeDataOrFn(parentVal, childVal, vm)</div><div class="line"> &#125;;</div><div class="line"></div><div class="line"> function mergeDataOrFn (</div><div class="line">   parentVal,</div><div class="line">   childVal,</div><div class="line">   vm</div><div class="line"> ) &#123;</div><div class="line">   if (!vm) &#123;</div><div class="line">     ...</div><div class="line">   &#125; else &#123;</div><div class="line">     return function mergedInstanceDataFn () &#123;</div><div class="line">       // instance merge</div><div class="line">       var instanceData = typeof childVal === &apos;function&apos;</div><div class="line">         ? childVal.call(vm, vm)</div><div class="line">         : childVal;</div><div class="line">       var defaultData = typeof parentVal === &apos;function&apos;</div><div class="line">         ? parentVal.call(vm, vm)</div><div class="line">         : parentVal;</div><div class="line">       if (instanceData) &#123;</div><div class="line">         return mergeData(instanceData, defaultData)</div><div class="line">       &#125; else &#123;</div><div class="line">         return defaultData</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸€æ­¥ç»“æŸå<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">vm.$options.data = function mergedInstanceDataFn () &#123;</div><div class="line">  //å£°æ˜æ—¶ä¼ é€’è¿›æ¥çš„dataå±æ€§å€¼,æ˜¯å‡½æ•°åˆ™æ‰§è¡Œæ‹¿åˆ°å¯¹è±¡</div><div class="line">  var instanceData = typeof childVal === &apos;function&apos; </div><div class="line">    ? childVal.call(vm, vm)</div><div class="line">    : childVal;</div><div class="line">  //å†…éƒ¨å±æ€§æ²¡æœ‰dataå±æ€§ï¼Œæ‰€ä»¥ defaultData ä¸ºundefined</div><div class="line">  var defaultData = typeof parentVal === &apos;function&apos;</div><div class="line">    ? parentVal.call(vm, vm)</div><div class="line">    : parentVal;</div><div class="line">  if (instanceData) &#123;</div><div class="line">    return mergeData(instanceData, defaultData)</div><div class="line">  &#125; else &#123;</div><div class="line">    return defaultData</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">function mergeData (to, from) &#123;</div><div class="line">  if (!from) &#123; return to &#125;</div><div class="line">  ...//çœç•¥è‹¥å¹²é€»è¾‘</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="æ•°æ®åŠ«æŒ"><a href="#æ•°æ®åŠ«æŒ" class="headerlink" title="æ•°æ®åŠ«æŒ"></a>æ•°æ®åŠ«æŒ</h1><p>å¼€å§‹è¿›è¡ŒçœŸæ­£åˆå§‹åŒ–â€”æ•°æ®åŠ«æŒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">function initState (vm) &#123;</div><div class="line">  vm._watchers = [];</div><div class="line">  var opts = vm.$options;</div><div class="line">  if (opts.data) &#123;</div><div class="line">    initData(vm);</div><div class="line">  &#125; else &#123;</div><div class="line">    observe(vm._data = &#123;&#125;, true /* asRootData */);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function initData (vm) &#123;</div><div class="line">    var data = vm.$options.data;</div><div class="line">    data = vm._data = typeof data === &apos;function&apos;</div><div class="line">      ? getData(data, vm)</div><div class="line">      : data || &#123;&#125;;</div><div class="line">    //å¾—åˆ°çš„dataä¸æ˜¯objectå¯¹è±¡</div><div class="line">    if (!isPlainObject(data)) &#123;</div><div class="line">      data = &#123;&#125;;</div><div class="line">    &#125;</div><div class="line">    // proxy data on instance</div><div class="line">    var keys = Object.keys(data);</div><div class="line">    var props = vm.$options.props;</div><div class="line">    var methods = vm.$options.methods;</div><div class="line">    var i = keys.length;</div><div class="line">    while (i--) &#123;</div><div class="line">      var key = keys[i];</div><div class="line">      &#123;if (methods &amp;&amp; hasOwn(methods, key)) &#123;...ä¸methodåŒåè­¦å‘Š&#125;&#125;</div><div class="line">      if (props &amp;&amp; hasOwn(props, key)) &#123;</div><div class="line">       ...ä¸propåŒåè­¦å‘Š</div><div class="line">      &#125; else if (!isReserved(key)) &#123; //ä¸æ˜¯ä»¥$æˆ–è€…_å¼€å¤´çš„key</div><div class="line">        proxy(vm, &quot;_data&quot;, key); //å°†keyå€¼å­˜ä¸€ä»½åˆ°vmçš„&apos;_data&apos;å±æ€§ä¸Š</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    // observe data</div><div class="line">    observe(data, true /* asRootData */);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  function getData (data, vm) &#123;</div><div class="line">    // #7573 disable dep collection when invoking(è°ƒç”¨) data getters</div><div class="line">    pushTarget();</div><div class="line">    try &#123;</div><div class="line">      return data.call(vm, vm)</div><div class="line">    &#125; catch (e) &#123;</div><div class="line">      handleError(e, vm, &quot;data()&quot;);</div><div class="line">      return &#123;&#125;</div><div class="line">    &#125; finally &#123;</div><div class="line">      popTarget();</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  var sharedPropertyDefinition = &#123;</div><div class="line">    enumerable: true,</div><div class="line">    configurable: true,</div><div class="line">    get: noop,</div><div class="line">    set: noop</div><div class="line">  &#125;;</div><div class="line">  function proxy (target, sourceKey, key) &#123;</div><div class="line">    sharedPropertyDefinition.get = function proxyGetter () &#123;</div><div class="line">      return this[sourceKey][key]</div><div class="line">    &#125;;</div><div class="line">    sharedPropertyDefinition.set = function proxySetter (val) &#123;</div><div class="line">      this[sourceKey][key] = val;</div><div class="line">    &#125;;</div><div class="line">    Object.defineProperty(target, key, sharedPropertyDefinition);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>ç»™dataåˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹ï¼ŒæŒ‚è½½â€˜<em>ob</em>â€™å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªObserverå¯¹è±¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">function observe (value, asRootData) &#123;</div><div class="line">  if (!isObject(value) || value instanceof VNode) &#123;</div><div class="line">    return</div><div class="line">  &#125;</div><div class="line">  var ob;</div><div class="line">  if (hasOwn(value, &apos;__ob__&apos;) &amp;&amp; value.__ob__ instanceof Observer) &#123;</div><div class="line">    ob = value.__ob__;</div><div class="line">  &#125; else if (</div><div class="line">    shouldObserve &amp;&amp;</div><div class="line">    !isServerRendering() &amp;&amp;</div><div class="line">    (Array.isArray(value) || isPlainObject(value)) &amp;&amp;</div><div class="line">    Object.isExtensible(value) &amp;&amp;</div><div class="line">    !value._isVue</div><div class="line">  ) &#123;</div><div class="line">    ob = new Observer(value);</div><div class="line">  &#125;</div><div class="line">  if (asRootData &amp;&amp; ob) &#123;</div><div class="line">    ob.vmCount++;</div><div class="line">  &#125;</div><div class="line">  return ob</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Observerå¯¹è±¡æœ‰ä¸‰ä¸ªå±æ€§,â€˜<strong>ob</strong>â€™å±æ€§ç›¸åŒ<br>{<br>  value:data,<br>  dep : new Dep();<br>  vmCount :0<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">var Observer = function Observer (value) &#123;</div><div class="line">  this.value = value;</div><div class="line">  this.dep = new Dep();</div><div class="line">  this.vmCount = 0;</div><div class="line">  def(value, &apos;__ob__&apos;, this);</div><div class="line">  if (Array.isArray(value)) &#123;</div><div class="line">    if (hasProto) &#123;</div><div class="line">      protoAugment(value, arrayMethods);</div><div class="line">    &#125; else &#123;</div><div class="line">      copyAugment(value, arrayMethods, arrayKeys);</div><div class="line">    &#125;</div><div class="line">    this.observeArray(value);</div><div class="line">  &#125; else &#123;</div><div class="line">    this.walk(value);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">function def (obj, key, val, enumerable) &#123;</div><div class="line">  Object.defineProperty(obj, key, &#123;</div><div class="line">    value: val,</div><div class="line">    enumerable: !!enumerable,</div><div class="line">    writable: true,</div><div class="line">    configurable: true</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line">//éå†æ‰€æœ‰å±æ€§å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºgetter / setterã€‚ </div><div class="line">//ä»…å½“å€¼ç±»å‹ä¸ºObjectæ—¶æ‰åº”è°ƒç”¨æ­¤æ–¹æ³•ã€‚</div><div class="line">Observer.prototype.walk = function walk (obj) &#123;</div><div class="line">  var keys = Object.keys(obj);</div><div class="line">  for (var i = 0; i &lt; keys.length; i++) &#123;</div><div class="line">    defineReactive$$1(obj, keys[i]);</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>çœŸæ­£è¿›è¡ŒåŠ«æŒçš„æ–¹æ³•defineReactive$$1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">function defineReactive$$1 (</div><div class="line">    obj,</div><div class="line">    key,</div><div class="line">    val,</div><div class="line">    customSetter,</div><div class="line">    shallow</div><div class="line">  ) &#123;</div><div class="line">    var dep = new Dep();</div><div class="line"></div><div class="line">    var property = Object.getOwnPropertyDescriptor(obj, key);</div><div class="line">    if (property &amp;&amp; property.configurable === false) &#123;</div><div class="line">      return</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // cater(è¿åˆ) for pre-defined getter/setters</div><div class="line">    var getter = property &amp;&amp; property.get;</div><div class="line">    var setter = property &amp;&amp; property.set;</div><div class="line">    if ((!getter || setter) &amp;&amp; arguments.length === 2) &#123;</div><div class="line">      val = obj[key];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var childOb = !shallow &amp;&amp; observe(val);//å¯¹å€¼è¿›è¡ŒåŠ«æŒå¤„ç† å¼€å§‹é€’å½’å¤„ç†</div><div class="line">    Object.defineProperty(obj, key, &#123;</div><div class="line">      enumerable: true,</div><div class="line">      configurable: true,</div><div class="line">      get: function reactiveGetter () &#123;</div><div class="line">        var value = getter ? getter.call(obj) : val;</div><div class="line">        if (Dep.target) &#123; //new watchçš„æ—¶å€™ï¼ŒDep.targetæŒ‡å‘Watcherå¯¹è±¡,å†è¿è¡Œrenderå‡½æ•°ï¼Œè®¿é—®å…·ä½“å˜é‡å°±ä¼šè°ƒç”¨è¿™é‡Œ</div><div class="line">          dep.depend();//å¯¹keyçš„ä¾èµ–è¿›è¡Œä¾èµ–æ”¶é›†</div><div class="line">          if (childOb) &#123;//å¦‚æœå€¼æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æƒ…å†µä¸‹</div><div class="line">            childOb.dep.depend();//å¯¹å¯¹è±¡å€¼çš„ä¾èµ–è¿›è¡Œä¾èµ–æ”¶é›† å®ç°æ·±åº¦ç›‘å¬</div><div class="line">            if (Array.isArray(value)) &#123;</div><div class="line">              dependArray(value);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">        return value</div><div class="line">      &#125;,</div><div class="line">      set: function reactiveSetter (newVal) &#123;</div><div class="line">        var value = getter ? getter.call(obj) : val;</div><div class="line">        //ç›¸åŒå€¼ï¼Œä¸æ›´æ–°</div><div class="line">        if (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</div><div class="line">          return</div><div class="line">        &#125;</div><div class="line">        //æœ‰setteræ–¹æ³•ç›´æ¥ç”¨setteræ–¹æ³•æ›´æ–°ï¼Œæ²¡æœ‰ç›´æ¥èµ‹å€¼</div><div class="line">        if (getter &amp;&amp; !setter) &#123; return &#125;</div><div class="line">        if (setter) &#123;</div><div class="line">          setter.call(obj, newVal);</div><div class="line">        &#125; else &#123;</div><div class="line">          val = newVal;</div><div class="line">        &#125;</div><div class="line">        //å¯¹æ–°å€¼è¿›è¡ŒåŠ«æŒå¤„ç† æ›´æ–°childOb</div><div class="line">        //å¦‚æœæ–°å€¼æ˜¯å¯¹è±¡å¯¹æ–°èµ‹çš„å€¼åœ¨æ›´æ–°æ—¶è¿›è¡Œä¾èµ–æ”¶é›†</div><div class="line">        childOb = !shallow &amp;&amp; observe(newVal); </div><div class="line">        dep.notify();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>æ¯ä¸ªè¢«åŠ«æŒè¿‡çš„æ•°æ®çš„æ ‡è¯†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">var Dep = function Dep () &#123;</div><div class="line">  this.id = uid++;</div><div class="line">  this.subs = [];</div><div class="line">&#125;;</div><div class="line">Dep.prototype.addSub = function addSub (sub) &#123;</div><div class="line">  this.subs.push(sub);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Dep.prototype.depend = function depend () &#123;</div><div class="line">  if (Dep.target) &#123;</div><div class="line">    Dep.target.addDep(this); //è°ƒç”¨Watcher.addDepæ–¹æ³•ï¼ŒthisæŒ‡dep</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Dep.prototype.notify = function notify () &#123;</div><div class="line">  // stabilize the subscriber list first</div><div class="line">  var subs = this.subs.slice();</div><div class="line">  if (!config.async) &#123;</div><div class="line">    // subs aren&apos;t sorted in scheduler if not running async</div><div class="line">    // we need to sort them now to make sure they fire in correct</div><div class="line">    // order</div><div class="line">    subs.sort(function (a, b) &#123; return a.id - b.id; &#125;);</div><div class="line">  &#125;</div><div class="line">  for (var i = 0, l = subs.length; i &lt; l; i++) &#123;</div><div class="line">    subs[i].update(); //æ‰§è¡Œwatcherçš„updateå‡½æ•°</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">Dep.target = null;</div><div class="line">var targetStack = [];</div></pre></td></tr></table></figure></p>
<h1 id="è®¢é˜…å‘å¸ƒ"><a href="#è®¢é˜…å‘å¸ƒ" class="headerlink" title="è®¢é˜…å‘å¸ƒ"></a>è®¢é˜…å‘å¸ƒ</h1><p>mountComponentå‡½æ•°ä¼šnew Watcherä¸€ä¸ªå¯¹è±¡,æ‰§è¡Œgetæ–¹æ³•ã€è¯¦è§æºç åˆ†æäºŒã€‘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line">var _Set;</div><div class="line">/* istanbul ignore if */ // $flow-disable-line</div><div class="line">if (typeof Set !== &apos;undefined&apos; &amp;&amp; isNative(Set)) &#123;</div><div class="line">  // use native Set when available.</div><div class="line">  _Set = Set;</div><div class="line">&#125; else &#123;</div><div class="line">  // a non-standard Set polyfill that only works with primitive keys.</div><div class="line">  _Set = /*@__PURE__*/(function () &#123;</div><div class="line">    function Set () &#123;</div><div class="line">      this.set = Object.create(null);</div><div class="line">    &#125;</div><div class="line">    Set.prototype.has = function has (key) &#123;</div><div class="line">      return this.set[key] === true</div><div class="line">    &#125;;</div><div class="line">    Set.prototype.add = function add (key) &#123;</div><div class="line">      this.set[key] = true;</div><div class="line">    &#125;;</div><div class="line">    Set.prototype.clear = function clear () &#123;</div><div class="line">      this.set = Object.create(null);</div><div class="line">    &#125;;</div><div class="line">    return Set;</div><div class="line">  &#125;());</div><div class="line">&#125;</div><div class="line">var Watcher = function Watcher (...args)&#123;</div><div class="line">  this.deps = [];</div><div class="line">  this.newDeps = [];</div><div class="line">  this.depIds = new _Set();</div><div class="line">  this.newDepIds = new _Set();</div><div class="line">&#125;</div><div class="line">Watcher.prototype.get = function get () &#123;</div><div class="line">    pushTarget(this); //å°†å½“å‰WatcheræŒ‚åˆ°ç¬¬ä¸‰æ–¹Dep.targetä¸Š</div><div class="line">    var value;</div><div class="line">    var vm = this.vm;</div><div class="line">    try &#123;</div><div class="line">      //this.getterä¼šæ‰§è¡Œrender,è§¦å‘æ•°æ®çš„getæ–¹æ³•ï¼Œè¿›è¡Œç›¸äº’è®¢é˜…</div><div class="line">      value = this.getter.call(vm, vm); </div><div class="line">    &#125; catch (e) &#123;</div><div class="line">      ...</div><div class="line">    &#125; finally &#123;</div><div class="line">      // &quot;touch&quot; every property so they are all tracked as</div><div class="line">      // dependencies for deep watching</div><div class="line">      if (this.deep) &#123;</div><div class="line">        traverse(value);</div><div class="line">      &#125;</div><div class="line">      popTarget();</div><div class="line">      this.cleanupDeps();</div><div class="line">    &#125;</div><div class="line">    return value</div><div class="line">  &#125;;</div><div class="line">function pushTarget (target) &#123;</div><div class="line">  targetStack.push(target);</div><div class="line">  Dep.target = target;</div><div class="line">&#125;</div><div class="line">//watcherå’Œdepäº’ç›¸å­˜id</div><div class="line">Watcher.prototype.addDep = function addDep (dep) &#123; </div><div class="line">  var id = dep.id;</div><div class="line">  if (!this.newDepIds.has(id)) &#123;</div><div class="line">    this.newDepIds.add(id);</div><div class="line">    this.newDeps.push(dep);</div><div class="line">    if (!this.depIds.has(id)) &#123;</div><div class="line">      dep.addSub(this); //å°†watcheråŠ å…¥åˆ°depçš„subå±æ€§ä¸­</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">Watcher.prototype.update = function update () &#123;</div><div class="line">  /* istanbul ignore else */</div><div class="line">  if (this.lazy) &#123;</div><div class="line">    this.dirty = true;</div><div class="line">  &#125; else if (this.sync) &#123;</div><div class="line">    this.run();</div><div class="line">  &#125; else &#123;</div><div class="line">    queueWatcher(this);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">Watcher.prototype.run = function run () &#123;</div><div class="line">  if (this.active) &#123;</div><div class="line">    var value = this.get(); //é‡æ–°è°ƒç”¨renderå‡½æ•°æ›´æ–°æ•°æ®</div><div class="line">    if (</div><div class="line">      value !== this.value ||</div><div class="line">      //å¯¹äºéœ€è¦æ·±åº¦ç›‘å¬çš„æ•°æ®ç±»å‹ï¼Œå€¼æ²¡æœ‰å˜ï¼Œä¹Ÿè®¸å€¼å†…å®¹å‘ç”Ÿäº†å˜åŒ– </div><div class="line">      isObject(value) ||</div><div class="line">      this.deep</div><div class="line">    ) &#123;</div><div class="line">      var oldValue = this.value;</div><div class="line">      this.value = value;</div><div class="line">      if (this.user) &#123;</div><div class="line">        try &#123;</div><div class="line">          this.cb.call(this.vm, value, oldValue);</div><div class="line">        &#125; catch (e) &#123;</div><div class="line">          handleError(e, this.vm, (&quot;callback for watcher \&quot;&quot; + (this.expression) + &quot;\&quot;&quot;));</div><div class="line">        &#125;</div><div class="line">      &#125; else &#123;</div><div class="line">        this.cb.call(this.vm, value, oldValue);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;vueåŒå‘ç»‘å®šåŸç†ï¼Œä¾èµ–æ”¶é›†æ˜¯&lt;br&gt;åœ¨createdå£°æ˜å‘¨æœŸä¹‹å‰ï¼Œ&lt;br&gt;renderç”Ÿæˆè™šæ‹Ÿdomçš„æ—¶å€™&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ssoå•ç‚¹ç™»å½•å®ç°</title>
    <link href="http://yoohannah.github.io/post/knowledge/sso.html"/>
    <id>http://yoohannah.github.io/post/knowledge/sso.html</id>
    <published>2020-03-25T15:27:15.000Z</published>
    <updated>2020-03-28T07:30:25.100Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å¤šé¡¹ç›®æƒ³è¦å®ç°ç»Ÿä¸€ç™»å½•ï¼Œå³ç™»å½•ä¸€ä¸ªç³»ç»Ÿåï¼Œåœ¨æ‰“å¼€å…¶ä»–ç›¸å…³ç³»ç»Ÿé¡µé¢åï¼Œæ˜¯å·²ç»ç™»å½•çš„çŠ¶æ€ï¼Œä¸å†è¿›è¡Œç™»å½•</p>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>å¤šä¸ªç³»ç»Ÿä½¿ç”¨ç»Ÿä¸€çš„é¡¶çº§åŸŸåï¼Œåˆ©ç”¨cookieçš„domainå±æ€§ï¼Œå°†ç™»å½•åcookieä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œåªè¦æ˜¯è¯¥cookieçš„domainæ‰€åŒ…å«çš„åŸŸåçš„ç«™ç‚¹ï¼Œéƒ½å¯ä»¥æ‹¿åˆ°è¿™ä¸ªcookie</p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>é€‰æ‹©åŸæ¥å¤šä¸ªç«™ç‚¹ä¸­å…¶ä¸­ä¸€ä¸ªç«™ç‚¹çš„ç™»å½•é¡µï¼Œä½œä¸ºå…¬å…±è·³è½¬é¡µ<br>åœ¨ç™»å½•ä¹‹åå°†tokenå¡åˆ°æµè§ˆå™¨ä¸­<br>è¿™é‡Œè®¾ç½®ç»Ÿä¸€tokenåœ¨cookieä¸­çš„keyå€¼ä¸º_a<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">æ ¹æ®è¿è¡Œç¯å¢ƒè®¾ç½®domain,sit,devå‡ä¸ºæµ‹è¯•ç¯å¢ƒ</div><div class="line">function getDomain(name)&#123;</div><div class="line">  let testENVs = [&apos;localhost&apos;,&apos;sit&apos;,&apos;dev&apos;]</div><div class="line">  let testENV = &apos;&apos;</div><div class="line">  testENVs.forEach(env=&gt;&#123;</div><div class="line">    if(location.hostname.includes(env))&#123; //æ ¹æ®åŸŸååˆ¤æ–­ç¯å¢ƒ</div><div class="line">      testENV = env</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  let temp = testENV?testENV +&apos;.xxxx.com&apos;:&apos;xxxx.com&apos;</div><div class="line">  //æœ¬åœ°å¼€å‘ä¸åŠ domain,é»˜è®¤localhost,å¦åˆ™æœ¬åœ°æ²¡åŠæ³•è¿›è¡Œå¼€å‘</div><div class="line">  let domain = testENV === &apos;localhost&apos; ? &apos;&apos;: (name === &apos;_a&apos;? temp:location.hostname)//ä¸ªåˆ«cookieå­—æ®µä»…ç”¨äºæœ¬ç«™ç‚¹ï¼Œæ‰€ä»¥domainè®¾ç½®ä¸ºç«™ç‚¹åŸŸå</div><div class="line">  return domain</div><div class="line">&#125;</div><div class="line">setCookie=(name,value) =&gt; &#123;</div><div class="line">    const Days = 0.5</div><div class="line">    const exp = new Date()</div><div class="line">    exp.setTime(exp.getTime() + Days*24*60*60*1000)</div><div class="line">    let str =  name + &apos;=&apos; + escape(value) + &apos;;expires=&apos; + exp.toGMTString()</div><div class="line">    let domain = getDomain(name)</div><div class="line">    if(domain)&#123;</div><div class="line">      str +=&apos;;domain=&apos; + domain</div><div class="line">    &#125;</div><div class="line">    document.cookie = str</div><div class="line">  &#125;,</div></pre></td></tr></table></figure></p>
<p>ä¹‹æ‰€ä»¥è¦æ ¹æ®ä¸åŒè¿è¡Œç¯å¢ƒè®¾ç½®ä¸åŒdomain,æ˜¯å› ä¸ºè¦åœ¨ä¸åŒæµ‹è¯•ç¯å¢ƒä¹Ÿè¦å®ç°å•ç‚¹ç™»å½•<br>æ¯”å¦‚æµ‹è¯•ç¯å¢ƒåœ¨sitç¯å¢ƒçš„a.sit.xxxx.comå’Œb.sit.xxxx.com<br>a.sit.xxxx.comç™»å½•é¡µä½œä¸ºå…¬å…±ç™»å½•é¡µ<br>åœ¨a.sit.xxxx.comç™»å½•åï¼Œtokençš„cookieä¼šè¢«è®¾ç½®æˆ<br>keyæ˜¯_a,domainæ˜¯sit.xxxx.com(æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨å‰é¢åŠ ä¸€ä¸ªç‚¹)ï¼Œè¿™æ ·æ‰“å¼€b.sit.xxxx.comçš„é¡µé¢ï¼Œæµè§ˆå™¨ä¸­è¿˜ä¼šå­˜åœ¨_aè¿™ä¸ªcookie,b.sit.xxxx.comå°±å¯ä»¥ç›´æ¥æ‹¿è¿™ä¸ªcookieå‘æœåŠ¡å™¨å‘è¯·æ±‚äº†</p>
<p>ä»¥æ­¤ç±»æ¨ï¼Œåœ¨devç¯å¢ƒï¼Œè¿™ä¸¤ä¸ªç«™ç‚¹åŸŸåä¼šå˜æˆ<br>a.dev.xxxx.comå’Œb.dev.xxxx.com<br>_açš„domainä¼šè¢«è®¾ç½®æˆdev.xxxx.com<br>è¿™æ—¶å¦‚æœå»b.dev.xxxx.com,_aæ˜¯ä¼šæœ‰çš„<br>ä½†å»a.sit.xxxx.com,æ˜¯ä¸ä¼šæœ‰çš„ï¼Œå› ä¸º_aæ­¤æ—¶ä»…é™äºdev.xxxx.comåŸŸååŠå…¶å­åŸŸå</p>
<p>ç­‰åˆ°äº†ç”Ÿäº§ç¯å¢ƒï¼ŒäºŒè€…åŸŸåå˜ä¸º<br>a.xxxx.comå’Œb.xxxx.com<br>_açš„domainä¼šè¢«è®¾ç½®æˆxxxx.com<br>æ­¤æ—¶å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚æˆ‘å…ˆç™»å½•äº†çº¿ä¸Šç¯å¢ƒ<br>æœ‰äº†domainä¸ºxxxx.comçš„_a<br>å†å»æµ‹è¯•ç¯å¢ƒç™»å½•ï¼Œæ­¤æ—¶ä¼šåŠ è¿›å»domainä¸ºsit/dev.xxx.comçš„_a<br>ä¸¤ä¸ª_aå¦‚ä½•åŒºåˆ†å“ªä¸ªæ‰æ˜¯å½“å‰ç¯å¢ƒçš„_aï¼Ÿ</p>
<p>é‡åˆ°çš„é—®é¢˜ä¸€ ï¼šæµ‹è¯•ç¯å¢ƒ_aåŠ ä¸è¿›å»ï¼Œå‡ºç°ä¸€é—ªè€Œè¿‡<br>å¼€å§‹ä»¥ä¸ºæ˜¯æµè§ˆå™¨æœºåˆ¶é—®é¢˜ï¼Œåæ¥æ‰å‘ç°ï¼Œæ˜¯ä»£ç é€»è¾‘é—®é¢˜<br>å…¶å®cookieæ˜¯æœ‰å†™è¿›æµè§ˆå™¨çš„ï¼Œè·Ÿcookieæœ¬èº«å¤„ç†æœºåˆ¶æ— å…³ï¼Œå¯ä»¥å†™è¿›å»ï¼Œé—®é¢˜å‡ºåœ¨äº†å–cookie _aå†ç»™åå°å‘è¯·æ±‚çš„æ—¶å€™ï¼Œä»¥å‰æ˜¯ä¿å­˜tokençš„åªæœ‰ä¸€ä¸ªç‰¹æ®Škeyåï¼Œç›´æ¥å–é‚£ä¸ªkeyåå°±è¡Œï¼Œç°åœ¨æœ‰ä¸¤ä¸ª_aï¼Œé€»è¾‘è¿˜æ˜¯æŒ‰ç…§ç¬¬ä¸€ä¸ªæ¥å–ï¼Œç»“æœå–é”™äº†ï¼Œåå°ç»™å‘è¿‡æ¥401ï¼Œå‰ç«¯ä»£ç å¤„ç†httpçŠ¶æ€ç çš„é€»è¾‘åˆæ˜¯401æ¸…cookieè·³ç™»å½•ï¼Œæ‰€ä»¥domainä¸º. sit/dev. xxxx. comçš„cookieå°±åˆæ¶ˆå¤±äº†ğŸ˜…</p>
<p>é‡åˆ°é—®é¢˜äºŒ ï¼šä¸¤ä¸ª_aå¦‚ä½•åŒºåˆ†å“ªä¸ªæ‰æ˜¯å½“å‰ç¯å¢ƒçš„_aï¼Ÿ<br>å› ä¸ºåå°å®ç°åˆ†å±‚ï¼Œä¸å‰ç«¯ç›´æ¥å¯¹æ¥çš„åå°ï¼Œæ— æ³•è®¿é—®åå°çš„ç”¨æˆ·cookieè¡¨ï¼Œèƒ½æ‹¿åˆ°cookieè¡¨çš„åå°ç«™åœ¨å¤§å±€è§’åº¦çœ‹é—®é¢˜ï¼Œè¿™ä¸ªé€»è¾‘åˆè§‰å¾—ä¸æ˜¯æœ‰å¿…è¦åŠ çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¦æ±‚åå°æ‹¿åˆ°æŠ¥æ–‡ä¸­cookieåå»è¡¨é‡Œé¢åšåˆ¤æ–­<br>æ‰€ä»¥ç”±å‰ç«¯é€šè¿‡è¯»å–document.cookie,æ•´ç†æ‹¿åˆ°ä¸¤ä¸ª_aåï¼Œä¾æ¬¡ç”¨æ¯ä¸ª_aå»ç»™åå°å‘è¯·æ±‚ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œè¯´æ˜å½“å‰_aæ˜¯æ­£ç¡®çš„ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ª_aå»å‘çœŸæ­£çš„è¯·æ±‚ï¼ŒåŒæ—¶è®°å½•ä¸‹è¿™ä¸ª_a,é¿å…ä¹‹åçš„é‡å¤æ¢æµ‹</p>
<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>1.ç¢°åˆ°é—®é¢˜ä¸€æ—¶ï¼Œå¾ˆæ— å˜å¤´ï¼Œä½†åˆ†æå‡ºåŸå› åï¼Œè®©äººæ„Ÿè§‰å¾ˆæ— è¯­ï¼Œæ­£ç¡®çš„è¯´æ˜¯ï¼Œè®©äººå¾ˆæ²¡é¢å­ï¼Œé‡åˆ°é—®é¢˜åº”è¯¥å–„äºåˆ†æï¼Œæˆ’éª„æˆ’èº<br>2.é—®é¢˜äºŒï¼Œæœ‰æ—¶å€™ï¼Œä½ è®¤ä¸ºå¾ˆæ¶å¿ƒçš„åšæ³•ï¼Œæ°å·§å¯èƒ½ä¼šè¢«é‡‡çº³</p>
<h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>å‘ç‰ˆåˆ°çº¿ä¸Šåï¼Œå‘ç°éƒ¨åˆ†åŒäº‹ç™»é™†æˆåŠŸååˆè·³å›ç™»å½•é¡µé¢ï¼Œä¸­é—´å‘èµ·çš„è¯·æ±‚æŠ¥401</p>
<p>ç»è¿‡æŸ¥çœ‹åŒäº‹æµè§ˆå™¨çš„cookieå‘ç°,å­˜åœ¨è®¾ç½®äº†httponlyçš„_aï¼Œå³æˆ‘ä»¬æ‰€æœ‰ç³»ç»Ÿç»Ÿä¸€ä½¿ç”¨çš„tokenæ ‡è¯†ï¼Œ<br>cookieè®¾ç½®äº†httponlyæ„å‘³ç€jsæ²¡æœ‰æƒé™è¿›è¡Œè·å–æ›´æ”¹ç”šè‡³ä¸èƒ½åˆ é™¤ï¼Œæ‰€ä»¥æ–°ç™»å½•çš„tokenæ˜¯æ²¡æœ‰å†™è¿›å»çš„ï¼Œæ‹¿åˆ°çš„tokenä¹Ÿå°±æ˜¯é”™çš„<br>è§£å†³åŠæ³•å°±æ˜¯è®©åå°åŒäº‹å¼ºåˆ¶å†™ä¸€ä¸ªæ²¡æœ‰httponlyçš„_aè¿›å»ï¼Œè®©åå°è¦†ç›–åå°ï¼Œ<br>è¯´æ˜æµè§ˆå™¨ä¼˜å…ˆçº§æ˜¯å…ˆå¤„ç†set-cookieçš„cookieé€»è¾‘ï¼Œå†çœ‹æ˜¯å¦æœ‰httponly,å†³å®šjsæ˜¯å¦æœ‰æƒé™å¤„ç†cookie</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å¤šé¡¹ç›®æƒ³è¦å®ç°ç»Ÿä¸€ç™»å½•ï¼Œå³ç™»å½•ä¸€ä¸ªç³»ç»Ÿåï¼Œåœ¨æ‰“å¼€å…¶ä»–ç›¸å…³ç³»ç»Ÿé¡µé¢åï¼Œæ˜¯å·²ç»ç™»å½•çš„çŠ¶æ€ï¼Œä¸å†è¿›è¡Œç™»å½•&lt;/p&gt;
&lt;h1 id=&quot;åŸç†&quot;&gt;&lt;a h
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨vuepressæ„å»ºæ–‡æ¡£ç³»ç»Ÿ</title>
    <link href="http://yoohannah.github.io/post/vue/vuepress.html"/>
    <id>http://yoohannah.github.io/post/vue/vuepress.html</id>
    <published>2020-03-24T05:18:15.000Z</published>
    <updated>2020-03-25T15:29:22.183Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é¢å‘æ™®é€šç”¨æˆ·çš„åº”ç”¨ç³»ç»Ÿï¼ŒåŒ…å«å¾ˆå¤šäº§å“çš„ä½¿ç”¨è¯´æ˜ï¼Œå±äºé™æ€é¡µé¢<br>ä¸€æ–¹é¢å æ®æ•´ä½“é¡¹ç›®çš„ä½“ç§¯ï¼Œæ‰“åŒ…æ—¶é—´ç”¨æ—¶é•¿ï¼Œæ‰“åŒ…ç»“æœä½“ç§¯å¤§<br>å¦ä¸€æ–¹é¢ï¼Œä¸æ–­æ–°å¢çš„ä¸åŒäº§å“çš„ä½¿ç”¨è¯´æ˜ï¼Œå¯¹äºå‰ç«¯å¼€å‘äººå‘˜æ¥è¯´ï¼Œ<br>ç›¸å¯¹å¼€å‘çœŸæ­£çš„äº§å“åŠŸèƒ½æ¥è¯´ä¼˜å…ˆçº§è¾ƒä½ï¼Œä¸”å ç”¨å¼€å‘æ—¶é—´</p>
<p>æ‰€ä»¥å¸Œæœ›å°†äº§å“ä½¿ç”¨è¯´æ˜ä¸å½“å‰é¡¹ç›®éš”ç¦»ï¼Œå»ºç«‹é™æ€ç½‘ç«™ï¼Œå­˜æ”¾ä½¿ç”¨è¯´æ˜<br>å†ç”±åŸç³»ç»Ÿè¿›è¡Œè·³è½¬<br>å°†æ–°å¢ä½¿ç”¨è¯´æ˜çš„ä»»åŠ¡äº¤ç”±ç›¸å…³äº§å“è´Ÿè´£äººç­‰éå¼€å‘äººå‘˜è¿›è¡Œæ–°å¢</p>
<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>1.å¯¹äºéå¼€å‘äººå‘˜æ¥è¯´ï¼Œé€‰æ‹©ä½•ç§æ–‡æ¡£æ ¼å¼ï¼Œå¯ä»¥æ—¢æ–¹ä¾¿ç¼–å†™ï¼Œåˆå¯ä»¥è½»æ¾è½¬æˆhtml<br>2.åŸæœ‰ç³»ç»Ÿç”¨vueç¼–å†™çš„æ‰¹é‡æ–‡ä»¶å¦‚ä½•è¿ç§»åˆ°æ–°çš„é™æ€ç½‘ç«™</p>
<h1 id="çŸ¥è¯†"><a href="#çŸ¥è¯†" class="headerlink" title="çŸ¥è¯†"></a>çŸ¥è¯†</h1><h2 id="vuepress"><a href="#vuepress" class="headerlink" title="vuepress"></a>vuepress</h2><p>vuepressæ˜¯ä¸€æ¬¾ä½¿ç”¨vueé©±åŠ¨çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨<br>ç”¨æˆ·å¯ä»¥ä½¿ç”¨markdownæ ¼å¼æ–‡ä»¶ç¼–è¾‘æ–‡æœ¬ï¼Œç„¶åè½¬ä¹‰æˆhtml<br>å¦å¤–é¡µé¢ä¸­åŠŸèƒ½è¿˜å¯ä»¥ä½¿ç”¨vueè¿›è¡ŒåµŒå…¥</p>
<h2 id="æ‰¹é‡è¿ç§»"><a href="#æ‰¹é‡è¿ç§»" class="headerlink" title="æ‰¹é‡è¿ç§»"></a>æ‰¹é‡è¿ç§»</h2><p>åŸç³»ç»Ÿvueç¼–å†™çš„æ‰¹é‡é¡µé¢å«æœ‰vueè¯­æ³•ï¼Œä¸èƒ½ç›´æ¥è¿ç§»<br>æ‰€ä»¥éœ€è¦å°†ç”Ÿæˆå¥½çš„htmlçˆ¬ä¸‹æ¥è½¬æˆmdæ–‡ä»¶ï¼Œåº”ç”¨åˆ°æ–°ç³»ç»Ÿ<br>â€˜html-to-mdâ€™çš„npm åŒ…å¯ä»¥å¸®åŠ©å°†htmlè½¬æ¢æˆmd</p>
<h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><h2 id="vuepressæ­å»º"><a href="#vuepressæ­å»º" class="headerlink" title="vuepressæ­å»º"></a>vuepressæ­å»º</h2><p>å› ä¸ºè¦ä¸åŸç³»ç»Ÿä¸»é¢˜é£æ ¼æ ·å¼ç±»ä¼¼ï¼Œæ•…éœ€è¦åœ¨åŸæ¥ä¸»é¢˜ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹<br>å®‰è£…å¥½vuepressåŒ…ä¹‹å<br>å°†åŒ…é‡Œé¢çš„é»˜è®¤ä¸»é¢˜@vuepress/theme-defaultå¤åˆ¶ç²˜è´´åˆ°doc/.vuepress/themeæ–‡ä»¶å¤¹ä¸‹é¢<br>ä¿®æ”¹é‡Œé¢çš„ä»£ç å°±å¯ä»¥ç›´æ¥åº”ç”¨äº†</p>
<h3 id="é…ç½®config-jsæ–‡ä»¶"><a href="#é…ç½®config-jsæ–‡ä»¶" class="headerlink" title="é…ç½®config.jsæ–‡ä»¶"></a>é…ç½®config.jsæ–‡ä»¶</h3><p>åœ¨.vuepressæ–‡ä»¶å¤¹ä¸‹æ–°å¢config.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">title:æ ‡ç­¾é¡µåç§°</div><div class="line">head:åœ¨é¡µé¢å¤´éƒ¨å¼•å…¥çš„æ–‡ä»¶</div><div class="line">base:å½“ä¸åœ¨åŸŸåæ ¹ç›®å½•ä¸‹éƒ¨ç½²æ—¶ï¼Œé…ç½®éƒ¨ç½²è·¯å¾„</div><div class="line">themeConfig:&#123; ä¸»é¢˜é…ç½®</div><div class="line">  logoï¼šæ ‡é¢˜æ å·¦ä¸Šè§’logo</div><div class="line">  nav:å³ä¸Šè§’æœç´¢åé¢çš„æŒ‰é’®</div><div class="line">  sidebar:å·¦ä¾§ä¾§è¾¹æ </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="enhanceApp-js"><a href="#enhanceApp-js" class="headerlink" title="enhanceApp.js"></a>enhanceApp.js</h3><p>åœ¨.vuepressæ–‡ä»¶å¤¹ä¸‹æ–°å¢enhanceApp.js<br>è¯¥æ–‡ä»¶ï¼Œå¯ä»¥æ·»åŠ å¯¹é¡¹ç›®çš„é¢å¤–å¤„ç†<br>æ¯”å¦‚å½“å‰é¡¹ç›®å³ä¸Šè§’ä¸‰ä¸ªæŒ‰é’®æ ¹æ®æƒé™æ˜¾ç¤º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">export default (&#123;</div><div class="line">  Vue, // VUEæ„é€ å‡½æ•°å¯¹è±¡</div><div class="line">  options, // vueå®ä¾‹é€‰é¡¹</div><div class="line">  router, // è·¯ç”±å¯¹è±¡</div><div class="line">  siteData//é…ç½®çš„æ•°æ®</div><div class="line">&#125;) =&gt; &#123;</div><div class="line">  async function getAuthorization()&#123;</div><div class="line">    if(location.hostname.includes(&apos;localhost&apos;))&#123;</div><div class="line">      return true</div><div class="line">    &#125;</div><div class="line">    let cookie_str = document.cookie</div><div class="line">    let cookie_parts = cookie_str.split(&apos;;&apos;)</div><div class="line">    let auths = []</div><div class="line">    cookie_parts.forEach(c=&gt;&#123;</div><div class="line">      if (c)&#123;</div><div class="line">        let kv = c.split(&apos;=&apos;)</div><div class="line">        let k = kv[0].trim()</div><div class="line">        let v = kv[1].trim()</div><div class="line">        if (k == &apos;_a&apos;)&#123;</div><div class="line">          auths.push(v)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    if(auths.length&lt;1)&#123;</div><div class="line">      return false</div><div class="line">    &#125;</div><div class="line">    for (var c of auths)&#123;</div><div class="line">      try &#123;</div><div class="line">        let response = await axios.get(location.origin + &apos;/api/v1/edit-user&apos;, &#123;headers: &#123;&apos;X-Auth-Token&apos;: c&#125;&#125;)</div><div class="line">        if(response.status &lt; 400)&#123;</div><div class="line">          return true</div><div class="line">        &#125;</div><div class="line">      &#125; catch (err) &#123;</div><div class="line">        console.log(err)</div><div class="line">        return false</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  getAuthorization().then(flag=&gt;&#123;</div><div class="line">    let divs = document.getElementsByClassName(&apos;nav-item&apos;)</div><div class="line">    if(flag)&#123;</div><div class="line">      divs[1].style.display = &apos;none&apos;</div><div class="line">      divs[2].style.display = &apos;none&apos;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="æ›´æ”¹é¡µé¢å‘ˆç°æ ·å¼"><a href="#æ›´æ”¹é¡µé¢å‘ˆç°æ ·å¼" class="headerlink" title="æ›´æ”¹é¡µé¢å‘ˆç°æ ·å¼"></a>æ›´æ”¹é¡µé¢å‘ˆç°æ ·å¼</h3><p>å¢åŠ æ‚¬æµ®é”šç‚¹å®šä½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line">page.vue</div><div class="line">&lt;template&gt;</div><div class="line">  &lt;main class=&quot;page&quot;&gt;</div><div class="line">    &lt;div v-show=&quot;$page.headers &amp;&amp; isShowAncher &amp;&amp; $page.frontmatter.ancherShow&quot; class=&apos;ancherSection&apos;&gt;</div><div class="line">      &lt;template v-for=&quot;(item,i) in headers&quot;&gt;</div><div class="line">        &lt;div :key=&quot;i&quot;&gt;</div><div class="line">          &lt;a  @click=&quot;gotoAncher(item.slug)&quot;&gt;&#123;&#123;item.title&#125;&#125;&lt;/a&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/template&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;slot name=&quot;top&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Content class=&quot;theme-default-content&quot; /&gt;</div><div class="line">    &lt;PageEdit /&gt;</div><div class="line"></div><div class="line">    &lt;PageNav v-bind=&quot;&#123; sidebarItems &#125;&quot; /&gt;</div><div class="line">  </div><div class="line">    &lt;slot name=&quot;bottom&quot; /&gt;</div><div class="line">  &lt;/main&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">export default &#123;</div><div class="line">  components: &#123; PageEdit, PageNav&#125;,</div><div class="line">  props: [&apos;sidebarItems&apos;],</div><div class="line">  data () &#123;</div><div class="line">    return &#123;</div><div class="line">      isShowAncher: false, //æ»šåŠ¨è¿‡ç¨‹æ§åˆ¶æ‚¬æµ®é”šç‚¹</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  computed:&#123;</div><div class="line">    headers:function()&#123;//è®¡ç®—é”šç‚¹å†…å®¹</div><div class="line">      let ancherLevel = this.$page.frontmatter.ancherLevel </div><div class="line">      let sidebarDepth = this.$page.frontmatter.sidebarDepth?this.$page.frontmatter.sidebarDepth:this.$themeConfig.sidebarDepth</div><div class="line">      let levelStr = ancherLevel?ancherLevel:(sidebarDepth&gt;1?&apos;h2,h3&apos;:&apos;h2&apos;)</div><div class="line">      if(ancherLevel &amp;&amp; !(/^(h2|h3|h2\,\s*\h3)$/ig.test(ancherLevel.trim())))&#123;</div><div class="line">        return []</div><div class="line">      &#125;</div><div class="line">      if(levelStr.includes(&apos;,&apos;))&#123;</div><div class="line">        return this.$page.headers &amp;&amp; groupHeaders(this.$page.headers).length&gt;0?this.$page.headers:[]</div><div class="line">      &#125;else&#123;</div><div class="line">        let level = +levelStr[1]</div><div class="line">        return this.$page.headers.filter(h =&gt; h.level === level)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  updated()&#123;</div><div class="line">    this.setPictureZoom()</div><div class="line">  &#125;,</div><div class="line">  mounted () &#123;</div><div class="line">    let  handleScroll= ()=&gt;&#123;</div><div class="line">      let scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop // æ»šåŠ¨æ¡åç§»é‡</div><div class="line">      this.isShowAncher = !!scrollTop</div><div class="line">    &#125;</div><div class="line">    window.addEventListener(&apos;scroll&apos;,handleScroll,false)</div><div class="line">    this.setPictureZoom()</div><div class="line">  &#125;,</div><div class="line">  methods:&#123;</div><div class="line">    //é”šç‚¹å®šä½</div><div class="line">    gotoAncher(ancher)&#123;</div><div class="line">      let el = document.getElementById(ancher)</div><div class="line">      let anchersHeight = document.getElementsByClassName(&apos;ancherSection&apos;)[0].clientHeight</div><div class="line">      window.scrollTo(&#123; </div><div class="line">          top: el.offsetTop-anchersHeight, </div><div class="line">          behavior: &quot;smooth&quot; </div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    //æ·»åŠ å›¾ç‰‡æ”¾å¤§åŠŸèƒ½</div><div class="line">    setPictureZoom () &#123;</div><div class="line">      let img = document.querySelectorAll(&apos;p &gt; img&apos;)</div><div class="line">        for (let i = 0; i &lt; img.length; i++) &#123;</div><div class="line">            if (img[i]) &#123;</div><div class="line">                let a = document.createElement(&quot;a&quot;);</div><div class="line">                let parent = img[i].parentNode</div><div class="line">                parent.appendChild(a)</div><div class="line">                let src = img[i].getAttribute(&apos;src&apos;)</div><div class="line">                a.setAttribute(&apos;data-fancybox&apos;, &apos;&apos;)</div><div class="line">                a.setAttribute(&apos;href&apos;, src)</div><div class="line">                a.appendChild(img[i])</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&lt;/script&gt;</div><div class="line"></div><div class="line">&lt;style lang=&quot;stylus&quot;&gt;</div><div class="line">@require &apos;../styles/wrapper.styl&apos;</div><div class="line">.page</div><div class="line">  padding-bottom 2rem</div><div class="line">  display block</div><div class="line">.ancherSection</div><div class="line">  position: fixed</div><div class="line">  background-color: white</div><div class="line">  box-shadow: rgb(234, 229, 229) 0px 1px 2px;</div><div class="line">  top: 64px</div><div class="line">  min-height: 42px</div><div class="line">  width: calc(100% - 320px);</div><div class="line">  display flex</div><div class="line">  align-items center</div><div class="line">  justify-content left</div><div class="line">  flex-wrap: wrap;</div><div class="line">  padding: 10px 0px 0px;</div><div class="line">  z-index:2</div><div class="line">  div</div><div class="line">    margin-left 20px</div><div class="line">    margin-bottom: 10px;</div><div class="line">    a</div><div class="line">      color black</div><div class="line">      cursor pointer</div><div class="line"></div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure></p>
<h3 id="æ›´æ¢å›¾æ ‡"><a href="#æ›´æ¢å›¾æ ‡" class="headerlink" title="æ›´æ¢å›¾æ ‡"></a>æ›´æ¢å›¾æ ‡</h3><p>åœ¨sidebarGroup.vueæ–‡ä»¶åŒçº§åˆ«æ–°å¢arrow.svgå›¾ç‰‡ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯æ’å…¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;img src=&apos;./arrow.svg&apos; v-if=&quot;collapsable&quot; :class=&quot;open ? &apos;down&apos; : &apos;&apos;&quot; style=&apos;width:20px&apos; /&gt;</div></pre></td></tr></table></figure></p>
<h2 id="æ‰¹é‡è¿ç§»-1"><a href="#æ‰¹é‡è¿ç§»-1" class="headerlink" title="æ‰¹é‡è¿ç§»"></a>æ‰¹é‡è¿ç§»</h2><h3 id="ç›®å½•æ”¹é€ "><a href="#ç›®å½•æ”¹é€ " class="headerlink" title="ç›®å½•æ”¹é€ "></a>ç›®å½•æ”¹é€ </h3><p>åŸæœ‰ç³»ç»Ÿé¡µé¢å›¾ç‰‡æŒ‰ç…§äº§å“åå‘½åæ–‡ä»¶å¤¹ï¼Œæ•…å…ˆå°†æ•´ä½“æ–‡ä»¶ç»“æ„è¿›è¡Œæ”¹é€ <br>åŸæ¥ç›®å½•ç»“æ„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">--content</div><div class="line">  --a</div><div class="line">    --a1.png</div><div class="line">    --a2.png</div><div class="line">    ......çœç•¥è‹¥å¹²</div><div class="line">    --a13.png</div><div class="line">  --b</div><div class="line">    --b1.png</div><div class="line">    --b2.png</div><div class="line">    ......çœç•¥è‹¥å¹²</div><div class="line">    --b13.png</div></pre></td></tr></table></figure></p>
<p>æ”¹é€ æˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">--content</div><div class="line">  --a</div><div class="line">    --images</div><div class="line">        --a1.png</div><div class="line">        --a2.png</div><div class="line">        ......çœç•¥è‹¥å¹²</div><div class="line">        --a13.png</div><div class="line">  --b</div><div class="line">    --images</div><div class="line">      --b1.png</div><div class="line">      --b2.png</div><div class="line">      ......çœç•¥è‹¥å¹²</div><div class="line">      --b13.png</div></pre></td></tr></table></figure></p>
<p>å°±æ˜¯åœ¨å½“å‰çˆ¶æ–‡ä»¶å¤¹ä¸‹æ–°å¢imagesæ–‡ä»¶å¤¹ï¼Œç„¶åæŠŠå›¾ç‰‡ç§»è¿›å»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;);//å¼•ç”¨æ–‡ä»¶ç³»ç»Ÿæ¨¡å—</div><div class="line">function readFileList(path, filesList) &#123;</div><div class="line">  var files = fs.readdirSync(path);</div><div class="line">  files.forEach(function (itm) &#123;</div><div class="line">    var obj = &#123;&#125;;//å®šä¹‰ä¸€ä¸ªå¯¹è±¡å­˜æ”¾æ–‡ä»¶çš„è·¯å¾„å’Œåå­—</div><div class="line">    obj.path = path;//è·¯å¾„</div><div class="line">    obj.filename = itm//åå­—</div><div class="line">    filesList.push(obj);</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line">var getFiles = &#123;</div><div class="line">  //è·å–æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</div><div class="line">  getFileList: function (path) &#123;</div><div class="line">      var filesList = [];</div><div class="line">      readFileList(path, filesList);</div><div class="line">      return filesList;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">let files = getFiles.getFileList(&quot;./content/&quot;)  //æ‹¿åˆ°a,bè¿™ä¸€çº§åˆ«æ–‡ä»¶</div><div class="line">for(let i=0;i&lt;files.length;i++)&#123;</div><div class="line">  let filepath = files[i].path+files[i].filename+&apos;/&apos; //æ‹¼æ¥a,bè·¯å¾„</div><div class="line">  let images = getFiles.getFileList(filepath)  //æ‹¿åˆ°a,bä¸‹ä¸€çº§çš„æ–‡ä»¶ï¼Œå³æ‰€æœ‰å›¾ç‰‡</div><div class="line">  let imgpath = filepath+&apos;images&apos;</div><div class="line">  fs.mkdirSync(imgpath);//æ–°å»ºæ–‡ä»¶å¤¹</div><div class="line">  for(let j = 0;j&lt;images.length;j++)&#123; //å°†å›¾ç‰‡ç§»åˆ°æ–°æ–‡ä»¶å¤¹ä¸­</div><div class="line">    let oldpath = images[j].path+images[j].filename</div><div class="line">    let newpath = imgpath+&apos;/&apos;+images[j].filename</div><div class="line">    fs.rename(oldpath,newpath,function(err)&#123;</div><div class="line">      console.log(err)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="è½¬ä¹‰æ–‡ä»¶"><a href="#è½¬ä¹‰æ–‡ä»¶" class="headerlink" title="è½¬ä¹‰æ–‡ä»¶"></a>è½¬ä¹‰æ–‡ä»¶</h3><p>å› ä¸ºåŸé¡¹ç›®ä¸ºå•é¡µé¢æ–‡ä»¶ï¼Œæ— æ³•è¿›è¡Œçˆ¬è™«æ‰¹é‡è·å–<br>æœ€ç»ˆå®ç°ä¹Ÿè¿˜æ˜¯æ‰‹åŠ¨copyé¡µé¢ä¸­dom,ä¸€ä¸ªé¡µé¢ä¸€ä¸ªé¡µé¢çš„copy<br>ç„¶åå¤„ç†</p>
<p>å®‰è£…è½¬ä¹‰åŒ…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install html-to-md</div></pre></td></tr></table></figure></p>
<p>å¼€å§‹ä½¿ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">const html2md=require(&apos;html-to-md&apos;)</div><div class="line">const fs = require(&apos;fs&apos;);</div><div class="line">//åœ¨é¡µé¢ä¸­æ‰¾åˆ°ä½¿ç”¨è¯´æ˜çš„dom,copyä¹‹åå­˜æ”¾åˆ°temp.txtä¸­</div><div class="line">//å½“åšå­—ç¬¦ä¸²è¢«è¯»å–</div><div class="line">var contentText = fs.readFileSync(&apos;temp.txt&apos;,&apos;utf-8&apos;);</div><div class="line">let res = html2md(contentText)</div><div class="line">//åŒ¹é…mdçš„â€˜[]()â€™ä¹¦å†™å½¢å¼</div><div class="line">let reg1=/\[([\S ]*?)]\s?()\( *&lt;?([^\s&apos;&quot;]*?(?:\([\S]*?\)[\S]*?)?)&gt;?\s*(?:()([&apos;&quot;])(.*?)\5)? *\)/g</div><div class="line">//åŒ¹é…mdçš„â€˜![]()â€™ä¹¦å†™å½¢å¼</div><div class="line">let reg2 = /!\[([^\]]*?)][ \t]*()\([ \t]?&lt;?([\S]+?(?:\([\S]*?\)[\S]*?)?)&gt;?(?: =([*\d]+[A-Za-z%]&#123;0,4&#125;)x([*\d]+[A-Za-z%]&#123;0,4&#125;))?[ \t]*(?:([&quot;&apos;])([^&quot;]*?)\6)?[ \t]?\)/g</div><div class="line">//åœ¨æ¯ç¯‡å¼€å¤´æ³¨å…¥è½¬ä¹‰è§„åˆ™front matter</div><div class="line">res = &apos;---\nsidebarDepth: 2 \nancherShow: true \nancherLevel: h3 \n--- \n&apos; + res.replace(reg1,function(group,text)&#123; //html-to-mdåŒ…è½¬ä¹‰ç»“æœå°†æ ‡é¢˜è½¬ç§»æˆæ²¡æœ‰è¿æ¥ä½†æœ‰è¿æ¥åçš„ä¹¦å†™å½¢å¼[xxx](),æ‰€ä»¥è¿™é‡Œå°†å…¶æ›¿æ¢æˆ mdå†™æ³•</div><div class="line">  return text?&apos;## &apos;+text:group</div><div class="line">&#125;).replace(reg2,function(...res)&#123; //å°†å›¾ç‰‡å¼•ç”¨è·¯å¾„åšç»Ÿä¸€å¤„ç†</div><div class="line">  let arr =  res[3].slice(res[3].lastIndexOf(&apos;/&apos;)+1).split(&apos;.&apos;)</div><div class="line">  return &apos;![](./images/&apos;+arr[0]+&apos;.&apos;+arr[2]+&apos;)&apos;</div><div class="line">&#125;)</div><div class="line">//å°†å¤„ç†åçš„æ–‡ä»¶å†™å…¥ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸­çš„manual.mdæ–‡ä»¶ä¸­ï¼Œå³ç”Ÿæˆmdæ–‡ä»¶</div><div class="line">fs.writeFile(&quot;./content/xxxx/manual.md&quot;, res, function(err) &#123; </div><div class="line">  if(err) &#123;</div><div class="line">      return console.log(err);</div><div class="line">  &#125;</div><div class="line">  console.log(&quot;The file was saved!&quot;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥æœ€ç»ˆæ–‡ä»¶å¤¹ç›®å½•ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">--content</div><div class="line">  --a</div><div class="line">    --images</div><div class="line">    --manual.md</div><div class="line">  --b</div><div class="line">    --images</div><div class="line">    --manual.md</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨å°†contentç›®å½•ä¸‹æ–‡ä»¶å…¨éƒ½ç²˜è´´åˆ°docsæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œä¸.vuepreså¹³çº§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">--docs</div><div class="line">  --.vuepress</div><div class="line">  --a</div><div class="line">    --images</div><div class="line">    --manual.md</div><div class="line">  --b</div><div class="line">    --images</div><div class="line">    --manual.md</div></pre></td></tr></table></figure></p>
<p>å°±å¯ä»¥åœ¨.vuepressæ–‡ä»¶å¤¹ä¸‹é¢çš„config.jsä¸­é…ç½®sidebaräº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> sidebar: [</div><div class="line">      &#123;</div><div class="line">        title: &apos;äº§å“a&apos;,</div><div class="line">        collapsable: true,</div><div class="line">        children:[</div><div class="line">            [&apos;/a/manual.md&apos;, &apos;aæ“ä½œæ‰‹å†Œ&apos;],</div><div class="line">          ]</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>1.å¦‚ä½•å°†å…¬å…±å¼€æºçš„é¡¹ç›®æ›´å¥‘åˆçš„åº”ç”¨åˆ°å…¬å¸çº§é¡¹ç›®ï¼Œå¯¹åŸé¡¹ç›®çš„ç ´åæ˜¯é¿å…ä¸äº†çš„ï¼Œæ¯”å¦‚æ›¿æ¢ä¸»é¢˜é¢œè‰²ï¼Œæ›¿æ¢ç›¸å…³å›¾æ ‡ï¼Œä»¥åŠä¸ºäº†æ–°å¢ä¸€äº›åŸæ¥é¡¹ç›®ä¸­æ²¡æœ‰çš„åŠŸèƒ½ï¼Œè€Œå»æ›´æ”¹åŸæœ‰å¤„ç†é€»è¾‘ï¼Œæ‰€è°“äºŒæ¬¡å¼€å‘ï¼Œå®è´¨ä¸Šï¼Œå¯èƒ½åº”è¯¥å«ç ´åæ€§å¼€å‘ï¼Œä¸éµå¾ªåŸæ¥çš„ä½¿ç”¨è§„åˆ™ï¼Œåœ¨åŸæ¥åŸºç¡€ä¸Šï¼Œé€ è‡ªå·±çš„è§„åˆ™</p>
<p>2.å¯¹äºå¤§æ‰¹é‡é‡å¤æ€§å·¥ä½œçš„å¤„ç†ï¼Œè¦å­¦ä¼šä½¿ç”¨å·¥å…·ï¼Œ<br>æ¯”å¦‚å±€éƒ¨å¤§é‡æ›¿æ¢ï¼Œå€ŸåŠ©vscodeçš„å±€éƒ¨é”å®šï¼ˆå…ˆé€‰å–èŒƒå›´å†ç‚¹å‡»ä¸‹å›¾1ï¼Œé”å®šæŒ‰é’®ï¼‰<br>å†æ¯”å¦‚è§„åˆ™ç±»ä¼¼çš„æ›¿æ¢ï¼Œåˆè¦å–„äºåˆ©ç”¨vscodeçš„æ­£åˆ™åŒ¹é…å»æ›¿æ¢ï¼Œå¦‚ä¸‹å›¾2<br><img src="/image/vscode.png" alt="vscode"><br>å¦‚æœå±äºå¤§è§„æ¨¡å¤„ç†ï¼Œè¿˜è¦å­¦ä¼šè‡ªå·±é€ å·¥å…·<br>æ¯”å¦‚ä¸Šè¿°æ‰¹é‡å¤„ç†ç›®å½•ç»“æ„ï¼Œæ”¹é€ mdæ–‡ä»¶<br>äººä¹‹æ‰€ä»¥ä¸ºäººï¼Œå­¦ä¼šä½¿ç”¨å·¥å…·æ‰èƒ½ç®—æ˜¯è¿›å…¥äº†æ–‡æ˜ç¤¾ä¼š</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;é¢å‘æ™®é€šç”¨æˆ·çš„åº”ç”¨ç³»ç»Ÿï¼ŒåŒ…å«å¾ˆå¤šäº§å“çš„ä½¿ç”¨è¯´æ˜ï¼Œå±äºé™æ€é¡µé¢&lt;br&gt;ä¸€æ–¹é¢å æ®æ•´ä½“é¡¹ç›®çš„ä½“ç§¯ï¼Œæ‰“åŒ…æ—¶é—´ç”¨æ—¶é•¿ï¼Œæ‰“åŒ…ç»“æœä½“ç§¯å¤§&lt;br&gt;å¦ä¸€æ–¹é¢
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªå‘ç‰ˆé—®é¢˜</title>
    <link href="http://yoohannah.github.io/post/knowledge/editionproblem.html"/>
    <id>http://yoohannah.github.io/post/knowledge/editionproblem.html</id>
    <published>2020-02-19T08:17:37.000Z</published>
    <updated>2020-03-01T08:25:11.717Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>ç”¨æˆ·æ­£åœ¨ä½¿ç”¨æŸä¸ªé¡µé¢æœŸé—´ï¼Œåå°å‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œç”¨æˆ·å†åˆ‡æ¢å…¶ä»–é¡µé¢ï¼Œ<br>æµè§ˆå™¨ä¼šæŠ¥ä¸€ä¸ªèµ„æºæ‰¾ä¸åˆ°çš„error,å¯¼è‡´é¡µé¢å´©æºƒ</p>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>æœ€ç»ˆå‘å¸ƒçš„ç‰ˆæœ¬ä¼šç»è¿‡æ‰“åŒ…å¤„ç†ï¼Œæ¯æ¬¡æ‰“åŒ…çš„äº§ç‰©ï¼Œæ–‡ä»¶åä¼šä¸åŒ<br>æ–°å‘å¸ƒçš„ç‰ˆæœ¬æ˜¯æœ€æ–°æ‰“åŒ…çš„ç»“æœï¼Œä¸Šä¸ªç‰ˆæœ¬å‘å¸ƒçš„æ˜¯ä¸Šæ¬¡å‘ç‰ˆå‰çš„ç»“æœ<br>åå°å‘å¸ƒåˆ°æœåŠ¡å™¨çš„é¡¹ç›®æ–°ç‰ˆæœ¬ä¸å†åŒ…å«ä¸Šä¸ªç‰ˆæœ¬å‘å¸ƒçš„æ–‡ä»¶<br>å³æœåŠ¡å™¨ä»…æœ‰æ–°ç‰ˆæœ¬çš„æ–‡ä»¶<br>å¦‚æœè§¦å‘åˆ‡æ¢é¡µé¢ï¼Œæ­¤æ—¶æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ä¸Šä¸ªç‰ˆæœ¬çš„æ–‡ä»¶<br>æœåŠ¡å™¨ä»…æœ‰æœ€æ–°ç‰ˆæœ¬æ–‡ä»¶ï¼Œä¸å†åŒ…å«ä¸Šä¸ªç‰ˆæœ¬æ–‡ä»¶<br>æ•…è¿”å›404ï¼Œæµè§ˆå™¨å´©æºƒ</p>
<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä½¿ç”¨vueæ¡†æ¶ç¼–å†™é¡¹ç›®ï¼Œä½¿ç”¨vue-routerè¿›è¡Œè·¯ç”±åˆ‡æ¢</p>
<h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><h2 id="åˆ©ç”¨è·¯ç”±"><a href="#åˆ©ç”¨è·¯ç”±" class="headerlink" title="åˆ©ç”¨è·¯ç”±"></a>åˆ©ç”¨è·¯ç”±</h2><p>åœ¨è·¯ç”±ç”Ÿå‘½é’©å­å‡½æ•°ä¸­æ·»åŠ onerrorçš„å¤„ç†ï¼Œ<br>è®©å½“å‰é¡µé¢é‡æ–°loadä¸€ä¸‹ï¼ŒæŠŠèµ„æºæ‹‰å›æ¥ï¼Œå†è®©ç”¨æˆ·è‡ªå·±å»ç‚¹å‡»è¦åˆ‡æ¢çš„é¡µé¢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">router.onError((error) =&gt; &#123;</div><div class="line">  const pattern = /Loading chunk (\d)+ failed/g</div><div class="line">  const isChunkLoadFailed = error.message.match(pattern)</div><div class="line">  if (isChunkLoadFailed) &#123;</div><div class="line">    $Message(&apos;ç³»ç»Ÿæ›´æ–°ï¼Œé¡µé¢å°†è¿›è¡Œåˆ·æ–°æ“ä½œï¼&apos;)</div><div class="line">    window.location.reload()</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢"></a>è½®è¯¢</h2><p>ä½¿ç”¨webpackæ‰“åŒ…çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªhash.jsonçš„æ–‡ä»¶ï¼Œç„¶åå‰ç«¯è½®è¯¢ï¼Œ<br>å‘ç°hashæ”¹å˜ï¼Œå°±å¼¹çª—æç¤ºç”¨æˆ·è¿›è¡Œæ›´æ–°</p>
<h2 id="å€ŸåŠ©CDNç¼“å­˜ç­–ç•¥"><a href="#å€ŸåŠ©CDNç¼“å­˜ç­–ç•¥" class="headerlink" title="å€ŸåŠ©CDNç¼“å­˜ç­–ç•¥"></a>å€ŸåŠ©CDNç¼“å­˜ç­–ç•¥</h2><p>å‘ç‰ˆä»£ç æ”¾åˆ°cdnä¸Šï¼Œç”¨æˆ·æœªè¿›è¡Œä»»ä½•åˆ·æ–°æ“ä½œåˆ™ä»ä½¿ç”¨è€ä»£ç ï¼Œ<br>ç”¨æˆ·è¿›è¡Œäº†æ‰‹åŠ¨åˆ·æ–°ï¼Œåˆ™æ‹¿åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¿›å…¥æ–°é¡µé¢</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h1&gt;&lt;p&gt;ç”¨æˆ·æ­£åœ¨ä½¿ç”¨æŸä¸ªé¡µé¢æœŸé—´ï¼Œåå°å‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œç”¨æˆ·å†åˆ‡æ¢å…¶ä»–é¡µé¢ï¼Œ&lt;br&gt;æµè§ˆå™¨ä¼šæŠ¥ä¸€ä¸ªèµ„æºæ‰¾ä¸åˆ°çš„error,å¯¼è‡´é¡µé¢å´©æºƒ&lt;/p&gt;
&lt;h1 
    
    </summary>
    
    
      <category term="knowledge" scheme="http://yoohannah.github.io/tags/knowledge/"/>
    
  </entry>
  
  <entry>
    <title>vueRouter æºç </title>
    <link href="http://yoohannah.github.io/post/vue/vueroutersrc.html"/>
    <id>http://yoohannah.github.io/post/vue/vueroutersrc.html</id>
    <published>2020-02-19T02:48:15.000Z</published>
    <updated>2020-02-24T15:56:19.364Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">  &lt;div id = &apos;app&apos; class=&apos;hello&apos;&gt;</div><div class="line">    &lt;p&gt;</div><div class="line">      &lt;router-link to=&quot;/foo&quot;&gt;Go to Foo&lt;/router-link&gt;</div><div class="line">      &lt;router-link to=&quot;/bar/user&quot;&gt;Go to Bar&lt;/router-link&gt;</div><div class="line">    &lt;/p&gt;</div><div class="line">    &lt;router-view&gt;&lt;/router-view&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;vue.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;vue-router.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">    const Foo = &#123; template: &apos;&lt;div&gt;foo&lt;/div&gt;&apos;,mounted()&#123;&#125;&#125;//è·¯ç”±fooç»„ä»¶</div><div class="line">    const Bar = &#123; </div><div class="line">      template: &apos;&lt;div&gt;bar&lt;div&gt;&#123;&#123;id&#125;&#125;&lt;/div&gt;&lt;a @click=&quot;aa&quot;&gt;go to foo&lt;/a&gt;&lt;/div&gt;&apos;,//è·¯ç”±barç»„ä»¶</div><div class="line">      data()&#123;</div><div class="line">        return &#123;</div><div class="line">          id:&apos;&apos;,</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      methods:&#123;</div><div class="line">        aa()&#123;</div><div class="line">          console.log(this.$router)</div><div class="line">          this.$router.push(&#123;name:&apos;foo&apos;,params:&#123;name:&apos;jck&apos;&#125;&#125;)</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      mounted()&#123;</div><div class="line">        console.log(this.$route,this.$router)</div><div class="line">        this.id = this.$route.params.id</div><div class="line">      &#125; </div><div class="line">      &#125;</div><div class="line">    const routes = [</div><div class="line">        &#123; path: &apos;/foo/:name&apos;,name:&apos;foo&apos;, component: Foo &#125;,</div><div class="line">        &#123; path: &apos;/bar/:id?&apos;,name:&apos;bar&apos;, component: Bar &#125;</div><div class="line">      ]</div><div class="line">    const router = new VueRouter(&#123;routes&#125;)</div><div class="line">    let app = new Vue(&#123;</div><div class="line">      el:&apos;#app&apos;,</div><div class="line">      data:&#123;&#125;,</div><div class="line">      method:&#123;&#125;,</div><div class="line">      router,</div><div class="line">    &#125;)</div><div class="line">  &lt;/script&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<h1 id="æ‰§è¡Œvue-Router-jsæ–‡ä»¶"><a href="#æ‰§è¡Œvue-Router-jsæ–‡ä»¶" class="headerlink" title="æ‰§è¡Œvue-Router.jsæ–‡ä»¶"></a>æ‰§è¡Œvue-Router.jsæ–‡ä»¶</h1><p>å¼•å…¥vue-routerä¹‹å‰ä¼šå…ˆå¼•å…¥vue.jsæ–‡ä»¶ï¼Œæ‰§è¡Œä¼šç”Ÿæˆvueæ„é€ å‡½æ•°,<br>å› ä¸ºvue-routerçš„æ‰§è¡Œè¿‡ç¨‹ä¼šç”¨åˆ°vueæ„é€ å‡½æ•°è¿™ä¸ªå¯¹è±¡ä¸Šçš„æ–¹æ³•<br>å½“ä»£ç å¼•å…¥vue-router.jsæ—¶ï¼Œé‡Œé¢ç›¸åº”çš„ä»£ç ä¼šæ‰§è¡Œä¸€éï¼Œ<br>æ­¤æ—¶vueæ„é€ å‡½æ•°å·²ç»ç”Ÿæˆ<br>æ‰€ä»¥vue-router.jsè¿è¡Œåï¼Œ<br>ä¸ä»…ä¼šç”Ÿæˆvue-routerçš„æ„é€ å¯¹è±¡<br>è¿˜ä¼šè°ƒç”¨vueæ„é€ å‡½æ•°ä¸Šçš„useæ–¹æ³•å°†ä¸routerç›¸å…³çš„ä¿¡æ¯æŒ‚åˆ°vueæ„é€ å‡½æ•°å¯¹è±¡ä¸Š<br>å³åšä¸€äº›æ³¨å†ŒæŒ‚è½½çš„åˆå§‹åŒ–å·¥ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">(function (global, factory) &#123;</div><div class="line">  global.VueRouter = factory());</div><div class="line">&#125;(this, function () &#123; &apos;use strict&apos;;</div><div class="line">  //vue-routerçš„æ„é€ å¯¹è±¡</div><div class="line">  var VueRouter = function VueRouter (options) &#123; </div><div class="line">    if ( options === void 0 ) options = &#123;&#125;;</div><div class="line">    //optionså³new vueRouteræ—¶ä¼ è¿›æ¥çš„å‚æ•°å¯¹è±¡ï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ªå±æ€§å³è·¯ç”±é…ç½®å¯¹è±¡routes</div><div class="line">    this.app = null;</div><div class="line">    this.apps = [];</div><div class="line">    this.options = options;</div><div class="line">    this.beforeHooks = [];</div><div class="line">    this.resolveHooks = [];</div><div class="line">    this.afterHooks = [];</div><div class="line">    //è¯¥å‡½æ•°ä¼šæ ¹æ®è·¯ç”±é…åˆç”Ÿæˆè·¯ç”±è¡¨ï¼Œè¿”å›ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªmatchå‡½æ•°ç”¨æ¥åŒ¹é…è·¯ç”±ï¼Œå¦ä¸€ä¸ªaddRoutesç”¨æ¥åŠ¨æ€å¢åŠ è·¯ç”±ï¼Œè¯¦è§ä¸‹æ–‡å…·ä½“åˆ†æ</div><div class="line">    this.matcher = createMatcher(options.routes || [], this);</div><div class="line">    var mode = options.mode || &apos;hash&apos;;//è·¯ç”±å¯¹è±¡æ¨¡å¼ï¼Œæ²¡æœ‰é…ç½®çš„è¯é»˜è®¤åˆå§‹åŒ–ä¸º&apos;hash&apos;</div><div class="line">    //fallbackå‚æ•°ç”¨äºé…ç½®å½“æµè§ˆå™¨ä¸æ”¯æŒ history.pushState æ§åˆ¶è·¯ç”±æ˜¯å¦åº”è¯¥å›é€€åˆ° hash æ¨¡å¼</div><div class="line">    //é»˜è®¤å€¼ä¸º true å®˜æ–‡ï¼šhttps://router.vuejs.org/zh/api/#fallback</div><div class="line">    this.fallback = mode === &apos;history&apos; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== false;</div><div class="line">    if (this.fallback) &#123; //historyæ¨¡å¼ä¸‹åœ¨ä¸æ”¯æŒpushstateæ–¹æ³•ä¸”é…ç½®å…è®¸å›é€€hashçš„æƒ…å†µä¸‹å›é€€hashæ¨¡å¼</div><div class="line">      mode = &apos;hash&apos;;</div><div class="line">    &#125;</div><div class="line">    if (!inBrowser) &#123; //æ²¡æœ‰åœ¨æµè§ˆå™¨ä¸­ï¼Œé‚£åº”è¯¥æ˜¯åœ¨nodejsä¸­ï¼Œæ¨¡å¼é‡ç½®ä¸ºabstract</div><div class="line">      mode = &apos;abstract&apos;;</div><div class="line">    &#125;</div><div class="line">    this.mode = mode;//æ¨¡å¼ç¡®å®š</div><div class="line"></div><div class="line">    switch (mode) &#123; //åˆå§‹åŒ–historyå¯¹è±¡ï¼Œä¸‰ç§ç±»å‹çš„historyæ„é€ å‡½æ•°ç»§æ‰¿è‡ªåŒä¸€çˆ¶ç±»æ„é€ å‡½æ•°History</div><div class="line">      case &apos;history&apos;:</div><div class="line">        this.history = new HTML5History(this, options.base);</div><div class="line">        break</div><div class="line">      case &apos;hash&apos;:</div><div class="line">        this.history = new HashHistory(this, options.base, this.fallback);</div><div class="line">        break</div><div class="line">      case &apos;abstract&apos;:</div><div class="line">        this.history = new AbstractHistory(this, options.base);</div><div class="line">        break</div><div class="line">      default:</div><div class="line">        &#123;</div><div class="line">          assert(false, (&quot;invalid mode: &quot; + mode));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">  VueRouter.install = install;</div><div class="line">  VueRouter.version = &apos;3.1.5&apos;;</div><div class="line"></div><div class="line">  function install (Vue) &#123; &#125; //æŒ‚åˆ°VueRouterä¸Šï¼Œè¢«vue.useå‡½æ•°è°ƒç”¨</div><div class="line"></div><div class="line">  if (inBrowser &amp;&amp; window.Vue) &#123; //åªåœ¨æµè§ˆå™¨ç¯å¢ƒè‡ªåŠ¨æŒ‚è½½ï¼Œè¯´æ˜åœ¨node.jsä¸­éœ€è¦è‡ªå·±è°ƒç”¨Vue.useæ‰‹åŠ¨æŒ‚è½½</div><div class="line">    window.Vue.use(VueRouter);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  return VueRouter;</div><div class="line"></div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
<h2 id="vue-use-ä¸-VueRouter-install"><a href="#vue-use-ä¸-VueRouter-install" class="headerlink" title="vue.use ä¸ VueRouter.install"></a>vue.use ä¸ VueRouter.install</h2><p>vueçš„useæ–¹æ³•ä¼šè°ƒç”¨æ’ä»¶çš„installæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//åœ¨è¿è¡ŒinitGlobalAPI(Vue)å‡½æ•°æ—¶è°ƒç”¨initUseæŒ‚è½½åˆ°VUEä¸Š</div><div class="line">Vue.use = function (plugin) &#123;</div><div class="line">  var installedPlugins = (this._installedPlugins || (this._installedPlugins = []));//thisæ˜¯æŒ‡Vueå“¦</div><div class="line">  if (installedPlugins.indexOf(plugin) &gt; -1) &#123; //é¿å…é‡å¤æŒ‚è½½</div><div class="line">    return this</div><div class="line">  &#125;</div><div class="line">  //è¿™ä¸ªæ–¹æ³•ä¼šä»argumentsä¸­å–å‡ºä»ç¬¬ä¸€ä¸ªæ•°ä»¥åçš„æ‰€æœ‰å‚æ•°ï¼Œè¿™é‡Œè¿”å›ç©ºæ•°ç»„===&gt;[]</div><div class="line">  var args = toArray(arguments, 1);</div><div class="line">  args.unshift(this);//thisæ˜¯vue,å°†vueä¼ ç»™ç»„ä»¶è¿›è¡Œåˆå§‹åŒ– ==&gt;[vue]</div><div class="line">  if (typeof plugin.install === &apos;function&apos;) &#123;  //ç»„ä»¶å®šä¹‰äº†plugin.installæ–¹æ³•ï¼Œæ‰§è¡Œç»„ä»¶plugin.installæ–¹æ³•</div><div class="line">    plugin.install.apply(plugin, args);</div><div class="line">  &#125; else if (typeof plugin === &apos;function&apos;) &#123; //æ²¡å®šä¹‰å®šä¹‰plugin.installæ–¹æ³•ä¸”ç»„ä»¶æœ¬èº«æ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨è‡ªèº«</div><div class="line">    plugin.apply(null, args);</div><div class="line">  &#125;</div><div class="line">  installedPlugins.push(plugin);//å°†æ’ä»¶æ¨å…¥vueå¯¹è±¡ä¸Šçš„installedPluginsé›†åˆä¸­</div><div class="line">  return this</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>VueRouter.installæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">function install (Vue) &#123; //æŒ‚åˆ°VueRouterä¸Šï¼Œè¢«vue.useå‡½æ•°è°ƒç”¨</div><div class="line">    if (install.installed &amp;&amp; _Vue === Vue) &#123; return &#125;//é¿å…é‡å¤æŒ‚è½½</div><div class="line">    install.installed = true;</div><div class="line"></div><div class="line">    _Vue = Vue;</div><div class="line"></div><div class="line">    var isDef = function (v) &#123; return v !== undefined; &#125;;</div><div class="line"></div><div class="line">    var registerInstance = function (vm, callVal) &#123;</div><div class="line">      var i = vm.$options._parentVnode;</div><div class="line">      if (isDef(i) &amp;&amp; isDef(i = i.data) &amp;&amp; isDef(i = i.registerRouteInstance)) &#123;</div><div class="line">        i(vm, callVal);//å¦‚æœå®šä¹‰äº†registerRouteInstanceå°±æ‰§è¡Œ</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">    //è°ƒç”¨vue.mixinæ–¹æ³• å°†beforeCreate å’Œ destroyedï¼Œä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å­˜åˆ°åˆ°å¯¹åº”çš„é’©å­å‡½æ•°çš„é›†åˆä¸­</div><div class="line">    //åœ¨æ‰§è¡Œnew vueæ—¶ä¼šè°ƒç”¨callHookæ‰§è¡Œ beforeCreateç›¸å…³çš„é’©å­å‡½æ•°</div><div class="line">    //åœ¨vueä¸­æ‰§è¡Œdestroyedé’©å­å‡½æ•°æ—¶ï¼ŒåŒæ ·ä¹Ÿä¼šè°ƒç”¨è¿™é‡Œå®šä¹‰å¥½çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</div><div class="line">    Vue.mixin(&#123; </div><div class="line">      beforeCreate: function beforeCreate () &#123; //è¿™é‡ŒthisæŒ‡å‘vue</div><div class="line">        if (isDef(this.$options.router)) &#123;</div><div class="line">          this._routerRoot = this;</div><div class="line">          this._router = this.$options.router;</div><div class="line">          //è°ƒç”¨vueRouterå¯¹è±¡ä¸Šçš„initæ–¹æ³•,ä¸»è¦åŠŸèƒ½æ˜¯åˆå§‹åŒ–å½“å‰è·¯ç”±ï¼Œè®¾ç½®ç›‘å¬ è¯¦è§ä¸‹æ–‡</div><div class="line">          this._router.init(this);</div><div class="line">          Vue.util.defineReactive(this, &apos;_route&apos;, this._router.history.current);</div><div class="line">          //defineReactiveä¼šå¯¹æ•°æ®è¿›è¡ŒåŠ«æŒï¼Œè¿›è¡Œä¾èµ–æ”¶é›†ï¼Œæ–¹ä¾¿ä¹‹åé¡µé¢åˆ‡æ¢è¿›è¡Œç›‘å¬</div><div class="line">        &#125; else &#123;//å¦‚æœæ²¡æœ‰åœ¨new vueæ—¶ä¼ è¿›vuerouterå¯¹è±¡</div><div class="line">          this._routerRoot = (this.$parent &amp;&amp; this.$parent._routerRoot) || this;</div><div class="line">        &#125;</div><div class="line">        registerInstance(this, this);</div><div class="line">      &#125;,</div><div class="line">      destroyed: function destroyed () &#123;</div><div class="line">        registerInstance(this);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    //è®¿é—®this.$router,è¿”å›new vueRouterç”Ÿæˆçš„å¯¹è±¡</div><div class="line">    Object.defineProperty(Vue.prototype, &apos;$router&apos;, &#123; </div><div class="line">      get: function get () &#123; return this._routerRoot._router &#125;</div><div class="line">    &#125;);</div><div class="line">    //è®¿é—®this.$route,å½“å‰é¡µé¢è·¯ç”±å¯¹è±¡ this._router.history.current</div><div class="line">    Object.defineProperty(Vue.prototype, &apos;$route&apos;, &#123;</div><div class="line">      get: function get () &#123; return this._routerRoot._route &#125;</div><div class="line">    &#125;);</div><div class="line">    //æŒ‚è½½RouterViewï¼ŒRouterLinkä¸¤ä¸ªç»„ä»¶</div><div class="line">    Vue.component(&apos;RouterView&apos;, View); </div><div class="line">    Vue.component(&apos;RouterLink&apos;, Link);</div><div class="line">    //ä½¿ç”¨vueç”Ÿå‘½é’©å­å‡½æ•°åˆå¹¶ç­–ç•¥å®šä¹‰è·¯ç”±ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°åˆå¹¶ç­–ç•¥ å…¶å®å°±æ˜¯mergeHookå‡½æ•°</div><div class="line">    var strats = Vue.config.optionMergeStrategies;</div><div class="line">    // use the same hook merging strategy for route hooks</div><div class="line">    strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate = strats.created;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>vueRouteråœ¨æ‰§è¡Œé˜¶æ®µä¼šåšä»¥ä¸‹ä¸¤ä»¶äº‹<br>1.ç”Ÿæˆvue-routerçš„æ„é€ å¯¹è±¡<br>2.æŒ‚è½½vuerouterç›¸å…³ä¿¡æ¯åˆ°vueå¯¹è±¡</p>
<p>æŒ‚è½½åˆ°vueå¯¹è±¡æ—¶ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹<br>1.æ³¨å…¥ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼šbeforeCreateå’Œ destroyed<br>2.æŒ‡å®švueçš„$routerå’Œ$routeåˆ†åˆ«æŒ‡å‘ä¼ è¿›å»çš„vueRouterå¯¹è±¡çš„æœ¬èº«å’Œhistory.currentå±æ€§<br>3.æŒ‚è½½RouterView,RouterLinkä¸¤ä¸ªç»„ä»¶<br>4.æŒ‡å®šè·¯ç”±ç”Ÿå‘½å‘¨æœŸå‡½æ•°åˆå¹¶ç­–ç•¥ä½¿ç”¨vueä¸­ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„åˆå¹¶ç­–ç•¥</p>
<p>beforeCreateä¼šåœ¨new vueæ—¶è¢«è°ƒç”¨ï¼Œä¸»è¦åšä»¥ä¸‹å‡ ä»¶äº‹<br>1.åœ¨vueå¯¹è±¡ä¸ŠæŒ‡å®šä¸routerç›¸å…³çš„å±æ€§<br>2.è°ƒç”¨vuerouterçš„initæ–¹æ³•ï¼Œåˆå§‹åŒ–å½“å‰è·¯ç”±ï¼Œè®¾ç½®ç›‘å¬<br>3.å¯¹å½“å‰è·¯ç”±è¿›è¡Œæ•°æ®åŠ«æŒï¼Œè¿›è¡Œç›‘å¬</p>
<p>åœ¨new vueRouteræ—¶ï¼Œä¼šåšä»¥ä¸‹å‡ ä»¶äº‹<br>1.æ ¹æ®è·¯ç”±é…ç½®æ•°ç»„ç”Ÿæˆè·¯ç”±è¡¨ï¼ŒåŒ¹é…å‡½æ•°ä»¥åŠåŠ¨æ€å¢åŠ è·¯ç”±çš„å‡½æ•°<br>2.ç¡®å®šè·¯ç”±æ¨¡å¼<br>3ã€‚æ ¹æ®è·¯ç”±æ¨¡å¼åˆ›å»ºhistoryå±æ€§</p>
<h1 id="ä¸€ä¸ªç–‘æƒ‘"><a href="#ä¸€ä¸ªç–‘æƒ‘" class="headerlink" title="ä¸€ä¸ªç–‘æƒ‘"></a>ä¸€ä¸ªç–‘æƒ‘</h1><p>å½“è·³è½¬çš„è·¯ç”±å¸¦æœ‰queryæˆ–è€…paramsæ—¶ï¼Œå°†å…¶ä¸­çš„å€¼æ’å…¥åˆ°é¡µé¢ä¸­ä¸ºä»€ä¹ˆä¸ä¼šå¼•èµ·XSSæ”»å‡»ï¼Ÿ<br>å› ä¸ºæ‹¿åˆ°çš„å€¼ç±»å‹éƒ½æ˜¯åŸå§‹jsç±»å‹ï¼Œvueåœ¨æ›¿æ¢å€¼æ—¶åªæ˜¯å½“åšå­—ç¬¦ä¸²æ›¿æ¢ï¼Œä¸ä¼šè¿›è¡ŒinnerHTML</p>
<h2 id="ä½¿ç”¨jsè·³è½¬è·¯ç”±"><a href="#ä½¿ç”¨jsè·³è½¬è·¯ç”±" class="headerlink" title="ä½¿ç”¨jsè·³è½¬è·¯ç”±"></a>ä½¿ç”¨jsè·³è½¬è·¯ç”±</h2><p>æ¯”å¦‚this.$router.push({name:foo,query:{id:1}})æ–¹æ³•è·³è½¬è·¯ç”±<br>ç›®çš„é¡µé¢æ‹¿åˆ°çš„query/paramsæ•°æ®ï¼Œå°±æ˜¯è°ƒç”¨pushå‡½æ•°ä¼ å…¥çš„æ•°æ®<br>å½“æˆ‘ä»¬è°ƒç”¨pushå‡½æ•°æ—¶ï¼Œå°±æ˜¯åœ¨è°ƒç”¨è¿™æ®µä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">VueRouter.prototype.push = function push (location, onComplete, onAbort) &#123;</div><div class="line">    var this$1 = this;</div><div class="line">    if (!onComplete &amp;&amp; !onAbort &amp;&amp; typeof Promise !== &apos;undefined&apos;) &#123;</div><div class="line">      return new Promise(function (resolve, reject) &#123;//è¿›è¡Œå¼‚æ­¥è·³è½¬</div><div class="line">        this$1.history.push(location, resolve, reject);</div><div class="line">      &#125;)</div><div class="line">    &#125; else &#123;//è¿›è¡ŒåŒæ­¥è·³è½¬</div><div class="line">      this.history.push(location, onComplete, onAbort);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div></pre></td></tr></table></figure></p>
<p>locationå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ï¼Œæ²¡æœ‰ä¼ å…¥ onComplete, onAbortï¼Œæ‰€ä»¥ä¼šè¿›å…¥ifåˆ†æ”¯<br>å¯è§æ— è®ºè¿›å…¥å“ªä¸ªåˆ†æ”¯éƒ½ä¼šè°ƒç”¨historyå¯¹è±¡çš„pushæ–¹æ³•<br>ç”±äºåœ¨new VueRouterå¯¹è±¡æ—¶ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­historyæ˜¯æ ¹æ®ä¼ å…¥çš„é€‰é¡¹ç”Ÿæˆçš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">var mode = options.mode || &apos;hash&apos;;</div><div class="line">  this.fallback = mode === &apos;history&apos; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== false;</div><div class="line">  if (this.fallback) &#123;</div><div class="line">    mode = &apos;hash&apos;;</div><div class="line">  &#125;</div><div class="line">  if (!inBrowser) &#123;</div><div class="line">    mode = &apos;abstract&apos;;</div><div class="line">  &#125;</div><div class="line">  this.mode = mode;</div><div class="line"></div><div class="line">  switch (mode) &#123;</div><div class="line">    case &apos;history&apos;:</div><div class="line">      this.history = new HTML5History(this, options.base);</div><div class="line">      break</div><div class="line">    case &apos;hash&apos;:</div><div class="line">      this.history = new HashHistory(this, options.base, this.fallback);</div><div class="line">      break</div><div class="line">    case &apos;abstract&apos;:</div><div class="line">      this.history = new AbstractHistory(this, options.base);</div><div class="line">      break</div><div class="line">    default:</div><div class="line">      &#123;</div><div class="line">        assert(false, (&quot;invalid mode: &quot; + mode));</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥pushæ–¹æ³•çš„å®ç°å¯èƒ½ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">HTML5History.prototype.push = function push (location, onComplete, onAbort) &#123;</div><div class="line">  var this$1 = this;</div><div class="line"></div><div class="line">  var ref = this;</div><div class="line">  var fromRoute = ref.current;</div><div class="line">  this.transitionTo(location, function (route) &#123;</div><div class="line">    pushState(cleanPath(this$1.base + route.fullPath));</div><div class="line">    handleScroll(this$1.router, route, fromRoute, false);</div><div class="line">    onComplete &amp;&amp; onComplete(route);</div><div class="line">  &#125;, onAbort);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">HashHistory.prototype.push = function push (location, onComplete, onAbort) &#123;</div><div class="line">  var this$1 = this;</div><div class="line">  var ref = this;</div><div class="line">  var fromRoute = ref.current;</div><div class="line">  this.transitionTo(</div><div class="line">    location,</div><div class="line">    function (route) &#123;</div><div class="line">      pushHash(route.fullPath);//æ›´æ”¹url</div><div class="line">      handleScroll(this$1.router, route, fromRoute, false);</div><div class="line">      onComplete &amp;&amp; onComplete(route);</div><div class="line">    &#125;,</div><div class="line">    onAbort</div><div class="line">  );</div><div class="line">&#125;;</div><div class="line">AbstractHistory.prototype.push = function push (location, onComplete, onAbort) &#123;</div><div class="line">  var this$1 = this;</div><div class="line">  this.transitionTo(</div><div class="line">    location,</div><div class="line">    function (route) &#123;</div><div class="line">      this$1.stack = this$1.stack.slice(0, this$1.index + 1).concat(route);</div><div class="line">      this$1.index++;</div><div class="line">      onComplete &amp;&amp; onComplete(route);</div><div class="line">    &#125;,</div><div class="line">    onAbort</div><div class="line">  );</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å¯è§ä¸‰ç§æ¨¡å¼ä¸‹éƒ½ä¼šè°ƒç”¨å…±åŒçš„çˆ¶ç±»Historyä¸Šçš„transitionToæ–¹æ³•<br>æ¥ä¸‹æ¥ä»¥HashHistoryä¸ºåŸºç¡€åˆ†ææ¥ä¸‹æ¥çš„æµç¨‹</p>
<p>åœ¨HashHistory pushè°ƒç”¨transitionToæ—¶ï¼Œ<br>ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š<br>location å³æˆ‘ä»¬è°ƒç”¨pushæ—¶ä¼ å…¥çš„å‚æ•°<br>onAbort è°ƒç”¨pushæ—¶æ²¡æœ‰ä¼ å…¥ï¼Œæ•…è¯¥å€¼ä¸ºundefined<br>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function (route) &#123;</div><div class="line">  pushHash(route.fullPath);//æ›´æ”¹url</div><div class="line">  handleScroll(this$1.router, route, fromRoute, false);//å¤„ç†é¡µé¢æ»šåŠ¨ç›¸å…³åŠŸèƒ½</div><div class="line">  onComplete &amp;&amp; onComplete(route);//è°ƒç”¨pushæ—¶æ²¡æœ‰ä¼ å…¥onComplete,æ•…onComplete=&gt;undefined,ä¸ä¼šè¢«æ‰§è¡Œ</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>å¯è§åŒ¿åå‡½æ•°å†…å°†æ¥è¦æ‰§è¡ŒpushHashå‡½æ•°</p>
<h3 id="pushHashå‡½æ•°æ›´æ”¹æµè§ˆå™¨url"><a href="#pushHashå‡½æ•°æ›´æ”¹æµè§ˆå™¨url" class="headerlink" title="pushHashå‡½æ•°æ›´æ”¹æµè§ˆå™¨url"></a>pushHashå‡½æ•°æ›´æ”¹æµè§ˆå™¨url</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">function pushHash (path) &#123;</div><div class="line">  if (supportsPushState) &#123; ä½¿ç”¨history.pushStateæ›´æ”¹URl</div><div class="line">    pushState(getUrl(path));</div><div class="line">  &#125; else &#123;//å¦‚æœä¸æ”¯æŒhistory.pushStateåˆ™ç›´æ¥æ›´æ”¹hashå€¼</div><div class="line">    window.location.hash = path;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">function getUrl (path) &#123;</div><div class="line">  var href = window.location.href;</div><div class="line">  var i = href.indexOf(&apos;#&apos;);</div><div class="line">  var base = i &gt;= 0 ? href.slice(0, i) : href;</div><div class="line">  return (base + &quot;#&quot; + path)</div><div class="line">&#125;</div><div class="line">function pushState (url, replace) &#123;</div><div class="line">  saveScrollPosition();</div><div class="line">  // try...catch the pushState call to get around Safari</div><div class="line">  // DOM Exception 18 where it limits to 100 pushState calls</div><div class="line">  var history = window.history;</div><div class="line">  try &#123;</div><div class="line">    if (replace) &#123; //åœ¨ä½¿ç”¨replaceå‡½æ•°è·³è½¬è·¯ç”±ä¼šèµ°è¯¥åˆ†æ”¯ï¼Œç”±replaceStateå‡½æ•°è°ƒç”¨ï¼Œreplaceä¼ å…¥ä¸ºtrue</div><div class="line">      // ä¿ç•™ç°æœ‰çš„å†å²è®°å½•çŠ¶æ€ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½ä¼šè¦†ç›–å®ƒ</div><div class="line">      var stateCopy = extend(&#123;&#125;, history.state);</div><div class="line">      stateCopy.key = getStateKey();</div><div class="line">      history.replaceState(stateCopy, &apos;&apos;, url); //ä½¿ç”¨windowçš„historyä¸Šçš„æ–¹æ³•</div><div class="line">    &#125; else &#123; //æ²¡æœ‰ä¼ å…¥replaceï¼Œæ•…è¿›å…¥è¯¥åˆ†æ”¯</div><div class="line">      history.pushState(&#123; key: setStateKey(genStateKey()) &#125;, &apos;&apos;, url);</div><div class="line">    &#125;</div><div class="line">  &#125; catch (e) &#123;</div><div class="line">    window.location[replace ? &apos;replace&apos; : &apos;assign&apos;](url);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥pushHashå‡½æ•°æœ€ç»ˆçš„ç›®çš„æ˜¯æ›´æ”¹æµè§ˆå™¨ä¸­çš„url<br>handleScrollå‡½æ•°å¤„ç†é¡µé¢æ»šåŠ¨çŠ¶æ€ï¼Œè¿™é‡Œæš‚ä¸åšæ·±å…¥<br>onComplete å€¼ä¸ºundefined,æ•…ä¸æ‰§è¡Œ</p>
<h3 id="transitionTo"><a href="#transitionTo" class="headerlink" title="transitionTo"></a>transitionTo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">History.prototype.transitionTo = function transitionTo (</div><div class="line">    location,</div><div class="line">    onComplete,</div><div class="line">    onAbort</div><div class="line">  ) &#123;</div><div class="line">    var this$1 = this;</div><div class="line">    var route = this.router.match(location, this.current);//å¾—åˆ°ç›®çš„è·¯ç”±çš„routeå¯¹è±¡</div><div class="line">    this.confirmTransition(...æš‚æ—¶çœç•¥));</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<p>transitionToå‡½æ•°ä¸­ç¬¬ä¸€æ­¥å°±æ˜¯æ ¹æ®æ ¹æ®å½“å‰è·¯ç”±ä¿¡æ¯å’Œä¼ å…¥çš„ç›®çš„è·¯ç”±ä¿¡æ¯ç”Ÿæˆç›®çš„è·¯ç”±å¯¹è±¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var route = this.router.match(location, this.current);</div></pre></td></tr></table></figure></p>
<p>location æ˜¯æˆ‘ä»¬è°ƒç”¨pushå‡½æ•°ä¼ å…¥çš„å‚æ•°ï¼Œ<br>this.currentå³å½“å‰é¡µé¢è·¯ç”±ä¿¡æ¯å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">VueRouter.prototype.match = function match (</div><div class="line">  raw,</div><div class="line">  current,</div><div class="line">  redirectedFrom</div><div class="line">) &#123;</div><div class="line">  return this.matcher.match(raw, current, redirectedFrom)</div><div class="line">&#125;;</div><div class="line"></div><div class="line">this.matcher = createMatcher(options.routes || [], this); //new vuerouteræ—¶åœ¨æ„é€ å‡½æ•°ä¸­ç”Ÿæˆ</div></pre></td></tr></table></figure>
<h3 id="createMatcher"><a href="#createMatcher" class="headerlink" title="createMatcher"></a>createMatcher</h3><p>createMatcherå‡½æ•°å³åˆ›é€ åŒ¹é…å™¨çš„å‡½æ•°ï¼Œä¸»è¦åšä¸‰ä»¶äº‹<br>1.ç”Ÿæˆè·¯ç”±è¡¨<br>2.ç”ŸæˆåŒ¹é…å™¨ï¼Œç”¨äºå°†å½“ç„¶è·¯ç”±å¯¹è±¡å’Œç›®çš„è·¯ç”±ä¿¡æ¯å¯¹è±¡åˆæˆç›®çš„è·¯ç”±å¯¹è±¡<br>3.ç”ŸæˆåŠ¨æ€æ·»åŠ è·¯ç”±çš„å‡½æ•°ï¼Œå› è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨è·¯ç”±è¡¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">function createMatcher (</div><div class="line">  routes,</div><div class="line">  router</div><div class="line">) &#123;</div><div class="line">  var ref = createRouteMap(routes);//æ ¹æ®è·¯ç”±é…ç½®ç”Ÿæˆè·¯ç”±è¡¨</div><div class="line">  var pathList = ref.pathList;</div><div class="line">  var pathMap = ref.pathMap;</div><div class="line">  var nameMap = ref.nameMap;</div><div class="line"></div><div class="line">  function addRoutes (routes) &#123; //åŠ¨æ€å¢åŠ è·¯ç”±</div><div class="line">    createRouteMap(routes, pathList, pathMap, nameMap);</div><div class="line">  &#125;</div><div class="line">  //æ ¹æ®å½“å‰è·¯ç”±å¯¹è±¡å’Œç›®çš„è·¯ç”±ä¿¡æ¯ä»¥åŠæ˜¯å¦é‡å®šå‘ç­‰æ¡ä»¶åˆæˆç›®çš„è·¯ç”±å¯¹è±¡è¿”å›</div><div class="line">  function match ( </div><div class="line">    raw,</div><div class="line">    currentRoute,</div><div class="line">    redirectedFrom</div><div class="line">  ) &#123;</div><div class="line">    //ç»Ÿä¸€è·¯ç”±å‚æ•°ï¼Œåˆå¹¶paramsç»™åˆ°ç›®çš„è·¯ç”±</div><div class="line">    var location = normalizeLocation(raw, currentRoute, false, router);</div><div class="line">    var name = location.name;</div><div class="line">    if (name) &#123;//èµ°è¿™æ¡åˆ†æ”¯</div><div class="line">      var record = nameMap[name];</div><div class="line">      &#123;</div><div class="line">        warn(record, (&quot;Route with name &apos;&quot; + name + &quot;&apos; does not exist&quot;));</div><div class="line">      &#125;</div><div class="line">      if (!record) &#123; return _createRoute(null, location) &#125;</div><div class="line">      var paramNames = record.regex.keys //æ²¡æœ‰åœ¨è·¯ç”±pathä¸­é…ç½®åŠ¨æ€å‚æ•°ï¼Œkeysæ•°ç»„ä¸ºç©º</div><div class="line">        .filter(function (key) &#123; return !key.optional; &#125;)</div><div class="line">        .map(function (key) &#123; return key.name; &#125;);</div><div class="line"></div><div class="line">      if (typeof location.params !== &apos;object&apos;) &#123;</div><div class="line">        location.params = &#123;&#125;; //ç»™location æŒ‚ä¸Šparams</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (currentRoute &amp;&amp; typeof currentRoute.params === &apos;object&apos;) &#123;</div><div class="line">        for (var key in currentRoute.params) &#123;//paramsä¸­æœ‰ç›¸åŒkeyå€¼æ—¶ï¼Œä»å½“å‰è·¯ç”±å°†å€¼ç»™åˆ°ç›®çš„è·¯ç”±</div><div class="line">          if (!(key in location.params) &amp;&amp; paramNames.indexOf(key) &gt; -1) &#123;</div><div class="line">            location.params[key] = currentRoute.params[key];</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      //å¦‚æœpathæœ‰åŠ¨æ€å‚æ•°ï¼Œä½¿ç”¨paramså°†pathè¡¥å…¨ï¼Œ//ä»¥nameå‘èµ·çš„è·³è½¬ï¼ŒæŒ‚ä¸Šäº†path</div><div class="line">      location.path = fillParams(record.path, location.params, (&quot;named route \&quot;&quot; + name + &quot;\&quot;&quot;));</div><div class="line">      return _createRoute(record, location, redirectedFrom) å¯çŸ¥è¿”å›ä¸€routeå¯¹è±¡</div><div class="line">    &#125; else if (location.path) &#123; //è¯¦è§linkè·³è½¬åˆ†æ</div><div class="line">      location.params = &#123;&#125;;</div><div class="line">      for (var i = 0; i &lt; pathList.length; i++) &#123;</div><div class="line">        var path = pathList[i];</div><div class="line">        var record$1 = pathMap[path];</div><div class="line">        if (matchRoute(record$1.regex, location.path, location.params)) &#123;</div><div class="line">          console.log(location)</div><div class="line">          return _createRoute(record$1, location, redirectedFrom)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    // no match</div><div class="line">    return _createRoute(null, location)</div><div class="line">  &#125;</div><div class="line">  function redirect () &#123;...å¯¹é‡å®šå‘ä¸€ç³»åˆ—çš„å¤„ç†ï¼Œä¼šè¿”å›createRoute()&#125;</div><div class="line">  function alias () &#123;...å¯¹è·¯ç”±é…ç½®ä¸­çš„åˆ«åè¿›è¡Œå¤„ç†ï¼Œä¼šè¿”å›createRoute()&#125;</div><div class="line">  function _createRoute ( //ä¼šç”Ÿæˆfullpath</div><div class="line">    record,</div><div class="line">    location,</div><div class="line">    redirectedFrom</div><div class="line">  ) &#123;</div><div class="line">    if (record &amp;&amp; record.redirect) &#123;</div><div class="line">      return redirect(record, redirectedFrom || location)</div><div class="line">    &#125;</div><div class="line">    if (record &amp;&amp; record.matchAs) &#123;</div><div class="line">      return alias(record, location, record.matchAs)</div><div class="line">    &#125;</div><div class="line">    return createRoute(record, location, redirectedFrom, router)</div><div class="line">  &#125;</div><div class="line">  return &#123;</div><div class="line">    match: match,</div><div class="line">    addRoutes: addRoutes</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="è·¯ç”±è¡¨ç”Ÿæˆ"><a href="#è·¯ç”±è¡¨ç”Ÿæˆ" class="headerlink" title="è·¯ç”±è¡¨ç”Ÿæˆ"></a>è·¯ç”±è¡¨ç”Ÿæˆ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line">function createRouteMap ( //ç”Ÿæˆè·¯ç”±è¡¨</div><div class="line">  routes,</div><div class="line">  oldPathList,</div><div class="line">  oldPathMap,</div><div class="line">  oldNameMap</div><div class="line">) &#123;</div><div class="line">  // the path list is used to control path matching priority</div><div class="line">  var pathList = oldPathList || [];</div><div class="line">  // $flow-disable-line</div><div class="line">  var pathMap = oldPathMap || Object.create(null);</div><div class="line">  // $flow-disable-line</div><div class="line">  var nameMap = oldNameMap || Object.create(null);</div><div class="line"></div><div class="line">  routes.forEach(function (route) &#123;</div><div class="line">    addRouteRecord(pathList, pathMap, nameMap, route);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  // ensure wildcard(é€šé…ç¬¦) routes are always at the end</div><div class="line">  for (var i = 0, l = pathList.length; i &lt; l; i++) &#123;</div><div class="line">    if (pathList[i] === &apos;*&apos;) &#123;</div><div class="line">      pathList.push(pathList.splice(i, 1)[0]);</div><div class="line">      l--;</div><div class="line">      i--;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  &#123;</div><div class="line">    // warn if routes do not include leading slashes(æ–œçº¿)</div><div class="line">    var found = pathList</div><div class="line">    // check for missing leading slash</div><div class="line">      .filter(function (path) &#123; return path &amp;&amp; path.charAt(0) !== &apos;*&apos; &amp;&amp; path.charAt(0) !== &apos;/&apos;; &#125;);</div><div class="line"></div><div class="line">    if (found.length &gt; 0) &#123;</div><div class="line">      var pathNames = found.map(function (path) &#123; return (&quot;- &quot; + path); &#125;).join(&apos;\n&apos;);</div><div class="line">      warn(false, (&quot;Non-nested routes must include a leading slash character. Fix the following routes: \n&quot; + pathNames));</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  return &#123;</div><div class="line">    pathList: pathList,//æ•°ç»„ï¼Œå­˜æ”¾pathå€¼çš„é›†åˆ</div><div class="line">    pathMap: pathMap,//å¯¹è±¡ï¼Œæœ‰é…ç½®pathçš„è·¯ç”±recordé›†åˆ</div><div class="line">    nameMap: nameMap//å¯¹è±¡ï¼Œæœ‰é…ç½®nameçš„è·¯ç”±recordçš„é›†åˆ</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">//æ ¹æ®é…ç½®çš„è·¯ç”±å°†å…¶è½¬æ¢æˆå†…éƒ¨ä½¿ç”¨çš„è·¯ç”±å¯¹è±¡record,å¹¶æ ¹æ®é…ç½®æƒ…å†µæ”¾åˆ°ä¸åŒè·¯ç”±é›†åˆ(å‰ä¸‰ä¸ªå‚æ•°)ä¸­ï¼Œ</div><div class="line">function addRouteRecord ( </div><div class="line">  pathList,</div><div class="line">  pathMap,</div><div class="line">  nameMap,</div><div class="line">  route,//å…·ä½“é…ç½®çš„route</div><div class="line">  parent,//ç”¨äºå¤„ç†é…ç½®äº†childrenï¼Œè¢«é€’å½’è°ƒç”¨æ—¶ä¼ å…¥ï¼Œ</div><div class="line">  matchAs</div><div class="line">) &#123;</div><div class="line">  var path = route.path;</div><div class="line">  var name = route.name;</div><div class="line"> </div><div class="line">  var pathToRegexpOptions =</div><div class="line">    route.pathToRegexpOptions || &#123;&#125;;</div><div class="line">  var normalizedPath = normalizePath(path, parent, pathToRegexpOptions.strict);</div><div class="line"></div><div class="line">  if (typeof route.caseSensitive === &apos;boolean&apos;) &#123;</div><div class="line">    pathToRegexpOptions.sensitive = route.caseSensitive;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  var record = &#123;</div><div class="line">    path: normalizedPath,</div><div class="line">    regex: compileRouteRegex(normalizedPath, pathToRegexpOptions),</div><div class="line">    components: route.components || &#123; default: route.component &#125;,</div><div class="line">    instances: &#123;&#125;,</div><div class="line">    name: name,</div><div class="line">    parent: parent,</div><div class="line">    matchAs: matchAs,</div><div class="line">    redirect: route.redirect,</div><div class="line">    beforeEnter: route.beforeEnter,</div><div class="line">    meta: route.meta || &#123;&#125;,</div><div class="line">    props:</div><div class="line">      route.props == null</div><div class="line">        ? &#123;&#125;</div><div class="line">        : route.components</div><div class="line">          ? route.props</div><div class="line">          : &#123; default: route.props &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  if (route.children) &#123;...&#125;</div><div class="line"></div><div class="line">  if (!pathMap[record.path]) &#123;</div><div class="line">    pathList.push(record.path);</div><div class="line">    pathMap[record.path] = record;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (route.alias !== undefined) &#123;...&#125;</div><div class="line"></div><div class="line">  if (name) &#123;</div><div class="line">    if (!nameMap[name]) &#123;</div><div class="line">      nameMap[name] = record;</div><div class="line">    &#125; else if ( !matchAs) &#123;</div><div class="line">      warn(</div><div class="line">        false,</div><div class="line">        &quot;Duplicate named routes definition: &quot; +</div><div class="line">          &quot;&#123; name: \&quot;&quot; + name + &quot;\&quot;, path: \&quot;&quot; + (record.path) + &quot;\&quot; &#125;&quot;</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åˆå¹¶params"><a href="#åˆå¹¶params" class="headerlink" title="åˆå¹¶params"></a>åˆå¹¶params</h3><p>åœ¨matchå‡½æ•°ä¸­é¦–å…ˆä¼šæ•´ç†å‚æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">function normalizeLocation (</div><div class="line">   raw,</div><div class="line">   current,</div><div class="line">   append,</div><div class="line">   router</div><div class="line"> ) &#123;</div><div class="line">   //linkæ ‡ç­¾ç‚¹å‡»ä¼ å…¥çš„rawæ˜¯toæ ‡ç­¾æŒ‡ä»¤çš„å€¼ï¼Œ ä¸ºå­—ç¬¦ä¸²</div><div class="line">   var next = typeof raw === &apos;string&apos; ? &#123; path: raw &#125; : raw;</div><div class="line">   // named target</div><div class="line">   if (next._normalized) &#123;//å·²ç»å¤„ç†è¿‡</div><div class="line">     return next</div><div class="line">   &#125; else if (next.name) &#123; //å½“å‰è°ƒç”¨pushä½¿ç”¨nameæ ‡è®°è·¯ç”±ï¼Œåªä¼šèµ°è¿™ä¸ªåˆ†æ”¯</div><div class="line">     next = extend(&#123;&#125;, raw);</div><div class="line">     var params = next.params;</div><div class="line">     if (params &amp;&amp; typeof params === &apos;object&apos;) &#123;</div><div class="line">       next.params = extend(&#123;&#125;, params);</div><div class="line">     &#125;</div><div class="line">     return next</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   // relative params</div><div class="line">   if (!next.path &amp;&amp; next.params &amp;&amp; current) &#123;</div><div class="line">     next = extend(&#123;&#125;, next);</div><div class="line">     next._normalized = true;</div><div class="line">     var params$1 = extend(extend(&#123;&#125;, current.params), next.params);</div><div class="line">     if (current.name) &#123;</div><div class="line">       next.name = current.name;</div><div class="line">       next.params = params$1;</div><div class="line">     &#125; else if (current.matched.length) &#123;</div><div class="line">       var rawPath = current.matched[current.matched.length - 1].path;</div><div class="line">       next.path = fillParams(rawPath, params$1, (&quot;path &quot; + (current.path)));</div><div class="line">     &#125; else &#123;</div><div class="line">       warn(false, &quot;relative params navigation requires a current route.&quot;);</div><div class="line">     &#125;</div><div class="line">     return next</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   var parsedPath = parsePath(next.path || &apos;&apos;);</div><div class="line">   var basePath = (current &amp;&amp; current.path) || &apos;/&apos;;</div><div class="line">   var path = parsedPath.path</div><div class="line">     ? resolvePath(parsedPath.path, basePath, append || next.append)</div><div class="line">     : basePath;</div><div class="line"></div><div class="line">   var query = resolveQuery(</div><div class="line">     parsedPath.query,</div><div class="line">     next.query,</div><div class="line">     router &amp;&amp; router.options.parseQuery</div><div class="line">   );</div><div class="line"></div><div class="line">   var hash = next.hash || parsedPath.hash;</div><div class="line">   if (hash &amp;&amp; hash.charAt(0) !== &apos;#&apos;) &#123;</div><div class="line">     hash = &quot;#&quot; + hash;</div><div class="line">   &#125;</div><div class="line">   return &#123;</div><div class="line">     _normalized: true,</div><div class="line">     path: path,</div><div class="line">     query: query,</div><div class="line">     hash: hash</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="åˆ›å»ºè·¯ç”±routeå¯¹è±¡"><a href="#åˆ›å»ºè·¯ç”±routeå¯¹è±¡" class="headerlink" title="åˆ›å»ºè·¯ç”±routeå¯¹è±¡"></a>åˆ›å»ºè·¯ç”±routeå¯¹è±¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">function createRoute (</div><div class="line">  record,</div><div class="line">  location,</div><div class="line">  redirectedFrom,</div><div class="line">  router</div><div class="line">) &#123;</div><div class="line">  var stringifyQuery = router &amp;&amp; router.options.stringifyQuery;</div><div class="line"></div><div class="line">  var query = location.query || &#123;&#125;;</div><div class="line">  try &#123;</div><div class="line">    query = clone(query);</div><div class="line">  &#125; catch (e) &#123;&#125;</div><div class="line"></div><div class="line">  var route = &#123;</div><div class="line">    name: location.name || (record &amp;&amp; record.name),</div><div class="line">    meta: (record &amp;&amp; record.meta) || &#123;&#125;,</div><div class="line">    path: location.path || &apos;/&apos;,</div><div class="line">    hash: location.hash || &apos;&apos;,</div><div class="line">    query: query,//è°ƒç”¨pushå‡½æ•°ä¼ é€’è¿›æ¥çš„queryï¼Œèµ‹å€¼æ—¶åªèƒ½èµ‹å€¼jsæ•°æ®ç±»å‹ï¼Œæ‹¿åˆ°çš„ä¹Ÿæ˜¯jsæ•°æ®ç±»å‹</div><div class="line">    params: location.params || &#123;&#125;,</div><div class="line">    fullPath: getFullPath(location, stringifyQuery),//ç”ŸæˆfullPath</div><div class="line">    matched: record ? formatMatch(record) : []</div><div class="line">  &#125;;</div><div class="line">  if (redirectedFrom) &#123;</div><div class="line">    route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery);</div><div class="line">  &#125;</div><div class="line">  return Object.freeze(route) //ç¦æ­¢æ”¹åŠ¨routeå¯¹è±¡</div><div class="line">&#125;</div><div class="line">function getFullPath ( //æ ¹æ®queryç”ŸæˆfullPath</div><div class="line">    ref,</div><div class="line">    _stringifyQuery</div><div class="line">  ) &#123;</div><div class="line">    var path = ref.path;</div><div class="line">    var query = ref.query; if ( query === void 0 ) query = &#123;&#125;;</div><div class="line">    var hash = ref.hash; if ( hash === void 0 ) hash = &apos;&apos;;</div><div class="line"></div><div class="line">    var stringify = _stringifyQuery || stringifyQuery;</div><div class="line">    return (path || &apos;/&apos;) + stringify(query) + hash</div><div class="line">  &#125;</div><div class="line">//ç»„è£…urlä¸Šå‚æ•°çš„éƒ¨åˆ†</div><div class="line">function stringifyQuery (obj) &#123;</div><div class="line">  var res = obj ? Object.keys(obj).map(function (key) &#123;</div><div class="line">    var val = obj[key];</div><div class="line"></div><div class="line">    if (val === undefined) &#123;</div><div class="line">      return &apos;&apos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (val === null) &#123;</div><div class="line">      return encode(key)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (Array.isArray(val)) &#123;</div><div class="line">      var result = [];</div><div class="line">      val.forEach(function (val2) &#123;</div><div class="line">        if (val2 === undefined) &#123;</div><div class="line">          return</div><div class="line">        &#125;</div><div class="line">        if (val2 === null) &#123;</div><div class="line">          result.push(encode(key));</div><div class="line">        &#125; else &#123;</div><div class="line">          result.push(encode(key) + &apos;=&apos; + encode(val2));</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">      return result.join(&apos;&amp;&apos;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return encode(key) + &apos;=&apos; + encode(val)</div><div class="line">  &#125;).filter(function (x) &#123; return x.length &gt; 0; &#125;).join(&apos;&amp;&apos;) : null;</div><div class="line">  return res ? (&quot;?&quot; + res) : &apos;&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥åœ¨è°ƒç”¨å®Œmatchä¹‹åä¼šå¾—åˆ°route,æ¥ç€ä¼šè°ƒç”¨confirmTransition</p>
<h3 id="confirmTransition"><a href="#confirmTransition" class="headerlink" title="confirmTransition"></a>confirmTransition</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div></pre></td><td class="code"><pre><div class="line">åœ¨transitionToè°ƒç”¨æ—¶</div><div class="line">this.confirmTransition(</div><div class="line">  route,</div><div class="line">  function () &#123;</div><div class="line">    this$1.updateRoute(route);//æ›´æ–°routerå¯¹è±¡</div><div class="line">    onComplete &amp;&amp; onComplete(route);//è°ƒç”¨transitionToæ—¶ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°å‡½æ•°ï¼Œé‡Œé¢æœ‰pushHashæ¥æ›´æ”¹url</div><div class="line">    this$1.ensureURL();</div><div class="line"></div><div class="line">    // fire ready cbs once</div><div class="line">    if (!this$1.ready) &#123;</div><div class="line">      this$1.ready = true;</div><div class="line">      this$1.readyCbs.forEach(function (cb) &#123;</div><div class="line">        cb(route);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  function (err) &#123;</div><div class="line">    if (onAbort) &#123;</div><div class="line">      onAbort(err);</div><div class="line">    &#125;</div><div class="line">    if (err &amp;&amp; !this$1.ready) &#123;</div><div class="line">      this$1.ready = true;</div><div class="line">      this$1.readyErrorCbs.forEach(function (cb) &#123;</div><div class="line">        cb(err);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">);</div><div class="line"></div><div class="line">History.prototype.confirmTransition = function confirmTransition (route, onComplete, onAbort) &#123;</div><div class="line">  var this$1 = this;</div><div class="line"></div><div class="line">  var current = this.current;</div><div class="line">  var abort = function (err) &#123;</div><div class="line">    // after merging https://github.com/vuejs/vue-router/pull/2771 we</div><div class="line">    // When the user navigates through history through back/forward buttons</div><div class="line">    // we do not want to throw the error. We only throw it if directly calling</div><div class="line">    // push/replace. That&apos;s why it&apos;s not included in isError</div><div class="line">    if (!isExtendedError(NavigationDuplicated, err) &amp;&amp; isError(err)) &#123;</div><div class="line">      if (this$1.errorCbs.length) &#123;</div><div class="line">        this$1.errorCbs.forEach(function (cb) &#123;</div><div class="line">          cb(err);</div><div class="line">        &#125;);</div><div class="line">      &#125; else &#123;</div><div class="line">        warn(false, &apos;uncaught error during route navigation:&apos;);</div><div class="line">        console.error(err);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    onAbort &amp;&amp; onAbort(err);</div><div class="line">  &#125;;</div><div class="line">  if (</div><div class="line">    isSameRoute(route, current) &amp;&amp;</div><div class="line">    // in the case the route map has been dynamically appended to</div><div class="line">    route.matched.length === current.matched.length</div><div class="line">  ) &#123;</div><div class="line">    this.ensureURL();</div><div class="line">    return abort(new NavigationDuplicated(route))</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  var ref = resolveQueue(</div><div class="line">    this.current.matched,</div><div class="line">    route.matched</div><div class="line">  );</div><div class="line">    var updated = ref.updated;</div><div class="line">    var deactivated = ref.deactivated;</div><div class="line">    var activated = ref.activated;</div><div class="line"></div><div class="line">  var queue = [].concat(</div><div class="line">    // in-component leave guards</div><div class="line">    extractLeaveGuards(deactivated),</div><div class="line">    // global before hooks</div><div class="line">    this.router.beforeHooks,</div><div class="line">    // in-component update hooks</div><div class="line">    extractUpdateHooks(updated),</div><div class="line">    // in-config enter guards</div><div class="line">    activated.map(function (m) &#123; return m.beforeEnter; &#125;),</div><div class="line">    // async components</div><div class="line">    resolveAsyncComponents(activated)</div><div class="line">  );</div><div class="line"></div><div class="line">  this.pending = route;</div><div class="line">  var iterator = function (hook, next) &#123;</div><div class="line">    if (this$1.pending !== route) &#123;</div><div class="line">      return abort()</div><div class="line">    &#125;</div><div class="line">    try &#123;</div><div class="line">      hook(route, current, function (to) &#123;</div><div class="line">        if (to === false || isError(to)) &#123;</div><div class="line">          // next(false) -&gt; abort navigation, ensure current URL</div><div class="line">          this$1.ensureURL(true);</div><div class="line">          abort(to);</div><div class="line">        &#125; else if (</div><div class="line">          typeof to === &apos;string&apos; ||</div><div class="line">          (typeof to === &apos;object&apos; &amp;&amp;</div><div class="line">            (typeof to.path === &apos;string&apos; || typeof to.name === &apos;string&apos;))</div><div class="line">        ) &#123;</div><div class="line">          // next(&apos;/&apos;) or next(&#123; path: &apos;/&apos; &#125;) -&gt; redirect</div><div class="line">          abort();</div><div class="line">          if (typeof to === &apos;object&apos; &amp;&amp; to.replace) &#123;</div><div class="line">            this$1.replace(to);</div><div class="line">          &#125; else &#123;</div><div class="line">            this$1.push(to);</div><div class="line">          &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">          // confirm transition and pass on the value</div><div class="line">          next(to);</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">    &#125; catch (e) &#123;</div><div class="line">      abort(e);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  runQueue(queue, iterator, function () &#123;</div><div class="line">    var postEnterCbs = [];</div><div class="line">    var isValid = function () &#123; return this$1.current === route; &#125;;</div><div class="line">    // wait until async components are resolved before</div><div class="line">    // extracting in-component enter guards</div><div class="line">    var enterGuards = extractEnterGuards(activated, postEnterCbs, isValid);</div><div class="line">    var queue = enterGuards.concat(this$1.router.resolveHooks);</div><div class="line">    runQueue(queue, iterator, function () &#123;</div><div class="line">      if (this$1.pending !== route) &#123;</div><div class="line">        return abort()</div><div class="line">      &#125;</div><div class="line">      this$1.pending = null;</div><div class="line">      onComplete(route);//æ‰€æœ‰éœ€è¦è¿è¡Œçš„é’©å­å‡½æ•°è¿è¡Œå®Œæ‰§è¡Œæ›´æ”¹url,æ›´æ–°current,å¤„ç†é¡µé¢æ»šåŠ¨</div><div class="line">      if (this$1.router.app) &#123;</div><div class="line">        this$1.router.app.$nextTick(function () &#123;</div><div class="line">          postEnterCbs.forEach(function (cb) &#123;</div><div class="line">            cb();</div><div class="line">          &#125;);</div><div class="line">        &#125;);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line"> function runQueue (queue, fn, cb) &#123;</div><div class="line">  var step = function (index) &#123;</div><div class="line">    if (index &gt;= queue.length) &#123;</div><div class="line">      cb();</div><div class="line">    &#125; else &#123;</div><div class="line">      if (queue[index]) &#123;</div><div class="line">        fn(queue[index], function () &#123;</div><div class="line">          step(index + 1);</div><div class="line">        &#125;);</div><div class="line">      &#125; else &#123;</div><div class="line">        step(index + 1);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">  step(0);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">History.prototype.updateRoute = function updateRoute (route) &#123;</div><div class="line">  var prev = this.current;</div><div class="line">  this.current = route;</div><div class="line">  this.cb &amp;&amp; this.cb(route); //é€šçŸ¥appæ›´æ”¹_routeå±æ€§å€¼ï¼Œå³æ›´æ”¹$routeå€¼</div><div class="line">  this.router.afterHooks.forEach(function (hook) &#123;</div><div class="line">    hook &amp;&amp; hook(route, prev);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">this.cbåœ¨installçš„æ—¶å€™è¢«å®šä¹‰å¦‚æœè·å–</div><div class="line">History.prototype.listen = function listen (cb) &#123;</div><div class="line">  this.cb = cb;</div><div class="line">&#125;;</div><div class="line">//åœ¨new vueæ—¶è¢«å®šä¹‰</div><div class="line">VueRouter.prototype.init = function init (app ) &#123;</div><div class="line">  history.listen(function (route) &#123;</div><div class="line">    this$1.apps.forEach(function (app) &#123;</div><div class="line">      app._route = route;</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line">//installçš„æ—¶å€™</div><div class="line">function install (Vue) &#123;</div><div class="line">  Object.defineProperty(Vue.prototype, &apos;$route&apos;, &#123;</div><div class="line">    get: function get () &#123; return this._routerRoot._route &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="linkæ ‡ç­¾è·³è½¬è·¯ç”±"><a href="#linkæ ‡ç­¾è·³è½¬è·¯ç”±" class="headerlink" title="linkæ ‡ç­¾è·³è½¬è·¯ç”±"></a>linkæ ‡ç­¾è·³è½¬è·¯ç”±</h2><p>ç‚¹å‡»linkæ ‡ç­¾æ—¶ï¼Œæ ¹æ®ç»‘å®šå‡½æ•°å³å¯çŸ¥é“ï¼ŒåŒæ ·ä¼šè°ƒç”¨router.push<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">var router = this.$router;</div><div class="line">var current = this.$route;</div><div class="line">var ref = router.resolve(</div><div class="line">  this.to,</div><div class="line">  current,</div><div class="line">  this.append</div><div class="line">);</div><div class="line"></div><div class="line">var location = ref.location;</div><div class="line">var route = ref.route;</div><div class="line">var href = ref.href;</div><div class="line"></div><div class="line">var handler = function (e) &#123;</div><div class="line">  if (guardEvent(e)) &#123;</div><div class="line">    if (this$1.replace) &#123;</div><div class="line">      router.replace(location, noop);</div><div class="line">    &#125; else &#123;</div><div class="line">      router.push(location, noop);//push,ç›´æ¥èµ°åŒæ­¥æµç¨‹</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var on = &#123; click: guardEvent &#125;;</div><div class="line">if (Array.isArray(this.event)) &#123;</div><div class="line">  this.event.forEach(function (e) &#123;</div><div class="line">    on[e] = handler;</div><div class="line">  &#125;);</div><div class="line">&#125; else &#123;</div><div class="line">  on[this.event] = handler;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ï¼Œç»è¿‡resolveå¤„ç†è¿‡çš„toæ ‡ç­¾å±æ€§çš„å€¼ï¼Œä¼šç”Ÿæˆç»Ÿä¸€è§„èŒƒçš„åç»­éœ€è¦ä½¿ç”¨çš„location,route<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">VueRouter.prototype.resolve = function resolve (</div><div class="line">  to,</div><div class="line">  current,</div><div class="line">  append</div><div class="line">) &#123;</div><div class="line">  current = current || this.history.current;</div><div class="line">  var location = normalizeLocation(</div><div class="line">    to,</div><div class="line">    current,</div><div class="line">    append,</div><div class="line">    this</div><div class="line">  );</div><div class="line">  var route = this.match(location, current);</div><div class="line">  var fullPath = route.redirectedFrom || route.fullPath;</div><div class="line">  var base = this.history.base;</div><div class="line">  var href = createHref(base, fullPath, this.mode);</div><div class="line">  return &#123;</div><div class="line">    location: location,</div><div class="line">    route: route,</div><div class="line">    href: href,</div><div class="line">    // for backwards compat</div><div class="line">    normalizedTo: location,</div><div class="line">    resolved: route</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>location ä¼šåœ¨normalizeLocationä¸­ä»¥ç¬¬ä¸‰ä¸ªreturnçš„ä½ç½®è¿”å›å¦‚ä¸‹ç»“æ„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  _normalized: true,</div><div class="line">  path: path,</div><div class="line">  query: query,</div><div class="line">  hash: hash</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ç›¸å½“äºæå‰normalizeLocationè°ƒç”¨ï¼Œæ‰€ä»¥åœ¨matchå†è°ƒç”¨çš„æ—¶å€™ç›´æ¥è¿”å›è‡ªèº«<br>åœ¨æ¥ä¸‹æ¥çš„matchæµç¨‹ä¸­,ä¼šè¿›å…¥ä»¥pathä¸ºä¾æ®çš„æµç¨‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">else if (location.path) &#123;</div><div class="line">  location.params = &#123;&#125;;</div><div class="line">  for (var i = 0; i &lt; pathList.length; i++) &#123;</div><div class="line">    var path = pathList[i];</div><div class="line">    var record$1 = pathMap[path];//æ ¹æ®pathæ‹¿åˆ°recordå¯¹è±¡</div><div class="line">    if (matchRoute(record$1.regex, location.path, location.params)) &#123;</div><div class="line">      return _createRoute(record$1, location, redirectedFrom)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ ¹æ®æ ‡ç­¾toèµ‹äºˆçš„pathå€¼ï¼Œå’Œç”Ÿæˆè·¯ç”±è¡¨æ—¶æ‹¿åˆ°çš„pathé…ç½®å€¼ï¼Œæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼è§£æparamså¯¹è±¡ï¼Œ<br>ä¹Ÿè¯´æ˜äº†ï¼Œä¸ºä»€ä¹ˆè·³è½¬è·¯åŒ…å«åŠ¨æ€å‚æ•°çš„pathæ—¶ï¼Œè¦è·Ÿparamsé…å¯¹ä½¿ç”¨</p>
<h3 id="matchRoute"><a href="#matchRoute" class="headerlink" title="matchRoute"></a>matchRoute</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">function matchRoute (</div><div class="line">    regex,</div><div class="line">    path,</div><div class="line">    params</div><div class="line">  ) &#123;</div><div class="line">    var m = path.match(regex);</div><div class="line">    if (!m) &#123;//å½“å‰è·¯ç”±ä¸ç¬¦åˆrouteå®šä¹‰æ—¶æ ¼å¼</div><div class="line">      return false</div><div class="line">    &#125; else if (!params) &#123;</div><div class="line">      return true</div><div class="line">    &#125;</div><div class="line">    //åŒ¹é…è·¯ç”±ç»„è£…params</div><div class="line">    for (var i = 1, len = m.length; i &lt; len; ++i) &#123;</div><div class="line">      var key = regex.keys[i - 1];</div><div class="line">      var val = typeof m[i] === &apos;string&apos; ? decodeURIComponent(m[i]) : m[i];//å§‹ç»ˆä¸ºå­å­—ç¬¦ä¸²</div><div class="line">      if (key) &#123;</div><div class="line">        // Fix #1994: using * with props: true generates a param named 0</div><div class="line">        params[key.name || &apos;pathMatch&apos;] = val;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return true</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="ç›´æ¥æ›´æ”¹urlè·³è½¬"><a href="#ç›´æ¥æ›´æ”¹urlè·³è½¬" class="headerlink" title="ç›´æ¥æ›´æ”¹urlè·³è½¬"></a>ç›´æ¥æ›´æ”¹urlè·³è½¬</h2><p>åœ¨æµè§ˆå™¨ç›´æ¥æ›´æ”¹å«æœ‰åŠ¨æ€è·¯ç”±çš„çš„urlï¼Œå›è½¦è·³è½¬ï¼Œä¼šæ ¹æ®äº‹å…ˆç»‘å®šçš„ç›‘å¬äº‹ä»¶è¿›è¡Œè§£æå¤„ç†<br>åœ¨new vueæ—¶åˆå§‹åŒ–å®Œå½“å‰è·¯ç”±ï¼Œä»¥æ‰§è¡Œå›è°ƒçš„æ–¹å¼ç»‘å®šç›‘å¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">  VueRouter.prototype.init = function init (app /* Vue component instance */) &#123;</div><div class="line">  var this$1 = this;</div><div class="line"></div><div class="line">  this.app = app;</div><div class="line"></div><div class="line">  var history = this.history;</div><div class="line"></div><div class="line">  if (history instanceof HTML5History) &#123; //h5historyåœ¨new h5historyæ—¶ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®popstateäº‹ä»¶ç›‘å¬</div><div class="line">    history.transitionTo(history.getCurrentLocation());</div><div class="line">  &#125; else if (history instanceof HashHistory) &#123;</div><div class="line">    var setupHashListener = function () &#123;</div><div class="line">      history.setupListeners();//è®¾ç½®ç›‘å¬</div><div class="line">    &#125;;</div><div class="line">    history.transitionTo( //æ— è®ºæˆåŠŸä¸å¦éƒ½ç»‘å®š</div><div class="line">      history.getCurrentLocation(),</div><div class="line">      setupHashListener, </div><div class="line">      setupHashListener</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  history.listen(function (route) &#123; //routeæ”¹å˜æ—¶è°ƒç”¨ï¼Œthis.cb</div><div class="line">    this$1.apps.forEach(function (app) &#123;</div><div class="line">      app._route = route;</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>è®¾ç½®ç›‘å¬å…·ä½“å†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">HashHistory.prototype.setupListeners = function setupListeners () &#123;</div><div class="line">    var this$1 = this;</div><div class="line"></div><div class="line">    var router = this.router;</div><div class="line">    var expectScroll = router.options.scrollBehavior;</div><div class="line">    var supportsScroll = supportsPushState &amp;&amp; expectScroll;</div><div class="line"></div><div class="line">    if (supportsScroll) &#123;</div><div class="line">      setupScroll();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    window.addEventListener(</div><div class="line">      supportsPushState ? &apos;popstate&apos; : &apos;hashchange&apos;,</div><div class="line">      function () &#123;</div><div class="line">        var current = this$1.current;</div><div class="line">        if (!ensureSlash()) &#123;</div><div class="line">          return</div><div class="line">      &#125;</div><div class="line">       //ç›´æ¥è°ƒç”¨transitionToè¿›è¡Œè·¯ç”±æ›´æ–°</div><div class="line">      this$1.transitionTo(getHash(), function (route) &#123; //æˆåŠŸå›è°ƒä¸ç”¨pushHashæ›´æ–°url</div><div class="line">        if (supportsScroll) &#123;</div><div class="line">          handleScroll(this$1.router, route, current, true);</div><div class="line">        &#125;</div><div class="line">        if (!supportsPushState) &#123;</div><div class="line">          replaceHash(route.fullPath);</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  );</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å¯è§é€šè¿‡ç›‘å¬äº‹ä»¶è§¦å‘çš„è·¯ç”±æ”¹å˜ä¼šç›´æ¥è°ƒç”¨transitionToå‡½æ•°è¿›è¡Œè·³è½¬</p>
<h1 id="ä¸¤ä¸ªæ”¶è·"><a href="#ä¸¤ä¸ªæ”¶è·" class="headerlink" title="ä¸¤ä¸ªæ”¶è·"></a>ä¸¤ä¸ªæ”¶è·</h1><p>1.normalizeLocationå‡½æ•°å‘æŒ¥çš„ä½œç”¨ï¼Œæ ¹æ®ç¬¬ä¸€å‚æ•°locationå¯¹è±¡ä¸åŒçš„å±æ€§çŠ¶æ€è¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œç”¨äºåœ¨ä¸Šæ¸¸çš„ä¸åŒæƒ…å¢ƒ(ä¸åŒæ–¹å¼å¯¼è‡´è·³è½¬)ä½¿ç”¨ä¸­ç»Ÿä¸€è°ƒç”¨<br>2.åœ¨transitionToå‡½æ•°ä¸­è°ƒç”¨comfirmTransition,ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨transitionToå‡½æ•°ä¸­ä¹¦å†™confirmTransitionå‡½æ•°å†…å®¹å‘¢ï¼Œä¸ºä»€ä¹ˆè¦å•ç‹¬æ‘˜å‡ºæ¥å‘¢ï¼ŸåŒæ ·ï¼ŒcomfirmTransitionå‡½æ•°ä¸æ­¢ä¼šåœ¨transitionä¸­è°ƒç”¨,<br>è¿˜ä¼šåœ¨AbstractHistoryçš„goå‡½æ•°ä¸­è¢«ç›´æ¥è°ƒç”¨ï¼ŒHashHistoryå’ŒHTML5Historyçš„goæ–¹æ³•ä¼šç›´æ¥ä½¿ç”¨window.history.go(n);nodejså…¨å±€å¯¹è±¡æ˜¯global,ä¸æ˜¯windows,æ‰€ä»¥éœ€è¦ç‰¹æ®Šå¤„ç†</p>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/di
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue æºç å­¦ä¹ äºŒã€ç¼–è¯‘å™¨ã€‘</title>
    <link href="http://yoohannah.github.io/post/vue/src2.html"/>
    <id>http://yoohannah.github.io/post/vue/src2.html</id>
    <published>2020-02-05T04:41:15.000Z</published>
    <updated>2020-04-04T11:42:09.215Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/image/lifecycle.png" alt="Vueå£°æ˜å‘¨æœŸ"><br>åˆ†æå®˜ç½‘çš„æµç¨‹å›¾å¯çŸ¥<br>new Vueæ—¶ï¼Œè¿›è¡Œä¸€ç³»åˆ—initxxxåˆå§‹åŒ–å·¥ä½œåä¼šæ ¹æ®é€‰é¡¹elå’Œtemplateé…ç½®æƒ…å†µå»åšç¼–è¯‘<br>å³<br>æƒ…å†µ1ï¼šæŒ‚è½½äº†elå’Œtemplateæƒ…å†µä¸‹ç›´æ¥å»å°†templateç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°<br>æƒ…å†µ2ï¼šæŒ‚è½½äº†elè€Œæ²¡æœ‰æŒ‚è½½templateæƒ…å†µä¸‹ï¼Œå°†ä»¥elå¤–éƒ¨çš„htmlä¸ºtemplateè¿›è¡Œç¼–è¯‘<br>æƒ…å†µ3ï¼šæ²¡æœ‰æŒ‚è½½elçš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨$mountå‡½æ•°æŒ‚è½½ï¼Œè¿™æ—¶å†å»åˆ¤æ–­æœ‰æ²¡æœ‰æŒ‚è½½templateï¼Œåœ¨è¿›è¡Œä¾æ®templateæœ‰æ— ç»§ç»­æ¥ä¸‹æ¥çš„ç¼–è¯‘å·¥ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._init = function (options) &#123;</div><div class="line">    var vm = this;</div><div class="line">    vm._uid = uid$3++;</div><div class="line">    var startTag, endTag;</div><div class="line">    vm._isVue = true;  // é˜²æ­¢è¢«ç›‘å¬çš„æ ‡è¯†</div><div class="line">    //åˆå¹¶å†…ç½®é€‰é¡¹ä¸ä¼ è¿›æ¥çš„é€‰é¡¹</div><div class="line">    if (options &amp;&amp; options._isComponent) &#123;</div><div class="line">      initInternalComponent(vm, options);</div><div class="line">    &#125; else &#123;</div><div class="line">      vm.$options = mergeOptions(</div><div class="line">        resolveConstructorOptions(vm.constructor),</div><div class="line">        options || &#123;&#125;,</div><div class="line">        vm</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">    /* istanbul ignore else */</div><div class="line">    &#123;</div><div class="line">      initProxy(vm);</div><div class="line">    &#125;</div><div class="line">    //è¿›è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–</div><div class="line">    vm._self = vm;</div><div class="line">    initLifecycle(vm);</div><div class="line">    initEvents(vm);</div><div class="line">    initRender(vm);</div><div class="line">    callHook(vm, &apos;beforeCreate&apos;);</div><div class="line">    initInjections(vm); </div><div class="line">    initState(vm);//å¯¹æ•°æ®è¿›è¡ŒåŠ«æŒ</div><div class="line">    initProvide(vm); </div><div class="line">    callHook(vm, &apos;created&apos;);</div><div class="line"></div><div class="line">    if (vm.$options.el) &#123; //åˆ¤æ–­æœ‰æ²¡æœ‰é…ç½®el,æœ‰åˆ™è°ƒç”¨vm.$mountè¿›å…¥æƒ…å†µ1å’Œ2ï¼Œæ²¡æœ‰åˆ™è¿›å…¥æƒ…å†µ3ï¼Œç­‰å¾…æ‰‹åŠ¨è°ƒç”¨vm.$mount</div><div class="line">      vm.$mount(vm.$options.el);//ç”Ÿæˆæ¸²æŸ“å‡½æ•°åï¼Œç»™optionæŒ‚ä¸Šrenderï¼ŒstaticRenderFnså±æ€§</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="mountæŒ‚è½½å‡½æ•°çš„å·§å¦™è®¾è®¡"><a href="#mountæŒ‚è½½å‡½æ•°çš„å·§å¦™è®¾è®¡" class="headerlink" title="$mountæŒ‚è½½å‡½æ•°çš„å·§å¦™è®¾è®¡"></a>$mountæŒ‚è½½å‡½æ•°çš„å·§å¦™è®¾è®¡</h1><p>ä¸€å¼€å§‹å®šä¹‰çš„$mountä»…ç”¨äºè¿è¡Œæ—¶ï¼ŒåŠŸèƒ½æ˜¯å°†ç¼–è¯‘å¥½çš„æ¸²æŸ“å‡½æ•°è¿è¡Œå®ç°æŒ‚è½½ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Vue.prototype.$mount = function ( </div><div class="line">  el,</div><div class="line">  hydrating</div><div class="line">) &#123;</div><div class="line">  el = el &amp;&amp; inBrowser ? query(el) : undefined;</div><div class="line">  return mountComponent(this, el, hydrating)</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>ä¹‹åä¼šå°†è¿è¡Œæ—¶å®šä¹‰å­˜æ”¾åˆ°å¦ä¸€ä¸ªå˜é‡<br>æ–¹ä¾¿å®šä¹‰ä¹‹ååŒ…å«ç¼–è¯‘æ­¥éª¤çš„æŒ‚è½½å‡½æ•°ï¼Œ<br>åŒæ—¶ç¼–è¯‘è¿è¡Œæ–¹æ¡ˆè¿˜ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°<br>è¿™æ ·åœ¨æ‰“åŒ…æ—¶ï¼Œå°±å¯ä»¥æ–¹ä¾¿çš„å»æ‰è¿›è¡Œç¼–è¯‘è¿‡ç¨‹çš„ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var mount = Vue.prototype.$mount;</div></pre></td></tr></table></figure></p>
<p>åœ¨å®šä¹‰å«æœ‰ç¼–è¯‘è¿‡ç¨‹çš„æŒ‚è½½å‡½æ•°ï¼Œå°†templateç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°<br>å†è°ƒç”¨è¿è¡Œæ—¶$mount(è¿™æ—¶ä¾æ‰˜åœ¨mountå˜é‡ä¸Š)ï¼Œè¿›è¡ŒæŒ‚è½½ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">Vue.prototype.$mount = function (</div><div class="line">  el,</div><div class="line">  hydrating</div><div class="line">) &#123;</div><div class="line">  el = el &amp;&amp; query(el);//queryæ£€æŸ¥æŒ‚è½½ç‚¹domæ˜¯å¦å­˜åœ¨</div><div class="line">  //ä¸è¦æŒ‚è½½åˆ°&lt;body&gt;å…ƒç´ æˆ–è€…&lt;html&gt;å…ƒç´ ,</div><div class="line">  //å› ä¸ºæŒ‚è½½ç‚¹çš„æœ¬æ„æ˜¯ç»„ä»¶æŒ‚è½½çš„å ä½ï¼Œå®ƒå°†ä¼šè¢«ç»„ä»¶è‡ªèº«çš„æ¨¡æ¿æ›¿æ¢æ‰ï¼Œè€Œ&lt;body&gt;å…ƒç´ å’Œ&lt;html&gt;å…ƒç´ æ˜¯ä¸èƒ½è¢«æ›¿æ¢æ‰çš„ã€‚</div><div class="line">  if (el === document.body || el === document.documentElement) &#123;</div><div class="line">    warn(</div><div class="line">      &quot;Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.&quot;</div><div class="line">    );</div><div class="line">    return this</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  var options = this.$options;</div><div class="line">  // è§£æ template/el è½¬æ¢æˆrenderå‡½æ•°</div><div class="line">  if (!options.render) &#123;</div><div class="line">    var template = options.template;</div><div class="line">    if (template) &#123; //é…ç½®äº†template</div><div class="line">      if (typeof template === &apos;string&apos;) &#123;</div><div class="line">        //å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ #ï¼Œé‚£ä¹ˆä¼šæŠŠè¯¥å­—ç¬¦ä¸²ä½œä¸º css é€‰æ‹©ç¬¦</div><div class="line">        //å»é€‰ä¸­å¯¹åº”çš„å…ƒç´ ï¼Œå¹¶æŠŠè¯¥å…ƒç´ çš„ innerHTML ä½œä¸ºæ¨¡æ¿</div><div class="line">        if (template.charAt(0) === &apos;#&apos;) &#123;</div><div class="line">          template = idToTemplate(template);</div><div class="line">          if (!template) &#123;</div><div class="line">            warn((&quot;Template element not found or is empty: &quot; + (options.template)),this);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; else if (template.nodeType) &#123; </div><div class="line">        //å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ #ï¼Œä¸”templateçš„ç±»å‹æ˜¯å…ƒç´ èŠ‚ç‚¹,</div><div class="line">        //é‚£å°±ç”¨ template è‡ªèº«çš„å­—ç¬¦ä¸²å€¼ä½œä¸ºæ¨¡æ¿</div><div class="line">        template = template.innerHTML;</div><div class="line">      &#125; else &#123;&#123; warn(&apos;invalid template option:&apos; + template, this);&#125;</div><div class="line">        //å¦åˆ™æŠ¥é”™ä¸å­˜åœ¨é…ç½®çš„template</div><div class="line">        return this</div><div class="line">      &#125;</div><div class="line">    &#125; else if (el) &#123; //å¦‚æœtemplateé€‰é¡¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä½¿ç”¨elå…ƒç´ çš„outerHTMLä½œä¸ºæ¨¡æ¿å†…å®¹</div><div class="line">      template = getOuterHTML(el);</div><div class="line">    &#125;</div><div class="line">    if (template) &#123;</div><div class="line">      //ç¼–è¯‘ç”Ÿæˆé™æ€ç»“ç‚¹æ¸²æŸ“å‡½æ•°å’ŒåŠ¨æ€ç»“ç‚¹æ¸²æŸ“å‡½æ•°</div><div class="line">      var ref = compileToFunctions(template, &#123;...å‚æ•°ä¸‹æ–‡æœ‰è¯´æ˜&#125;, this);</div><div class="line">      var render = ref.render;</div><div class="line">      var staticRenderFns = ref.staticRenderFns;</div><div class="line">      //ç”Ÿæˆæ¸²æŸ“å‡½æ•°åï¼Œç»™optionæŒ‚ä¸Šrenderï¼ŒstaticRenderFnsæ¸²æŸ“å‡½æ•°å±æ€§</div><div class="line">      options.render = render;</div><div class="line">      options.staticRenderFns = staticRenderFns;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  return mount.call(this, el, hydrating) //è°ƒç”¨è¿è¡Œæ—¶æŒ‚è½½å‡½æ•°</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h1 id="compileToFunctions"><a href="#compileToFunctions" class="headerlink" title="compileToFunctions"></a>compileToFunctions</h1><p>compileToFunctions ä½œç”¨å°±ä¸¤ä¸ª<br>1.è°ƒç”¨compileç¼–è¯‘ç”Ÿæˆæ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²<br>2.å°†æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ç”Ÿæˆæ¸²æŸ“å‡½æ•°è¿”å›<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">function createCompileToFunctionFn (compile) &#123;</div><div class="line">  var cache = Object.create(null);</div><div class="line">  return function compileToFunctions (template, options,vm) &#123;</div><div class="line">    options = extend(&#123;&#125;, options);</div><div class="line">    var warn$$1 = options.warn || warn;</div><div class="line">    delete options.warn;</div><div class="line">      &#123;  //æ£€æµ‹ new Function() æ˜¯å¦å¯ç”¨ï¼Œ</div><div class="line">         //åœ¨æŸäº›æç«¯æƒ…å†µä¸‹(å¦‚CSPé™åˆ¶)ç»™ä¸€ä¸ªæœ‰ç”¨çš„æç¤º</div><div class="line">        try &#123;new Function(&apos;return 1&apos;);&#125; catch (e) &#123;</div><div class="line">          if (e.toString().match(/unsafe-eval|CSP/)) &#123;</div><div class="line">            warn$$1(...è­¦å‘Šå†…å®¹);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    // æœ‰ç¼“å­˜ç›´æ¥è¿”å›ç¼“å­˜ï¼Œä¸ç”¨å†è¿›è¡Œç¼–è¯‘ä¸€æ¬¡ï¼Œ</div><div class="line">    // cacheåœ¨é—­åŒ…çˆ¶åŸŸå®šä¹‰ï¼Œç›¸å½“äºå…¨å±€ï¼Œ</div><div class="line">    // æ‰€ä»¥æ¯æ¬¡ç¼–è¯‘çš„ç»“æœéƒ½å¯ä»¥ç¼“å­˜èµ·æ¥</div><div class="line">    //options.delimitersè¿™ä¸ªé€‰é¡¹æ˜¯é…ç½®çº¯æ–‡æœ¬æ’å…¥åˆ†éš”ç¬¦</div><div class="line">    //è¿™é‡Œç”¨æ¥æ‹¼æ¥åšç¼“å­˜keyå€¼</div><div class="line">    var key = options.delimiters </div><div class="line">      ? String(options.delimiters) + template</div><div class="line">      : template;</div><div class="line">    if (cache[key]) &#123;</div><div class="line">      return cache[key]</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //è°ƒç”¨ baseCompileç¼–è¯‘æ¨¡æ¿å¹¶è¿”å›å…¶ç”Ÿæˆçš„å€¼ </div><div class="line">    var compiled = compile(template, options);</div><div class="line"></div><div class="line">    //å°†å­—ç¬¦ä¸²ä»£ç è½¬æ¢æˆå‡½æ•°</div><div class="line">    var res = &#123;&#125;;</div><div class="line">    var fnGenErrors = [];</div><div class="line">    res.render = createFunction(compiled.render, fnGenErrors);</div><div class="line">    res.staticRenderFns = compiled.staticRenderFns.map(function (code) &#123;</div><div class="line">      return createFunction(code, fnGenErrors)</div><div class="line">    &#125;);</div><div class="line">    return (cache[key] = res)//ç¼“å­˜å­—ç¬¦ä¸²æ¨¡æ¿çš„ç¼–è¯‘ç»“æœï¼Œé˜²æ­¢é‡å¤ç¼–è¯‘ï¼Œæå‡æ€§èƒ½</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>try-catchè¯­å¥å¦‚æœæœ‰é”™è¯¯å‘ç”Ÿä¸”é”™è¯¯çš„å†…å®¹ä¸­<br>åŒ…å«å¦‚ â€˜unsafe-evalâ€™ æˆ–è€… â€˜CSPâ€™ è¿™äº›å­—æ ·çš„ä¿¡æ¯æ—¶å°±ä¼šç»™å‡ºä¸€ä¸ªè­¦å‘Š</p>
<p>CSPå…¨ç§°Content Security Policy ,å¯ä»¥ç›´æ¥ç¿»è¯‘ä¸ºå†…å®¹å®‰å…¨ç­–ç•¥<br>å°±æ˜¯ä¸ºäº†é¡µé¢å†…å®¹å®‰å…¨è€Œåˆ¶å®šçš„ä¸€ç³»åˆ—é˜²æŠ¤ç­–ç•¥<br>é€šè¿‡CSPæ‰€çº¦æŸçš„çš„è§„è´£æŒ‡å®šå¯ä¿¡çš„å†…å®¹æ¥æº<br>ï¼ˆè¿™é‡Œçš„å†…å®¹å¯ä»¥æŒ‡è„šæœ¬ã€å›¾ç‰‡ã€iframeã€ftonã€styleç­‰ç­‰å¯èƒ½çš„è¿œç¨‹çš„èµ„æºï¼‰ã€‚<br>é€šè¿‡CSPåå®šï¼Œè®©WEBå¤„äºä¸€ä¸ªå®‰å…¨çš„è¿è¡Œç¯å¢ƒä¸­</p>
<p>å¦‚æœä½ çš„ç­–ç•¥æ¯”è¾ƒä¸¥æ ¼ï¼Œé‚£ä¹ˆ new Function() å°†ä¼šå—åˆ°å½±å“ï¼Œä»è€Œä¸èƒ½å¤Ÿä½¿ç”¨<br>ä½†æ˜¯å°†æ¨¡æ¿å­—ç¬¦ä¸²ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°åˆä¾èµ– new Function()ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼š<br>1ã€æ”¾å®½ä½ çš„CSPç­–ç•¥<br>2ã€é¢„ç¼–è¯‘</p>
<h1 id="ä¸€äº›å˜é‡å‚æ•°è¯´æ˜"><a href="#ä¸€äº›å˜é‡å‚æ•°è¯´æ˜" class="headerlink" title="ä¸€äº›å˜é‡å‚æ•°è¯´æ˜"></a>ä¸€äº›å˜é‡å‚æ•°è¯´æ˜</h1><p>å› ä¸ºä¹‹ååˆ†æä¼šç”¨åˆ°ï¼Œäº‹å…ˆäº†è§£ä¸€ä¸‹</p>
<h2 id="å˜é‡ä¹‹é—´å…³ç³»"><a href="#å˜é‡ä¹‹é—´å…³ç³»" class="headerlink" title="å˜é‡ä¹‹é—´å…³ç³»"></a>å˜é‡ä¹‹é—´å…³ç³»</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">var modules$1 = [</div><div class="line">	klass$1,</div><div class="line">	style$1,</div><div class="line">	model$1</div><div class="line">];</div><div class="line"></div><div class="line">var klass$1 = &#123;</div><div class="line">	staticKeys: [&apos;staticClass&apos;],</div><div class="line">	transformNode: transformNode,</div><div class="line">	genData: genData</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var style$1 = &#123;</div><div class="line">	staticKeys: [&apos;staticStyle&apos;],</div><div class="line">	transformNode: transformNode$1,</div><div class="line">	genData: genData$1</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var model$1 = &#123;</div><div class="line">	preTransformNode: preTransformNode</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="baseOptions"><a href="#baseOptions" class="headerlink" title="baseOptions"></a>baseOptions</h2><p>baseOptionsåŒ…å«ç¼–è¯‘å™¨åœ¨è¿ä½œçš„æ—¶å€™æ‰€éœ€çš„åŸºæœ¬é…ç½®é€‰é¡¹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">var baseOptions = &#123;</div><div class="line">  expectHTML: true,</div><div class="line">  modules: modules$1,</div><div class="line">  directives: directives$1,</div><div class="line">  isPreTag: isPreTag,</div><div class="line">  isUnaryTag: isUnaryTag,</div><div class="line">  mustUseProp: mustUseProp,</div><div class="line">  canBeLeftOpenTag: canBeLeftOpenTag,</div><div class="line">  isReservedTag: isReservedTag,</div><div class="line">  getTagNamespace: getTagNamespace,</div><div class="line">  staticKeys: genStaticKeys(modules$1)</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸‰ä¸ªå±æ€§ï¼šdirectives å€¼æ˜¯ä¸‰ä¸ªå±æ€§ (modelã€textã€html) çš„å¯¹è±¡ï¼Œä¸”å±æ€§çš„å€¼éƒ½æ˜¯å‡½æ•°ã€‚<br>ç¬¬å››ä¸ªå±æ€§ï¼šisPreTag å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯é€šè¿‡ç»™å®šçš„æ ‡ç­¾åå­—æ£€æŸ¥æ ‡ç­¾æ˜¯å¦æ˜¯ â€˜preâ€™ æ ‡ç­¾ã€‚<br>ç¬¬äº”ä¸ªå±æ€§ï¼šisUnaryTag æ˜¯ä¸€ä¸ªé€šè¿‡makeMapç”Ÿæˆçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯æ£€æµ‹ç»™å®šçš„æ ‡ç­¾æ˜¯å¦æ˜¯ä¸€å…ƒæ ‡ç­¾ã€‚<br>ç¬¬å…­ä¸ªå±æ€§ï¼šmustUseProp å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥æ£€æµ‹ä¸€ä¸ªå±æ€§åœ¨æ ‡ç­¾ä¸­æ˜¯å¦è¦ä½¿ç”¨propsè¿›è¡Œç»‘å®šã€‚<br>ç¬¬ä¸ƒä¸ªå±æ€§ï¼šcanBeLeftOpenTag ä¸€ä¸ªä½¿ç”¨makeMapç”Ÿæˆçš„å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ£€æµ‹éä¸€å…ƒæ ‡ç­¾ï¼Œä½†å´å¯ä»¥è‡ªå·±è¡¥å…¨å¹¶é—­åˆçš„æ ‡ç­¾ã€‚æ¯”å¦‚ div æ ‡ç­¾æ˜¯ä¸€ä¸ªåŒæ ‡ç­¾ï¼Œä½ éœ€è¦è¿™æ ·ä½¿ç”¨&lt;div&gt; text &lt;/div&gt;ï¼Œä½†æ˜¯ä½ ä¾ç„¶å¯ä»¥çœç•¥é—­åˆæ ‡ç­¾ï¼Œç›´æ¥è¿™æ ·å†™ï¼š&lt;div&gt; text ï¼Œä¸”æµè§ˆå™¨ä¼šè‡ªåŠ¨è¡¥å…¨ã€‚ä½†æ˜¯æœ‰äº›æ ‡ç­¾ä½ ä¸å¯ä»¥è¿™æ ·ç”¨ï¼Œå®ƒä»¬æ˜¯ä¸¥æ ¼çš„åŒæ ‡ç­¾ã€‚<br>ç¬¬å…«ä¸ªå±æ€§ï¼šisReservedTag å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯æ£€æŸ¥ç»™å®šçš„æ ‡ç­¾æ˜¯å¦æ˜¯ä¿ç•™çš„æ ‡ç­¾ã€‚<br>ç¬¬ä¹ä¸ªå±æ€§ï¼šgetTagNamespace å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯è·å–å…ƒç´ (æ ‡ç­¾)çš„å‘½åç©ºé—´ã€‚<br>ç¬¬åä¸ªå±æ€§ï¼šstaticKeys å®ƒçš„å€¼æ˜¯é€šè¿‡ä»¥ modules ä¸ºå‚æ•°è°ƒç”¨ genStaticKeys å‡½æ•°çš„è¿”å›å€¼å¾—åˆ°çš„ã€‚ å…¶ä½œç”¨æ˜¯æ ¹æ®ç¼–è¯‘å™¨é€‰é¡¹çš„ modules é€‰é¡¹ç”Ÿæˆä¸€ä¸ªé™æ€é”®å­—ç¬¦ä¸²ã€‚</p>
<h2 id="compileToFunctionsä¼ å…¥çš„å‚æ•°"><a href="#compileToFunctionsä¼ å…¥çš„å‚æ•°" class="headerlink" title="compileToFunctionsä¼ å…¥çš„å‚æ•°"></a>compileToFunctionsä¼ å…¥çš„å‚æ•°</h2><p>å®é™…è°ƒç”¨æ—¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var ref = compileToFunctions(template, &#123;</div><div class="line">  outputSourceRange: &quot;development&quot; !== &apos;production&apos;,</div><div class="line">  shouldDecodeNewlines: shouldDecodeNewlines,</div><div class="line">  shouldDecodeNewlinesForHref: shouldDecodeNewlinesForHref,</div><div class="line">  delimiters: options.delimiters,//æ›´æ”¹çº¯æ–‡æœ¬æ’å…¥ç¬¦</div><div class="line">  comments: options.comments//è®¾ç½®ä¸ºtrueæ—¶ï¼Œä¿ç•™ä¸”æ¸²æŸ“æ¨¡æ¿HTMLæ³¨é‡Šï¼Œfalseæ—¶èˆå¼ƒæ³¨é‡Š</div><div class="line">&#125;, this);</div></pre></td></tr></table></figure></p>
<p>å‚æ•°è¯´æ˜<br>åœ¨æˆ‘ä»¬innerHTMLè·å–å†…å®¹æ—¶ï¼Œæ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦åˆ†åˆ«è¢«è½¬æ¢æˆäº†&amp;#10å’Œ&amp;#9ã€‚<br>åœ¨IEä¸­ï¼Œä¸ä»…ä»…æ˜¯ a æ ‡ç­¾çš„ href å±æ€§å€¼ï¼Œä»»ä½•å±æ€§å€¼éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜<br>è¿™å°±ä¼šå½±å“Vueçš„ç¼–è¯‘å™¨åœ¨å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘åçš„ç»“æœï¼Œä¸ºäº†é¿å…è¿™äº›é—®é¢˜Vueéœ€è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™è¦åšå…¼å®¹å·¥ä½œï¼Œ<br>å¦‚æœ shouldDecodeNewlines ä¸º trueï¼Œæ„å‘³ç€ Vue åœ¨ç¼–è¯‘æ¨¡æ¿çš„æ—¶å€™ï¼Œè¦å¯¹å±æ€§å€¼ä¸­çš„æ¢è¡Œç¬¦æˆ–åˆ¶è¡¨ç¬¦åšå…¼å®¹å¤„ç†ã€‚<br>è€ŒshouldDecodeNewlinesForHrefä¸ºtrue æ„å‘³ç€Vueåœ¨ç¼–è¯‘æ¨¡æ¿çš„æ—¶å€™ï¼Œè¦å¯¹aæ ‡ç­¾çš„ href å±æ€§å€¼ä¸­çš„æ¢è¡Œç¬¦æˆ–åˆ¶è¡¨ç¬¦åšå…¼å®¹å¤„ç†ã€‚<br>delimiterså’Œcommentséƒ½æ˜¯ Vue æä¾›çš„é€‰é¡¹ï¼ŒVueå®ä¾‹çš„$optionså±æ€§<br>delimitersä»£è¡¨çº¯æ–‡æœ¬æ’å…¥åˆ†éš”ç¬¦<br>commentsä»£è¡¨ç¼–è¯‘æ—¶æ˜¯å¦ä¿ç•™æ³¨é‡Šï¼Œä¼šåœ¨parseé˜¶æ®µè¿›è¡Œåˆ¤æ–­</p>
<h1 id="compilerç¼–è¯‘å™¨ç”Ÿæˆ"><a href="#compilerç¼–è¯‘å™¨ç”Ÿæˆ" class="headerlink" title="compilerç¼–è¯‘å™¨ç”Ÿæˆ"></a>compilerç¼–è¯‘å™¨ç”Ÿæˆ</h1><p>compilerçš„çˆ·çˆ·createCompilerCreatorï¼Œ<br>ä¼šç”Ÿæˆcompilerçš„çˆ¸çˆ¸createCompiler<br>createCompilerä¼šç”Ÿæˆcompiler<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">function createCompilerCreator (baseCompile) &#123;</div><div class="line">  return function createCompiler (baseOptions) &#123;</div><div class="line">    function compile (</div><div class="line">      template,</div><div class="line">      options</div><div class="line">    ) &#123;</div><div class="line">      //æ‰€æœ‰çš„é…ç½®é€‰é¡¹æœ€ç»ˆéƒ½ä¼šæŒ‚è½½åœ¨è¿™ä¸ªfinalOptions å¯¹è±¡ä¸Š</div><div class="line">      var finalOptions = Object.create(baseOptions);</div><div class="line">      var errors = [];</div><div class="line">      var tips = [];</div><div class="line">      var warn = function (msg, range, tip) &#123; (tip ? tips : errors).push(msg) &#125;;</div><div class="line">      //optionsä¸ºè°ƒç”¨ compileToFunctions å‡½æ•°æ—¶ä¼ é€’çš„é€‰é¡¹å‚æ•°ã€‚</div><div class="line">      //baseOptionsç†è§£ä¸ºç¼–è¯‘å™¨çš„é»˜è®¤é€‰é¡¹æˆ–è€…åŸºæœ¬é€‰é¡¹ï¼Œoptions æ˜¯ç”¨æ¥æä¾›å®šåˆ¶èƒ½åŠ›çš„æ‰©å±•é€‰é¡¹</div><div class="line">      if (options) &#123;</div><div class="line">        // merge custom modules</div><div class="line">        //å¦‚æœ options.modules å­˜åœ¨ï¼Œå°±åœ¨ finalOptions å¯¹è±¡ä¸Šæ·»åŠ  modules å±æ€§ï¼Œ</div><div class="line">        //å…¶å€¼ä¸º baseOptions.modules å’Œ options.modules è¿™ä¸¤ä¸ªæ•°ç»„åˆå¹¶åçš„æ–°æ•°ç»„</div><div class="line">        if (options.modules) &#123;</div><div class="line">          finalOptions.modules =</div><div class="line">            (baseOptions.modules || []).concat(options.modules);</div><div class="line">        &#125;</div><div class="line">        // merge custom directives</div><div class="line">        //å¯¹äºdirectives é‡‡ç”¨åŸå‹é“¾çš„åŸç†å®ç°æ‰©å±•å±æ€§å¯¹åŸºæœ¬å±æ€§çš„è¦†ç›–</div><div class="line">        if (options.directives) &#123;</div><div class="line">          finalOptions.directives = extend(</div><div class="line">            Object.create(baseOptions.directives || null),</div><div class="line">            options.directives</div><div class="line">          );</div><div class="line">        &#125;</div><div class="line">        // copy other options</div><div class="line">        for (var key in options) &#123;</div><div class="line">          if (key !== &apos;modules&apos; &amp;&amp; key !== &apos;directives&apos;) &#123;</div><div class="line">            finalOptions[key] = options[key];</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      finalOptions.warn = warn;</div><div class="line"></div><div class="line">      var compiled = baseCompile(template.trim(), finalOptions);//è°ƒç”¨ baseCompileå¹¶è¿”å›å…¶ç”Ÿæˆçš„å€¼</div><div class="line">      &#123;</div><div class="line">        detectErrors(compiled.ast, warn);</div><div class="line">      &#125;</div><div class="line">      compiled.errors = errors;</div><div class="line">      compiled.tips = tips;</div><div class="line">      return compiled</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return &#123;</div><div class="line">      compile: compile,</div><div class="line">      compileToFunctions: createCompileToFunctionFn(compile)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¼ å…¥å®é™…ç¼–è¯‘å™¨ç”ŸæˆcreateCompiler<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var createCompiler = createCompilerCreator(function baseCompile (</div><div class="line">  template,</div><div class="line">  options</div><div class="line">) &#123;</div><div class="line">  var ast = parse(template.trim(), options);</div><div class="line">  if (options.optimize !== false) &#123;</div><div class="line">    optimize(ast, options);</div><div class="line">  &#125;</div><div class="line">  var code = generate(ast, options);</div><div class="line">  return &#123;</div><div class="line">    ast: ast,</div><div class="line">    render: code.render,</div><div class="line">    staticRenderFns: code.staticRenderFns</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">var ref$1 = createCompiler(baseOptions);</div><div class="line">var compile = ref$1.compile;</div><div class="line">var compileToFunctions = ref$1.compileToFunctions;</div></pre></td></tr></table></figure></p>
<p>å¯è§compileToFunctionsä¹Ÿç”±createCompilerå‡½æ•°ç”Ÿæˆ</p>
<p>createCompilerå‡½æ•° ç”± createCompilerCreatorå‡½æ•°åœ¨ä¼ å…¥å‡½æ•° baseCompile æ¡ä»¶ä¸‹ç”Ÿæˆ</p>
<p>åœ¨createCompilerå‡½æ•°ä¸­ä¼šå£°æ˜compileå‡½æ•°,åœ¨compileä¸­ä¼šè°ƒç”¨ baseCompileå¹¶è¿”å›å…¶ç”Ÿæˆçš„å€¼</p>
<p>ç„¶åå¯¹ createCompileToFunctionFn å‡½æ•°ä¼ å…¥compileå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°å³compileToFunctions</p>
<p>åœ¨compileToFunctions å‡½æ•°ä¸­ä¼šè°ƒç”¨compileå‡½æ•°å¹¶å¤„ç†å…¶è¿”å›å€¼<br>æœ€ç»ˆç”Ÿæˆrenderå’ŒstaticRenderFnså±æ€§</p>
<p>æ‰€ä»¥å¯è§åœ¨compileToFunctionsè¿˜æ˜¯åœ¨è°ƒç”¨baseCompileæ¥ç”Ÿæˆrenderå’ŒstaticRenderFnså±æ€§ï¼Œ<br>ç°åœ¨æ‘˜å‡ºæ¥ä¸»è¦é€»è¾‘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">//baseå‡½æ•°</div><div class="line">function baseCompile (</div><div class="line">  template,</div><div class="line">  options</div><div class="line">) &#123;</div><div class="line">  var ast = parse(template.trim(), options);</div><div class="line">  if (options.optimize !== false) &#123;</div><div class="line">    optimize(ast, options);</div><div class="line">  &#125;</div><div class="line">  var code = generate(ast, options);</div><div class="line">  return &#123;</div><div class="line">    ast: ast,</div><div class="line">    render: code.render,</div><div class="line">    staticRenderFns: code.staticRenderFns</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// compileToFunctionsè°ƒç”¨compile</div><div class="line">// å®é™…è°ƒç”¨ baseCompileå¾—åˆ°å…¶ç”Ÿæˆçš„å€¼</div><div class="line">var compiled = compile(template, options);</div><div class="line"></div><div class="line">// è°ƒç”¨åå¤„ç†</div><div class="line">//å°†å­—ç¬¦ä¸²è½¬æˆå‡½æ•°</div><div class="line">var res = &#123;&#125;;</div><div class="line">var fnGenErrors = [];</div><div class="line">res.render = createFunction(compiled.render, fnGenErrors);</div><div class="line">res.staticRenderFns = compiled.staticRenderFns.map(function (code) &#123;</div><div class="line">  return createFunction(code, fnGenErrors)</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>baseCompile çš„ä¸»è¦æ ¸å¿ƒä»£ç ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var ast =parse(template.trim(), options);</div></pre></td></tr></table></figure></p>
<p>parse ä¼šç”¨æ­£åˆ™ç­‰æ–¹å¼è§£æ template æ¨¡æ¿ä¸­çš„æŒ‡ä»¤ã€classã€styleç­‰æ•°æ®ï¼Œå½¢æˆASTã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optimize(ast, options);</div></pre></td></tr></table></figure></p>
<p>optimize çš„ä¸»è¦ä½œç”¨æ˜¯æ ‡è®° static é™æ€èŠ‚ç‚¹ï¼Œ<br>è¿™æ˜¯ Vue åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€å¤„ä¼˜åŒ–ï¼Œåé¢å½“ update æ›´æ–°ç•Œé¢æ—¶<br>ä¼šæœ‰ä¸€ä¸ª patch çš„è¿‡ç¨‹ï¼Œ diff ç®—æ³•ä¼šç›´æ¥è·³è¿‡é™æ€èŠ‚ç‚¹<br>ä»è€Œå‡å°‘äº†æ¯”è¾ƒçš„è¿‡ç¨‹ï¼Œä¼˜åŒ–äº† patch çš„æ€§èƒ½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var code =generate(ast, options);</div></pre></td></tr></table></figure></p>
<p>ç”Ÿæˆç›®æ ‡å¹³å°æ‰€éœ€çš„ä»£ç ï¼Œå°† AST è½¬åŒ–æˆ render function å­—ç¬¦ä¸²çš„è¿‡ç¨‹<br>å¾—åˆ°ç»“æœæ˜¯ render çš„å­—ç¬¦ä¸²ä»¥åŠ staticRenderFns å­—ç¬¦ä¸²ã€‚</p>
<h1 id="ç¼–è¯‘å™¨çš„åŸºæœ¬çŸ¥è¯†"><a href="#ç¼–è¯‘å™¨çš„åŸºæœ¬çŸ¥è¯†" class="headerlink" title="ç¼–è¯‘å™¨çš„åŸºæœ¬çŸ¥è¯†"></a>ç¼–è¯‘å™¨çš„åŸºæœ¬çŸ¥è¯†</h1><p>ç¼–è¯‘å™¨çš„æŠ€æœ¯åˆ†ä¸ºè¯æ³•åˆ†æã€è¯­æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æä¸‰ä¸ªéƒ¨åˆ†<br>é€šå¸¸ç¼–è¯‘å™¨çš„ç¬¬ä¸€é¡¹å·¥ä½œå«åšè¯æ³•åˆ†æ<br>å°±åƒé˜…è¯»æ–‡ç« ä¸€æ ·ï¼Œæ–‡ç« æ˜¯ç”±ä¸€ä¸ªä¸ªçš„ä¸­æ–‡å•è¯ç»„æˆçš„<br>ç¨‹åºå¤„ç†ä¹Ÿä¸€æ ·ï¼Œåªä¸è¿‡è¿™é‡Œä¸å«å•è¯ï¼Œè€Œæ˜¯å«åšâ€œè¯æ³•è®°å·â€ï¼Œè‹±æ–‡å« Token<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;app&quot; v-if=&quot;ret&quot;&gt;&#123;&#123; message &#125;&#125;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹å†™ç¨‹åºåˆ¶å®šä¸€äº›è§„åˆ™æ¥åŒºåˆ†æ¯ä¸ªä¸åŒçš„ Tokenï¼Œ<br>è¿™äº›è§„åˆ™ç”¨â€œæ­£åˆ™æ–‡æ³•â€è¡¨è¾¾ï¼Œç¬¦åˆæ­£åˆ™æ–‡æ³•çš„è¡¨è¾¾å¼ç§°ä¸ºâ€œæ­£åˆ™è¡¨è¾¾å¼â€<br>é€šè¿‡ä»–ä»¬æ¥å®Œæˆå…·ä½“çš„è¯æ³•åˆ†æå·¥ä½œ</p>
<p>ç¼–è¯‘å™¨ä¸‹ä¸€ä¸ªé˜¶æ®µçš„å·¥ä½œæ˜¯è¯­æ³•åˆ†æ<br>è¯æ³•åˆ†ææ˜¯è¯†åˆ«ä¸€ä¸ªä¸ªçš„å•è¯ï¼Œè€Œè¯­æ³•åˆ†æå°±æ˜¯åœ¨è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šè¯†åˆ«å‡ºç¨‹åºçš„è¯­æ³•ç»“æ„<br>è¿™ä¸ªç»“æ„æ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œæ˜¯è®¡ç®—æœºå®¹æ˜“ç†è§£å’Œæ‰§è¡Œçš„<br>ç¨‹åºä¹Ÿè¦å®šä¹‰è‰¯å¥½çš„è¯­æ³•ç»“æ„ï¼Œå®ƒçš„è¯­æ³•åˆ†æè¿‡ç¨‹ï¼Œå°±æ˜¯æ„é€ è¿™ä¹ˆä¸€æ£µæ ‘<br>ä¸€ä¸ªç¨‹åºå°±æ˜¯ä¸€æ£µæ ‘ï¼Œè¿™æ£µæ ‘å«åšæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼ŒAST)<br>æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå­æ ‘ï¼‰æ˜¯ä¸€ä¸ªè¯­æ³•å•å…ƒï¼Œè¿™ä¸ªå•å…ƒçš„æ„æˆè§„åˆ™å°±å«â€œè¯­æ³•â€ã€‚</p>
<p>è€Œæˆ‘ä»¬è¿™é‡Œè¦è®²çš„ parser å°±æ˜¯åœ¨ç¼–è¯‘å™¨å¯¹æºä»£ç å¤„ç†çš„ç¬¬ä¸€æ­¥<br>parser æŠŠæŸç§ç‰¹å®šæ ¼å¼çš„æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰è½¬æ¢æˆæŸç§æ•°æ®ç»“æ„çš„ç¨‹åº(å¯¹è±¡)<br>å¹¶ä¸”è¿™ä¸ªæ•°æ®ç»“æ„æ˜¯ç¼–è¯‘å™¨èƒ½å¤Ÿç†è§£çš„<br>å› ä¸ºç¼–è¯‘å™¨çš„åç»­æ­¥éª¤<br>æ¯”å¦‚ä¸Šé¢æåˆ°çš„ å¥æ³•åˆ†æï¼Œç±»å‹æ£€æŸ¥/æ¨å¯¼ï¼Œä»£ç ä¼˜åŒ–ï¼Œä»£ç ç”Ÿæˆ ç­‰ç­‰éƒ½ä¾èµ–äºè¯¥æ•°æ®ç»“æ„</p>
<p><b>æ³¨ï¼šparse &amp; parser è¿™ä¸¤ä¸ªå•è¯ï¼Œä¸è¦æ··æ·†ï¼Œparse æ˜¯åŠ¨è¯ï¼Œä»£è¡¨â€œè§£æâ€çš„è¿‡ç¨‹ï¼Œparser æ˜¯åè¯ï¼Œä»£è¡¨â€œè§£æå™¨â€ã€‚</b><br>Vue çš„ç¼–è¯‘å™¨ä¹Ÿä¸ä¾‹å¤–, åœ¨è¯æ³•åˆ†æé˜¶æ®µ Vue ä¼šæŠŠå­—ç¬¦ä¸²æ¨¡æ¿è§£ææˆä¸€ä¸ªä¸ªçš„ä»¤ç‰Œ(token)<br>è¯¥ä»¤ç‰Œå°†ç”¨äºå¥æ³•åˆ†æé˜¶æ®µï¼Œåœ¨å¥æ³•åˆ†æé˜¶æ®µä¼šæ ¹æ®ä»¤ç‰Œç”Ÿæˆä¸€æ£µ AST<br>æœ€åå†æ ¹æ®è¯¥ ASTç”Ÿæˆæœ€ç»ˆçš„æ¸²æŸ“å‡½æ•°ï¼Œè¿™æ ·å°±å®Œæˆäº†ä»£ç çš„ç”Ÿæˆ</p>
<h1 id="parse"><a href="#parse" class="headerlink" title="parse"></a>parse</h1><p>è¿›å…¥baseCompileç¬¬ä¸€æ­¥å°±æ˜¯è°ƒç”¨parse,å°†HTMLè½¬æˆAST</p>
<h2 id="æ ‡ç­¾é…å¯¹åŸç†"><a href="#æ ‡ç­¾é…å¯¹åŸç†" class="headerlink" title="æ ‡ç­¾é…å¯¹åŸç†"></a>æ ‡ç­¾é…å¯¹åŸç†</h2><p>åœ¨parseå‡½æ•°å’ŒparseHTMLå‡½æ•°ä¸­éƒ½ä¼šå£°æ˜ä¸€ä¸ªstackæ•°ç»„ç”¨æ¥å­˜æ”¾å¼€å§‹æ ‡ç­¾<br>parseå‡½æ•°ä¸­çš„stackåœ¨ä¼ ç»™parseHTMLå‡½æ•°ä¸­çš„å›è°ƒå‡½æ•°ä¸­è¢«è°ƒç”¨<br>parseHTMLå‡½æ•°ä¸­çš„stackåœ¨è§£æå¼€å§‹ç»“æŸæ ‡ç­¾æ—¶è¢«è°ƒç”¨<br>å…¶å®ä¸¤ä¸ªstackè£…çš„ç»“ç‚¹ç›¸åŒ<br>åªæ˜¯parseå‡½æ•°ä¸­stackå­˜æ”¾çš„è™šæ‹ŸèŠ‚ç‚¹å¯¹è±¡æ˜¯å¯¹parseHTMLå‡½æ•°ä¸­å­˜æ”¾çš„å¯¹è±¡åšäº†è¿›ä¸€æ­¥å¤„ç†çš„ç»“æœ<br>é…å¯¹åŸç†å°±æ˜¯<br>æ¯é‡åˆ°ä¸€ä¸ªå¼€å§‹æ ‡ç­¾å°±pushè¿›stackä¸­<br>æ¯é‡åˆ°ä¸€ä¸ªç»“å°¾æ ‡ç­¾å°±åœ¨stackä¸­æ‰¾åˆ°ä¸è¯¥ç»“å°¾æ ‡ç­¾tagç›¸åŒçš„æœ€è¿‘ä¸€æ¬¡pushè¿›å»çš„å¼€å§‹æ ‡ç­¾çš„ä½ç½®<br>å¦‚æœè¯¥ä½ç½®ä¸æ˜¯åœ¨stackæœ€åä¸€ä½ï¼Œè¯´æ˜ä¹‹å‰è§£æåˆ°çš„å¼€å§‹æ ‡ç­¾ä¸­å­˜åœ¨æœªé—­åˆçš„æ ‡ç­¾ï¼Œ<br>åˆ™å…ˆå°†ä¸ç»“æŸæ ‡ç­¾ç›¸åŒçš„å¼€å§‹æ ‡ç­¾ä¹‹åçš„åŒ…æ‹¬å¼€å§‹æ ‡ç­¾è°ƒç”¨parseHTMLä¼ å…¥çš„å›è°ƒè¿›è¡Œé—­åˆï¼Œ<br>ç„¶åé€šè¿‡æ›´æ”¹stacké•¿åº¦ï¼Œç›´æ¥å°†å¼€å§‹æ ‡ç­¾åŠä»¥åçš„æ ‡ç­¾å…¨éƒ¨popå‡ºstack<br>parseHTMLä¼ å…¥çš„å›è°ƒä¼šå¤„ç†parseå‡½æ•°ä¸­å£°æ˜çš„stackæ•°ç»„</p>
<h2 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h2><p>parseå‡½æ•°ä¸­ä¼šå£°æ˜ä¸€ç³»åˆ—å˜é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">warn$2 = options.warn || baseWarn; //æ‰“å°è­¦å‘Šä¿¡æ¯</div><div class="line">//ä¸€ä¸ªç¼–è¯‘å™¨é€‰é¡¹ï¼Œå…¶ä½œç”¨æ˜¯é€šè¿‡ç»™å®šçš„æ ‡ç­¾åå­—åˆ¤æ–­è¯¥æ ‡ç­¾æ˜¯å¦æ˜¯ pre æ ‡ç­¾</div><div class="line">platformIsPreTag = options.isPreTag || no;</div><div class="line">//ä¸€ä¸ªç¼–è¯‘å™¨é€‰é¡¹ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥æ£€æµ‹ä¸€ä¸ªå±æ€§åœ¨æ ‡ç­¾ä¸­æ˜¯å¦è¦ä½¿ç”¨å…ƒç´ å¯¹è±¡åŸç”Ÿçš„ prop è¿›è¡Œç»‘å®š</div><div class="line">platformMustUseProp = options.mustUseProp || no;</div><div class="line">//ä¸€ä¸ªç¼–è¯‘å™¨é€‰é¡¹ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥è·å–å…ƒç´ (æ ‡ç­¾)çš„å‘½åç©ºé—´</div><div class="line">platformGetTagNamespace = options.getTagNamespace || no;</div><div class="line"></div><div class="line">transforms = pluckModuleFunction(options.modules, &apos;transformNode&apos;);</div><div class="line">preTransforms = pluckModuleFunction(options.modules, &apos;preTransformNode&apos;);</div><div class="line">postTransforms = pluckModuleFunction(options.modules, &apos;postTransformNode&apos;);</div><div class="line"></div><div class="line">delimiters = options.delimiters;//åœ¨åˆ›å»º Vue å®ä¾‹å¯¹è±¡æ—¶æ‰€ä¼ é€’çš„ delimiters é€‰é¡¹</div><div class="line">/**å­˜å‚¨å¼€å§‹æ ‡ç­¾ï¼Œä¸è§£æåˆ°çš„é—­åˆæ ‡ç­¾å¯¹æ¯”ï¼Œè¿›è¡Œä¸€å…ƒæ ‡ç­¾å¤„ç†å’ŒåŒæ ‡ç­¾åˆ¤æ–­å¤„ç†**/</div><div class="line">var stack = [];</div><div class="line">//options.preserveWhitespace é€‰é¡¹ç”¨æ¥å‘Šè¯‰ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ html å­—ç¬¦ä¸²æ—¶æ˜¯å¦æ”¾å¼ƒæ ‡ç­¾ä¹‹é—´çš„ç©ºæ ¼</div><div class="line">//å¦‚æœä¸º true åˆ™ä»£è¡¨æ”¾å¼ƒã€‚</div><div class="line">var preserveWhitespace = options.preserveWhitespace !== false;</div><div class="line">var whitespaceOption = options.whitespace;</div><div class="line">var currentParent;/**ç»´æŠ¤å…ƒç´ æè¿°å¯¹è±¡ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œå½“å‰èŠ‚ç‚¹çˆ¶å…ƒç´ **/</div><div class="line">var inVPre = false;//æ ‡è¯†å½“å‰è§£æçš„æ ‡ç­¾æ˜¯å¦åœ¨æ‹¥æœ‰ v-pre çš„æ ‡ç­¾ä¹‹å†…</div><div class="line">var inPre = false;//æ ‡è¯†å½“å‰æ­£åœ¨è§£æçš„æ ‡ç­¾æ˜¯å¦åœ¨ &lt;pre&gt;&lt;/pre&gt; æ ‡ç­¾ä¹‹å†…</div><div class="line">var root;/**å­˜å‚¨æœ€ç»ˆç”Ÿæˆçš„AST**/</div></pre></td></tr></table></figure></p>
<h2 id="parseHTML"><a href="#parseHTML" class="headerlink" title="parseHTML"></a>parseHTML</h2><p>parse å‡½æ•°ä¸­ä¼šæ‰§è¡ŒparseHTMLå‡½æ•°ï¼Œç„¶åè¿”å›root,å³AST<br>parseHTML å‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”¨æ¥åšè¯æ³•åˆ†æçš„<br>parseå‡½æ•°çš„ä½œç”¨åˆ™æ˜¯åœ¨è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šä¼ å…¥å›è°ƒï¼Œåšå¥æ³•åˆ†æä»è€Œç”Ÿæˆä¸€æ£µAST<br>è¢«è°ƒç”¨æ—¶ä¼ å…¥å‚æ•°å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">parseHTML(template, &#123;</div><div class="line">  warn: warn$2,</div><div class="line">  expectHTML: options.expectHTML,</div><div class="line">  isUnaryTag: options.isUnaryTag,</div><div class="line">  canBeLeftOpenTag: options.canBeLeftOpenTag,</div><div class="line">  shouldDecodeNewlines: options.shouldDecodeNewlines,</div><div class="line">  shouldDecodeNewlinesForHref: options.shouldDecodeNewlinesForHref,</div><div class="line">  shouldKeepComment: options.comments,//å¯¹åº”é…ç½®é¡¹comments,trueä¸ºä¿ç•™æ¨¡æ¿ä¸­æ³¨é‡Šè¯­å¥</div><div class="line">  outputSourceRange: options.outputSourceRange,</div></pre></td></tr></table></figure></p>
<h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><p> è§£æå®Œä¸€æ®µæ¨¡æ¿çš„å¼€å§‹æ ‡ç­¾åçš„å›è°ƒ<br> ä¾‹å¦‚ï¼š&lt;div id=â€™jkâ€™ class=â€™menuâ€™ v-if=â€™isShowâ€™&gt;&lt;span&gt;123&lt;/span&gt;&lt;/div&gt;<br> è§£æå®Œ&lt;div id=â€™jkâ€™ class=â€™menuâ€™ v-if=â€™isShowâ€™&gt;çš„å›è°ƒå‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">start: function start (tag, attrs, unary, start$1, end) &#123;</div><div class="line">  // check namespace.</div><div class="line">  // inherit parent ns if there is one</div><div class="line">  var ns = (currentParent &amp;&amp; currentParent.ns) || platformGetTagNamespace(tag);</div></pre></td></tr></table></figure></p>
<p>ns å˜é‡ï¼Œä»£è¡¨æ ‡ç­¾çš„å‘½åç©ºé—´<br>platformGetTagNamespace å‡½æ•°åªä¼šè·å– svg å’Œ math è¿™ä¸¤ä¸ªæ ‡ç­¾çš„å‘½åç©ºé—´<br>ä½†è¿™ä¸¤ä¸ªæ ‡ç­¾çš„æ‰€æœ‰å­æ ‡ç­¾éƒ½ä¼šç»§æ‰¿å®ƒä»¬ä¸¤ä¸ªçš„å‘½åç©ºé—´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// handle IE svg bug</div><div class="line">/* istanbul ignore if */</div><div class="line">if (isIE &amp;&amp; ns === &apos;svg&apos;) &#123;</div><div class="line">  attrs = guardIESVGBug(attrs);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œé€šè¿‡isIEæ¥åˆ¤æ–­å®¿ä¸»ç¯å¢ƒæ˜¯ä¸æ˜¯IEæµè§ˆå™¨ï¼Œå¹¶ä¸”å‰å…ƒç´ çš„å‘½åç©ºé—´ä¸ºsvg<br>å¦‚æœæ˜¯é€šè¿‡guardIESVGBugå¤„ç†å½“å‰å…ƒç´ çš„å±æ€§æ•°ç»„attrsï¼Œå¹¶ä½¿ç”¨å¤„ç†åçš„ç»“æœé‡æ–°èµ‹å€¼ç»™attrså˜é‡<br>è¯¥é—®é¢˜æ˜¯svgæ ‡ç­¾ä¸­æ¸²æŸ“å¤šä½™çš„å±æ€§ï¼Œå¦‚ä¸‹svgæ ‡ç­¾ï¼š<br>&lt;svg xmlns:feature=â€<a href="http://www.openplans.org/topp&quot;&gt;&lt;/svg&amp;gt" target="_blank" rel="external">http://www.openplans.org/topp&quot;&gt;&lt;/svg&amp;gt</a>;<br>è¢«æ¸²æŸ“ä¸º:<br>&lt;svg xmlns:NS1=â€â€ NS1:xmlns:feature=â€<a href="http://www.openplans.org/topp&quot;&quot;&gt;&lt;/svg&amp;gt" target="_blank" rel="external">http://www.openplans.org/topp&quot;&quot;&gt;&lt;/svg&amp;gt</a>;<br>æ ‡ç­¾ä¸­å¤šäº† â€˜xmlns:NS1=â€â€ NS1:â€™ è¿™æ®µå­—ç¬¦ä¸²ï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†æ•´ä¸ªå¤šä½™çš„å­—ç¬¦ä¸²å»æ‰å³å¯<br>è€Œ guardIESVGBug å‡½æ•°å°±æ˜¯ç”¨æ¥ä¿®æ”¹NS1:xmlns:featureå±æ€§å¹¶ç§»é™¤xmlns:NS1=â€â€ å±æ€§çš„</p>
<p>æ¥ç€startå‡½æ•°ä¼šåˆ›å»ºè™šæ‹Ÿç»“ç‚¹ï¼Œè¿”å›ä¸€ä¸ªæè¿°è¯¥æ ‡ç­¾çš„å¯¹è±¡ç»“æ„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">var element = createASTElement(tag, attrs, currentParent); //ä¸‹æ–‡æœ‰ä»£ç </div><div class="line">if (ns) &#123;</div><div class="line">  element.ns = ns;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#123;</div><div class="line">  if (options.outputSourceRange) &#123; //å¤„ç†è™šæ‹ŸèŠ‚ç‚¹å ç”¨åŸæ¨¡æ¿æºç èŒƒå›´</div><div class="line">    element.start = start$1;</div><div class="line">    element.end = end;</div><div class="line">    element.rawAttrsMap = element.attrsList.reduce(function (cumulated, attr) &#123;</div><div class="line">      cumulated[attr.name] = attr;</div><div class="line">      return cumulated</div><div class="line">    &#125;, &#123;&#125;);</div><div class="line">  &#125;</div><div class="line">  //æ£€æŸ¥æ¯ä¸ªå±æ€§åæ˜¯å¦ç¬¦åˆè§„åˆ™</div><div class="line">  attrs.forEach(function (attr) &#123;</div><div class="line">    if (invalidAttributeRE.test(attr.name)) &#123; </div><div class="line">      warn$2(&apos;å±æ€§åä¸èƒ½åŒ…å«ç©ºæ ¼å¼•å·&lt;, &gt;, / æˆ–è€… =&apos;,</div><div class="line">        &#123;start: attr.start + attr.name.indexOf(&quot;[&quot;),end: attr.start + attr.name.length&#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line">//æ˜¯å¦æ˜¯ä¸å…è®¸çš„styleæˆ–è€…scriptæ ‡ç­¾ï¼Œè€Œä¸”ä¸æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æƒ…å†µä¸‹ isForbiddenTagä¸‹æ–‡æœ‰</div><div class="line">if (isForbiddenTag(element) &amp;&amp; !isServerRendering()) &#123; </div><div class="line">  element.forbidden = true;</div><div class="line">  warn$2(...è­¦å‘Šå†…å®¹ï¼Œ&#123; start: element.start &#125;);</div><div class="line">&#125;</div><div class="line">for (var i = 0; i &lt; preTransforms.length; i++) &#123;</div><div class="line">  element = preTransforms[i](element, options) || element;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>preTransforms æ˜¯é€šè¿‡pluckModuleFunction å‡½æ•°ä»options.modules é€‰é¡¹ä¸­ç­›é€‰å‡ºåå­—ä¸ºpreTransformNode å‡½æ•°æ‰€ç»„æˆçš„æ•°ç»„<br>å®é™…ä¸Š preTransforms æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ª preTransformNode å‡½æ•°è¯¥å‡½æ•°åªç”¨æ¥å¤„ç† input æ ‡ç­¾</p>
<p>inVpre å®šä¹‰åœ¨parseå‡½æ•°ä¸­ï¼Œä¸€å¼€å§‹ä¸ºfalse<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">if (!inVPre) &#123;</div><div class="line">  //è§£ææ˜¯å¦æœ‰é…ç½®v-preæŒ‡ä»¤ï¼Œæœ‰çš„è¯åˆ é™¤</div><div class="line">  //v-preæŒ‡ä»¤å¯ä»¥è·³è¿‡è¿™ä¸ªå…ƒç´ å’Œå®ƒçš„å­å…ƒç´ çš„ç¼–è¯‘è¿‡ç¨‹ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºåŸå§‹ Mustache æ ‡ç­¾ã€‚</div><div class="line">  //è·³è¿‡å¤§é‡æ²¡æœ‰æŒ‡ä»¤çš„èŠ‚ç‚¹ä¼šåŠ å¿«ç¼–è¯‘ã€‚</div><div class="line">  processPre(element); </div><div class="line">  if (element.pre) &#123;</div><div class="line">    inVPre = true;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (platformIsPreTag(element.tag)) &#123;</div><div class="line">  inPre = true;</div><div class="line">&#125;</div><div class="line">if (inVPre) &#123;</div><div class="line">  processRawAttrs(element);</div><div class="line">&#125; else if (!element.processed) &#123;  // å¤„ç†ç»“æ„æŒ‡ä»¤v-for,v-if,v-once</div><div class="line">  //processForä¼šå°†è§£æçš„ç»“æœæŒ‚åˆ°elementä¸Š</div><div class="line">  //&#123;for:inåé¢çš„æ•°ç»„è¡¨è¾¾å¼ï¼Œalias:inå‰çš„è¡¨è¾¾å¼&#125;</div><div class="line">  //è§£æç»“æœåªæ˜¯å¯¹è¡¨è¾¾å¼è¿›è¡Œè§£æ,in/ofå‰åé…ç½®çš„å•¥ï¼Œè§£æå‡ºæ¥</div><div class="line">  processFor(element);</div><div class="line">  processIf(element);//å¤„ç†v-if,v-else,v-else-ifçš„è¡¨è¾¾å¼</div><div class="line">  processOnce(element);//å¤„ç†v-onceæŒ‡ä»¤</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰€æœ‰process<em> ç³»åˆ—å‡½æ•°çš„ä½œç”¨éƒ½ä¼šå…ˆæ‹¿åˆ°è§£æçš„é…ç½®çš„å€¼ï¼Œ<br>ç„¶åå°†v-</em>å±æ€§ä»attrsListåˆ—è¡¨é‡Œé¢ç§»é™¤ï¼Œåªå‰©ä¸‹çº¯htmlæ”¯æŒçš„å±æ€§<br>å°†é’ˆå¯¹v-*å±æ€§çš„è§£æç»“æœæŒ‚åˆ°è™šæ‹ŸèŠ‚ç‚¹å¯¹è±¡ä¸Š<br>ä½¿è¿™ä¸ªå¯¹è±¡èƒ½æ›´åŠ è¯¦ç»†åœ°æè¿°ä¸€ä¸ªå…ƒç´ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if (!root) &#123;</div><div class="line">  root = element;//rootèŠ‚ç‚¹æ²¡æœ‰æŒ‚è½½ä¸œè¥¿æ—¶ï¼ŒæŒ‚ä¸Šï¼Œå³æ‰¾åˆ°äº†æ ¹èŠ‚ç‚¹</div><div class="line">  &#123;</div><div class="line">    checkRootConstraints(root);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ç¼–å†™ Vue æ¨¡æ¿çš„æ—¶å€™ä¼šå—åˆ°ä¸¤ç§çº¦æŸ<br>é¦–å…ˆæ¨¡æ¿å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè¢«æ¸²æŸ“çš„æ ¹å…ƒç´ <br>ç¬¬äºŒä¸èƒ½ä½¿ç”¨ slot æ ‡ç­¾å’Œ template æ ‡ç­¾ä½œä¸ºæ¨¡æ¿çš„æ ¹å…ƒç´ <br>checkRootConstraints å‡½æ•°å†…éƒ¨é¦–å…ˆé€šè¿‡åˆ¤æ–­el.tag === â€˜slotâ€™ || el.tag === â€˜templateâ€™<br>æ¥åˆ¤æ–­æ ¹å…ƒç´ æ˜¯å¦æ˜¯slot æ ‡ç­¾æˆ– template æ ‡ç­¾<br>å¦‚æœæ˜¯åˆ™æ‰“å°è­¦å‘Šä¿¡æ¯<br>æ¥ç€ä¼šåˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¦ä½¿ç”¨äº† v-for æŒ‡ä»¤<br>å› ä¸ºv-for æŒ‡ä»¤ä¼šæ¸²æŸ“å¤šä¸ªèŠ‚ç‚¹æ‰€ä»¥æ ¹å…ƒç´ æ˜¯ä¸å…è®¸ä½¿ç”¨ v-for æŒ‡ä»¤çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  //è¿™é‡Œçš„stackæ˜¯parseå‡½æ•°ä¸­å®šä¹‰çš„stack</div><div class="line">  if (!unary) &#123;//éä¸€å…ƒæ ‡ç­¾</div><div class="line">    currentParent = element;//ç¡®å®šå½“å‰èŠ‚ç‚¹å³æ¥ä¸‹æ¥æ ‡ç­¾çš„çˆ¶èŠ‚ç‚¹</div><div class="line">    stack.push(element);//å­˜å…¥æ ˆä¸­ï¼Œåˆ°æ—¶ä¾›ç»“æŸæ ‡ç­¾åˆ¤æ–­ï¼Œå‰ä¸€ä¸ªæ ‡ç­¾æ˜¯ä¸€å…ƒæ ‡ç­¾è¿˜æ˜¯æœ€è¿‘çš„å¼€å§‹æ ‡ç­¾</div><div class="line">  &#125; else &#123;</div><div class="line">    //å¦‚æœæ˜¯ä¸€å…ƒçš„è¯ï¼Œè§£æç»“æŸï¼Œè°ƒç”¨ç»“æŸæ ‡ç­¾å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨parseHTMLå‡½æ•°è°ƒç”¨å‰ï¼Œparseå‡½æ•°ä¸­å®šä¹‰</div><div class="line">    closeElement(element);//ä¼šå»ºç«‹çˆ¶å­ç»“ç‚¹å…³ç³»</div><div class="line">  &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>åœ¨è§£æå®Œå¼€å§‹æ ‡ç­¾åï¼Œå›è°ƒå‡½æ•°ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹<br>1.é’ˆå¯¹ieæµè§ˆå™¨å¯¹svgå’Œmathæ ‡ç­¾å±æ€§åšä¸€ä¸ªå…¼å®¹æ€§å¤„ç†<br>2.ç”Ÿæˆè™šæ‹Ÿdomå¯¹è±¡<br>3.æ ‡è¯†å¼€å§‹æ ‡ç­¾åœ¨åŸå§‹ä»£ç æ‰€åœ¨çš„ä½ç½®<br>4.æ£€æŸ¥å±æ€§å‘½åæ˜¯å¦è§„åˆ™<br>5.æ£€æŸ¥æ˜¯ä¸æ˜¯ä¸å…è®¸çš„scriptå’Œstyleæ ‡ç­¾<br>6.å¤„ç†é…ç½®çš„v-for,v-if,v-onceå±æ€§<br>7.å¦‚æœæ ¹ç»“ç‚¹è¿˜æ²¡æœ‰è¢«æŒ‚è½½ï¼Œåˆ™æŒ‚è½½åˆ°æ ¹ç»“ç‚¹rootä¸Šï¼Œç„¶åæ£€æŸ¥æ˜¯å¦å…è®¸æŒ‚åˆ°æ ¹ç»“ç‚¹(template,slot,v-for)<br>8.å¦‚æœæ˜¯ä¸€å…ƒæ ‡ç­¾,è§£æç»“æŸ;å¦‚æœä¸æ˜¯ï¼Œæ›´æ–°å½“å‰çˆ¶å…ƒç´ ç»“ç‚¹ä¸ºè¯¥è™šæ‹Ÿdom,å¹¶å­˜å…¥stack,ç”¨äºé…å¯¹ç»“æŸæ ‡ç­¾</p>
<h3 id="end"><a href="#end" class="headerlink" title="end"></a>end</h3><p>è§£æå®Œä¸€ä¸ªç»“æŸæ ‡ç­¾æ—¶è°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">end: function end (tag, start, end$1) &#123;</div><div class="line">  var element = stack[stack.length - 1];</div><div class="line">  //æ¯å½“é‡åˆ°ä¸€ä¸ªéä¸€å…ƒæ ‡ç­¾çš„ç»“æŸæ ‡ç­¾æ—¶ï¼Œ</div><div class="line">  //éƒ½ä¼šå›é€€ currentParent å˜é‡çš„å€¼ä¸ºä¹‹å‰çš„å€¼</div><div class="line">  //è¿™æ ·æˆ‘ä»¬å°±ä¿®æ­£äº†å½“å‰æ­£åœ¨è§£æçš„å…ƒç´ çš„çˆ¶çº§å…ƒç´ </div><div class="line">  //åœ¨è§£æå…„å¼ŸèŠ‚ç‚¹æ—¶æ˜¯å¿…é¡»è¦è¿™æ ·åšçš„</div><div class="line">  stack.length -= 1;</div><div class="line">  currentParent = stack[stack.length - 1];</div><div class="line">  if (options.outputSourceRange) &#123;</div><div class="line">    element.end = end$1;</div><div class="line">  &#125;</div><div class="line">  closeElement(element);</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<h3 id="chars"><a href="#chars" class="headerlink" title="chars"></a>chars</h3><p>è§£æåˆ°ä¸€æ®µéæ ‡ç­¾å†…å®¹åè°ƒç”¨<br>æ¯”å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p>æ‹¿åˆ°â€™helloâ€˜è¿™ä¸€æ®µåè°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">chars: function chars (text, start, end) &#123; </div><div class="line">  if (!currentParent) &#123; //ä¸€äº›è¾¹ç•Œæƒ…å†µå¤„ç†</div><div class="line">    &#123;//æ²¡æœ‰æ ¹å…ƒç´ ï¼Œåªæœ‰æ–‡æœ¬ã€‚</div><div class="line">      if (text === template) &#123; </div><div class="line">        warnOnce(&apos;Component template requires a root element, rather than just text.&apos;,&#123; start: start &#125;</div><div class="line">        );</div><div class="line">      &#125; else if ((text = text.trim())) &#123; //æ–‡æœ¬åœ¨æ ¹å…ƒç´ ä¹‹å¤–</div><div class="line">        warnOnce((&quot;text \&quot;&quot; + text + &quot;\&quot; outside root element will be ignored.&quot;),&#123; start: start &#125;</div><div class="line">        );</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    return</div><div class="line">  &#125;</div><div class="line">  //æ¥è§£å†³ IE æµè§ˆå™¨ä¸­æ¸²æŸ“ &lt;textarea&gt; æ ‡ç­¾çš„ placeholder å±æ€§æ—¶å­˜åœ¨çš„ bug çš„</div><div class="line">  if (isIE &amp;&amp; currentParent.tag === &apos;textarea&apos; &amp;&amp; currentParent.attrsMap.placeholder === text</div><div class="line">  ) &#123;return&#125;</div><div class="line"></div><div class="line">  var children = currentParent.children;</div><div class="line">  //å¯¹ç©ºæ ¼ç©ºè¡Œè¿›è¡Œåˆ é™¤,ç¼–è¯‘å™¨åªä¼šä¿ç•™é‚£äº› ä¸å­˜åœ¨äºå¼€å§‹æ ‡ç­¾ä¹‹åçš„ç©ºæ ¼ã€‚</div><div class="line">  if (inPre || text.trim()) &#123; </div><div class="line">    //isTextTagåˆ¤æ–­æ˜¯ä¸æ˜¯styleæˆ–è€…scriptæ ‡ç­¾</div><div class="line">    //decodeHTMLCached å‡½æ•°å¯¹æ–‡æœ¬è¿›è¡Œè§£ç ã€‚</div><div class="line">    text = isTextTag(currentParent) ? text : decodeHTMLCached(text);</div><div class="line">  &#125; else if (!children.length) &#123;</div><div class="line">    text = &apos;&apos;;</div><div class="line">  &#125; else if (whitespaceOption) &#123;</div><div class="line">    if (whitespaceOption === &apos;condense&apos;) &#123;</div><div class="line">      //ä»£ç å‹ç¼©æ¨¡å¼ä¸‹ï¼Œå¦‚æœåŒ…å«æ¢è¡Œç¬¦ï¼Œåˆ é™¤è¿™æ ·çš„ç©ºç™½ç»“ç‚¹ï¼Œå¦åˆ™å‹ç¼©æˆç©ºæ ¼</div><div class="line">      text = lineBreakRE.test(text) ? &apos;&apos; : &apos; &apos;;</div><div class="line">    &#125; else &#123;</div><div class="line">      text = &apos; &apos;;</div><div class="line">    &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">    //preserveWhitespace æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ä»£è¡¨ç€æ˜¯å¦ä¿ç•™ç©ºæ ¼ï¼Œåªæœ‰å®ƒä¸ºçœŸçš„æƒ…å†µä¸‹æ‰ä¼šä¿ç•™ç©ºæ ¼ã€‚</div><div class="line">    //ä½†å³ä½¿preserveWhitespace å¸¸é‡çš„å€¼ä¸ºçœŸï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ²¡æœ‰å­å…ƒç´ åˆ™ä¹Ÿä¸ä¼šä¿ç•™ç©ºæ ¼ï¼Œ</div><div class="line">    text = preserveWhitespace ? &apos; &apos; : &apos;&apos;;</div><div class="line">  &#125;</div><div class="line">  if (text) &#123;</div><div class="line">    if (!inPre &amp;&amp; whitespaceOption === &apos;condense&apos;) &#123;</div><div class="line">      //å°†è¿ç»­çš„ç©ºæ ¼å‹ç¼©ä¸ºå•ä¸ªç©ºæ ¼</div><div class="line">      text = text.replace(whitespaceRE$1, &apos; &apos;);</div><div class="line">    &#125;</div><div class="line">    var res;</div><div class="line">    var child;</div><div class="line">    //æ¨¡æ¿ä¸­å­˜åœ¨çš„æ–‡æœ¬èŠ‚ç‚¹åŒ…å«äº† Vue è¯­æ³•ä¸­çš„å­—é¢é‡è¡¨è¾¾å¼ï¼Œ</div><div class="line">    //è€Œ parseText å‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”¨æ¥è§£æè¿™æ®µåŒ…å«äº†å­—é¢é‡è¡¨è¾¾å¼çš„æ–‡æœ¬çš„</div><div class="line">    if (!inVPre &amp;&amp; text !== &apos; &apos; &amp;&amp; (res = parseText(text, delimiters))) &#123;</div><div class="line">      //å«æœ‰è¡¨è¾¾å¼æˆ–è€…å˜é‡çš„æƒ…å†µ</div><div class="line">      //resè¿”å›åŠ¨æ€å˜é‡çš„æè¿°</div><div class="line">      //ä¾‹&#123;&#123;a&#125;&#125;,è¿”å›:&#123;expression: &quot;_s(a)&quot;,tokens: [&#123;@binding: &quot;a&quot;&#125;]</div><div class="line">      child = &#123;</div><div class="line">        type: 2,</div><div class="line">        expression: res.expression,</div><div class="line">        tokens: res.tokens,</div><div class="line">        text: text</div><div class="line">      &#125;;</div><div class="line">    &#125; else if (text !== &apos; &apos; || !children.length || children[children.length - 1].text !== &apos; &apos;) &#123;</div><div class="line">      //çº¯å¸¸é‡å­—ç¬¦ä¸²çš„æƒ…å†µ</div><div class="line">      child = &#123;</div><div class="line">        type: 3,</div><div class="line">        text: text</div><div class="line">      &#125;;</div><div class="line">    &#125;</div><div class="line">    if (child) &#123;</div><div class="line">      if (options.outputSourceRange) &#123;</div><div class="line">        child.start = start;</div><div class="line">        child.end = end;</div><div class="line">      &#125;</div><div class="line">      children.push(child);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>ä¸»è¦ä½œç”¨å°±æ˜¯å¤„ç†æ¢è¡Œç¬¦ï¼Œç©ºæ ¼ç¬¦ï¼Œ<br>ç„¶åæŒ‰ç…§å¸¸é‡å­—ç¬¦ä¸²å’ŒåŠ¨æ€å­—ç¬¦ä¸²åˆ†åˆ«åˆ›å»ºè™šæ‹Ÿdom,<br>å› ä¸ºåŠ¨æ€å­—ç¬¦ä¸²éœ€è¦è¿›è¡Œä¸€ä¸‹è§£æ<br>å¯¹è™šæ‹ŸdomæŒ‚è½½åœ¨æºç ä¸­èµ·æ­¢ä½ç½®ä¿¡æ¯<br>å°†è™šæ‹Ÿdomæ¨å…¥çˆ¶èŠ‚ç‚¹childrenå±æ€§</p>
<h3 id="comments"><a href="#comments" class="headerlink" title="comments"></a>comments</h3><p>é’ˆå¯¹è§£æåˆ°çš„æ³¨é‡Šè¿›è¡Œå¤„ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">  comment: function comment (text, start, end) &#123;</div><div class="line">    //åªä¼šå¤„ç†è¢«æ ‡ç­¾åŒ…è£¹çš„æ³¨é‡Šï¼Œå› ä¸ºæ ¹èŠ‚ç‚¹ä¸å…è®¸æœ‰å…„å¼Ÿç»“ç‚¹</div><div class="line">    if (currentParent) &#123;</div><div class="line">      //æ™®é€šæ–‡æœ¬èŠ‚ç‚¹ä¸æ³¨é‡ŠèŠ‚ç‚¹çš„å…ƒç´ æè¿°å¯¹è±¡çš„ç±»å‹æ˜¯ä¸€æ ·çš„éƒ½æ˜¯ 3 ï¼Œ</div><div class="line">      //ä¸åŒçš„æ˜¯æ³¨é‡ŠèŠ‚ç‚¹çš„å…ƒç´ æè¿°å¯¹è±¡æ‹¥æœ‰ isComment å±æ€§ï¼Œå¹¶ä¸”è¯¥å±æ€§çš„å€¼ä¸º trueï¼Œ</div><div class="line">      //ç›®çš„å°±æ˜¯ç”¨æ¥ä¸æ™®é€šæ–‡æœ¬èŠ‚ç‚¹ä½œåŒºåˆ†çš„ã€‚</div><div class="line">      var child = &#123;</div><div class="line">        type: 3,</div><div class="line">        text: text,</div><div class="line">        isComment: true</div><div class="line">      &#125;;</div><div class="line">      if (options.outputSourceRange) &#123;</div><div class="line">        child.start = start;</div><div class="line">        child.end = end;</div><div class="line">      &#125;</div><div class="line">      currentParent.children.push(child);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="çœŸæ­£çš„parseHTML"><a href="#çœŸæ­£çš„parseHTML" class="headerlink" title="çœŸæ­£çš„parseHTML"></a>çœŸæ­£çš„parseHTML</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line">//è§£æHTML</div><div class="line">function parseHTML (html, options) &#123;</div><div class="line">  var stack = [];//åœ¨ while å¾ªç¯ä¸­å¤„ç† html å­—ç¬¦æµçš„æ—¶å€™æ¯å½“é‡åˆ°ä¸€ä¸ªéå•æ ‡ç­¾ï¼Œéƒ½ä¼šå°†è¯¥å¼€å§‹æ ‡ç­¾ push åˆ°è¯¥æ•°ç»„ã€‚å®ƒçš„ä½œç”¨æ¨¡æ¿ä¸­ DOM ç»“æ„è§„èŒƒæ€§çš„æ£€æµ‹</div><div class="line">  var expectHTML = options.expectHTML;</div><div class="line">  var isUnaryTag$$1 = options.isUnaryTag || no; //ç”¨æ¥æ£€æµ‹ä¸€ä¸ªæ ‡ç­¾æ˜¯å¦æ˜¯ä¸€å…ƒæ ‡ç­¾</div><div class="line">  var canBeLeftOpenTag$$1 = options.canBeLeftOpenTag || no;//ç”¨æ¥æ£€æµ‹ä¸€ä¸ªæ ‡ç­¾æ˜¯å¦æ˜¯å¯ä»¥çœç•¥é—­åˆæ ‡ç­¾çš„éä¸€å…ƒæ ‡ç­¾</div><div class="line">  var index = 0; //æ ‡è¯†ç€å½“å‰å­—ç¬¦æµçš„è¯»å…¥ä½ç½®</div><div class="line">  //last å­˜å‚¨å‰©ä½™è¿˜æœªç¼–è¯‘çš„ html å­—ç¬¦ä¸²</div><div class="line">  //lastTag å§‹ç»ˆå­˜å‚¨ç€ä½äº stack æ ˆé¡¶çš„å…ƒç´ </div><div class="line">  var last, lastTag;</div><div class="line">  while (html) &#123;</div><div class="line">    last = html; //HTMLä¸ºå¾…è§£æçš„HTMLç‰‡æ®µï¼Œlast ä¿ç•™æœ€åŸå§‹çš„ç‰‡æ®µï¼Œadvanceä¼šåœ¨è§£æè¿‡ç¨‹ä¸­åˆ‡å‰²html</div><div class="line">    // ç¡®ä¿æ²¡æœ‰åœ¨script/styleçº¯æ–‡æœ¬æ ‡ç­¾é‡Œé¢</div><div class="line">    //var isPlainTextElement = makeMap(&apos;script,style,textarea&apos;, true);</div><div class="line">    if (!lastTag || !isPlainTextElement(lastTag)) &#123;</div><div class="line">      var textEnd = html.indexOf(&apos;&lt;&apos;);</div><div class="line">      if (textEnd === 0) &#123; //å¦‚æœä»¥&lt;å¼€å¤´</div><div class="line">        // comment = /^&lt;!\--/;å¦‚æœæ˜¯ä»¥æ³¨é‡Šå¼€å¤´çš„</div><div class="line">        if (comment.test(html)) &#123; </div><div class="line">          var commentEnd = html.indexOf(&apos;--&gt;&apos;); //æ‹¿åˆ°æ³¨é‡Šç»“å°¾çš„ä½ç½®</div><div class="line">          if (commentEnd &gt;= 0) &#123; //å¦‚æœæœ‰å®Œæ•´æ³¨é‡Š</div><div class="line">            //æ ¹æ®new vueæ—¶ä¼ é€’è¿›æ¥çš„commentsé€‰é¡¹å€¼åˆ¤æ–­æ˜¯å¦ä¿ç•™æ¨¡æ¿ä¸­æ³¨é‡Š</div><div class="line">            if (options.shouldKeepComment) &#123;</div><div class="line">              //options.commentåœ¨parseå‡½æ•°è°ƒç”¨parseHTMLæ—¶ä¼ é€’è¿›æ¥ï¼Œå³å›è°ƒ</div><div class="line">              //è¯¥å‡½æ•°ä¼šå°†html.substringæ‹¿åˆ°æ³¨é‡Šçš„å†…å®¹åŒ…è£…æˆ type:3çš„èŠ‚ç‚¹ï¼Œ</div><div class="line">              //ç„¶åpushè¿›å…¶çˆ¶èŠ‚ç‚¹çš„childrenå±æ€§</div><div class="line">              options.comment(html.substring(4, commentEnd), index, index + commentEnd + 3);</div><div class="line">            &#125;</div><div class="line">            advance(commentEnd + 3);//è£å‰ªhtmlæ¨¡æ¿ï¼Œä½ç§»indexçš„å€¼</div><div class="line">            continue</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // ä¸å¤„ç†æ¡ä»¶æ³¨é‡Š,ç›´æ¥ç•¥è¿‡</div><div class="line">        if (conditionalComment.test(html)) &#123;</div><div class="line">          var conditionalEnd = html.indexOf(&apos;]&gt;&apos;);</div><div class="line"></div><div class="line">          if (conditionalEnd &gt;= 0) &#123;</div><div class="line">            advance(conditionalEnd + 2);</div><div class="line">            continue</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // var doctype = /^&lt;!DOCTYPE [^&gt;]+&gt;/i;</div><div class="line">        //ä¸å¤„ç†&lt;!DOCTYPE&gt;æ ‡ç­¾</div><div class="line">        var doctypeMatch = html.match(doctype);</div><div class="line">        if (doctypeMatch) &#123;</div><div class="line">          advance(doctypeMatch[0].length);</div><div class="line">          continue</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //var endTag = new RegExp((&quot;^&lt;\\/&quot; + qnameCapture + &quot;[^&gt;]*&gt;&quot;)); </div><div class="line">        //qnameCaptureè¯¦è§parseStartTagå‡½æ•°</div><div class="line">        var endTagMatch = html.match(endTag);</div><div class="line">        if (endTagMatch) &#123;</div><div class="line">          var curIndex = index;</div><div class="line">          advance(endTagMatch[0].length);</div><div class="line">          parseEndTag(endTagMatch[1], curIndex, index);//å¤„ç†stackä¸­å¼€æ ‡ç­¾/ä¸€å…ƒæ ‡ç­¾</div><div class="line">          continue</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //å¦‚æœæ˜¯æ­£å¸¸ç¼–å†™çš„æ ‡ç­¾(ç”±&lt;&gt;åŒ…è£¹)è¿”å›ä¸€ä¸ªæè¿°å¼€å§‹æ ‡ç­¾çš„å¯¹è±¡</div><div class="line">        var startTagMatch = parseStartTag();</div><div class="line">        if (startTagMatch) &#123;</div><div class="line">          handleStartTag(startTagMatch);</div><div class="line">          if (shouldIgnoreFirstNewline(startTagMatch.tagName, html)) &#123;</div><div class="line">            advance(1);</div><div class="line">          &#125;</div><div class="line">          continue</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line"></div><div class="line">      //å¤„ç†htmléå°–æ‹¬å·å¼€å¤´æƒ…å†µ,å³è§£æåˆ°æ–‡æœ¬å†…å®¹çš„æ—¶å€™</div><div class="line">      var text = (void 0), rest = (void 0), next = (void 0);</div><div class="line">      if (textEnd &gt;= 0) &#123; //æ­¤æ—¶htmléå°–æ‹¬å·å¼€å¤´ï¼Œä½†å‰©ä¸‹çš„é‡Œé¢è¿˜å«æœ‰å°–æ‹¬å·</div><div class="line">        rest = html.slice(textEnd);//æˆªæ–­å°–æ‹¬å·ä»¥å‰çš„å†…å®¹ï¼Œæ‹¿åˆ°å‰©ä¸‹çš„å†…å®¹</div><div class="line">        while ( ç¬¬ä¸€ä¸ªå°–æ‹¬å·ä¸æ˜¯å¼€å§‹æ ‡ç­¾ä¹Ÿä¸æ˜¯ç»“æŸæˆ–è€…è¯„è®ºæ ‡ç­¾</div><div class="line">          !endTag.test(rest) &amp;&amp;</div><div class="line">          !startTagOpen.test(rest) &amp;&amp;</div><div class="line">          !comment.test(rest) &amp;&amp;</div><div class="line">          !conditionalComment.test(rest)</div><div class="line">        ) &#123;</div><div class="line">          // å¤„ç†æ–‡æœ¬é‡Œçš„å°–æ‹¬å·ï¼Œç›´åˆ°æ‰¾åˆ°æ˜¯æ ‡ç­¾çš„å°–æ‹¬å·çš„ä½ç½®ï¼Œå³æ–‡æœ¬ç»“æŸçš„ä½ç½®</div><div class="line">          next = rest.indexOf(&apos;&lt;&apos;, 1);//ä»ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹æ‰¾å‰©ä¸‹htmlé‡Œé¢çš„ç¬¬ä¸€ä¸ªå°–æ‹¬å·</div><div class="line">          if (next &lt; 0) &#123; break &#125; //å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥ç»“æŸ</div><div class="line">          textEnd += next;//å¦‚æœæœ‰çš„è¯ï¼Œé‡åˆ¶textç»“æŸä½ç½®ä¸ºè¯¥å°–æ‹¬å·ä½ç½®</div><div class="line">          rest = html.slice(textEnd);//æˆªå–htmlï¼Œåœ¨åˆ¤æ–­å°–æ‹¬å·æ˜¯å¦æ˜¯æ ‡ç­¾æˆ–è€…æ³¨é‡Š</div><div class="line">        &#125;//whileå¾ªç¯çš„ä½œç”¨æ˜¯æ‰¾å‡ºéæ ‡ç­¾å†…å®¹</div><div class="line">        text = html.substring(0, textEnd);//æœ€ç»ˆå¾—åˆ°éæ ‡ç­¾å†…å®¹</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (textEnd &lt; 0) &#123; //htmlé‡Œé¢æ²¡å°–æ‹¬å·äº†</div><div class="line">        text = html;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (text) &#123;</div><div class="line">        advance(text.length);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (options.chars &amp;&amp; text) &#123;</div><div class="line">        options.chars(text, index - text.length, index);//è°ƒç”¨å›è°ƒï¼Œå¤„ç†æ–‡æœ¬ç»“ç‚¹</div><div class="line">      &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">      //å¤„ç†textareaå†…å®¹å’Œç»“æŸæ ‡ç­¾</div><div class="line">      var endTagLength = 0;</div><div class="line">      var stackedTag = lastTag.toLowerCase();</div><div class="line">      var reStackedTag = reCache[stackedTag] || (reCache[stackedTag] = new RegExp(&apos;([\\s\\S]*?)(&lt;/&apos; + stackedTag + &apos;[^&gt;]*&gt;)&apos;, &apos;i&apos;));</div><div class="line">      //ç›´æ¥é€šè¿‡endæ ‡ç­¾æ‹¿åˆ°æ ‡ç­¾ä¹‹é—´çš„æ–‡æœ¬å†…å®¹ï¼Œä»é¿å…åˆ†æä¸­é—´çš„å°–æ‹¬å·å†…å®¹ï¼Œç›´æ¥ä¿ç•™</div><div class="line">      var rest$1 = html.replace(reStackedTag, function (all, text, endTag) &#123;</div><div class="line">        endTagLength = endTag.length;</div><div class="line">        if (!isPlainTextElement(stackedTag) &amp;&amp; stackedTag !== &apos;noscript&apos;) &#123;</div><div class="line">          text = text</div><div class="line">            .replace(/&lt;!\--([\s\S]*?)--&gt;/g, &apos;$1&apos;) // #7298</div><div class="line">            .replace(/&lt;!\[CDATA\[([\s\S]*?)]]&gt;/g, &apos;$1&apos;);</div><div class="line">        &#125;</div><div class="line">        if (shouldIgnoreFirstNewline(stackedTag, text)) &#123;</div><div class="line">          text = text.slice(1);</div><div class="line">        &#125;</div><div class="line">        if (options.chars) &#123;</div><div class="line">          options.chars(text);</div><div class="line">        &#125;</div><div class="line">        return &apos;&apos;</div><div class="line">      &#125;);</div><div class="line">      index += html.length - rest$1.length;</div><div class="line">      html = rest$1;</div><div class="line">      parseEndTag(stackedTag, index - endTagLength, index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (html === last) &#123;</div><div class="line">      options.chars &amp;&amp; options.chars(html);</div><div class="line">      if (!stack.length &amp;&amp; options.warn) &#123;</div><div class="line">        options.warn((&quot;Mal-formatted tag at end of template: \&quot;&quot; + html + &quot;\&quot;&quot;), &#123; start: index + html.length &#125;);</div><div class="line">      &#125;</div><div class="line">      break</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // Clean up any remaining tags</div><div class="line">  parseEndTag();</div><div class="line"></div><div class="line">  function advance (n) &#123;</div><div class="line">    index += n;</div><div class="line">    html = html.substring(n);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="parseStartTag"><a href="#parseStartTag" class="headerlink" title="parseStartTag"></a>parseStartTag</h4><p>è§£æå¼€å§‹æ ‡ç­¾<br>ä½¿ç”¨unicodeä¸ºåŸºç¡€çš„æ­£åˆ™startTagOpenåŒ¹é…html tag<br>unicodeä¼šç”¨äºæ¯”è¾ƒæ ‡ç­¾åï¼Œç»„ä»¶åä»¥åŠå±æ€§è·¯å¾„<br>var unicodeRegExp = /a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;<br>var ncname = â€œ[a-zA-Z_][\-\.0-9_a-zA-Zâ€ + (unicodeRegExp.source) + â€œ]*â€;<br>var qnameCapture = â€œ((?:â€ + ncname + â€œ\:)?â€ + ncname + â€œ)â€;<br>var startTagOpen = new RegExp((â€œ^&lt;â€ + qnameCapture)); æ ‡ç­¾å¼€å¤´æ­£åˆ™<br>ã€æ­£åˆ™è¡¨è¾¾å¼çš„sourceå±æ€§æ˜¯å…¶è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²å½¢å¼ã€‘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">function parseStartTag () &#123;</div><div class="line">  var start = html.match(startTagOpen);</div><div class="line">  if (start) &#123;</div><div class="line">    var match = &#123;</div><div class="line">      tagName: start[1],</div><div class="line">      attrs: [],//ç”¨æ¥å­˜å‚¨å°†æ¥è¢«åŒ¹é…åˆ°çš„å±æ€§</div><div class="line">      start: index //åˆå§‹å€¼ä¸º indexï¼Œæ˜¯å½“å‰å­—ç¬¦æµè¯»å…¥ä½ç½®åœ¨æ•´ä¸ª html å­—ç¬¦ä¸²ä¸­çš„ç›¸å¯¹ä½ç½®</div><div class="line">    &#125;;</div><div class="line">    advance(start[0].length);</div><div class="line">    var end, attr;</div><div class="line">    //startTagClose = /^\s*(\/?)&gt;/;æ ‡ç­¾ç»“æŸæ­£åˆ™,åªå¯ä»¥åŒ¹é…&gt;æˆ–è€…/&gt;ï¼Œæˆ–è€…ä¹‹å‰æœ‰nä¸ªç©ºæ ¼</div><div class="line">    //attribute = /^\s*([^\s&quot;&apos;&lt;&gt;\/=]+)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|&apos;([^&apos;]*)&apos;+|([^\s&quot;&apos;=&lt;&gt;`]+)))?/;</div><div class="line">    //dynamicArgAttribute = /^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+\][^\s&quot;&apos;&lt;&gt;\/=]*)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|&apos;([^&apos;]*)&apos;+|([^\s&quot;&apos;=&lt;&gt;`]+)))?/;</div><div class="line">    //dynamicArgAttributeæ•è·æ ‡ç­¾ä¸Šé…ç½®çš„å±æ€§pushåˆ°èŠ‚ç‚¹çš„attrå±æ€§é‡Œé¢</div><div class="line">    //å¾—åˆ°çš„ç»“æœæ˜¯[&apos;key=val&apos;,&apos;key&apos;,&apos;=&apos;,&apos;val&apos;,]</div><div class="line">    //whileæ¡ä»¶æ˜¯æ²¡æœ‰åŒ¹é…åˆ°å¼€å§‹æ ‡ç­¾çš„ç»“æŸéƒ¨åˆ†ï¼Œå¹¶ä¸”åŒ¹é…åˆ°äº†å¼€å§‹æ ‡ç­¾ä¸­çš„å±æ€§ï¼Œè¿™ä¸ªæ—¶å€™å¾ªç¯ä½“å°†è¢«æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°å¼€å§‹æ ‡ç­¾çš„ç»“æŸéƒ¨åˆ†ä¸ºæ­¢</div><div class="line">    while (!(end = html.match(startTagClose)) &amp;&amp; (attr = html.match(dynamicArgAttribute) || html.match(attribute))) &#123;</div><div class="line">      attr.start = index;</div><div class="line">      advance(attr[0].length);</div><div class="line">      attr.end = index;</div><div class="line">      match.attrs.push(attr);</div><div class="line">    &#125;</div><div class="line">    &lt;!-- å³ä½¿åŒ¹é…åˆ°äº†å¼€å§‹æ ‡ç­¾çš„å¼€å§‹éƒ¨åˆ†ä»¥åŠå±æ€§éƒ¨åˆ†ä½†æ˜¯å´æ²¡æœ‰åŒ¹é…åˆ°å¼€å§‹æ ‡ç­¾çš„ç»“æŸéƒ¨åˆ†ï¼Œè¿™è¯´æ˜è¿™æ ¹æœ¬å°±ä¸æ˜¯ä¸€ä¸ªå¼€å§‹æ ‡ç­¾ã€‚æ‰€ä»¥åªæœ‰å½“å˜é‡endå­˜åœ¨ï¼Œå³åŒ¹é…åˆ°äº†å¼€å§‹æ ‡ç­¾çš„ç»“æŸéƒ¨åˆ†æ—¶ï¼Œæ‰èƒ½è¯´æ˜è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¼€å§‹æ ‡ç­¾ --&gt;</div><div class="line">    if (end) &#123;</div><div class="line">      match.unarySlash = end[1];//æ˜¯å¦æ˜¯å•æ ‡ç­¾ï¼ŒåŒæ ‡ç­¾è¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå•æ ‡ç­¾è¯¥å€¼ä¸º&apos;/&apos;</div><div class="line">      advance(end[0].length);//ä½ç§»ä¸€ä¸ªæ ‡ç­¾ç»“æŸç¬¦&apos;&gt;&apos;æˆ–è€…&apos;/&gt;&apos;åŠ å‰é¢nä¸ªç©ºæ ¼çš„è·ç¦»</div><div class="line">      match.end = index;</div><div class="line">      return match//ä¸€ä¸ªhtmlåŒæ ‡ç­¾çš„å¼€å¤´æ ‡ç­¾æˆ–è€…å•æ ‡ç­¾è§£æå®Œæ¯•</div><div class="line">    &#125;</div><div class="line">     &lt;!-- åªæœ‰å½“å˜é‡endå­˜åœ¨æ—¶ï¼Œå³èƒ½å¤Ÿç¡®å®šç¡®å®è§£æåˆ°äº†ä¸€ä¸ªå¼€å§‹æ ‡ç­¾çš„æ—¶å€™parseStartTagå‡½æ•°æ‰ä¼šæœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›å€¼æ˜¯matchå¯¹è±¡ï¼Œå…¶ä»–æƒ…å†µä¸‹parseStartTagå…¨éƒ¨è¿”å›undefined --&gt;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸»è¦ä½œç”¨æ˜¯<br>1.æ­£åˆ™æ‹¿åˆ°å¼€å§‹æ ‡ç­¾å<br>2.whileå¾ªç¯æ‹¿åˆ°å±æ€§çš„key-valueå¯¹è±¡é›†åˆï¼Œå¯¹è±¡ä¸­åŒ…å«è¯¥å±æ€§åœ¨æºç ä¸­æ‰€å çš„èµ·æ­¢ä½ç½®<br>3.æ ‡è¯†æ˜¯å¦ä¸ºä¸€å…ƒæ ‡ç­¾ï¼Œè¿”å›è§£æç»“æœ</p>
<h4 id="handleStartTag"><a href="#handleStartTag" class="headerlink" title="handleStartTag"></a>handleStartTag</h4><p>å¤„ç†å¼€å§‹æ ‡ç­¾çš„è§£æç»“æœï¼Œå¯¹ä¸Šä¸€æ­¥ç»“æœåšè¿›ä¸€æ­¥å¤„ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function handleStartTag (match) &#123;</div><div class="line">  var tagName = match.tagName;</div><div class="line">  var unarySlash = match.unarySlash;</div><div class="line">  //baseOptionsä¸­é»˜è®¤è®¾ç½®ä¸ºtrue</div><div class="line">  if (expectHTML) &#123;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæœ€è¿‘ä¸€æ¬¡é‡åˆ°çš„å¼€å§‹æ ‡ç­¾æ˜¯ p æ ‡ç­¾<br>å¹¶ä¸”å½“å‰æ­£åœ¨è§£æçš„å¼€å§‹æ ‡ç­¾å¿…é¡»ä¸èƒ½æ˜¯æ®µè½å¼å†…å®¹(Phrasing content)æ¨¡å‹<br>æ¯ä¸€ä¸ª html å…ƒç´ éƒ½æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå†…å®¹æ¨¡å‹(content model)<br>å…¶ä¸­p æ ‡ç­¾æœ¬èº«çš„å†…å®¹æ¨¡å‹æ˜¯æµå¼å†…å®¹(Flow content)<br>å¹¶ä¸” p æ ‡ç­¾çš„ç‰¹æ€§æ˜¯åªå…è®¸åŒ…å«æ®µè½å¼å†…å®¹(Phrasing content)<br>æ‰€ä»¥æ¡ä»¶æˆç«‹çš„æƒ…å†µå¦‚ä¸‹ï¼š&lt;p&gt;&lt;h1&gt;&lt;/h1&gt;&lt;/p&gt;<br>åœ¨è§£æä¸Šé¢è¿™æ®µ html å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œé¦–å…ˆé‡åˆ°pæ ‡ç­¾çš„å¼€å§‹æ ‡ç­¾ï¼Œæ­¤æ—¶lastTagè¢«è®¾ç½®ä¸º p<br>ç´§æ¥ç€ä¼šé‡åˆ° h1 æ ‡ç­¾çš„å¼€å§‹æ ‡ç­¾ï¼Œç”±äº h2 æ ‡ç­¾çš„å†…å®¹æ¨¡å‹å±äºéæ®µè½å¼å†…å®¹(Phrasing content)æ¨¡å‹<br>æ‰€ä»¥ä¼šç«‹å³è°ƒç”¨ parseEndTag(lastTag) å‡½æ•°é—­åˆ p æ ‡ç­¾ï¼Œæ­¤æ—¶ç”±äºå¼ºè¡Œæ’å…¥äº†&lt;/p&gt; æ ‡ç­¾<br>æ‰€ä»¥è§£æåçš„å­—ç¬¦ä¸²å°†å˜ä¸ºå¦‚ä¸‹å†…å®¹ï¼š&lt;p&gt;&lt;/p&gt;&lt;h2&gt;&lt;/h2&gt;&lt;/p&gt;<br>ç»§ç»­è§£æè¯¥å­—ç¬¦ä¸²ï¼Œä¼šé‡åˆ° &lt;h2&gt;&lt;/h2&gt;æ ‡ç­¾å¹¶æ­£å¸¸è§£æä¹‹<br>æœ€åè§£æå™¨ä¼šé‡åˆ°ä¸€ä¸ªå•ç‹¬çš„p æ ‡ç­¾çš„ç»“æŸæ ‡ç­¾ï¼Œå³ï¼š&lt;/p&gt;<br>è¿™ä¸ªæ—¶å€™å°±å›åˆ°äº†æˆ‘ä»¬å‰é¢è®²è¿‡çš„ï¼Œå½“è§£æå™¨é‡åˆ° p æ ‡ç­¾æˆ–è€… br æ ‡ç­¾çš„ç»“æŸæ ‡ç­¾æ—¶ä¼šè¡¥å…¨ä»–ä»¬<br>æœ€ç»ˆ&lt;p&gt;&lt;h2&gt;&lt;/h2&gt;&lt;/p&gt;<br>è¿™æ®µ html å­—ç¬¦ä¸²å°†è¢«è§£æä¸ºï¼š&lt;p&gt;&lt;/p&gt;&lt;h2&gt;&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">    if (lastTag === &apos;p&apos; &amp;&amp; isNonPhrasingTag(tagName)) &#123;</div><div class="line">      parseEndTag(lastTag);//å¤„ç†ç»“æŸæ ‡ç­¾</div><div class="line">    &#125;</div><div class="line">    //å½“å‰æ­£åœ¨è§£æçš„æ ‡ç­¾æ˜¯ä¸€ä¸ªå¯ä»¥çœç•¥ç»“æŸæ ‡ç­¾çš„æ ‡ç­¾ï¼Œå¹¶ä¸”ä¸ä¸Šä¸€æ¬¡è§£æåˆ°çš„å¼€å§‹æ ‡ç­¾ç›¸åŒ</div><div class="line">    //ä¾‹&lt;p&gt;max&lt;p&gt;kaixin</div><div class="line">    //å½“è§£æåˆ°ä¸€ä¸ªpæ ‡ç­¾çš„å¼€å§‹æ ‡ç­¾å¹¶ä¸”ä¸‹ä¸€æ¬¡é‡åˆ°çš„æ ‡ç­¾ä¹Ÿæ˜¯pæ ‡ç­¾çš„å¼€å§‹æ ‡ç­¾æ—¶ï¼Œä¼šç«‹å³å…³é—­ç¬¬äºŒä¸ªpæ ‡ç­¾ã€‚</div><div class="line">    //å³è°ƒç”¨ï¼šparseEndTag(tagName) å‡½æ•°ï¼Œç„¶åç”±äºç¬¬ä¸€ä¸ªpæ ‡ç­¾ç¼ºå°‘é—­åˆæ ‡ç­¾æ‰€ä»¥ä¼šVueä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Šã€‚</div><div class="line">    if (canBeLeftOpenTag$$1(tagName) &amp;&amp; lastTag === tagName) &#123;</div><div class="line">      parseEndTag(tagName);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  var unary = isUnaryTag$$1(tagName) || !!unarySlash;//æ˜¯å¦æ˜¯ä¸€å…ƒæ ‡ç­¾</div><div class="line"></div><div class="line">  var l = match.attrs.length;</div><div class="line">  var attrs = new Array(l);//æ•´ç†å±æ€§</div><div class="line">  for (var i = 0; i &lt; l; i++) &#123; </div><div class="line">    var args = match.attrs[i];</div><div class="line">    var value = args[3] || args[4] || args[5] || &apos;&apos;;</div><div class="line">    //å¯¹äºaæ ‡ç­¾æ˜¯å¦æ’å…¥æ¢è¡Œç¼–ç </div><div class="line">    var shouldDecodeNewlines = tagName === &apos;a&apos; &amp;&amp; args[1] === &apos;href&apos; </div><div class="line">      ? options.shouldDecodeNewlinesForHref</div><div class="line">      : options.shouldDecodeNewlines;</div><div class="line">    attrs[i] = &#123;</div><div class="line">      name: args[1],</div><div class="line">      //decodeAttr ç”¨æ˜¯å¯¹å±æ€§å€¼ä¸­æ‰€åŒ…å«çš„ html å®ä½“è¿›è¡Œè§£ç ï¼Œå°†å…¶è½¬æ¢ä¸ºå®ä½“å¯¹åº”çš„å­—ç¬¦ã€‚</div><div class="line">      value: decodeAttr(value, shouldDecodeNewlines)</div><div class="line">    &#125;;</div><div class="line">    if (options.outputSourceRange) &#123;</div><div class="line">      attrs[i].start = args.start + args[0].match(/^\s*/).length;</div><div class="line">      attrs[i].end = args.end;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  //å¦‚æœå¼€å§‹æ ‡ç­¾æ˜¯éä¸€å…ƒæ ‡ç­¾ï¼Œåˆ™å°†è¯¥å¼€å§‹æ ‡ç­¾çš„ä¿¡æ¯å…¥æ ˆï¼Œ</div><div class="line">  //å³pushåˆ°stackæ•°ç»„ä¸­ï¼Œå¹¶å°†lastTagçš„å€¼è®¾ç½®ä¸ºè¯¥æ ‡ç­¾åã€‚</div><div class="line">  if (!unary) &#123;//è¿™é‡Œçš„stackæ˜¯parseHTMLä¸­å®šä¹‰çš„stack</div><div class="line">    stack.push(&#123; tag: tagName, lowerCasedTag: tagName.toLowerCase(), attrs: attrs, start: match.start, end: match.end &#125;);</div><div class="line">    lastTag = tagName;//lastTag æ‰€å­˜å‚¨çš„æ ‡ç­¾åå­—å§‹ç»ˆä¿å­˜ç€ stack æ ˆé¡¶çš„å…ƒç´ </div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (options.start) &#123; è°ƒç”¨é…ç½®çš„å¼€å¤´æ ‡ç­¾å¤„ç†å‡½æ•°ï¼Œæ˜¯parseå‡½æ•°ä¸­ä¼ è¾“parseHTMLå‡½æ•°çš„å‚æ•°</div><div class="line">    options.start(tagName, attrs, unary, match.start, match.end);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä½œç”¨å¦‚ä¸‹ï¼š<br>1.å¤„ç†pæ ‡ç­¾é—­åˆæƒ…å†µï¼Œä»¥åŠaæ ‡ç­¾å±æ€§å€¼æ˜¯å¦æ’å…¥æ¢è¡Œçš„å¤„ç†<br>2.è¿›ä¸€æ­¥å¤„ç†å±æ€§å€¼ç»“åˆï¼Œå°†æ­£åˆ™å¾—åˆ°çš„æ•°ç»„è½¬æˆkey-valueå¯¹è±¡<br>3.å°†èŠ‚ç‚¹pushåˆ°stackä¸­ï¼Œè¿›è¡Œé—­åˆæ ‡ç­¾é…å¯¹ï¼Œè®¾ç½®lastTagä¸ºæœ€è¿‘ä¸€æ¬¡çš„å¼€å§‹æ ‡ç­¾<br>4.è°ƒç”¨å¼€å§‹æ ‡ç­¾å›è°ƒstart</p>
<h4 id="createASTElement"><a href="#createASTElement" class="headerlink" title="createASTElement"></a>createASTElement</h4><p>åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">function createASTElement (</div><div class="line">  tag,</div><div class="line">  attrs,</div><div class="line">  parent</div><div class="line">) &#123;</div><div class="line">  return &#123;</div><div class="line">    type: 1,</div><div class="line">    tag: tag,</div><div class="line">    attrsList: attrs,</div><div class="line">    attrsMap: makeAttrsMap(attrs),</div><div class="line">    rawAttrsMap: &#123;&#125;,</div><div class="line">    parent: parent,</div><div class="line">    children: []</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="parseEndTag"><a href="#parseEndTag" class="headerlink" title="parseEndTag"></a>parseEndTag</h4><p>å¤„ç†ç»“æŸæ ‡ç­¾<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">  function parseEndTag (tagName, start, end) &#123;</div><div class="line">    var pos, lowerCasedTagName;</div><div class="line">    //å½“ start å’Œ end ä¸å­˜åœ¨æ—¶ï¼Œå°†è¿™ä¸¤ä¸ªå˜é‡çš„å€¼è®¾ç½®ä¸ºå½“å‰å­—ç¬¦æµçš„è¯»å…¥ä½ç½®ï¼Œå³index</div><div class="line">    //åœ¨handleStartTag å‡½æ•°ä¸­è°ƒç”¨æ—¶ä¼šè¢«è¿™æ ·è¿™æ ·è°ƒç”¨</div><div class="line">    if (start == null) &#123; start = index; &#125;</div><div class="line">    if (end == null) &#123; end = index; &#125;</div><div class="line">    //æ‰¾åˆ°æœ€è¿‘çš„ç›¸åŒç±»å‹çš„å¼€å§‹æ ‡ç­¾çš„ä½ç½®</div><div class="line">    if (tagName) &#123;</div><div class="line">      lowerCasedTagName = tagName.toLowerCase();</div><div class="line">      for (pos = stack.length - 1; pos &gt;= 0; pos--) &#123;</div><div class="line">        if (stack[pos].lowerCasedTag === lowerCasedTagName) &#123;</div><div class="line">          break</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125; else &#123;//è°ƒç”¨ parseEndTag() å‡½æ•°æ—¶ä¸ä¼ é€’ä»»ä½•å‚æ•°ï¼Œå°±å¤„ç†stackæ ˆä¸­å‰©ä½™æœªå¤„ç†çš„æ ‡ç­¾,</div><div class="line">      pos = 0;</div><div class="line">    &#125;</div><div class="line">    //åˆ é™¤æœ€è¿‘å¼€å§‹æ ‡ç­¾ ä»¥åçš„å¼€å§‹æ ‡ç­¾(å¯èƒ½æ˜¯ä¸€å…ƒæ ‡ç­¾)</div><div class="line">    if (pos &gt;= 0) &#123;//æ£€æµ‹æ˜¯å¦ç¼ºå°‘é—­åˆæ ‡ç­¾</div><div class="line">      // Close all the open elements, up the stack</div><div class="line">      for (var i = stack.length - 1; i &gt;= pos; i--) &#123;</div><div class="line">        if (i &gt; pos || !tagName &amp;&amp; options.warn) &#123;</div><div class="line">          //å¦‚æœå‘ç° stack æ•°ç»„ä¸­å­˜åœ¨ç´¢å¼•å¤§äº pos çš„å…ƒç´ ï¼Œé‚£ä¹ˆä¸€å®šæœ‰å…ƒç´ æ˜¯ç¼ºå°‘é—­åˆæ ‡ç­¾çš„</div><div class="line">          options.warn((&quot;tag &lt;&quot; + (stack[i].tag) + &quot;&gt; has no matching end tag.&quot;),&#123; start: stack[i].start, end: stack[i].end &#125;);</div><div class="line">        &#125;</div><div class="line">        if (options.end) &#123;</div><div class="line">          options.end(stack[i].tag, start, end);//å›è°ƒparseå‡½æ•°è°ƒç”¨æ—¶ä¼ é€’è¿›æ¥çš„å›è°ƒå‡½æ•°</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      //ä»stackä¸­åˆ é™¤å¼€æ ‡ç­¾</div><div class="line">      stack.length = pos;</div><div class="line">      lastTag = pos &amp;&amp; stack[pos - 1].tag;//å°†lastTagé‡åˆ¶ä¸ºstackæ ˆé¡¶å…ƒç´ </div><div class="line">    &#125; else if (lowerCasedTagName === &apos;br&apos;) &#123;</div><div class="line">      //ä¸ºäº†ä¸æµè§ˆå™¨çš„è¡Œä¸ºç›¸åŒï¼Œä¸“é—¨å¤„ç†brä¸pçš„ç»“æŸæ ‡ç­¾,å³ï¼š&lt;/br&gt; å’Œ&lt;/p&gt;ã€‚</div><div class="line">      //&lt;/br&gt; æ ‡ç­¾è¢«æ­£å¸¸è§£æä¸º &lt;br&gt; æ ‡ç­¾ï¼Œè€Œ&lt;/p&gt;æ ‡ç­¾è¢«æ­£å¸¸è§£æä¸º &lt;p&gt;&lt;/p&gt;</div><div class="line">      if (options.start) &#123;</div><div class="line">        options.start(tagName, [], true, start, end);</div><div class="line">      &#125;</div><div class="line">    &#125; else if (lowerCasedTagName === &apos;p&apos;) &#123;</div><div class="line">      if (options.start) &#123;</div><div class="line">        options.start(tagName, [], false, start, end);</div><div class="line">      &#125;</div><div class="line">      if (options.end) &#123;</div><div class="line">        options.end(tagName, start, end);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸»è¦ä½œç”¨æ˜¯<br>1.åˆ©ç”¨stackè¿›è¡Œé…å¯¹ï¼Œå¤„ç†stackå’ŒlastTag<br>2.ç‰¹æ®Šå¤„ç†brå’Œpæ ‡ç­¾<br>3.è°ƒç”¨endå›è°ƒå‡½æ•°å¤„ç†çˆ¶å­å…³ç³»</p>
<h4 id="closeElement"><a href="#closeElement" class="headerlink" title="closeElement"></a>closeElement</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">function closeElement(element) &#123;</div><div class="line">  trimEndingWhitespace(element);</div><div class="line">  if (!inVPre &amp;&amp; !element.processed) &#123;</div><div class="line">    //processElementä¼šç»§ç»­å¤„ç†elementä¸Šçš„å±æ€§key,is,inline-template,ref,v-bind,v-onç­‰ç­‰,ä¼šæŒ‚è½½plainå±æ€§ä¾›generateåˆ›å»ºrenderå‡½æ•°æ—¶ä½¿ç”¨</div><div class="line">    element = processElement(element, options);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ v-if æˆ– v-else-if æˆ– v-else åˆ›å»ºå¤šä¸ªæ ¹ç»“ç‚¹æ—¶<br>v-else-if æˆ– v-elseåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹æ”¾åˆ°v-ifèŠ‚ç‚¹çš„ifconditionså±æ€§ä¸‹é¢ã€å¾…éªŒè¯ã€‘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">  if (!stack.length &amp;&amp; element !== root) &#123;</div><div class="line">    // allow root elements with v-if, v-else-if and v-else</div><div class="line">    if (root.if &amp;&amp; (element.elseif || element.else)) &#123;</div><div class="line">      &#123;</div><div class="line">        checkRootConstraints(element);</div><div class="line">      &#125;</div><div class="line">      //ç»™root.ifconditionså±æ€§push if,elseif,elseç­‰æ¡ä»¶æ¨¡æ¿ä¸‹çš„è™šæ‹Ÿdomå¯¹è±¡</div><div class="line">      addIfCondition(root, &#123; </div><div class="line">        exp: element.elseif,</div><div class="line">        block: element</div><div class="line">      &#125;);</div><div class="line">    &#125; else &#123;</div><div class="line">      warnOnce(</div><div class="line">        &quot;Component template should contain exactly one root element. &quot; +</div><div class="line">        &quot;If you are using v-if on multiple elements, &quot; +</div><div class="line">        &quot;use v-else-if to chain them instead.&quot;,</div><div class="line">        &#123; start: element.start &#125;</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  if (currentParent &amp;&amp; !element.forbidden) &#123;</div><div class="line">    if (element.elseif || element.else) &#123;</div><div class="line">      processIfConditions(element, currentParent);</div><div class="line">    &#125; else &#123;</div><div class="line">      if (element.slotScope) &#123;</div><div class="line">        var name = element.slotTarget || &apos;&quot;default&quot;&apos;</div><div class="line">        ;(currentParent.scopedSlots || (currentParent.scopedSlots = &#123;&#125;))[name] = element;</div><div class="line">      &#125;</div><div class="line">      //è¿™æ ·å°±å»ºç«‹äº†å…ƒç´ æè¿°å¯¹è±¡é—´çš„çˆ¶å­çº§å…³ç³»ã€‚</div><div class="line">      currentParent.children.push(element);</div><div class="line">      element.parent = currentParent;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  element.children = element.children.filter(function (c) &#123; return !(c).slotScope; &#125;);</div><div class="line">  trimEndingWhitespace(element);</div><div class="line">  if (element.pre) &#123;</div><div class="line">    inVPre = false;</div><div class="line">  &#125;</div><div class="line">  if (platformIsPreTag(element.tag)) &#123;</div><div class="line">    inPre = false;</div><div class="line">  &#125;</div><div class="line">  for (var i = 0; i &lt; postTransforms.length; i++) &#123;</div><div class="line">    postTransforms[i](element, options);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸»è¦ä½œç”¨æ˜¯<br>1.å¤„ç†æ¡ä»¶æ¸²æŸ“èŠ‚ç‚¹å…³ç³»<br>2.å»ºç«‹çˆ¶å­ç»“ç‚¹å…³ç³»</p>
<h4 id="isForbiddenTag"><a href="#isForbiddenTag" class="headerlink" title="isForbiddenTag"></a>isForbiddenTag</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function isForbiddenTag(el) &#123;</div><div class="line">	return (</div><div class="line">		el.tag === &apos;style&apos; ||</div><div class="line">		(el.tag === &apos;script&apos; &amp;&amp; (</div><div class="line">			!el.attrsMap.type ||</div><div class="line">			el.attrsMap.type === &apos;text/javascript&apos;</div><div class="line">		))</div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="optimize"><a href="#optimize" class="headerlink" title="optimize"></a>optimize</h1><p>é€šè¿‡ä¸¤ä¸ªé€’å½’å‡½æ•°ç»™ç»“ç‚¹æŒ‚è½½staticå’ŒstaticRootä¸¤ä¸ªå±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">function optimize (root, options) &#123;</div><div class="line">  if (!root) &#123; return &#125;</div><div class="line">  isStaticKey = genStaticKeysCached(options.staticKeys || &apos;&apos;);</div><div class="line">  isPlatformReservedTag = options.isReservedTag || no;</div><div class="line">  // first pass: mark all non-static nodes.</div><div class="line">  markStatic$1(root);</div><div class="line">  // second pass: mark static roots.</div><div class="line">  markStaticRoots(root, false);</div><div class="line">&#125;</div><div class="line">//åˆ¤æ–­ç»“ç‚¹æ˜¯å¦ä¸ºé™æ€ç»“ç‚¹</div><div class="line">function isStatic (node) &#123;</div><div class="line">    if (node.type === 2) &#123; // expression</div><div class="line">      return false</div><div class="line">    &#125;</div><div class="line">    if (node.type === 3) &#123; // text</div><div class="line">      return true</div><div class="line">    &#125;</div><div class="line">    return !!(node.pre || (</div><div class="line">      !node.hasBindings &amp;&amp; // no dynamic bindings</div><div class="line">      !node.if &amp;&amp; !node.for &amp;&amp; // not v-if or v-for or v-else</div><div class="line">      !isBuiltInTag(node.tag) &amp;&amp; // not a built-in</div><div class="line">      isPlatformReservedTag(node.tag) &amp;&amp; // not a component</div><div class="line">      !isDirectChildOfTemplateFor(node) &amp;&amp;</div><div class="line">      Object.keys(node).every(isStaticKey)</div><div class="line">    ))</div><div class="line">  &#125;</div><div class="line">function markStatic$1 (node) &#123;</div><div class="line">    node.static = isStatic(node);</div><div class="line">    if (node.type === 1) &#123;</div><div class="line">      // do not make component slot content static. this avoids</div><div class="line">      // 1. components not able to mutate slot nodes</div><div class="line">      // 2. static slot content fails for hot-reloading</div><div class="line">      if (</div><div class="line">        !isPlatformReservedTag(node.tag) &amp;&amp;</div><div class="line">        node.tag !== &apos;slot&apos; &amp;&amp;</div><div class="line">        node.attrsMap[&apos;inline-template&apos;] == null</div><div class="line">      ) &#123;</div><div class="line">        return</div><div class="line">      &#125;</div><div class="line">      for (var i = 0, l = node.children.length; i &lt; l; i++) &#123;</div><div class="line">        var child = node.children[i];</div><div class="line">        markStatic$1(child);</div><div class="line">        if (!child.static) &#123;//å­èŠ‚ç‚¹ä¸€ä½†ä¸ºåŠ¨æ€ç»“ç‚¹ï¼Œåˆ™çˆ¶èŠ‚ç‚¹ä¸ºåŠ¨æ€ç»“ç‚¹</div><div class="line">          node.static = false;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      if (node.ifConditions) &#123; //å¤„ç†æ¡ä»¶æ¸²æŸ“èŠ‚ç‚¹æ˜¯å¦ä¸ºé™æ€ç»“ç‚¹</div><div class="line">        for (var i$1 = 1, l$1 = node.ifConditions.length; i$1 &lt; l$1; i$1++) &#123;</div><div class="line">          var block = node.ifConditions[i$1].block;</div><div class="line">          markStatic$1(block);</div><div class="line">          if (!block.static) &#123;</div><div class="line">            node.static = false;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  function markStaticRoots (node, isInFor) &#123;</div><div class="line">    if (node.type === 1) &#123;</div><div class="line">      if (node.static || node.once) &#123;</div><div class="line">        node.staticInFor = isInFor;</div><div class="line">      &#125;</div><div class="line">      //å¯¹åªå«æœ‰ä¸€ä¸ªçº¯æ–‡æœ¬ç»“ç‚¹çš„nodeæ·»åŠ staticRoot = false</div><div class="line">      //å¦åˆ™staticRoot = true</div><div class="line">      if (node.static &amp;&amp; node.children.length &amp;&amp; !(</div><div class="line">        node.children.length === 1 &amp;&amp;</div><div class="line">        node.children[0].type === 3</div><div class="line">      )) &#123;</div><div class="line">        node.staticRoot = true;</div><div class="line">        return</div><div class="line">      &#125; else &#123;</div><div class="line">        node.staticRoot = false;</div><div class="line">      &#125;</div><div class="line">      if (node.children) &#123;</div><div class="line">        for (var i = 0, l = node.children.length; i &lt; l; i++) &#123;</div><div class="line">          markStaticRoots(node.children[i], isInFor || !!node.for);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      if (node.ifConditions) &#123;</div><div class="line">        for (var i$1 = 1, l$1 = node.ifConditions.length; i$1 &lt; l$1; i$1++) &#123;</div><div class="line">          markStaticRoots(node.ifConditions[i$1].block, isInFor);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>ä¸»è¦å¤„ç†æ€æƒ³å°±æ˜¯<br>å­èŠ‚ç‚¹ä¸€æ—¦ä¸ºåŠ¨æ€ç»“ç‚¹ï¼Œåˆ™çˆ¶èŠ‚ç‚¹ä¸ºåŠ¨æ€ç»“ç‚¹, static = false<br>åªå«æœ‰ä¸€ä¸ªçº¯æ–‡æœ¬ç»“ç‚¹çš„node,æ²¡æœ‰å…¶ä»–å­èŠ‚ç‚¹ï¼ŒstaticRoot = false</p>
<h1 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function generate (</div><div class="line">    ast,</div><div class="line">    options</div><div class="line">  ) &#123;</div><div class="line">    var state = new CodegenState(options);</div><div class="line">    var code = ast ? genElement(ast, state) : &apos;_c(&quot;div&quot;)&apos;;</div><div class="line">    return &#123;</div><div class="line">      render: (&quot;with(this)&#123;return &quot; + code + &quot;&#125;&quot;),</div><div class="line">      staticRenderFns: state.staticRenderFns</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="CodegenState"><a href="#CodegenState" class="headerlink" title="CodegenState"></a>CodegenState</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">var CodegenState = function CodegenState (options) &#123;</div><div class="line">    this.options = options;</div><div class="line">    this.warn = options.warn || baseWarn;</div><div class="line">    this.transforms = pluckModuleFunction(options.modules, &apos;transformCode&apos;);</div><div class="line">    this.dataGenFns = pluckModuleFunction(options.modules, &apos;genData&apos;);</div><div class="line">    this.directives = extend(extend(&#123;&#125;, baseDirectives), options.directives);</div><div class="line">    var isReservedTag = options.isReservedTag || no;</div><div class="line">    this.maybeComponent = function (el) &#123; return !!el.component || !isReservedTag(el.tag); &#125;;</div><div class="line">    this.onceId = 0;</div><div class="line">    this.staticRenderFns = [];</div><div class="line">    this.pre = false;</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<h2 id="genElement"><a href="#genElement" class="headerlink" title="genElement"></a>genElement</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">function genElement (el, state) &#123;</div><div class="line">  if (el.parent) &#123;</div><div class="line">    el.pre = el.pre || el.parent.pre;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (el.staticRoot &amp;&amp; !el.staticProcessed) &#123;</div><div class="line">    return genStatic(el, state)</div><div class="line">  &#125; else if (el.once &amp;&amp; !el.onceProcessed) &#123;</div><div class="line">    return genOnce(el, state)</div><div class="line">  &#125; else if (el.for &amp;&amp; !el.forProcessed) &#123;</div><div class="line">    return genFor(el, state)</div><div class="line">  &#125; else if (el.if &amp;&amp; !el.ifProcessed) &#123;</div><div class="line">    return genIf(el, state)</div><div class="line">  &#125; else if (el.tag === &apos;template&apos; &amp;&amp; !el.slotTarget &amp;&amp; !state.pre) &#123;</div><div class="line">    return genChildren(el, state) || &apos;void 0&apos;</div><div class="line">  &#125; else if (el.tag === &apos;slot&apos;) &#123;</div><div class="line">    return genSlot(el, state)</div><div class="line">  &#125; else &#123;</div><div class="line">    var code;</div><div class="line">    if (el.component) &#123;</div><div class="line">      code = genComponent(elp.comonent, el, state);</div><div class="line">    &#125; else &#123;//æ™®é€šæ ‡ç­¾æƒ…å†µ</div><div class="line">      var data;</div><div class="line">      //åœ¨processElementå‡½æ•°ä¸­</div><div class="line">      // el.plain = !el.key &amp;&amp;!el.scopedSlots &amp;&amp; !el.attrsList.length</div><div class="line">      // v-pre å¯ä»¥è·³è¿‡ç¼–è¯‘</div><div class="line">      if (!el.plain || (el.pre &amp;&amp; state.maybeComponent(el))) &#123;</div><div class="line">        data = genData$2(el, state);//æ‹¼æ¥elæ ‡ç­¾ä¸Šé…ç½®çš„å†…å®¹</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      var children = el.inlineTemplate ? null : genChildren(el, state, true);</div><div class="line">      code = &quot;_c(&apos;&quot; + (el.tag) + &quot;&apos;&quot; + (data ? (&quot;,&quot; + data) : &apos;&apos;) + (children ? (&quot;,&quot; + children) : &apos;&apos;) + &quot;)&quot;;</div><div class="line">    &#125;</div><div class="line">    for (var i = 0; i &lt; state.transforms.length; i++) &#123;</div><div class="line">      code = state.transforms[i](el, code);</div><div class="line">    &#125;</div><div class="line">    return code</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="genData-2"><a href="#genData-2" class="headerlink" title="genData$2"></a>genData$2</h3><p>genData$2 ç”Ÿæˆelæ ‡ç­¾ä¸Šé…ç½®çš„å†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">function genData$2 (el, state) &#123;</div><div class="line">  var data = &apos;&#123;&apos;;</div><div class="line">  //ä¼˜å…ˆå¤„ç†æŒ‡ä»¤ï¼Œå› ä¸ºæŒ‡ä»¤å¯èƒ½ä¼šå½±å“å…¶ä»–å±æ€§</div><div class="line">  //å¾ˆé‡è¦è¿™ä¸ªæ­¥éª¤å¾ˆé‡è¦ï¼Œä¼šç»™inputç­‰å­˜åœ¨äº¤äº’çš„æ ‡ç­¾å› ä¸ºv-modelç»‘å®šå“åº”äº‹ä»¶</div><div class="line">  //genDirectivesä¸‹æ–‡æœ‰è¯¦è§£</div><div class="line">  var dirs = genDirectives(el, state);</div><div class="line">  if (dirs) &#123; data += dirs + &apos;,&apos;; &#125;</div><div class="line"></div><div class="line">  // key</div><div class="line">  if (el.key) &#123;</div><div class="line">    data += &quot;key:&quot; + (el.key) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // ref</div><div class="line">  if (el.ref) &#123;</div><div class="line">    data += &quot;ref:&quot; + (el.ref) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  if (el.refInFor) &#123;</div><div class="line">    data += &quot;refInFor:true,&quot;;</div><div class="line">  &#125;</div><div class="line">  // pre</div><div class="line">  if (el.pre) &#123;</div><div class="line">    data += &quot;pre:true,&quot;;</div><div class="line">  &#125;</div><div class="line">  // record original tag name for components using &quot;is&quot; attribute</div><div class="line">  if (el.component) &#123;</div><div class="line">    data += &quot;tag:\&quot;&quot; + (el.tag) + &quot;\&quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // module data generation functions</div><div class="line">  for (var i = 0; i &lt; state.dataGenFns.length; i++) &#123;</div><div class="line">    data += state.dataGenFns[i](el);</div><div class="line">  &#125;</div><div class="line">  // attributes</div><div class="line">  if (el.attrs) &#123;</div><div class="line">    data += &quot;attrs:&quot; + (genProps(el.attrs)) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // DOM props</div><div class="line">  if (el.props) &#123;</div><div class="line">    data += &quot;domProps:&quot; + (genProps(el.props)) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // event handlers</div><div class="line">  if (el.events) &#123;</div><div class="line">    data += (genHandlers(el.events, false)) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  if (el.nativeEvents) &#123;</div><div class="line">    data += (genHandlers(el.nativeEvents, true)) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // slot target</div><div class="line">  // only for non-scoped slots</div><div class="line">  if (el.slotTarget &amp;&amp; !el.slotScope) &#123;</div><div class="line">    data += &quot;slot:&quot; + (el.slotTarget) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // scoped slots</div><div class="line">  if (el.scopedSlots) &#123;</div><div class="line">    data += (genScopedSlots(el, el.scopedSlots, state)) + &quot;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // component v-model</div><div class="line">  if (el.model) &#123;</div><div class="line">    data += &quot;model:&#123;value:&quot; + (el.model.value) + &quot;,callback:&quot; + (el.model.callback) + &quot;,expression:&quot; + (el.model.expression) + &quot;&#125;,&quot;;</div><div class="line">  &#125;</div><div class="line">  // inline-template</div><div class="line">  if (el.inlineTemplate) &#123;</div><div class="line">    var inlineTemplate = genInlineTemplate(el, state);</div><div class="line">    if (inlineTemplate) &#123;</div><div class="line">      data += inlineTemplate + &quot;,&quot;;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  data = data.replace(/,$/, &apos;&apos;) + &apos;&#125;&apos;;</div><div class="line">  // v-bind dynamic argument wrap</div><div class="line">  // v-bind with dynamic arguments must be applied using the same v-bind object</div><div class="line">  // merge helper so that class/style/mustUseProp attrs are handled correctly.</div><div class="line">  if (el.dynamicAttrs) &#123;</div><div class="line">    data = &quot;_b(&quot; + data + &quot;,\&quot;&quot; + (el.tag) + &quot;\&quot;,&quot; + (genProps(el.dynamicAttrs)) + &quot;)&quot;;</div><div class="line">  &#125;</div><div class="line">  // v-bind data wrap</div><div class="line">  if (el.wrapData) &#123;</div><div class="line">    data = el.wrapData(data);</div><div class="line">  &#125;</div><div class="line">  // v-on data wrap</div><div class="line">  if (el.wrapListeners) &#123;</div><div class="line">    data = el.wrapListeners(data);</div><div class="line">  &#125;</div><div class="line">  return data</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="genDirectives"><a href="#genDirectives" class="headerlink" title="genDirectives"></a>genDirectives</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">function genDirectives (el, state) &#123;</div><div class="line">  var dirs = el.directives;</div><div class="line">  if (!dirs) &#123; return &#125;</div><div class="line">  var res = &apos;directives:[&apos;;</div><div class="line">  var hasRuntime = false;</div><div class="line">  var i, l, dir, needRuntime;</div><div class="line">  for (i = 0, l = dirs.length; i &lt; l; i++) &#123;</div><div class="line">    dir = dirs[i];</div><div class="line">    needRuntime = true;</div><div class="line">    var gen = state.directives[dir.name];</div><div class="line">    if (gen) &#123;</div><div class="line">      // å¤„ç†asté‡Œé¢çš„ç¼–è¯‘æ—¶æŒ‡ä»¤</div><div class="line">      // å¦‚æœè¿˜éœ€è¦è¿è¡Œæ—¶å‰¯æœ¬ï¼Œåˆ™è¿”å›true</div><div class="line">      needRuntime = !!gen(el, dir, state.warn);</div><div class="line">    &#125;</div><div class="line">    if (needRuntime) &#123;</div><div class="line">      hasRuntime = true;</div><div class="line">      res += &quot;&#123;name:\&quot;&quot; + (dir.name) + &quot;\&quot;,rawName:\&quot;&quot; + (dir.rawName) + &quot;\&quot;&quot; + (dir.value ? (&quot;,value:(&quot; + (dir.value) + &quot;),expression:&quot; + (JSON.stringify(dir.value))) : &apos;&apos;) + (dir.arg ? (&quot;,arg:&quot; + (dir.isDynamicArg ? dir.arg : (&quot;\&quot;&quot; + (dir.arg) + &quot;\&quot;&quot;))) : &apos;&apos;) + (dir.modifiers ? (&quot;,modifiers:&quot; + (JSON.stringify(dir.modifiers))) : &apos;&apos;) + &quot;&#125;,&quot;;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  if (hasRuntime) &#123;</div><div class="line">    return res.slice(0, -1) + &apos;]&apos;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="el-directives"><a href="#el-directives" class="headerlink" title="el.directives"></a>el.directives</h5><p>el.directiveså±æ€§åœ¨closeElementâ€”&gt;processElementâ€”&gt;processAttrs<br>å‡½æ•°è°ƒç”¨æµç¨‹ä¸­è¢«æŒ‚è½½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">function processAttrs (el) &#123;</div><div class="line">    var list = el.attrsList;</div><div class="line">    var i, l, name, rawName, value, modifiers, syncGen, isDynamic;</div><div class="line">    for (i = 0, l = list.length; i &lt; l; i++) &#123;</div><div class="line">      name = rawName = list[i].name;</div><div class="line">      value = list[i].value;</div><div class="line">      if (dirRE.test(name)) &#123; // var dirRE = /^v-|^@|^:|^#/;</div><div class="line">        el.hasBindings = true;</div><div class="line">        if (bindRE.test(name)) &#123; ...// v-bind</div><div class="line">        &#125; else if (onRE.test(name)) &#123;... // v-on</div><div class="line">        &#125; else &#123; // normal directives</div><div class="line">          name = name.replace(dirRE, &apos;&apos;);</div><div class="line">          var argMatch = name.match(argRE);</div><div class="line">          var arg = argMatch &amp;&amp; argMatch[1];</div><div class="line">          isDynamic = false;</div><div class="line">          if (arg) &#123;</div><div class="line">            name = name.slice(0, -(arg.length + 1));</div><div class="line">            if (dynamicArgRE.test(arg)) &#123;</div><div class="line">              arg = arg.slice(1, -1);</div><div class="line">              isDynamic = true;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">          addDirective(el, name, rawName, value, arg, isDynamic, modifiers, list[i]);</div><div class="line">          if (name === &apos;model&apos;) &#123;</div><div class="line">            checkForAliasModel(el, value);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; else &#123;....&#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">function addDirective (el,name,rawName,value,arg,isDynamicArg,modifiers,range) &#123;</div><div class="line">  (el.directives || (el.directives = [])).push(rangeSetItem(&#123;</div><div class="line">    name: name,</div><div class="line">    rawName: rawName,</div><div class="line">    value: value,</div><div class="line">    arg: arg,</div><div class="line">    isDynamicArg: isDynamicArg,</div><div class="line">    modifiers: modifiers</div><div class="line">  &#125;, range));</div><div class="line">  el.plain = false;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h5><p>å‡å¦‚ç°åœ¨æ ‡ç­¾ä¸º&lt;input v-model=â€™aâ€™ &gt;<br>é‚£ä¹ˆç°åœ¨çš„el.directives=[{name: â€œmodelâ€,rawName: â€œv-modelâ€,value: â€œaâ€,isDynamicArg: false,start: 106,end: 117,modifiers:undefined}]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">var gen = state.directives[dir.name];</div><div class="line">---&gt;</div><div class="line">state = new CodegenState()</div><div class="line">---&gt;</div><div class="line">var CodegenState = function CodegenState (options) &#123;</div><div class="line">  this.directives = extend(extend(&#123;&#125;, baseDirectives), options.directives);</div><div class="line">&#125;</div><div class="line">---&gt;</div><div class="line">options (finalOptions = Object.create(baseOptions);---&gt;baseCompile()---&gt;generate())</div><div class="line">---&gt;</div><div class="line">var baseOptions = &#123;</div><div class="line">    directives: directives$1,</div><div class="line">&#125;</div><div class="line">---&gt;</div><div class="line">directives$1 = &#123;</div><div class="line">  model: model,</div><div class="line">  text: text,</div><div class="line">  html: html</div><div class="line">&#125;;</div><div class="line">---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</div><div class="line">state.directives = directives$1</div><div class="line">state.directives[el.directives[0].name] ===&gt;model</div></pre></td></tr></table></figure></p>
<p>é’ˆå¯¹ä¸åŒæ ‡ç­¾å¤„ç†åŒå‘ç»‘å®šï¼Œæ·»åŠ ç›¸åº”äº‹ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">function model (el,dir,_warn) &#123;</div><div class="line">  warn$1 = _warn;</div><div class="line">  var value = dir.value;</div><div class="line">  var modifiers = dir.modifiers;</div><div class="line">  var tag = el.tag;</div><div class="line">  var type = el.attrsMap.type;</div><div class="line">  &#123;if (tag === &apos;input&apos; &amp;&amp; type === &apos;file&apos;) &#123;warn$1(....);&#125;&#125;</div><div class="line"></div><div class="line">  if (el.component) &#123;</div><div class="line">    genComponentModel(el, value, modifiers);</div><div class="line">    return false</div><div class="line">  &#125; else if (tag === &apos;select&apos;) &#123;</div><div class="line">    genSelect(el, value, modifiers);</div><div class="line">  &#125; else if (tag === &apos;input&apos; &amp;&amp; type === &apos;checkbox&apos;) &#123;</div><div class="line">    genCheckboxModel(el, value, modifiers);</div><div class="line">  &#125; else if (tag === &apos;input&apos; &amp;&amp; type === &apos;radio&apos;) &#123;</div><div class="line">    genRadioModel(el, value, modifiers);</div><div class="line">  &#125; else if (tag === &apos;input&apos; || tag === &apos;textarea&apos;) &#123;</div><div class="line">    genDefaultModel(el, value, modifiers);</div><div class="line">  &#125; else if (!config.isReservedTag(tag)) &#123;</div><div class="line">    genComponentModel(el, value, modifiers);</div><div class="line">    // component v-model doesn&apos;t need extra runtime</div><div class="line">    return false</div><div class="line">  &#125; else &#123;</div><div class="line">    warn$1(...);</div><div class="line">  &#125;</div><div class="line">  return true</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é’ˆå¯¹input çš„v-modelç»‘å®šinputäº‹ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">function genDefaultModel (</div><div class="line">    el,</div><div class="line">    value,</div><div class="line">    modifiers</div><div class="line">  ) &#123;</div><div class="line">    var type = el.attrsMap.type;</div><div class="line"></div><div class="line">    var ref = modifiers || &#123;&#125;;</div><div class="line">    var lazy = ref.lazy;</div><div class="line">    var number = ref.number;</div><div class="line">    var trim = ref.trim;</div><div class="line">    var needCompositionGuard = !lazy &amp;&amp; type !== &apos;range&apos;;</div><div class="line">    var event = lazy</div><div class="line">      ? &apos;change&apos;</div><div class="line">      : type === &apos;range&apos;</div><div class="line">        ? RANGE_TOKEN</div><div class="line">        : &apos;input&apos;; //é»˜è®¤inputäº‹ä»¶è§¦å‘åŒå‘ç»‘å®š</div><div class="line"></div><div class="line">    var valueExpression = &apos;$event.target.value&apos;;</div><div class="line">    if (trim) &#123;</div><div class="line">      valueExpression = &quot;$event.target.value.trim()&quot;;</div><div class="line">    &#125;</div><div class="line">    if (number) &#123;</div><div class="line">      valueExpression = &quot;_n(&quot; + valueExpression + &quot;)&quot;;</div><div class="line">    &#125;</div><div class="line">     //inputäº‹ä»¶å“åº”å‡½æ•°å­—ç¬¦ä¸²å½¢å¼</div><div class="line">    var code = genAssignmentCode(value, valueExpression);</div><div class="line">    if (needCompositionGuard) &#123;</div><div class="line">      code = &quot;if($event.target.composing)return;&quot; + code;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    addProp(el, &apos;value&apos;, (&quot;(&quot; + value + &quot;)&quot;));</div><div class="line">    addHandler(el, event, code, null, true); //addHandlerå‡½æ•°ç»™elç»‘å®ševentså±æ€§</div><div class="line">    if (trim || number) &#123;</div><div class="line">      addHandler(el, &apos;blur&apos;, &apos;$forceUpdate()&apos;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>$event.target.composingæ˜¯vueè‡ªå·±æ·»åŠ çš„å±æ€§ï¼Œç”¨äºæ§åˆ¶åœ¨è¾“å…¥ä¸­æ—¥éŸ©è¿™ç±»è¯­è¨€æ—¶<br>ç¡®å®šä¸€ä¸ªå­—æˆ–è¯è¾“å…¥å®Œæˆåå†æ›´æ–°ç»‘å®šå€¼ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¾“å…¥ä¸€ä¸ªå­—æ¯å°±æ›´æ–°ä¸€æ¬¡ç»‘å®šå€¼</p>
<h3 id="genChildren"><a href="#genChildren" class="headerlink" title="genChildren"></a>genChildren</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var children = el.inlineTemplate ? null : genChildren(el, state, true);</div></pre></td></tr></table></figure>
<p>genElementå‡½æ•°ä¸­ç»„å»ºå®Œæœ¬èº«æ ‡ç­¾å†…å®¹åï¼Œä¼šç»§ç»­ç»„å»ºå­æ ‡ç­¾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">function genChildren (</div><div class="line">    el,</div><div class="line">    state,</div><div class="line">    checkSkip,</div><div class="line">    altGenElement,</div><div class="line">    altGenNode</div><div class="line">  ) &#123;</div><div class="line">    var children = el.children;</div><div class="line">    if (children.length) &#123;</div><div class="line">      var el$1 = children[0];</div><div class="line">      // optimize single v-for</div><div class="line">      if (children.length === 1 &amp;&amp;</div><div class="line">        el$1.for &amp;&amp;</div><div class="line">        el$1.tag !== &apos;template&apos; &amp;&amp;</div><div class="line">        el$1.tag !== &apos;slot&apos;</div><div class="line">      ) &#123;</div><div class="line">        var normalizationType = checkSkip</div><div class="line">          ? state.maybeComponent(el$1) ? &quot;,1&quot; : &quot;,0&quot;</div><div class="line">          : &quot;&quot;;</div><div class="line">        return (&quot;&quot; + ((altGenElement || genElement)(el$1, state)) + normalizationType)</div><div class="line">      &#125;</div><div class="line">      var normalizationType$1 = checkSkip</div><div class="line">        ? getNormalizationType(children, state.maybeComponent)</div><div class="line">        : 0;</div><div class="line">      var gen = altGenNode || genNode;</div><div class="line">      return (&quot;[&quot; + (children.map(function (c) &#123; return gen(c, state); &#125;).join(&apos;,&apos;)) + &quot;]&quot; + (normalizationType$1 ? (&quot;,&quot; + normalizationType$1) : &apos;&apos;))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">function genNode (node, state) &#123;</div><div class="line">  if (node.type === 1) &#123;</div><div class="line">    return genElement(node, state)</div><div class="line">  &#125; else if (node.type === 3 &amp;&amp; node.isComment) &#123;</div><div class="line">    return genComment(node)</div><div class="line">  &#125; else &#123;</div><div class="line">    return genText(node)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>genChildrenå‡½æ•°ä¼šå¾ªç¯çˆ¶æ ‡ç­¾çš„çš„childrenå±æ€§ç”Ÿæˆæ¯ä¸ªå­æ ‡ç­¾çš„æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ï¼Œ<br>ä»¥æ•°ç»„å­—ç¬¦ä¸²å½¢å¼è¿”å›ç»™çˆ¶æ ‡ç­¾çš„_cå‡½æ•°ï¼Œç”¨ä½œå‚æ•°</p>
<h3 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å‡å¦‚htmlå†…å®¹ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div id = &apos;app&apos; class=&apos;hello&apos;&gt;</div><div class="line">  &lt;p &gt;&#123;&#123;a+&apos;...&apos;+arr[0]&#125;&#125;&lt;/p&gt;</div><div class="line">  &lt;input class=&quot;kk&quot; key=&apos;kkk&apos; ref=&apos;hellodiv&apos; v-model=&apos;a&apos; @input=&apos;search&apos;/&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆgenerateå‡½æ•°è¿”å›çš„renderå€¼å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;with(this)&#123;return _c(&apos;div&apos;,&#123;staticClass:&quot;hello&quot;,attrs:&#123;&quot;id&quot;:&quot;app&quot;&#125;&#125;,[_c(&apos;p&apos;,[_v(_s(a+&apos;...&apos;+arr[0]))]),_v(&quot; &quot;),_c(&apos;input&apos;,&#123;directives:[&#123;name:&quot;model&quot;,rawName:&quot;v-model&quot;,value:(a),expression:&quot;a&quot;&#125;],key:&quot;kkk&quot;,ref:&quot;hellodiv&quot;,staticClass:&quot;kk&quot;,domProps:&#123;&quot;value&quot;:(a)&#125;,on:&#123;&quot;input&quot;:[function($event)&#123;if($event.target.composing)return;a=$event.target.value&#125;,search]&#125;&#125;)])&#125;&quot;</div></pre></td></tr></table></figure></p>
<p>å¯è§ï¼Œgenerateå‡½æ•°åªæ˜¯å°†parseå’Œoptimizeå¤„ç†å¾—åˆ°çš„æ ‡ç­¾æè¿°å¯¹è±¡astæ•´ç†æˆå‡½æ•°å‚æ•°<br>äº¤ç”±ä¸åŒç±»å‹çš„å¯ä»¥ç”Ÿæˆvnodeå¯¹è±¡çš„å¤„ç†å‡½æ•°ï¼Œæ•´ä¸ªå‡½æ•°ï¼Œç”±å­—ç¬¦ä¸²æ‹¼æ¥å½¢æˆ<br>æ•´ä¸ªå‡½æ•°å­—ç¬¦ä¸²ä¼šåœ¨compileToFunctionså‡½æ•°ä¸­è°ƒç”¨createFunctionè½¬åŒ–ä¸ºçœŸæ­£çš„å‡½æ•°å¯¹è±¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function createFunction (code, errors) &#123;</div><div class="line">   try &#123;</div><div class="line">     return new Function(code)</div><div class="line">   &#125; catch (err) &#123;</div><div class="line">     errors.push(&#123; err: err, code: code &#125;);</div><div class="line">     return noop</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ä¸­çš„å‡½æ•°ç¼©å†™"><a href="#æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ä¸­çš„å‡½æ•°ç¼©å†™" class="headerlink" title="æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ä¸­çš„å‡½æ•°ç¼©å†™"></a>æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ä¸­çš„å‡½æ•°ç¼©å†™</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">function installRenderHelpers (target) &#123;</div><div class="line">    target._o = markOnce;</div><div class="line">    target._n = toNumber;</div><div class="line">    target._s = toString;</div><div class="line">    target._l = renderList;//v-for</div><div class="line">    target._t = renderSlot;</div><div class="line">    target._q = looseEqual;</div><div class="line">    target._i = looseIndexOf;</div><div class="line">    target._m = renderStatic;</div><div class="line">    target._f = resolveFilter;</div><div class="line">    target._k = checkKeyCodes;</div><div class="line">    target._b = bindObjectProps;</div><div class="line">    target._v = createTextVNode;</div><div class="line">    target._e = createEmptyVNode;</div><div class="line">    target._u = resolveScopedSlots;</div><div class="line">    target._g = bindObjectListeners;</div><div class="line">    target._d = bindDynamicKeys;</div><div class="line">    target._p = prependModifier;</div><div class="line">  &#125;</div><div class="line">  Object.defineProperty(Vue, &apos;FunctionalRenderContext&apos;, &#123;</div><div class="line">    value: FunctionalRenderContext</div><div class="line">  &#125;);</div><div class="line">  installRenderHelpers(FunctionalRenderContext.prototype);</div><div class="line">  ---&gt;</div><div class="line">  render:(&quot;with(this)&#123;return &quot; + code + &quot;&#125;&quot;)</div></pre></td></tr></table></figure>
<h4 id="c"><a href="#c" class="headerlink" title="_c"></a>_c</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">vm._c = function (a, b, c, d) &#123; return createElement(vm, a, b, c, d, false); &#125;;</div><div class="line">function createElement (context,tag,data,children,normalizationType,alwaysNormalize) &#123;</div><div class="line">  if (Array.isArray(data) || isPrimitive(data)) &#123;</div><div class="line">    normalizationType = children;</div><div class="line">    children = data;</div><div class="line">    data = undefined;</div><div class="line">  &#125;</div><div class="line">  if (isTrue(alwaysNormalize)) &#123;</div><div class="line">    normalizationType = ALWAYS_NORMALIZE;</div><div class="line">  &#125;</div><div class="line">  return _createElement(context, tag, data, children, normalizationType)</div><div class="line">&#125;</div><div class="line">function _createElement (context,tag,data,children,normalizationType) &#123;</div><div class="line">  //è¿™é‡Œçœç•¥ä¸€ç³»åˆ—è¾¹ç•Œåˆ¤æ–­</div><div class="line">  var vnode, ns;</div><div class="line">  if (typeof tag === &apos;string&apos;) &#123;</div><div class="line">    var Ctor;</div><div class="line">    ns = (context.$vnode &amp;&amp; context.$vnode.ns) || config.getTagNamespace(tag);</div><div class="line">    if (config.isReservedTag(tag)) &#123; //æ ‡ç­¾åæ˜¯ä¸€èˆ¬çš„htmlæ ‡ç­¾</div><div class="line">      vnode = new VNode(</div><div class="line">        config.parsePlatformTagName(tag), data, children,</div><div class="line">        undefined, undefined, context</div><div class="line">      );</div><div class="line">    &#125; else if ((!data || !data.pre) &amp;&amp; isDef(Ctor = resolveAsset(context.$options, &apos;components&apos;, tag))) &#123; //æ ‡ç­¾åæ˜¯ç»„ä»¶æ ‡ç­¾å</div><div class="line">      vnode = createComponent(Ctor, data, context, children, tag);</div><div class="line">    &#125; else &#123;</div><div class="line">      //æœªçŸ¥æˆ–æœªåˆ—å‡ºçš„å‘½åç©ºé—´å…ƒç´ åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œ</div><div class="line">      //å› ä¸ºå½“å…¶çˆ¶é¡¹æ ‡å‡†åŒ–å­å…ƒç´ æ—¶å¯èƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªå‘½åç©ºé—´</div><div class="line">      vnode = new VNode(</div><div class="line">        tag, data, children,</div><div class="line">        undefined, undefined, context</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">    // direct component options / constructor</div><div class="line">    vnode = createComponent(tag, data, context, children);</div><div class="line">  &#125;</div><div class="line">  if (Array.isArray(vnode)) &#123;</div><div class="line">    return vnode</div><div class="line">  &#125; else if (isDef(vnode)) &#123;</div><div class="line">    if (isDef(ns)) &#123; applyNS(vnode, ns); &#125;</div><div class="line">    if (isDef(data)) &#123; registerDeepBindings(data); &#125;</div><div class="line">    return vnode</div><div class="line">  &#125; else &#123;</div><div class="line">    return createEmptyVNode()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">var VNode = function VNode (</div><div class="line">    tag,</div><div class="line">    data,</div><div class="line">    children,</div><div class="line">    text,</div><div class="line">    elm,</div><div class="line">    context,</div><div class="line">    componentOptions,</div><div class="line">    asyncFactory</div><div class="line">  ) &#123;</div><div class="line">    this.tag = tag;</div><div class="line">    this.data = data;</div><div class="line">    this.children = children;//childrenæœ¬èº«æ˜¯vnodeå¯¹è±¡é›†åˆï¼Œæ‰€ä»¥ä¸éœ€é€’å½’å¤„ç†çˆ¶å­å…³ç³»</div><div class="line">    this.text = text;</div><div class="line">    this.elm = elm;//æŒ‚è½½çœŸæ­£çš„domå¯¹è±¡</div><div class="line">    this.ns = undefined;</div><div class="line">    this.context = context;</div><div class="line">    this.fnContext = undefined;</div><div class="line">    this.fnOptions = undefined;</div><div class="line">    this.fnScopeId = undefined;</div><div class="line">    this.key = data &amp;&amp; data.key;</div><div class="line">    this.componentOptions = componentOptions;</div><div class="line">    this.componentInstance = undefined;</div><div class="line">    this.parent = undefined;</div><div class="line">    this.raw = false;</div><div class="line">    this.isStatic = false;</div><div class="line">    this.isRootInsert = true;</div><div class="line">    this.isComment = false;</div><div class="line">    this.isCloned = false;</div><div class="line">    this.isOnce = false;</div><div class="line">    this.asyncFactory = asyncFactory;</div><div class="line">    this.asyncMeta = undefined;</div><div class="line">    this.isAsyncPlaceholder = false;</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<p>æ³¨æ„createElementå‡½æ•°åªæ˜¯å°†ä¸€ä¸ªç»“ç‚¹è½¬æˆvnodeå¯¹è±¡<br>ä¸Šé¢generateå¾—åˆ°çš„renderå­—ç¬¦ä¸²çš„é€»è¾‘æ˜¯ç”Ÿæˆä¸€ä¸ªæ ¹ç»“ç‚¹ï¼Œ<br>é‡Œé¢ä¼ é€’çš„å­èŠ‚ç‚¹æ•°ç»„ä¹Ÿæ˜¯è°ƒç”¨createElementå‡½æ•°ç”Ÿæˆçš„ä¸€ä¸ªä¸ªvnode<br>æ‰€ä»¥è¿™é‡Œè°ƒç”¨renderç”Ÿæˆvnodeå‡½æ•°æ—¶ï¼Œæ²¡æœ‰é€’å½’é€»è¾‘ï¼Œ<br>è€Œæ˜¯æ¯ä¸ªç»“ç‚¹è‡ªå·±å»è°ƒcreateElementç”Ÿæˆè‡ªå·±çš„vnode</p>
<h4 id="s"><a href="#s" class="headerlink" title="_s"></a>_s</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">function toString (val) &#123;</div><div class="line">   return val == null</div><div class="line">     ? &apos;&apos;</div><div class="line">     : Array.isArray(val) || (isPlainObject(val) &amp;&amp; val.toString === _toString)</div><div class="line">       ? JSON.stringify(val, null, 2)</div><div class="line">       : String(val)</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h4 id="v"><a href="#v" class="headerlink" title="_v"></a>_v</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function createTextVNode (val) &#123;</div><div class="line">    return new VNode(undefined, undefined, undefined, String(val))</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="l"><a href="#l" class="headerlink" title="_l"></a>_l</h4><p>å¾ªç¯ç»„å»ºç»“ç‚¹çš„åˆ›å»ºå‡½æ•°å­—ç¬¦ä¸²<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">function renderList (</div><div class="line">    val,</div><div class="line">    render</div><div class="line">  ) &#123;</div><div class="line">    var ret, i, l, keys, key;</div><div class="line">    if (Array.isArray(val) || typeof val === &apos;string&apos;) &#123;</div><div class="line">      ret = new Array(val.length);</div><div class="line">      for (i = 0, l = val.length; i &lt; l; i++) &#123;</div><div class="line">        ret[i] = render(val[i], i);</div><div class="line">      &#125;</div><div class="line">    &#125; else if (typeof val === &apos;number&apos;) &#123;</div><div class="line">      ret = new Array(val);</div><div class="line">      for (i = 0; i &lt; val; i++) &#123;</div><div class="line">        ret[i] = render(i + 1, i);</div><div class="line">      &#125;</div><div class="line">    &#125; else if (isObject(val)) &#123;</div><div class="line">      if (hasSymbol &amp;&amp; val[Symbol.iterator]) &#123;</div><div class="line">        ret = [];</div><div class="line">        var iterator = val[Symbol.iterator]();//è·å–å¯¹è±¡ç”Ÿæˆå™¨</div><div class="line">        var result = iterator.next();</div><div class="line">        while (!result.done) &#123;</div><div class="line">          ret.push(render(result.value, ret.length));</div><div class="line">          result = iterator.next();</div><div class="line">        &#125;</div><div class="line">      &#125; else &#123;</div><div class="line">        keys = Object.keys(val);</div><div class="line">        ret = new Array(keys.length);</div><div class="line">        for (i = 0, l = keys.length; i &lt; l; i++) &#123;</div><div class="line">          key = keys[i];</div><div class="line">          ret[i] = render(val[key], key, i);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    if (!isDef(ret)) &#123;</div><div class="line">      ret = [];</div><div class="line">    &#125;</div><div class="line">    (ret)._isVList = true;</div><div class="line">    return ret</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h1 id="mountComponent"><a href="#mountComponent" class="headerlink" title="mountComponent"></a>mountComponent</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">function mountComponent (vm,el,hydrating) &#123;</div><div class="line">  vm.$el = el;</div><div class="line">  if (!vm.$options.render) &#123;</div><div class="line">    vm.$options.render = createEmptyVNode;</div><div class="line">    &#123;...&#125;</div><div class="line">  callHook(vm, &apos;beforeMount&apos;);</div><div class="line"></div><div class="line">  var updateComponent;</div><div class="line">  if (config.performance &amp;&amp; mark) &#123;...</div><div class="line">  &#125; else &#123;  //å®šä¹‰updateComponent</div><div class="line">    updateComponent = function () &#123;</div><div class="line">      vm._update(vm._render(), hydrating);</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line">  new Watcher(vm, updateComponent, noop, &#123;</div><div class="line">    before: function before () &#123;</div><div class="line">      if (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123;</div><div class="line">        callHook(vm, &apos;beforeUpdate&apos;);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;, true);</div><div class="line">  hydrating = false;</div><div class="line">  if (vm.$vnode == null) &#123;</div><div class="line">    vm._isMounted = true;</div><div class="line">    callHook(vm, &apos;mounted&apos;);</div><div class="line">  &#125;</div><div class="line">  return vm</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>watcher æ„é€ å‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">var Watcher = function Watcher (vm,expOrFn,cb,options,isRenderWatcher) &#123;</div><div class="line">  this.vm = vm;</div><div class="line">  if (isRenderWatcher) &#123;</div><div class="line">    vm._watcher = this;</div><div class="line">  &#125;</div><div class="line">  vm._watchers.push(this);</div><div class="line">  //...çœç•¥ä¸é‡è¦ä»£ç </div><div class="line">  this.expression = expOrFn.toString(); //updateComponentå­—ç¬¦ä¸²åŒ–</div><div class="line">  // parse expression for getter</div><div class="line">  if (typeof expOrFn === &apos;function&apos;) &#123;</div><div class="line">    this.getter = expOrFn; //æŒ‡å‘updateComponent</div><div class="line">  &#125; else &#123;</div><div class="line">    this.getter = parsePath(expOrFn);</div><div class="line">    if (!this.getter) &#123;</div><div class="line">      this.getter = noop;</div><div class="line">      warn(....);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  this.value = this.lazy</div><div class="line">    ? undefined</div><div class="line">    : this.get();//é‡Œé¢ä¼šè°ƒç”¨this.getter</div><div class="line">&#125;;</div><div class="line">Watcher.prototype.get = function get () &#123;</div><div class="line">  var value;</div><div class="line">  var vm = this.vm;</div><div class="line">  try &#123;</div><div class="line">    value = this.getter.call(vm, vm);//å°±æ˜¯åœ¨è°ƒç”¨updateComponent</div><div class="line">  &#125; catch (e) &#123;...</div><div class="line">  &#125; finally &#123;...</div><div class="line">  &#125;</div><div class="line">  return value //æœ€ç»ˆè¿”å›value</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å¯çŸ¥åœ¨new Watcherè¿‡ç¨‹ä¸­æ„é€ å‡½æ•°ä¼šå°†updateComponentæŒ‚åˆ°getterå±æ€§ä¸Šï¼Œ<br>åœ¨é€šè¿‡getå±æ€§è¿›è¡Œè°ƒç”¨<br>å†æ¥çœ‹ä¸€ä¸‹updateComponentæ€ä¹ˆå®šä¹‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">updateComponent = function () &#123;</div><div class="line">   vm._update(vm._render(), hydrating);</div><div class="line"> &#125;;</div></pre></td></tr></table></figure></p>
<p>updateComponentè¦è°ƒç”¨vueçš„_updateå‡½æ•°<br>æ³¨æ„è¿™é‡Œè°ƒç”¨äº†vm._render()ï¼Œç”Ÿæˆäº†vnodeï¼Œå½“åšå‚æ•°ä¼ é€’äº†è¿›å»<br>vueçš„_updateå‡½æ•°æ˜¯åœ¨æ„å»ºvueæ„é€ å‡½æ•°æ—¶<br>è°ƒç”¨lifecycleMixinå‡½æ•°è¢«æŒ‚è½½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">function lifecycleMixin (Vue) &#123;</div><div class="line">  Vue.prototype._update = function (vnode, hydrating) &#123;</div><div class="line">    var vm = this;</div><div class="line">    var prevEl = vm.$el;//vm.$elåˆæ¬¡æ¸²æŸ“æ—¶ä¸ºæŒ‚è½½ç‚¹æ‰€åœ¨html,å³æœ€åŸå§‹çš„,parseå¤„ç†çš„htmlæ¨¡æ¿</div><div class="line">    var prevVnode = vm._vnode;//è¿™é‡Œåˆæ¬¡æ¸²æŸ“æ—¶ä¸ºnull</div><div class="line">    var restoreActiveInstance = setActiveInstance(vm);//ç»™å…¨å±€å˜é‡activeInstanceèµ‹å€¼ä¸ºvm</div><div class="line">    vm._vnode = vnode;//ç»™vueæŒ‚ä¸Šå¾—åˆ°çš„vnode</div><div class="line">    if (!prevVnode) &#123;//åˆæ¬¡æ¸²æŸ“èµ°è¿™é‡Œ</div><div class="line">      vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */);</div><div class="line">    &#125; else &#123;//æ›´æ–°æ—¶èµ°è¿™é‡Œ</div><div class="line">      vm.$el = vm.__patch__(prevVnode, vnode);</div><div class="line">    &#125;</div><div class="line">    restoreActiveInstance();//å¤„ç†å®Œåæ›´æ–°activeInstanceä¸ºnull</div><div class="line">    // update __vue__ reference</div><div class="line">    if (prevEl) &#123;</div><div class="line">      prevEl.__vue__ = null;</div><div class="line">    &#125;</div><div class="line">    if (vm.$el) &#123;</div><div class="line">      vm.$el.__vue__ = vm;</div><div class="line">    &#125;</div><div class="line">    // if parent is an HOC, update its $el as well</div><div class="line">    if (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) &#123;</div><div class="line">      vm.$parent.$el = vm.$el;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div></pre></td></tr></table></figure></p>
<h2 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h2><p><strong>patch</strong>å‡½æ•°ç›´æ¥åœ¨ç”Ÿæˆvueæ„é€ å‡½æ•°æ—¶è¢«æŒ‚è½½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">Vue.prototype.__patch__ = inBrowser ? patch : noop;</div><div class="line">var patch = createPatchFunction(&#123; nodeOps: nodeOps, modules: modules &#125;);</div><div class="line"></div><div class="line">function createPatchFunction (backend) &#123;</div><div class="line">    var i, j;</div><div class="line">    var cbs = &#123;&#125;;</div><div class="line"></div><div class="line">    var modules = backend.modules;</div><div class="line">    var nodeOps = backend.nodeOps;</div><div class="line"></div><div class="line">    for (i = 0; i &lt; hooks.length; ++i) &#123;</div><div class="line">      cbs[hooks[i]] = [];</div><div class="line">      for (j = 0; j &lt; modules.length; ++j) &#123;</div><div class="line">        if (isDef(modules[j][hooks[i]])) &#123;</div><div class="line">          cbs[hooks[i]].push(modules[j][hooks[i]]);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    //çœç•¥è‹¥å¹²å‡½æ•°å£°æ˜......</div><div class="line">    return function patch (oldVnode, vnode, hydrating, removeOnly) &#123;</div><div class="line">      if (isUndef(vnode)) &#123;</div><div class="line">        if (isDef(oldVnode)) &#123; invokeDestroyHook(oldVnode); &#125;</div><div class="line">        return</div><div class="line">      &#125;</div><div class="line">      var isInitialPatch = false;</div><div class="line">      var insertedVnodeQueue = [];</div><div class="line">      if (isUndef(oldVnode)) &#123;</div><div class="line">        isInitialPatch = true;</div><div class="line">        createElm(vnode, insertedVnodeQueue);</div><div class="line">      &#125; else &#123;</div><div class="line">        var isRealElement = isDef(oldVnode.nodeType);</div><div class="line">        if (!isRealElement &amp;&amp; sameVnode(oldVnode, vnode)) &#123;//æ›´æ–°æ—¶ï¼Œè¯¦è§æ›´æ–°èŠ‚ç‚¹</div><div class="line">          patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly);</div><div class="line">        &#125; else &#123;//åˆæ¬¡æ¸²æŸ“æ—¶oldVnodeä¸ºåŸå§‹htmlç»“ç‚¹</div><div class="line">          if (isRealElement) &#123;</div><div class="line">           //æ˜¯çœŸå®çš„DOMè€Œä¸”æ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„ç»“æœ</div><div class="line">            if (oldVnode.nodeType === 1 &amp;&amp; oldVnode.hasAttribute(SSR_ATTR)) &#123;</div><div class="line">              oldVnode.removeAttribute(SSR_ATTR);</div><div class="line">              hydrating = true;</div><div class="line">            &#125;</div><div class="line">            if (isTrue(hydrating)) &#123;</div><div class="line">              if (hydrate(oldVnode, vnode, insertedVnodeQueue)) &#123;</div><div class="line">                invokeInsertHook(vnode, insertedVnodeQueue, true);</div><div class="line">                return oldVnode</div><div class="line">              &#125; else &#123;</div><div class="line">                warn(....);</div><div class="line">              &#125;</div><div class="line">            &#125;</div><div class="line">            //ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“æˆ–è€…åˆæˆå¤±è´¥ï¼Œå°±åˆ›å»ºç©ºçš„vnodeä»£æ›¿è€ç»“ç‚¹</div><div class="line">            oldVnode = emptyNodeAt(oldVnode);</div><div class="line">            //oldVnode:&#123;elm:æŒ‡å‘åŸå§‹æœªç¼–è¯‘å‰çš„çœŸå®htmlç»“ç‚¹&#125;</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          // æ›¿æ¢æ­£å­˜åœ¨çš„ç»“ç‚¹</div><div class="line">          var oldElm = oldVnode.elm;//åŸæ¥ç»“ç‚¹</div><div class="line">          var parentElm = nodeOps.parentNode(oldElm);//åŸèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</div><div class="line"></div><div class="line">          // åˆ›å»ºdomç»“ç‚¹</div><div class="line">          createElm(</div><div class="line">            vnode,</div><div class="line">            insertedVnodeQueue,</div><div class="line">            oldElm._leaveCb ? null : parentElm,</div><div class="line">            nodeOps.nextSibling(oldElm)</div><div class="line">          );</div><div class="line">          //åˆ›å»ºdomç»“æŸåï¼Œbodyé‡Œé¢ä¼šæœ‰ä¸¤ä¸ªæŒ‚è½½ç‚¹ï¼Œä¸€ä¸ªç¼–è¯‘å‰html,ä¸€ä¸ªç¼–è¯‘åhtml</div><div class="line">          //æ‰€ä»¥æ–°è€ç»“ç‚¹æ›´æ–°çš„æ€è·¯æ˜¯,åœ¨çˆ¶å…ƒç´ åœ¨æ–°å¢æ–°ç»“ç‚¹å­å…ƒç´ ï¼Œç„¶åå°†è€ç»“ç‚¹åˆ é™¤</div><div class="line">          // é€’å½’æ›´æ–°çˆ¶å ä½ç¬¦èŠ‚ç‚¹å…ƒç´ </div><div class="line">          if (isDef(vnode.parent)) &#123;....&#125;</div><div class="line"></div><div class="line">          // destroy old node</div><div class="line">          if (isDef(parentElm)) &#123;</div><div class="line">            removeVnodes([oldVnode], 0, 0);//ä»çˆ¶å…ƒç´ ä¸­åˆ é™¤è€ç»“ç‚¹</div><div class="line">          &#125; else if (isDef(oldVnode.tag)) &#123;</div><div class="line">            invokeDestroyHook(oldVnode);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      invokeInsertHook(vnode, insertedVnodeQueue, isInitialPatch);</div><div class="line">      return vnode.elm //è¿”å›çœŸæ­£çš„domç»“ç‚¹</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="createElm"><a href="#createElm" class="headerlink" title="createElm"></a>createElm</h3><p>ç”ŸæˆçœŸæ­£çš„domç»“ç‚¹æŒ‚è½½åœ¨å„è‡ªçš„vnodeçš„elmå±æ€§ä¸Šï¼Œå¹¶åœ¨ç”Ÿæˆçš„è¿‡ç¨‹ä¸­å»ºç«‹çˆ¶å­å…³ç³»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">  function createElm (vnode,insertedVnodeQueue,parentElm,refElm,nested,ownerArray,index</div><div class="line">  ) &#123;</div><div class="line">    if (isDef(vnode.elm) &amp;&amp; isDef(ownerArray)) &#123;//é¢„æ¸²æŸ“æ—¶å…‹éš†æºèŠ‚ç‚¹ï¼Œä¸å†é‡æ–°ç”Ÿæˆ</div><div class="line">      vnode = ownerArray[index] = cloneVNode(vnode);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    vnode.isRootInsert = !nested; // for transition enter check</div><div class="line">    if (createComponent(vnode, insertedVnodeQueue, parentElm, refElm)) &#123;</div><div class="line">      return</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var data = vnode.data;</div><div class="line">    var children = vnode.children;</div><div class="line">    var tag = vnode.tag;</div><div class="line">    if (isDef(tag)) &#123;</div><div class="line">      &#123;</div><div class="line">        if (data &amp;&amp; data.pre) &#123;creatingElmInVPre++;&#125;</div><div class="line">        if (isUnknownElement$$1(vnode, creatingElmInVPre)) &#123; warn(...);&#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      vnode.elm = vnode.ns</div><div class="line">        ? nodeOps.createElementNS(vnode.ns, tag)</div><div class="line">        : nodeOps.createElement(tag, vnode);//æ²¡æœ‰å‘½åç©ºé—´ç›´æ¥ç”ŸæˆçœŸæ­£htmlæ ‡ç­¾æŒ‚åˆ°elmå±æ€§ä¸Š</div><div class="line">      setScope(vnode);</div><div class="line">      &#123;</div><div class="line">        createChildren(vnode, children, insertedVnodeQueue); //æ„å»ºå­èŠ‚ç‚¹</div><div class="line">        if (isDef(data)) &#123;</div><div class="line">          invokeCreateHooks(vnode, insertedVnodeQueue);//å¤„ç†æ ‡ç­¾ä¸Šå±æ€§ï¼ˆid,class....ï¼‰</div><div class="line">        &#125;</div><div class="line">        insert(parentElm, vnode.elm, refElm);</div><div class="line">      &#125;</div><div class="line">      if (data &amp;&amp; data.pre) &#123;</div><div class="line">        creatingElmInVPre--;</div><div class="line">      &#125;</div><div class="line">    &#125; else if (isTrue(vnode.isComment)) &#123;//å¤„ç†æ³¨é‡Šç»“ç‚¹</div><div class="line">      vnode.elm = nodeOps.createComment(vnode.text);</div><div class="line">      insert(parentElm, vnode.elm, refElm);</div><div class="line">    &#125; else &#123;//å¤„ç†çº¯é™æ€æ–‡æœ¬ç»“ç‚¹</div><div class="line">      vnode.elm = nodeOps.createTextNode(vnode.text);</div><div class="line">      insert(parentElm, vnode.elm, refElm);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">-----&gt;nodeOps.createElement-----&gt;</div><div class="line">  function createElement$1 (tagName, vnode) &#123;</div><div class="line">    var elm = document.createElement(tagName);</div><div class="line">    if (tagName !== &apos;select&apos;) &#123;</div><div class="line">      return elm</div><div class="line">    &#125;</div><div class="line">    // false or null will remove the attribute but undefined will not</div><div class="line">    if (vnode.data &amp;&amp; vnode.data.attrs &amp;&amp; vnode.data.attrs.multiple !== undefined) &#123;</div><div class="line">      elm.setAttribute(&apos;multiple&apos;, &apos;multiple&apos;);</div><div class="line">    &#125;</div><div class="line">    return elm</div><div class="line">  &#125;</div><div class="line">----&gt;nodeOps.createTextNode----&gt;</div><div class="line">function createTextNode (text) &#123;</div><div class="line">  return document.createTextNode(text)</div><div class="line">&#125;</div><div class="line">----&gt;nodeOps.createComment----&gt;</div><div class="line">function createComment (text) &#123;</div><div class="line">  return document.createComment(text)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="createChildren"><a href="#createChildren" class="headerlink" title="createChildren"></a>createChildren</h3><p>æ„å»ºå­èŠ‚ç‚¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function createChildren (vnode, children, insertedVnodeQueue) &#123;</div><div class="line">      if (Array.isArray(children)) &#123;</div><div class="line">        &#123;</div><div class="line">          checkDuplicateKeys(children);//æ£€æŸ¥å­èŠ‚ç‚¹æ˜¯å¦æœ‰é‡å¤keyå€¼</div><div class="line">        &#125;</div><div class="line">        for (var i = 0; i &lt; children.length; ++i) &#123; //é€’å½’è°ƒç”¨createElmåˆ›å»ºå­èŠ‚ç‚¹</div><div class="line">          createElm(children[i], insertedVnodeQueue, vnode.elm, null, true, children, i);</div><div class="line">        &#125;</div><div class="line">      &#125; else if (isPrimitive(vnode.text)) &#123;</div><div class="line">        nodeOps.appendChild(vnode.elm, nodeOps.createTextNode(String(vnode.text)));</div><div class="line">      &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><p>æ„å»ºçˆ¶å­domç»“ç‚¹å…³ç³»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"> function insert (parent, elm, ref$$1) &#123;</div><div class="line">  if (isDef(parent)) &#123;</div><div class="line">    if (isDef(ref$$1)) &#123;</div><div class="line">      if (nodeOps.parentNode(ref$$1) === parent) &#123;</div><div class="line">        nodeOps.insertBefore(parent, elm, ref$$1);</div><div class="line">      &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">      nodeOps.appendChild(parent, elm);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">----&gt;nodeOps.insertBefore-----&gt;çº¯domæ“ä½œ</div><div class="line">function insertBefore (parentNode, newNode, referenceNode) &#123;</div><div class="line">  parentNode.insertBefore(newNode, referenceNode);</div><div class="line">&#125;</div><div class="line">-----&gt;nodeOps.appendChild----&gt;çº¯domæ“ä½œ</div><div class="line">function appendChild (node, child) &#123;</div><div class="line">    node.appendChild(child);</div><div class="line">  &#125;</div><div class="line">-----&gt;nodeOps.removeChild----&gt;çº¯domæ“ä½œ</div><div class="line">function removeChild (node, child) &#123;</div><div class="line">    node.removeChild(child);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h2 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>mountComponentä¸»è¦åšè¿™æ ·å‡ ä»¶äº‹<br>1.æ‰§è¡ŒbeforeMounté’©å­å‡½æ•°<br>2.å®šä¹‰updateComponent,å¹¶åœ¨new watcherçš„æ—¶å€™è°ƒç”¨<br>3.è°ƒç”¨updateComponentå‡½æ•°æ—¶ä¼šè°ƒç”¨vm_renderå‡½æ•°ç”Ÿæˆvnodeå¯¹è±¡,è¿™ä¸ªè¿‡ç¨‹astä¸­å˜é‡ä¼šæ‹¿åˆ°å®é™…çš„å€¼<br>4.updateComponentå‡½æ•°ä¼šå°†vnodeä¼ é€’ç»™vm_update,vm_updateåœ¨ç”Ÿæˆvueæ„é€ å‡½æ•°æ—¶è¢«æŒ‚è½½<br>5.vm_updateä¼šè°ƒç”¨vm<strong>patch</strong>,vm<strong>patch</strong>ä¼šè°ƒç”¨patchå‡½æ•°<br>6.patchå‡½æ•°ä¼šæ ¹æ®ä¼ å…¥å‚æ•°ç‰¹å¾å¤„ç†ç¬¬ä¸€æ¬¡æŒ‚è½½è¿˜æ˜¯æ›´æ–°æ“ä½œ<br>7.patchå‡½æ•°ä¼šè°ƒç”¨createElementé€’å½’å°†vnodeå¯¹è±¡é‡Œé¢çš„ç»“ç‚¹è½¬æˆçœŸæ­£çš„domç»“ç‚¹æŒ‚è½½åœ¨å¯¹åº”çš„elmå±æ€§ä¸Šï¼ŒåŒæ—¶ä¼šå¤„ç†å¥½çˆ¶å­å…³ç³»ä»¥åŠæ ‡ç­¾ä¸Šclass,idä¹‹ç±»çš„å±æ€§<br>8.å› ä¸ºå¤„ç†æœ€å¤–å±‚ç»“ç‚¹æ—¶ï¼Œå³æŒ‚è½½ç‚¹ç»“ç‚¹æ—¶ï¼Œè·å–çš„çˆ¶èŠ‚ç‚¹ä¸æœªç¼–è¯‘çš„æŒ‚è½½ç‚¹æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥è¦æŠŠæœªç¼–è¯‘çš„æŒ‚è½½ç‚¹è°ƒç”¨removeVnodesç§»é™¤ï¼Œ</p>
<h1 id="æ›´æ–°èŠ‚ç‚¹"><a href="#æ›´æ–°èŠ‚ç‚¹" class="headerlink" title="æ›´æ–°èŠ‚ç‚¹"></a>æ›´æ–°èŠ‚ç‚¹</h1><h2 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode"></a>patchVnode</h2><p>è´Ÿè´£å…·ä½“çš„ç»“ç‚¹æ›´æ–°å·¥ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">function patchVnode (oldVnode,vnode,insertedVnodeQueue,ownerArray,indexï¼ŒremoveOnly</div><div class="line">) &#123;</div><div class="line">  if (oldVnode === vnode) &#123;</div><div class="line">    return</div><div class="line">  &#125;</div><div class="line">  //...çœç•¥è‹¥å¹²è¾¹ç•Œ/ç‰¹æ®Šæ¡ä»¶å¤„ç†</div><div class="line">  var i;</div><div class="line">  var data = vnode.data;</div><div class="line">  //ç»„ä»¶æ‰ä¼šæœ‰hookå±æ€§</div><div class="line">  if (isDef(data) &amp;&amp; isDef(i = data.hook) &amp;&amp; isDef(i = i.prepatch)) &#123;</div><div class="line">    i(oldVnode, vnode);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  var oldCh = oldVnode.children;</div><div class="line">  var ch = vnode.children;</div><div class="line">  if (isDef(data) &amp;&amp; isPatchable(vnode)) &#123;//å¤„ç†æ ‡ç­¾ä¸Šå±æ€§æ›´æ–°</div><div class="line">    for (i = 0; i &lt; cbs.update.length; ++i) &#123; cbs.update[i](oldVnode, vnode); &#125;</div><div class="line">    if (isDef(i = data.hook) &amp;&amp; isDef(i = i.update)) &#123; i(oldVnode, vnode); &#125;</div><div class="line">  &#125;</div><div class="line">  if (isUndef(vnode.text)) &#123;//å¦‚æœæ–°ç»“ç‚¹ä¸æ˜¯çº¯æ–‡æœ¬ç»“ç‚¹</div><div class="line">    if (isDef(oldCh) &amp;&amp; isDef(ch)) &#123;//å¦‚æœæ–°è€ç»“ç‚¹éƒ½æœ‰å­èŠ‚ç‚¹</div><div class="line">      if (oldCh !== ch) &#123; updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly); &#125;</div><div class="line">    &#125; else if (isDef(ch)) &#123; //å¦‚æœæ–°ç»“ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œè€ç»“ç‚¹æ²¡æœ‰ï¼Œç›´æ¥æ–°å¢</div><div class="line">      &#123;</div><div class="line">        checkDuplicateKeys(ch);</div><div class="line">      &#125;</div><div class="line">      if (isDef(oldVnode.text)) &#123; nodeOps.setTextContent(elm, &apos;&apos;); &#125;</div><div class="line">      addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue);</div><div class="line">    &#125; else if (isDef(oldCh)) &#123; //å¦‚æœè€ç»“ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œæ–°ç»“ç‚¹æ²¡æœ‰ï¼Œç›´æ¥åˆ é™¤</div><div class="line">      removeVnodes(oldCh, 0, oldCh.length - 1);</div><div class="line">    &#125; else if (isDef(oldVnode.text)) &#123;//å¦‚æœæ˜¯æ–‡æœ¬ç»“ç‚¹ï¼Œæ¸…ç©º</div><div class="line">      nodeOps.setTextContent(elm, &apos;&apos;);</div><div class="line">    &#125;</div><div class="line">  &#125; else if (oldVnode.text !== vnode.text) &#123; //å¦‚æœæ–°ç»“ç‚¹ä¹Ÿæ˜¯çº¯æ–‡æœ¬ç»“ç‚¹ï¼Œåˆ™æ›´æ–°å†…å®¹</div><div class="line">    nodeOps.setTextContent(elm, vnode.text);</div><div class="line">  &#125;</div><div class="line">  if (isDef(data)) &#123;</div><div class="line">    if (isDef(i = data.hook) &amp;&amp; isDef(i = i.postpatch)) &#123; i(oldVnode, vnode); &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren"></a>updateChildren</h2><p>è´Ÿè´£åˆ¤æ–­å­èŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œé€’å½’è°ƒç”¨patchVnodeè¿›è¡Œæ›´æ–°æ“ä½œ<br>ä¸»è¦æ€è·¯æ˜¯ä»¥æ–°ç»“ç‚¹ä¸ºæ ‡å°ºï¼Œå¯¹æ¯”è€ç»“ç‚¹ï¼Œåœ¨è€ç»“ç‚¹æ ‘ä¸Šé¢ç§»åŠ¨æˆ–è€…æ–°å¢åˆ é™¤èŠ‚ç‚¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">  function updateChildren (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) &#123;</div><div class="line">      var oldStartIdx = 0;</div><div class="line">      var newStartIdx = 0;</div><div class="line">      var oldEndIdx = oldCh.length - 1;</div><div class="line">      var oldStartVnode = oldCh[0];</div><div class="line">      var oldEndVnode = oldCh[oldEndIdx];</div><div class="line">      var newEndIdx = newCh.length - 1;</div><div class="line">      var newStartVnode = newCh[0];</div><div class="line">      var newEndVnode = newCh[newEndIdx];</div><div class="line">      var oldKeyToIdx, idxInOld, vnodeToMove, refElm;</div><div class="line">      var canMove = !removeOnly;</div><div class="line"></div><div class="line">      &#123;</div><div class="line">        checkDuplicateKeys(newCh);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</div><div class="line">        if (isUndef(oldStartVnode)) &#123;</div><div class="line">          oldStartVnode = oldCh[++oldStartIdx]; // Vnode has been moved left</div><div class="line">        &#125; else if (isUndef(oldEndVnode)) &#123;</div><div class="line">          oldEndVnode = oldCh[--oldEndIdx];</div><div class="line">        &#125; else if (sameVnode(oldStartVnode, newStartVnode)) &#123;</div><div class="line">          patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx);</div><div class="line">          oldStartVnode = oldCh[++oldStartIdx];</div><div class="line">          newStartVnode = newCh[++newStartIdx];</div><div class="line">        &#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123;</div><div class="line">          patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx);</div><div class="line">          oldEndVnode = oldCh[--oldEndIdx];</div><div class="line">          newEndVnode = newCh[--newEndIdx];</div><div class="line">        &#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; </div><div class="line">          patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx);</div><div class="line">//å› ä¸ºè€nodeçš„å¼€å§‹èŠ‚ç‚¹ç«Ÿç„¶ä¸æ–°nodeçš„ç»“æŸèŠ‚ç‚¹ä¸€è‡´ï¼Œè¯´æ˜è€nodeçš„å¼€å§‹èŠ‚ç‚¹éœ€è¦ç§»åŠ¨åˆ°å½“å‰çš„è€nodeç»“æŸèŠ‚ç‚¹çš„åä¸€ä½</div><div class="line">          canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm));</div><div class="line">          oldStartVnode = oldCh[++oldStartIdx];</div><div class="line">          newEndVnode = newCh[--newEndIdx];</div><div class="line">        &#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; // Vnode moved left</div><div class="line">          patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx);</div><div class="line">//è€nodeçš„ç»“æŸèŠ‚ç‚¹ç§»åŠ¨åˆ°è€nodeçš„å¼€å§‹èŠ‚ç‚¹ä¹‹å‰</div><div class="line">          canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm);</div><div class="line">          oldEndVnode = oldCh[--oldEndIdx];</div><div class="line">          newStartVnode = newCh[++newStartIdx];</div><div class="line">        &#125; else &#123;</div><div class="line">          if (isUndef(oldKeyToIdx)) &#123; oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx); &#125;</div><div class="line">          idxInOld = isDef(newStartVnode.key)</div><div class="line">            ? oldKeyToIdx[newStartVnode.key]</div><div class="line">            : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx);</div><div class="line">          //åˆ¤æ–­è€ç»“ç‚¹æ•°ç»„ä¸­æ˜¯å¦æœ‰å½“å‰è¿™ä¸ªæ–°ç»“ç‚¹</div><div class="line">          if (isUndef(idxInOld)) &#123; // å¦‚æœæ²¡æœ‰åœ¨å½“å‰è€ç»“ç‚¹å‰é¢æ–°å¢è¿™ä¸ªæ–°ç»“ç‚¹</div><div class="line">            createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx);</div><div class="line">          &#125; else &#123;</div><div class="line">            vnodeToMove = oldCh[idxInOld];</div><div class="line">            if (sameVnode(vnodeToMove, newStartVnode)) &#123; </div><div class="line">              patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx);</div><div class="line">              oldCh[idxInOld] = undefined;</div><div class="line">              //å¦‚æœæœ‰ä¸”keyç›¸åŒï¼Œå¯¹æ¯”ä¹‹åï¼Œç§»åŠ¨åˆ°å½“å‰è€ç»“ç‚¹å‰é¢ï¼Œä¿æŒæ–°è€ç»“ç‚¹ä½ç½®ç›¸åŒ</div><div class="line">              canMove &amp;&amp; nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm);</div><div class="line">            &#125; else &#123;</div><div class="line">              å¦‚æœæ–°è€ç»“ç‚¹ä¸æ˜¯åŒä¸€ä¸ªkeyï¼Œåˆ™æ–°å¢æ–°ç»“ç‚¹</div><div class="line">              createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">          newStartVnode = newCh[++newStartIdx];</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      if (oldStartIdx &gt; oldEndIdx) &#123;</div><div class="line">//æ­¤æ—¶newStartIdxå’ŒnewEndIdxä¹‹é—´çš„vnodeæ˜¯æ–°å¢çš„ï¼Œè°ƒç”¨addVnodesï¼ŒæŠŠä»–ä»¬å…¨éƒ¨æ’è¿›beforeçš„åè¾¹ï¼Œbeforeå¾ˆå¤šæ—¶å€™æ˜¯ä¸ºnullçš„</div><div class="line">        refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm;</div><div class="line">        addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue);</div><div class="line">      &#125; else if (newStartIdx &gt; newEndIdx) &#123;</div><div class="line"> //newStartIdx &gt; newEndIdxï¼Œå¯ä»¥è®¤ä¸ºnewChå…ˆéå†å®Œã€‚</div><div class="line"> //æ­¤æ—¶oldStartIdxå’ŒoldEndIdxä¹‹é—´çš„vnodeåœ¨æ–°çš„å­èŠ‚ç‚¹é‡Œå·²ç»ä¸å­˜åœ¨äº†ï¼Œè°ƒç”¨removeVnodeså°†å®ƒä»¬ä»domé‡Œåˆ é™¤ã€‚</div><div class="line">        removeVnodes(oldCh, oldStartIdx, oldEndIdx);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">function sameVnode (a, b) &#123;</div><div class="line">    return (</div><div class="line">      a.key === b.key &amp;&amp; (</div><div class="line">        (</div><div class="line">          a.tag === b.tag &amp;&amp;</div><div class="line">          a.isComment === b.isComment &amp;&amp;</div><div class="line">          isDef(a.data) === isDef(b.data) &amp;&amp;</div><div class="line">          sameInputType(a, b)</div><div class="line">        ) || (</div><div class="line">          isTrue(a.isAsyncPlaceholder) &amp;&amp;</div><div class="line">          a.asyncFactory === b.asyncFactory &amp;&amp;</div><div class="line">          isUndef(b.asyncFactory.error)</div><div class="line">        )</div><div class="line">      )</div><div class="line">    )</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/image/lifecycle.png&quot; alt=&quot;Vueå£°æ˜å‘¨æœŸ&quot;&gt;&lt;br&gt;åˆ†æå®˜ç½‘çš„æµç¨‹å›¾å¯çŸ¥&lt;br&gt;new Vueæ—¶ï¼Œè¿›è¡Œä¸€ç³»åˆ—initxxxåˆå§‹åŒ–å·¥ä½œåä¼šæ ¹æ®é€‰é¡¹elå’Œtemplateé…ç½®æƒ…å†µå»åšç¼–è¯‘&lt;br&gt;å³&lt;br&gt;æƒ…å†µ1ï¼šæŒ‚è½½äº†elå’Œtem
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºcssçš„ä¸€äº›äº‹</title>
    <link href="http://yoohannah.github.io/post/knowledge/css.html"/>
    <id>http://yoohannah.github.io/post/knowledge/css.html</id>
    <published>2020-01-27T12:41:15.000Z</published>
    <updated>2020-01-27T13:10:16.995Z</updated>
    
    <content type="html"><![CDATA[<p>1.CSS é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§<br>!important<br>å†…è”æ ·å¼ï¼ˆ1000ï¼‰<br>idé€‰æ‹©å™¨ï¼ˆ100ï¼‰<br>ç±»é€‰æ‹©å™¨ï¼ˆ10ï¼‰<br>å…ƒç´ é€‰æ‹©å™¨ï¼ˆ1ï¼‰</p>
<p>2.ä¸ºå…¼å®¹æµè§ˆå™¨ï¼Œå¯¹cssåŸºæœ¬æ ·å¼åšç»Ÿä¸€å¤„ç†çš„ä¸‰ç§æ–¹æ³•<br>ã€resetã€‘<br>æ¶ˆé™¤æµè§ˆå™¨é»˜è®¤æ ·å¼ï¼Œé’ˆå¯¹å…·ä½“å…ƒç´ æ ‡ç­¾é‡å†™æ ·å¼<br>ã€normalizeã€‘<br>æ ·å¼è§„èŒƒç¡®å®šçš„æƒ…å†µä¸‹ï¼Œç›´æ¥é‡å†™å…¨éƒ¨æ ·å¼<br>ã€neatã€‘<br>å‰ä¸¤è€…ç»“åˆï¼Œé’ˆå¯¹ç¡®å®šçš„æ ·å¼ç›´æ¥é‡å†™ï¼Œä¸ç¡®å®šçš„è¿›è¡Œæ¸…é™¤</p>
<p>3.cssé¢„å¤„ç†è¯­æ³•å·¥å…·éœ€è¦å…·å¤‡çš„ç‰¹æ€§<br>å¯ä»¥å˜é‡å£°æ˜å’Œè®¡ç®—<br>æ”¯æŒè¯­æ³•è¡¨è¾¾å¼<br>å¯ä»¥å®šä¹‰å‡½æ•°è¿›è¡Œå¤„ç†<br>å±æ€§å¯ä»¥ç»§æ‰¿<br>å¯ä»¥è‡ªè¡Œå®ç°autoprefixç±»ä¼¼çš„å…¼å®¹æ€§è¡¥å…¨åŠŸèƒ½</p>
<p>4.å®ç°åŠ¨ç”»çš„6ç§æ–¹å¼<br>çº¯JS(åˆ©ç”¨setInternal,16ms)<br>svg(åˆ©ç”¨æ ‡ç­¾é…ç½®)<br>canvasï¼ˆåˆ©ç”¨jsAPIé…ç½®ï¼‰<br>css3-transition(è¿‡æ¸¡åŠ¨ç”»ï¼Œä¸èƒ½ç‹¬ç«‹å®ç°åŠ¨ç”»)<br>css3-animation(çº¯csså®ç°åŠ¨ç”»)<br>requestAnimationFrame(ç±»ä¼¼setInterval,ä½†æ€§èƒ½æ¶ˆè€—ä½)<br>å‰ä¸¤ç§å…¼å®¹æ€§è‰¯å¥½ï¼Œåå››ç§é€‚ç”¨äºç§»åŠ¨ç«¯</p>
<p>5.å±å¹•é€‚é…å¸ƒå±€æ–¹æ¡ˆ<br>æƒ³åŠæ³•è®©æ¯”ä¾‹ä¸å˜<br>A.åœ¨html/bodyæ ‡ç­¾ä¸ŠåŠ ä¸Šzoomå±æ€§ï¼Œç¼ºç‚¹æ˜¯ä¸çµæ´»<br>B.ä½¿ç”¨remï¼Œç›¸å¯¹äºæ–‡æ¡£æ ¹å…ƒç´ font-size,<br>  åˆ©ç”¨mediaQueryå¯¹å¸¸è§å‡ ç§å±å¹•å®½åº¦è®¾ç½®htmlçš„font-size<br>  ä»¥font-sizeå¤§å°ä¸º1rem</p>
<p>6.å“åº”å¼è®¾è®¡çš„ä¸¤ç§æ–¹æ¡ˆ<br>å‰ç«¯æˆ–è€…åç«¯åˆ¤æ–­useragentæ¥è·³è½¬ä¸åŒç«™ç‚¹å¾—åˆ°ä¸åŒé¡µé¢<br>ä½¿ç”¨mediaQueryåª’ä½“æŸ¥è¯¢è®©é¡µé¢æ ¹æ®ä¸åŒè®¾å¤‡è‡ªåŠ¨æ”¹å˜é¡µé¢å¸ƒå±€å’Œæ˜¾ç¤º</p>
<p>7.æ ¹æ®æµè§ˆå™¨å±å¹•å®½åº¦å’Œåˆ†è¾¨ç‡åŠ è½½ä¸åŒå¤§å°çš„å›¾ç‰‡<br>ä½¿ç”¨mediaQueryåˆ¤æ–­åŠ è½½ä¸åŒçš„èƒŒæ™¯å›¾<br>ä½¿ç”¨H5çš„pictureæ ‡ç­¾<br>æ¨¡æ¿è¿›è¡Œåˆ¤æ–­ç„¶åæ¸²æŸ“ä¸åŒå›¾ç‰‡<br>è¯·æ±‚å›¾ç‰‡æ—¶å¸¦ä¸Šç›¸å…³å‚æ•°ï¼Œè®©å›¾ç‰‡æœåŠ¡å™¨åå‡ºä¸åŒå¤§å°å›¾ç‰‡</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;1.CSS é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§&lt;br&gt;!important&lt;br&gt;å†…è”æ ·å¼ï¼ˆ1000ï¼‰&lt;br&gt;idé€‰æ‹©å™¨ï¼ˆ100ï¼‰&lt;br&gt;ç±»é€‰æ‹©å™¨ï¼ˆ10ï¼‰&lt;br&gt;å…ƒç´ é€‰æ‹©å™¨ï¼ˆ1ï¼‰&lt;/p&gt;
&lt;p&gt;2.ä¸ºå…¼å®¹æµè§ˆå™¨ï¼Œå¯¹cssåŸºæœ¬æ ·å¼åšç»Ÿä¸€å¤„ç†çš„ä¸‰ç§æ–¹æ³•&lt;br&gt;ã€resetã€‘&lt;br&gt;æ¶ˆé™¤æµè§ˆå™¨é»˜è®¤æ ·
    
    </summary>
    
    
      <category term="css" scheme="http://yoohannah.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>Shadow DOM</title>
    <link href="http://yoohannah.github.io/post/knowledge/shadowDom.html"/>
    <id>http://yoohannah.github.io/post/knowledge/shadowDom.html</id>
    <published>2020-01-27T12:18:15.000Z</published>
    <updated>2020-01-27T12:33:42.519Z</updated>
    
    <content type="html"><![CDATA[<p>Shadow DOMæ˜¯HTMLçš„ä¸€ä¸ªè§„èŒƒï¼Œå®ƒå…è®¸æµè§ˆå™¨å¼€å‘è€…å°è£…è‡ªå·±çš„HTMLæ ‡ç­¾ï¼Œcssæ ·å¼å’Œç‰¹å®šjsä»£ç <br>åŒæ—¶ä¹Ÿå¯ä»¥è®©å¼€å‘è€…å¸¸è§ç±»ä¼¼videoè¿™æ ·çš„è‡ªå®šä¹‰ä¸€çº§æ ‡ç­¾ï¼Œ<br>åˆ›å»ºçš„è¿™äº›æ–°æ ‡ç­¾å’Œç›¸å…³çš„apiè¢«ç§°ä¸º WEB Component</p>
<p>Shadow host æ˜¯shadow dom çš„å®¹å™¨å…ƒç´ ï¼Œå°±æ˜¯æœ€ç»ˆä½¿ç”¨çš„æ ‡ç­¾å…ƒç´ <br>Shadow root æ˜¯shadow dom å…·ä½“å†…å®¹çš„æ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨document.createShadowRoot()åˆ›å»º<br>shadow tree æ˜¯shadow dom åŒ…å«çš„å­èŠ‚ç‚¹æ•°</p>
<p>åœ¨shadow root ä¸Šå¯ä»¥ä»»æ„é€šè¿‡DOMæ“ä½œæ·»åŠ ä»»æ„shadow treeï¼ŒåŒæ—¶æŒ‡å®šæ ·å¼å’Œå¤„ç†é€»è¾‘<br>å¹¶å°†è‡ªå·±çš„APIæš´éœ²å‡ºæ¥<br>å®Œæˆåˆ›å»ºåéœ€è¦é€šè¿‡document.registerElement()åœ¨æ–‡æ¡£ä¸­æ³¨å†Œå…ƒç´ <br>shadow dom åˆ›å»ºå°±å®Œæˆäº†</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Shadow DOMæ˜¯HTMLçš„ä¸€ä¸ªè§„èŒƒï¼Œå®ƒå…è®¸æµè§ˆå™¨å¼€å‘è€…å°è£…è‡ªå·±çš„HTMLæ ‡ç­¾ï¼Œcssæ ·å¼å’Œç‰¹å®šjsä»£ç &lt;br&gt;åŒæ—¶ä¹Ÿå¯ä»¥è®©å¼€å‘è€…å¸¸è§ç±»ä¼¼videoè¿™æ ·çš„è‡ªå®šä¹‰ä¸€çº§æ ‡ç­¾ï¼Œ&lt;br&gt;åˆ›å»ºçš„è¿™äº›æ–°æ ‡ç­¾å’Œç›¸å…³çš„apiè¢«ç§°ä¸º WEB Component&lt;/p&gt;
&lt;p&gt;Shadow
    
    </summary>
    
    
      <category term="html" scheme="http://yoohannah.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>vuerouteræºç åˆæ­¥å­¦ä¹ </title>
    <link href="http://yoohannah.github.io/post/vue/vue-router.html"/>
    <id>http://yoohannah.github.io/post/vue/vue-router.html</id>
    <published>2020-01-27T04:34:15.000Z</published>
    <updated>2020-01-27T04:37:09.151Z</updated>
    
    <content type="html"><![CDATA[<p>å·¥ä½œæµç¨‹ï¼š<br> URLæ”¹å˜-&gt;å‡ºå‘ç›‘å¬äº‹ä»¶-&gt;æ”¹å˜vue-routeré‡Œçš„currentå˜é‡-&gt;<br> è§¦å‘currentå˜é‡çš„ç›‘å¬è€…-&gt;è·å–æ–°ç»„ä»¶-&gt;renderæ–°ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">class HistoryRoute&#123;</div><div class="line">  constructor()&#123;</div><div class="line">    this.current=null</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">class vueRouter&#123;</div><div class="line">  constructor(options)&#123;</div><div class="line">    this.history= new HistoryRoute;</div><div class="line">    this.mode = options.mode || &apos;hash&apos;</div><div class="line">    this.routes = options.routes || []</div><div class="line">    this.routesMap = this.createMap(this.routes)</div><div class="line">    this.init()</div><div class="line">  &#125;</div><div class="line">  Init()&#123;</div><div class="line">    if(this.mode==&apos;hash&apos;)&#123;</div><div class="line">      //å¦‚æœæ²¡æœ‰#å·ï¼Œè‡ªåŠ¨åŠ ä¸Š#</div><div class="line">      location.hash?&quot;&quot;:location.hash=&apos;/&apos;</div><div class="line">      //ç›‘å¬hashæ”¹å˜</div><div class="line">      window.addEventListener(&apos;load&apos;,()=&gt;&#123;</div><div class="line">        //sliceå»æ‰#å·</div><div class="line">        this.history.current=location.hash.slice(1)</div><div class="line">      &#125;)</div><div class="line">      window.addEventListener(&apos;hashchange&apos;,()=&gt;&#123;</div><div class="line">        this.history.current=location.hash.slice(1)</div><div class="line">      &#125;)</div><div class="line">    &#125;else&#123;</div><div class="line">      location.pathname?&quot;&quot;:location.pathname=&apos;/&apos;</div><div class="line">      window.addEventListener(&apos;load&apos;,()=&gt;&#123;</div><div class="line">        this.history.current=location.pathname</div><div class="line">      &#125;)</div><div class="line">      window.addEventListener(&apos;hashchange&apos;,()=&gt;&#123;</div><div class="line">        this.history.current=location.pathname</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  //å°†è·¯ç”±å¯¹è±¡[&#123;path:&apos;xxx&apos;,component:a&#125;]è½¬æˆï¼š&#123;xxx:a&#125;</div><div class="line">  createMap(routes)&#123;</div><div class="line">    return routes.reduce((memo,current)=&gt;&#123;</div><div class="line">      memo[current.path] = current.components</div><div class="line">      return memo</div><div class="line">    &#125;)</div><div class="line">  &#125;  </div><div class="line">&#125;</div><div class="line">//å®šä¹‰å±æ€§æ ‡ç­¾ get set ===&gt;ä¾›VUE.useä½¿ç”¨</div><div class="line">//VUE.use(xxxx) xxxæ˜¯ä¸€ä¸ªå‡½æ•°æ—¶ç›´æ¥è¿è¡Œxxxå‡½æ•°ï¼Œxxxæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…ç±»æ—¶ï¼Œè¿è¡Œå…¶ä¸Šé¢çš„installæ–¹æ³•</div><div class="line">vueRouter.install = function(Vue)&#123;</div><div class="line">  Vue.mixin(&#123;</div><div class="line">    beforeCreate()&#123;</div><div class="line">      //thisæŒ‡å‘å½“å‰ç»„ä»¶å®ä¾‹ï¼Œthis.$optionsæŒ‡å‘åˆ›å»ºVUEå®ä¾‹æ—¶ä¼ å…¥çš„é…ç½®é¡¹</div><div class="line">      if(this.$options&amp;&amp;this.$option.router)&#123;</div><div class="line">        //æŠŠå½“å‰å®ä¾‹æŒ‚åœ¨_rootä¸Š</div><div class="line">        this._root = this</div><div class="line">        this._router = this.$options.router</div><div class="line">        Vue.util.defineReactive(this,&apos;current&apos;,this._router.history) //åŒå‘ç»‘å®šï¼Œå¯¹è·¯ç”±å˜åŒ–è¿›è¡Œç›‘å¬ï¼Œ</div><div class="line">      &#125;</div><div class="line">      Object.defineProperty(this,&quot;$router&quot;,&#123; //èƒ½å¤Ÿè·å–$routerä½†ä¸èƒ½ä¿®æ”¹çš„åŸç†ã€‚é˜²æ­¢ç”¨æˆ·ä¿®æ”¹_router</div><div class="line">        get()&#123;</div><div class="line">          return this._root._router;</div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  Vue.components(&apos;router-view&apos;,&#123;</div><div class="line">    render(r)&#123;</div><div class="line">      //æ‹¿åˆ°å½“å‰è·¯å¾„</div><div class="line">      //thisæŒ‡å‘proxy,å½“å‰ç»„ä»¶ä»£ç†å¯¹è±¡ï¼›this._selfå½“å‰ç»„ä»¶å®ä¾‹åŒ–å¯¹è±¡ï¼›this._self._rootå½“å‰ç»„ä»¶å¯¹è±¡</div><div class="line">      let current = this._self._root._router.history.current</div><div class="line">      let routeMap = this._self._root._router.routeMap</div><div class="line">      return r(routeMap[current])</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line">module.exports = vueRouter</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å·¥ä½œæµç¨‹ï¼š&lt;br&gt; URLæ”¹å˜-&amp;gt;å‡ºå‘ç›‘å¬äº‹ä»¶-&amp;gt;æ”¹å˜vue-routeré‡Œçš„currentå˜é‡-&amp;gt;&lt;br&gt; è§¦å‘currentå˜é‡çš„ç›‘å¬è€…-&amp;gt;è·å–æ–°ç»„ä»¶-&amp;gt;renderæ–°ç»„ä»¶&lt;br&gt;&lt;figure class=&quot;highlight plain
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºæ¨¡å—åŒ–</title>
    <link href="http://yoohannah.github.io/post/js/module.html"/>
    <id>http://yoohannah.github.io/post/js/module.html</id>
    <published>2020-01-27T03:08:15.000Z</published>
    <updated>2020-01-27T04:41:18.469Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–"><a href="#ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–"></a>ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–</h1><p>  æ¨¡å—åŒ–å°±æ˜¯æŠŠç³»ç»Ÿåˆ†ç¦»æˆç‹¬ç«‹åŠŸèƒ½çš„æ–¹æ³•ï¼Œä»è€Œå®ç°éœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±åŠ è½½ä»€ä¹ˆåŠŸèƒ½<br>  å½“ä¸€ä¸ªé¡¹ç›®å¼€å‘å¾—è¶Šæ¥è¶Šå¤æ‚æ—¶ï¼Œä¼šå‡ºç°é—®é¢˜ï¼šå‘½åå†²çªï¼›æ–‡ä»¶ä¾èµ–<br>  ä½¿ç”¨æ¨¡å—åŒ–å¼€å‘ï¼Œå¯ä»¥é¿å…ä»¥ä¸Šé—®é¢˜ï¼Œå¹¶ä¸”æé«˜å¼€å‘æ•ˆç‡ï¼šå¯ç»´æŠ¤æ€§ï¼›å¯å¤ç”¨æ€§</p>
<p>  æ¨¡å—åŒ–å¼€å‘æ¼”å˜<br>  1.ä½¿ç”¨å…¨å±€å‡½æ•°      ===&gt;æ—©æœŸå¼€å‘å°±æ˜¯å°†é‡å¤å¾—ä»£ç å°è£…åˆ°å‡½æ•°ä¸­ï¼Œå†å°†ä¸€ç³»åˆ—çš„å‡½æ•°æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­<br>    å­˜åœ¨çš„é—®é¢˜å°±æ˜¯ï¼šæ±¡æŸ“å…¨å±€å˜é‡ï¼›çœ‹ä¸å‡ºç›¸äº’çš„ç›´æ¥å…³ç³»<br>  2.ä½¿ç”¨å¯¹è±¡å‘½åç©ºé—´  ===&gt;é€šè¿‡å¯¹è±¡å‘½åç©ºé—´çš„å½¢å¼ï¼Œä»æŸç§ç¨‹åº¦ä¸Šè§£å†³äº†å˜é‡å‘½åå†²çªçš„é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³å‘½åå†²çª<br>    å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šå†…éƒ¨çŠ¶æ€å¯è¢«å¤–éƒ¨æ”¹å†™ï¼›å‘½åç©ºé—´è¶Šæ¥è¶Šæ¥é•¿<br>  3.ç§æœ‰å…±æœ‰æˆå‘˜åˆ†ç¦»  ===&gt;åˆ©ç”¨æ­¤ç§æ–¹å¼å°†å‡½æ•°åŒ…è£…æˆä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œç§æœ‰ç©ºé—´çš„å˜é‡å’Œå‡½æ•°ä¸ä¼šå½±å“å…¨å±€ä½œç”¨åŸŸ<br>    å­˜åœ¨é—®é¢˜ï¼šè§£å†³äº†å˜é‡å‘½åå†²çªé—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³é™ä½å¼€å‘å¤æ‚åº¦çš„é—®é¢˜</p>
<h1 id="Commonjs"><a href="#Commonjs" class="headerlink" title="Commonjs"></a>Commonjs</h1><p>  commomJSè§„èŒƒåŠ è½½æ¨¡å—æ˜¯ã€åŒæ­¥ã€‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ è½½å®Œæˆæ‰æ‰§è¡Œåé¢çš„æ“ä½œ<br>  Node.jsä¸»è¦ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ï¼Œæ¨¡å—éƒ½æ˜¯å­˜åœ¨æœ¬åœ°ç¡¬ç›˜ä¸­åŠ è½½æ¯”è¾ƒå¿«ï¼Œæ‰€ä»¥Node.jsé‡‡ç”¨CommonJS<br>  ä¸‰ä¸ªéƒ¨åˆ†ï¼š<br>  moduleå˜é‡åœ¨æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œå°±ä»£è¡¨å½“å‰æ¨¡å—<br>  exportså±æ€§æ˜¯å¯¹å¤–çš„æ¥å£ï¼Œç”¨äºå¯¼å‡ºå½“å‰æ¨¡å—çš„æ–¹æ³•æˆ–å˜é‡<br>  require()ç”¨æ¥åŠ è½½å¤–éƒ¨æ¨¡å—ï¼Œè¯»å–å¹¶æ‰§è¡Œjsæ–‡ä»¶ï¼Œè¿”å›è¯¥æ¨¡å—çš„exportså¯¹è±¡<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">åŠ è½½æ—¶æ‰§è¡Œï¼š</div><div class="line">a.js</div><div class="line">exports.done = ture</div><div class="line">var b = require(&apos;b.js&apos;)</div><div class="line">console.log(&apos;a.js-done&apos;)</div><div class="line"></div><div class="line">b.js</div><div class="line">exports.done = false</div><div class="line">var a = require(&apos;a.js&apos;)</div><div class="line">console.log(a.done)</div><div class="line">console.log(&apos;b.js-done&apos;)</div><div class="line"></div><div class="line">App.js   æ‰§è¡ŒApp.js</div><div class="line">var a = require(&apos;a.js&apos;) // å› ä¸ºå¼•ç”¨b.jsï¼Œæ‰§è¡Œb.jsä»£ç æ•…æ‰“å°å‡ºtrue b.js-doneï¼Œå¼•ç”¨å®Œæ¯•åæ¥ç€æ‰§è¡Œæ‰“å°å‡º a.js-done</div><div class="line">var b = require(&apos;b.js&apos;)// å·²ç»è¢«aå¼•ç”¨è¿‡ï¼Œä¸å†æ‰§è¡Œ ç›´æ¥åœ¨ç¼“å­˜ä¸­æ‰¾å‡º exports &#123;doneï¼šfalse&#125; è¿”å›</div><div class="line">console.log(a.done)</div><div class="line">console.log(b.done) </div><div class="line"></div><div class="line">å¦‚æœa.jsæ”¹æˆå¦‚ä¸‹</div><div class="line">var b = require(&apos;b.js&apos;)</div><div class="line">exports.done = ture</div><div class="line">console.log(&apos;a.js-done&apos;)</div><div class="line">æ‰§è¡ŒApp.js</div><div class="line">æ‰“å°ç»“æœä¸ºundefined b.js-done a.js-done true false </div><div class="line">å› ä¸ºaä¾èµ–bæ—¶ï¼Œæ‰§è¡Œbï¼Œbå†ä¾èµ–aæ—¶ï¼Œexports.done = tureè¯­å¥è¿˜æœªæ‰§è¡Œï¼Œæ•…a çš„ exports ä¸º&#123;&#125; exports.doneè‡ªç„¶ä¸ºundefined</div></pre></td></tr></table></figure></p>
<p>  åªæœ‰commonjså› ä¸ºåŒæ­¥åŠ è½½ï¼ŒåŠ è½½æ—¶æ‰§è¡Œå¯å®ç°å¾ªç¯ä¾èµ–ï¼Œå…¶ä»–æ¨¡å¼å‡ä¸å¯ä»¥å¤„ç†å¾ªç¯ä¾èµ–çš„ç”¨æ³•</p>
<h1 id="AMD-requirejs"><a href="#AMD-requirejs" class="headerlink" title="AMD(requirejs)"></a>AMD(requirejs)</h1><p>  AMDä¹Ÿå°±æ˜¯ã€å¼‚æ­¥ã€‘æ¨¡å—å®šä¹‰ï¼Œå®ƒé‡‡ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½æ¨¡å—ï¼Œé€šè¿‡defineæ–¹æ³•å»å®šä¹‰æ¨¡å—ï¼Œrequireæ–¹æ³•å»åŠ è½½æ¨¡å—<br>  å®šä¹‰ï¼š<br>  define([tools],function(){return {}}) //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°ç»„æ—¶ï¼Œè¯´æ˜è¯¥æ¨¡å—è¿˜ä¾èµ–å…¶ä»–æ¨¡å—,æå‰å£°æ˜ä¾èµ–ï¼Œæ²¡æœ‰ä¾èµ–æ—¶ï¼Œåªä¼ å…¥functionå³å¯<br>  åŠ è½½ï¼š<br>  require([â€˜moduleâ€™],callback) //ç¬¬ä¸€ä¸ªå‚æ•°æ•°ç»„å†…æˆå‘˜å³è¦åŠ è½½çš„æ¨¡å—ï¼Œcallbackæ˜¯å‰é¢æ‰€æœ‰æŸå—éƒ½åŠ è½½æˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">/** a.js */</div><div class="line"></div><div class="line">define([&apos;b&apos;], function(b) &#123;</div><div class="line">  console.log(b)</div><div class="line">  var hello = function()&#123;</div><div class="line">    console.log(&apos;hello work&apos;)</div><div class="line">  &#125;</div><div class="line">  return &#123;</div><div class="line">    Hello:Hello</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">/** b.js */</div><div class="line"></div><div class="line">define(function()&#123;</div><div class="line">  var name = &apos;max&apos;</div><div class="line">  return&#123;</div><div class="line">    name:name</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">/** ä½¿ç”¨a.js,b.js */</div><div class="line"></div><div class="line">/*</div><div class="line"> &lt;script type=&apos;text/javascript&apos; src=&apos;require.js&apos;&gt;&lt;/script&gt;</div><div class="line"> &lt;script type=&apos;text/javascript&apos;&gt;</div><div class="line">  require.config(&#123;</div><div class="line">    paths:&#123;</div><div class="line">      &apos;a&apos;:&apos;./a&apos;,</div><div class="line">      &apos;b&apos;:&apos;./b&apos;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  require([&apos;a&apos;,&apos;b&apos;],function(a,b)&#123; //å¯ç”¨æ¨¡å—åŠ è½½å™¨</div><div class="line">    console.log(a)</div><div class="line">    console.log(b)</div><div class="line">  &#125;)</div><div class="line"> &lt;/script&gt;</div><div class="line"> */</div></pre></td></tr></table></figure></p>
<h1 id="CMD-seajs"><a href="#CMD-seajs" class="headerlink" title="CMD(seajs)"></a>CMD(seajs)</h1><p>  ä¸AMDä¸€æ ·ï¼Œåªæ˜¯å®šä¹‰å’Œæ¨¡å—åŠ è½½æ–¹å¼ä¸Šä¸åŒ<br>  ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ–‡ä»¶<br>  define(function(require,exports,module){<br>   //require æ˜¯å¯ä»¥æŠŠå…¶ä»–æ¨¡å—å¯¼å…¥è¿›æ¥çš„ä¸€ä¸ªå‚æ•°<br>   //exportså¯ä»¥æŠŠæ¨¡å—å†…çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•å¯¼å‡º<br>   //moduleæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•<br>  })<br>  CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼Œæ–‡ä»¶æ˜¯æå‰åŠ è½½å¥½çš„ï¼Œåªæœ‰åœ¨requireçš„æ—¶å€™æ‰å»æ‰§è¡Œæ–‡ä»¶<br>  define(function(require,exports,module){<br>     var math = require(â€˜./mathâ€™)<br>     math.add()<br>  })<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/** a.js */</div><div class="line"></div><div class="line">define(function(require,exports,module) &#123;</div><div class="line">  var b = require(&apos;b&apos;)</div><div class="line">  console.log(b)</div><div class="line">  exports.hello = function()&#123;</div><div class="line">    console.log(&apos;hello work&apos;)</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"> &lt;script type=&apos;text/javascript&apos; src=&apos;sea.js&apos;&gt;&lt;/script&gt;</div><div class="line"> &lt;script type=&apos;text/javascript&apos;&gt;</div><div class="line">  seajs.config(&#123;</div><div class="line">    alias:&#123;</div><div class="line">      &apos;a&apos;:&apos;./a&apos;,</div><div class="line">      &apos;b&apos;:&apos;./b&apos;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  seajs.use([&apos;a&apos;,&apos;b&apos;],function(a,b)&#123; //å¯ç”¨æ¨¡å—åŠ è½½å™¨</div><div class="line">    console.log(a)</div><div class="line">    console.log(b)</div><div class="line">  &#125;)</div><div class="line"> &lt;/script&gt;</div></pre></td></tr></table></figure></p>
<h1 id="ES6æ¨¡å—åŒ–"><a href="#ES6æ¨¡å—åŒ–" class="headerlink" title="ES6æ¨¡å—åŒ–"></a>ES6æ¨¡å—åŒ–</h1><p>  æ±²å–CommonJSå’ŒAMDä¼˜ç‚¹ï¼Œæ”¯æŒå¼‚æ­¥åŠ è½½ï¼Œæœªæ¥å¯ä»¥æˆä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šç”¨çš„æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆ<br>  export:ç”¨äºæŠŠæ¨¡å—é‡Œçš„å†…å®¹æš´éœ²å‡ºæ¥ï¼Œ export default ä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡ºï¼Œä¸€ä¸ªæ¨¡å—åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤è¾“å‡ºï¼Œæ‰€ä»¥export default åªèƒ½ä½¿ç”¨ä¸€æ¬¡<br>  importï¼š ç”¨äºå¼•å…¥æ¨¡å—æä¾›çš„åŠŸèƒ½===&gt; import {x1,x2} form â€˜./libâ€™; x1()</p>
<p>  ES6æ¨¡å—è¿è¡Œæœºåˆ¶ï¼š<br>  ES6æ¨¡å—æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œå¦‚æœä½¿ç”¨importä»ä¸€ä¸ªæ¨¡å—åŠ è½½å˜é‡ï¼Œå˜é‡ä¸ä¼šè¢«ç¼“å­˜ï¼Œ<br>  è€Œæ˜¯æˆä¸ºä¸€ä¸ªæŒ‡å‘è¢«åŠ è½½æ¨¡å—çš„å¼•ç”¨ã€‚ç­‰è„šæœ¬æ‰§è¡Œæ—¶ï¼Œæ ¹æ®åªè¯»å¼•ç”¨åˆ°è¢«åŠ è½½çš„é‚£ä¸ªæ¨¡å—ä¸­å»å–å€¼</p>
<p>  ES6ä¸CommonJSæ¨¡å—å·®å¼‚<br>  CommonJSæ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼å¾—å¼•ç”¨<br>  CommonJSæ¨¡å—è¿è¡Œæ—¶åŠ è½½ï¼ŒES6æ¨¡å—ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£</p>
<h1 id="åŠ è½½å™¨ç»“æ„"><a href="#åŠ è½½å™¨ç»“æ„" class="headerlink" title="åŠ è½½å™¨ç»“æ„"></a>åŠ è½½å™¨ç»“æ„</h1><h2 id="æ¨¡å—éƒ¨åˆ†"><a href="#æ¨¡å—éƒ¨åˆ†" class="headerlink" title="æ¨¡å—éƒ¨åˆ†"></a>æ¨¡å—éƒ¨åˆ†</h2><p>   æ¯ä¸ªæ¨¡å—åˆ›å»ºéƒ½å…ˆåˆå§‹åŒ–æ•°æ®ï¼Œå­˜å‚¨åœ¨ç¼“å­˜å¯¹è±¡ä¸­<br>   <img src="/image/module1.png" alt="module1"></p>
<h3 id="æ•°æ®åˆå§‹åŒ–"><a href="#æ•°æ®åˆå§‹åŒ–" class="headerlink" title="æ•°æ®åˆå§‹åŒ–"></a>æ•°æ®åˆå§‹åŒ–</h3><p>  <img src="/image/module2.png" alt="module2"><br>  åŠ è½½å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªåä¸ºModuleçš„æ„é€ å‡½æ•°ï¼Œã€æ¯ä¸ªæ¨¡å—éƒ½æ˜¯æ­¤æ„é€ å‡½æ•°çš„å®ä¾‹å¯¹è±¡ã€‘<br>  æ„é€ å‡½æ•°ä¸­ç»™å®ä¾‹å¯¹è±¡æ‰©å±•äº†â€™æœªæ¥â€™æ‰€éœ€è¦ç”¨åˆ°çš„å±æ€§ï¼ˆuri:å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„åœ°å€ï¼Œdeps:æ¨¡å—çš„ä¾èµ–åˆ—è¡¨â€¦.)åŠæ–¹æ³•(load,resolve:è·å–å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„â€¦)</p>
<h3 id="æ¨¡å—å­˜å‚¨"><a href="#æ¨¡å—å­˜å‚¨" class="headerlink" title="æ¨¡å—å­˜å‚¨"></a>æ¨¡å—å­˜å‚¨</h3><p>  åŠ è½½å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªåä¸ºcacheçš„ç¼“å­˜å¯¹è±¡ï¼Œæ¯ä¸ªæ–‡ä»¶(æ¨¡å—)éƒ½ä¼šå­˜å‚¨åœ¨cacheå¯¹è±¡ä¸­<br>  å…·ä½“å­˜å‚¨æ–¹å¼:{â€˜å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„â€™: new Module()} æ³¨æ„ï¼šå½“å‰æ¨¡å—çš„ç»å¯¹è·¯å¾„æ˜¯é€šè¿‡èµ„æºéƒ¨åˆ†ï¼Œèµ„æºå®šä½æ–¹æ³•å®ç°çš„</p>
<h2 id="èµ„æºéƒ¨åˆ†"><a href="#èµ„æºéƒ¨åˆ†" class="headerlink" title="èµ„æºéƒ¨åˆ†"></a>èµ„æºéƒ¨åˆ†</h2><p>   èµ„æºå®šä½å’Œä¾èµ–ç®¡ç†æ˜¯åŠ è½½å™¨æ¶‰åŠçš„ä¸¤å¤§æ ¸å¿ƒ</p>
<h3 id="èµ„æºå®šä½"><a href="#èµ„æºå®šä½" class="headerlink" title="èµ„æºå®šä½"></a>èµ„æºå®šä½</h3><p>  <img src="/image/module3.png" alt="module3"><br>  åŠ è½½å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªresolve()æ–¹æ³•æŠŠæ¨¡å—åè§£ææˆç»å¯¹è·¯å¾„æ ¼å¼<br>  æ£€æµ‹å½“å‰æ¨¡å—åç§°æ˜¯å¦æœ‰è·¯å¾„çŸ­åç§°é…ç½®ï¼Œæ˜¯å¦æœ‰æ¨¡å—çŸ­åç§°é…ç½®ï¼Œæ˜¯å¦æœ‰åç¼€<br>  åœ¨åŠ è½½å™¨å¯åŠ¨æ–¹æ³•ä¸­ä¼šå»è°ƒç”¨ä¼ å…¥æ•°ç»„åˆ—è¡¨ä¸­çš„æ¨¡å—ï¼Œè·å–æ¨¡å—åç§°<br>  ç„¶åæ ¹æ®å½“å‰é¡¹ç›®ç»å¯¹è·¯å¾„å’Œæ¨¡å—åç§°è¿›è¡Œæ‹¼æ¥</p>
<h4 id="åŠ¨æ€åŠ è½½scriptæ–‡ä»¶"><a href="#åŠ¨æ€åŠ è½½scriptæ–‡ä»¶" class="headerlink" title="åŠ¨æ€åŠ è½½scriptæ–‡ä»¶"></a>åŠ¨æ€åŠ è½½scriptæ–‡ä»¶</h4><p>  åŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾ï¼š document.create(â€˜scriptâ€™)ï¼› srcæŒ‡å‘å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„åœ°å€<br>  åŠ è½½æ–‡ä»¶åŒæ—¶ï¼Œæ¨¡å—åŠ è½½å™¨è§£æå½“å‰æ¨¡å—æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œä»¥æ•°ç»„å½¢å¼å­˜å‚¨ï¼Œæ›´æ–°åˆ°depså±æ€§ä¸­</p>
<h3 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h3><p>  å·²çŸ¥å½“å‰æ¨¡å—åœ¨cacheä¸­çš„å½¢æ€ï¼Œ{â€˜å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„â€™: new Module()}<br>  æ¢ç®—æˆï¼š{â€˜å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„â€™: {uri:â€™å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„â€™,deps:[]}}<br>  <img src="/image/module4.png" alt="module4"><br>    depså­˜å‚¨å½“å‰æ¨¡å—çš„ä¾èµ–åˆ—è¡¨ï¼Œä¾èµ–åˆ—è¡¨é€šè¿‡åŠ¨æ€åŠ è½½scriptæ–‡ä»¶æ­£åˆ™è§£æè·å–<br>    é‡ç‚¹ï¼šè§£æä¾èµ–â€”&gt;è·å–ä¾èµ–æ¨¡å—ç»å¯¹è·¯å¾„åœ°å€â€”-&gt;åŠ¨æ€åŠ è½½â€”-&gt;æå–ä¾èµ–â€”-&gt;è§£æä¾èµ–<br>        é€’å½’æ–¹å¼åŠ è½½æ‰€æœ‰æ¨¡å—ï¼Œç›´è‡³æ¨¡å—å…¨éƒ¨åŠ è½½å®Œæ¯•ï¼ˆæ¨¡å—çš„depså±æ€§é›†åˆä¸­æ²¡æœ‰ä¾èµ–çš„ç»å¯¹è·¯å¾„ï¼Œå³é•¿åº¦ä¸º0ï¼‰</p>
<h2 id="å¦‚ä½•å®ç°ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªä½œç”¨åŸŸï¼Ÿ"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªä½œç”¨åŸŸï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªä½œç”¨åŸŸï¼Ÿ"></a>å¦‚ä½•å®ç°ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªä½œç”¨åŸŸï¼Ÿ</h2><p>  ä¿è¯æ¨¡å—æ‹¥æœ‰ç‹¬ç«‹ä½œç”¨åŸŸï¼Œé‡‡ç”¨å¯¹è±¡å‘½åç©ºé—´çš„æ€æƒ³ï¼Œå³æ¯ä¸ªæ¨¡å—è¿”å›ä¸€ä¸ªæ¥å£å¯¹è±¡ï¼Œè¿™ä¸ªç‹¬ç«‹ä½œç”¨åŸŸå°±æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<h2 id="å¦‚ä½•æ‹¿åˆ°ä¾èµ–æ¨¡å—çš„æ¥å£å¯¹è±¡ï¼Ÿ"><a href="#å¦‚ä½•æ‹¿åˆ°ä¾èµ–æ¨¡å—çš„æ¥å£å¯¹è±¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‹¿åˆ°ä¾èµ–æ¨¡å—çš„æ¥å£å¯¹è±¡ï¼Ÿ"></a>å¦‚ä½•æ‹¿åˆ°ä¾èµ–æ¨¡å—çš„æ¥å£å¯¹è±¡ï¼Ÿ</h2><p>  å‚æ•°å³defineä¼ å…¥çš„å‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°ï¼Œè¿”å›å‡½æ•°è¿”å›çš„ç»“æœå³å¯¹è±¡</p>
<h2 id="å¦‚ä½•è®©å¯»æ‰¾ä¾èµ–ï¼Ÿ"><a href="#å¦‚ä½•è®©å¯»æ‰¾ä¾èµ–ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®©å¯»æ‰¾ä¾èµ–ï¼Ÿ"></a>å¦‚ä½•è®©å¯»æ‰¾ä¾èµ–ï¼Ÿ</h2><p>  æ‹¼æ¥åœ°å€ï¼Œç¼“å­˜ï¼Œç„¶åé€’å½’<br>  å›¾ç‰‡ï¼šä¾èµ–åŠ è½½ç­–ç•¥ æ¨¡å—æ•°æ®åˆå§‹åŒ– èµ„æºå®šä½-åŠ¨æ€åŠ è½½ ä¾èµ–ç®¡ç†è§£å†³æ–¹æ¡ˆ</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div></pre></td><td class="code"><pre><div class="line">(function(global) &#123;</div><div class="line">  var startUp = global.startUp = &#123;</div><div class="line">    version:&apos;1.0.1&apos;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  </div><div class="line">  var data = &#123;&#125; //é…ç½®ä¿¡æ¯</div><div class="line">  var cache = &#123;&#125;</div><div class="line">  var anonymousMeta = &#123;&#125;</div><div class="line">  //æ¨¡å—ç”Ÿå‘½å‘¨æœŸ</div><div class="line"></div><div class="line">  var status = &#123;</div><div class="line">    FETCHED: 1,</div><div class="line">    SAVED:2,</div><div class="line">    LOADING:3,</div><div class="line">    LOADED:4,</div><div class="line">    EXECTING:5,</div><div class="line">    EXECTED:6</div><div class="line">  &#125;</div><div class="line">  var isArray = function (obj) &#123;</div><div class="line">    return toString.call(obj) === &quot;[object Array]&quot;</div><div class="line">  &#125;</div><div class="line">  var isFunction = function (obj) &#123;</div><div class="line">    return toString.call(obj) === &quot;[object Function]&quot;</div><div class="line">  &#125;</div><div class="line">  var isString = function (obj) &#123;</div><div class="line">    return toString.call(obj) === &quot;[object String]&quot;</div><div class="line">  &#125;</div><div class="line">  function scripts()&#123;</div><div class="line">    return document.getElementsByTagName(&apos;script&apos;)</div><div class="line">  &#125;</div><div class="line">  function getInteractiveScript()&#123; //æ”¯æŒdata-mainå±æ€§æ·»åŠ é»˜è®¤è·¯å¾„: &lt;script data-main = &apos;common/js&apos; src=&apos;module.js&apos;&gt;&lt;/script&gt;</div><div class="line">    var arrS = scripts()</div><div class="line">    var dataMain,src</div><div class="line">    var exp = /^.*\.js$/</div><div class="line">    arrS = [].slice.call(arrS)</div><div class="line">    arrS.forEach(function(script)&#123;</div><div class="line">      dataMain = script.getAttribute(&apos;data-main&apos;)</div><div class="line">      if(dataMain &amp;&amp; !data.baseUrl &amp;&amp; !(exp.test(dataMain)))&#123;</div><div class="line">        if(dataMain.substring(dataMain.length-1) !== &apos;/&apos;)&#123;</div><div class="line">          dataMain = (dataMain+&apos;/&apos;)</div><div class="line">        &#125;</div><div class="line">        data.baseUrl = dataMain</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  getInteractiveScript()</div><div class="line">  //æ˜¯å¦ä½¿ç”¨äº†åˆ«å</div><div class="line">  function parseAlias(id)&#123;</div><div class="line">    var alias = data.alias //æ˜¯å¦é…ç½®åˆ«å</div><div class="line">    return alias &amp;&amp; isString(alias[id]) ? alias[id] :id //æ²¡æœ‰é…ç½®åˆ«åï¼Œè¿”å›åŸæ¥å€¼ï¼Œæœ‰é…ç½®åˆ«åï¼Œè¿”å›åˆ«åå¯¹åº”å€¼</div><div class="line">  &#125;</div><div class="line">  //ä¸èƒ½ä»¥&apos;/&apos;&apos;:&apos;å¼€å¤´ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ª&apos;/&apos;åé¢è·Ÿéšä»»æ„å­—ç¬¦è‡³å°‘ä¸€ä¸ª</div><div class="line">  var PATH_RE = /^([^\/:]+)(\/.+)$/ //([^\/:]+) è·¯å¾„çš„çŸ­åç§°é…ç½®</div><div class="line"></div><div class="line">  //æ£€æµ‹æ˜¯å¦ ä¹¦å†™è·¯å¾„çŸ­åç§°</div><div class="line">  function parsePaths(id) &#123;</div><div class="line">    var paths = data.paths; //æ˜¯å¦é…ç½®çŸ­è·¯å¾„</div><div class="line">    if(paths &amp;&amp; (m=id.match(PATH_RE)) &amp;&amp; isString(paths[m[1]]))&#123;</div><div class="line">      id = paths[m[1]]+m[2]</div><div class="line">    &#125;</div><div class="line">    return id</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //æ£€æµ‹æ˜¯å¦æ·»åŠ åç¼€</div><div class="line">  function normalize(path)&#123;</div><div class="line">    var last = path.length-1</div><div class="line">    var lastC = path.charAt(last)</div><div class="line">    return (lastC === &apos;/&apos; || path.substring(last-2) === &apos;.js&apos;) ? path :path+&apos;.js&apos;</div><div class="line">  &#125;</div><div class="line">  //æ·»åŠ æ ¹ç›®å½•</div><div class="line">  function addBase(id,uri)&#123;</div><div class="line">    // var result;</div><div class="line">    // //ç›¸å¯¹è·¯å¾„</div><div class="line">    // if(id.charAt(0) === &apos;.&apos;)&#123;</div><div class="line">    //   result = realpath( (uri ? uri.match(/[^?]*\//)[0] : data.cwd ) + id)</div><div class="line">    // &#125;else&#123;</div><div class="line">    //   result = data.cwd+id</div><div class="line">    // &#125;</div><div class="line">    var result = data.baseUrl ?data.cwd + data.baseUrl +id : data.cwd + id //æ”¯æŒdata-mainå±æ€§æ·»åŠ é»˜è®¤è·¯å¾„</div><div class="line">    return result</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  var DOT_RE = /\/.\//g //   /a/b/./c/./d ==&gt;/a/b/c/d     /./ ==&gt;/</div><div class="line">  var DOUBLE_DOT_RE = /\/[^/]+\/\.\.\//; // a/b/c/../../d ===&gt;a/b/../d ==&gt; a/d    /xxxxx/../==&gt; /</div><div class="line">  //è§„èŒƒè·¯å¾„</div><div class="line">  function realpath(path)&#123;</div><div class="line">    path = path.replace(DOT_RE,&apos;/&apos;)</div><div class="line">    while(path.match(DOUBLE_DOT_RE))&#123;</div><div class="line">      path= path.replace(DOUBLE_DOT_RE,&apos;/&apos;)</div><div class="line">    &#125;</div><div class="line">    return path</div><div class="line">  &#125;</div><div class="line">  //ç”Ÿæˆç»å¯¹è·¯å¾„ èµ„æºè·¯å¾„è§£æ</div><div class="line">  startUp.resolve = function (child,parent) &#123;</div><div class="line">    if(!child) return &apos;&apos;</div><div class="line">    child = parseAlias(child) //æ£€æµ‹æ˜¯å¦æœ‰åˆ«å</div><div class="line">    child = parsePaths(child) //æ£€æµ‹æ˜¯å¦æœ‰è·¯å¾„åˆ«åï¼Œä¾èµ–æ¨¡å—ä¸­å¼•åŒ…çš„æ¨¡å—è·¯å¾„åœ°å€ require(&apos;app/c)</div><div class="line">    child = normalize(child) //æ£€æµ‹æ˜¯å¦æ·»åŠ åç¼€</div><div class="line">    return addBase(child,parent) //æ·»åŠ æ ¹ç›®å½•</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  startUp.request = function(url,callback)&#123;</div><div class="line">    var node = document.createElement(&apos;script&apos;)</div><div class="line">    node.src = url</div><div class="line">    document.body.appendChild(node)</div><div class="line">    node.onload = function()&#123;</div><div class="line">      node.onload = null</div><div class="line">      document.body.removeChild(node) //åŠ è½½ä¾èµ–ç»“æŸåç§»é™¤åŠ è½½æ—¶çš„scriptæ ‡ç­¾</div><div class="line">      callback()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  //æ¨¡å—åŠ è½½å™¨å¯ç”¨</div><div class="line">  startUp.use = function(list,callback)&#123;</div><div class="line">    //æ£€é˜…æœ‰æ²¡æœ‰é¢„å…ˆåŠ è½½çš„æ¨¡å—</div><div class="line">    Module.preload(function()&#123;</div><div class="line">      Module.use(list,callback,data.cwd+&quot;_use_&quot;+cid()) //è™šæ‹Ÿçš„æ ¹ç›®å½•</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  //æ¨¡å—åŠ è½½å™¨é…ç½®</div><div class="line">  /**</div><div class="line">   * </div><div class="line">   * startUp.config(&#123;</div><div class="line">   *   alias:&#123;</div><div class="line">   *    a:&apos;common/js/a&apos;</div><div class="line">   *   &#125;,</div><div class="line">   *   preload:[c.js]</div><div class="line">   * &#125;)</div><div class="line">   */</div><div class="line">  startUp.config = function (options) &#123;</div><div class="line">    var key,curr</div><div class="line">    for(key in options)&#123;</div><div class="line">      curr = Option[key]</div><div class="line">      data[key] = curr</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //æ„é€ å‡½æ•° æ¨¡å—åˆå§‹åŒ–æ•°æ®</div><div class="line">  function Module(uri,deps)&#123;</div><div class="line">    this.uri = uri;</div><div class="line">    this.deps = deps || [] //ä¾èµ–é¡¹</div><div class="line">    this.exports = null</div><div class="line">    this.status = 0</div><div class="line">    this._waitings = &#123;&#125;</div><div class="line">    this._remain = 0</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //åˆ†æä¸»å¹²(å·¦å­æ ‘ | å³å­æ ‘)ä¸Šçš„ä¾èµ–é¡¹</div><div class="line">  Module.prototype.load = function()&#123;</div><div class="line">    var m = this</div><div class="line">    m.status = status.LOADING//LOADING == 3 æ­£åœ¨åŠ è½½æ¨¡å—ä¾èµ–é¡¹</div><div class="line">    var uris = m.resolve()//è·å–ä¸»å¹²ä¸Šçš„ä¾èµ–é¡¹</div><div class="line">    var len = m.remain = uris.length</div><div class="line"></div><div class="line">    //åŠ è½½ä¸»å¹²ä¸Šçš„ä¾èµ–é¡¹(æ¨¡å—)</div><div class="line">    var seed</div><div class="line">    for(var i=0;i&lt;len;i++)&#123;</div><div class="line">      seed = Module.get(uris[i]) //åˆ›å»ºç¼“å­˜ä¿¡æ¯</div><div class="line">      if(seed.status &lt;status.LOADED)&#123; //LOADED == 4 å‡†å¤‡åŠ è½½æ‰§è¡Œå½“å‰æ¨¡å—</div><div class="line">        seed._waitings[m.uri] = seed._waitings[m.uri] || 1 //å¤šå°‘æ¨¡å—ä¾èµ–äºæˆ‘ï¼Œ_waitingsæ˜¯ä¾èµ–æˆ‘çš„æ¨¡å—çš„è·¯å¾„é›†åˆ</div><div class="line">      &#125;else&#123;</div><div class="line">        seed._remain--</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    //å¦‚æœä¾èµ–åˆ—è¡¨æ¨¡å—å…¨éƒ¨åŠ è½½å®Œæ¯•</div><div class="line">    if(m._remain == 0)&#123; //é€’å½’è¿‡ç¨‹åˆ°æ­¤ç»“æŸ</div><div class="line">      //è·å–æ¨¡å—çš„æ¥å£å¯¹è±¡</div><div class="line">      m.onload()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //å‡†å¤‡æ‰§è¡Œæ ¹ç›®å½•ä¸‹çš„ä¾èµ–åˆ—è¡¨ä¸­çš„æ¨¡å—</div><div class="line">    var requestCache = &#123;&#125;</div><div class="line">    for(var i=0;i&lt;len;i++)&#123;</div><div class="line">      seed = Module.get(uris[i])</div><div class="line">      if(seed.status &lt; status.FETCHED)&#123;</div><div class="line">        seed.fetch(requestCache)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    for(uri in requestCache)&#123;</div><div class="line">      requestCache[uri]()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Module.prototype.fetch = function(requestCache)&#123;</div><div class="line">    var m =this</div><div class="line">    m.status = status.FETCHED</div><div class="line">    var uri = m.uri</div><div class="line">    requestCache[uri] = sendRequest; //Document.createElement(&apos;script)</div><div class="line">    </div><div class="line">    function sendRequest()&#123;</div><div class="line">      startUp.request(uri,onRequest) //åŠ¨æ€åŠ è½½script</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function onRequest()&#123; //äº‹ä»¶å‡½æ•° scriptæ ‡ç­¾åŠ è½½æ¨¡å—ç»“æŸåï¼Œonload å‡½æ•°ä¸­ä¼šè¢«è°ƒç”¨</div><div class="line">      if(anonymousMeta)&#123; //æ¨¡å—çš„æ•°æ®æ›´æ–°</div><div class="line">        m.save(uri,anonymousMeta)</div><div class="line">      &#125;</div><div class="line">      m.load() //é€’å½’ æ¨¡å—åŠ è½½ç­–ç•¥</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Module.prototype.onload = function()&#123;</div><div class="line">    var mod = this</div><div class="line">    mod.status = LOADED //4</div><div class="line">    if(mod.callback)&#123;//è·å–æ¨¡å—æ¥å£å¯¹è±¡</div><div class="line">      mod.callback()</div><div class="line">    &#125;</div><div class="line">    var waitings = mod._waitings //ä¾èµ–åŠ è½½å®Œï¼Œé€’å½’å›è°ƒ è¢«ä¾èµ–æ¨¡å—(çˆ¶)çš„callback</div><div class="line">    var key,m;</div><div class="line">    for(key in waitings)&#123;</div><div class="line">      var m = cache[key]</div><div class="line">      m._remain -= waitings[key]</div><div class="line">      if(m._remain == 0)&#123; //åˆ¤æ–­çˆ¶æ¨¡å—ä¾èµ–æ˜¯å¦å…¨éƒ¨åŠ è½½å®Œ</div><div class="line">        m.onload()</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  //èµ„æºå®šä½ è§£æä¾èµ–é¡¹ç”Ÿæˆç»å¯¹è·¯å¾„</div><div class="line">  Module.prototype.resolve = function()&#123;</div><div class="line">    var mod = this</div><div class="line">    var ids = mod.deps</div><div class="line">    var uris = []</div><div class="line">    for(var i =0;i&lt;ids.length;i++)&#123;</div><div class="line">      uris[i] = startUp.resolve(ids[i],mod.uri) //ä¾èµ–é¡¹ï¼ˆä¸»å¹² | å­æ ‘ï¼‰</div><div class="line">    &#125;</div><div class="line">    return uris;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">   //æ›´æ”¹åˆå§‹åŒ–æ•°æ®</div><div class="line">  Module.prototype.save = function(uri,meta)&#123;</div><div class="line">    var mod = Module.get(uri)</div><div class="line">    mod.uri = uri</div><div class="line">    mod.deps = meta.deps || []</div><div class="line">    mod.factory = meta.factory</div><div class="line">    mod.status = status.SAVED</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  //è·å–æ¥å£å¯¹è±¡</div><div class="line">  Module.prototype.exec = function()&#123;</div><div class="line">    var module = this</div><div class="line">    //é˜²æ­¢é‡å¤æ‰§è¡Œ</div><div class="line">    if(module.status &gt;= status.EXECTING)&#123;</div><div class="line">      return module.exports</div><div class="line">    &#125;</div><div class="line">    module.status = status.EXECTING;</div><div class="line">    var uri = module.uri</div><div class="line">    function require(id)&#123; //ä½œä¸ºå‚æ•°ä¼ é€’åˆ°defineå‚æ•°çš„å‡½æ•°ä¸­</div><div class="line">      return Module.get(require.resolve(id)).exec() //è·å–æ¥å£å¯¹è±¡</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    require.resolve = function(id)&#123;</div><div class="line">      return startUp.resolve(id,uri)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var factory = module.factory //defineä¼ å…¥çš„å‡½æ•°</div><div class="line">    var exports = isFunction(factory) ? factory(require,module.exports= &#123;&#125;,module) :factory;</div><div class="line">    if(exports === undefined) &#123;</div><div class="line">      exports = module.exports</div><div class="line">    &#125;</div><div class="line">    module.exports = exports</div><div class="line">    module.status = status.EXECTED //6</div><div class="line">    return exports</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //å®šä¹‰ä¸€ä¸ªæ¨¡å—</div><div class="line">  Module.define = function(factory)&#123;</div><div class="line">    var deps</div><div class="line">    if(isFunction(factory))&#123;</div><div class="line">      //æ­£åˆ™è§£æä¾èµ–é¡¹</div><div class="line">      deps = parseDependencies(factory.toString())</div><div class="line">    &#125;</div><div class="line">    //å­˜å‚¨å½“å‰æ¨¡å—ä¿¡æ¯</div><div class="line">    var meta = &#123;</div><div class="line">      id:&apos;&apos;,</div><div class="line">      uri:&apos;&apos;,</div><div class="line">      deps:deps,</div><div class="line">      factory:factory</div><div class="line">    &#125;</div><div class="line">    anonymousMeta = meta</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //æ£€æµ‹ç¼“å­˜å¯¹è±¡ä¸Šæ˜¯å¦æœ‰å½“å‰æ¨¡å—ä¿¡æ¯</div><div class="line">  Module.get = function(uri,deps)&#123;</div><div class="line">    //cache[&apos;xxxxx.js&apos;] = &#123;uri:&apos;xxxxx.js&apos;,deps:[]&#125; //module å®ä¾‹å¯¹è±¡</div><div class="line">    return cache[uri] || (cache[uri] = new Module(uri,deps))</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Module.use = function(deps,callback,uri)&#123;</div><div class="line">    var m = Module.get(uri,isArray(deps)?dep:[deps])</div><div class="line">    console.log(module)</div><div class="line">    //æ‰€æœ‰æ¨¡å—éƒ½åŠ è½½å®Œæ¯•</div><div class="line">    m.callback= function()&#123;</div><div class="line">      var exports = [] //æ‰€æœ‰ä¾èµ–é¡¹æ¨¡å—çš„æ¥å£å¯¹è±¡</div><div class="line">      var uris = m.resolve()</div><div class="line">      for(var i = 0;i&lt;uris.length;i++)&#123;</div><div class="line">        exports[i] = cache[uris[i]].exec() //è·å–æ¨¡å—å¯¹å¤–å®šä¹‰çš„æ¥å£å¯¹è±¡</div><div class="line">      &#125;</div><div class="line">      if(callback)&#123;</div><div class="line">        callback.apply(global,exports)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    m.load()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  var _cid = 0</div><div class="line"></div><div class="line">  function cid()&#123;</div><div class="line">    return _cid++</div><div class="line">  &#125;</div><div class="line">  // data.preload = []</div><div class="line">  //å–æ¶ˆå½“å‰é¡¹ç›®æ–‡æ¡£çš„URL</div><div class="line">  data.cwd = document.URL.match(/[^?]*\//)[0]</div><div class="line">  Module.preload = function(callback)&#123;</div><div class="line">    var preload = data.preload ||[]</div><div class="line">    var length = data.preload.length</div><div class="line">    if(length)&#123; //length !== 0 å…ˆåŠ è½½é¢„å…ˆè®¾å®šæ¨¡å—</div><div class="line">      Module.use(preload,function () &#123;</div><div class="line">        preload.splice(0,length)</div><div class="line">        callback()</div><div class="line">      &#125;,data.cwd+&apos;_use_&apos;+cid())</div><div class="line">    &#125; else&#123;</div><div class="line">      callback() </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  var REQUIRE_RE = /\brequire\s*\(\s*([&quot;&apos;])(.+?)\1\s*\)/g</div><div class="line">  function parseDependencies(code)&#123;</div><div class="line">    var ret = []</div><div class="line">    code.replace(REQUIRE_RE,function(m,m1,m2)&#123;</div><div class="line">      if(m2) ret.push(m2)</div><div class="line">    &#125;)</div><div class="line">    return ret</div><div class="line">  &#125;</div><div class="line">  global.define = module.define</div><div class="line">&#125;)(this)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–&lt;/h1&gt;&lt;p&gt;  æ¨¡å—åŒ–å°±æ˜¯æŠŠç³»ç»Ÿåˆ†ç¦»æˆç‹¬ç«‹åŠŸèƒ½çš„æ–¹æ³•ï¼Œä»è€Œå®ç°éœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±åŠ è½½ä»€ä¹ˆåŠŸèƒ½&lt;br&gt;  å½“ä¸€ä¸ªé¡¹ç›®å¼€å‘å¾—è¶Š
    
    </summary>
    
    
      <category term="js" scheme="http://yoohannah.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>vue æºç å­¦ä¹ ä¸€ã€new vueã€‘</title>
    <link href="http://yoohannah.github.io/post/vue/src1.html"/>
    <id>http://yoohannah.github.io/post/vue/src1.html</id>
    <published>2020-01-27T02:48:15.000Z</published>
    <updated>2020-04-11T14:06:51.060Z</updated>
    
    <content type="html"><![CDATA[<h1 id="new-vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#new-vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="new vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"></a>new vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ</h1><p>å¹³å¸¸ç»ƒä¹ æ—¶ä½¿ç”¨vueé¡ºåºæ˜¯ï¼Œå°†vue.jså¼•å…¥html,<br>new vueå°±å¯ä»¥å¼€å§‹ä½¿ç”¨vueæ¡†æ¶å†™ä¸œè¥¿<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">  &lt;div id = &apos;app&apos;&gt;</div><div class="line">    &lt;p&gt;&#123;&#123;a&#125;&#125;&lt;/p&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;vue.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">    let app = new Vue(&#123;</div><div class="line">      el:&apos;#app&apos;,</div><div class="line">      data:&#123;</div><div class="line">        a:&apos;hello world&apos;</div><div class="line">      &#125;,</div><div class="line">      method:&#123;&#125;,</div><div class="line">    &#125;)</div><div class="line">  &lt;/script&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure></p>
<p>ä»£ç è¿è¡Œé¡ºåºæ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨scriptæ ‡ç­¾å¼•å…¥æ–‡ä»¶æ—¶ï¼Œ<br>å¼•å…¥çš„vuejsæ–‡ä»¶ä¼šå…ˆæ‰§è¡Œä¸€éï¼Œ<br>æ‰§è¡Œçš„ç»“æœå°±æ˜¯å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªæŒ‚è½½åœ¨å…¨å±€çš„ï¼Œvueå¯¹è±¡çš„æ„é€ å‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">(function (global, factory) &#123;</div><div class="line">  typeof exports === &apos;object&apos; &amp;&amp; typeof module !== &apos;undefined&apos; ? module.exports = factory() :</div><div class="line">  typeof define === &apos;function&apos; &amp;&amp; define.amd ? define(factory) :</div><div class="line">  (global = global || self, global.Vue = factory());//å°†vueæŒ‚åˆ°å…¨å±€ä¸Šä¸‹æ–‡ä¸­</div><div class="line">&#125;(this, function () &#123; &apos;use strict&apos;;</div><div class="line">  function Vue (options) &#123;</div><div class="line">    if (!(this instanceof Vue)</div><div class="line">    ) &#123;</div><div class="line">      warn(&apos;Vue is a constructor and should be called with the `new` keyword&apos;);</div><div class="line">    &#125;</div><div class="line">    this._init(options);</div><div class="line">  &#125;</div><div class="line">  initMixin(Vue);</div><div class="line">  stateMixin(Vue);</div><div class="line">  eventsMixin(Vue);</div><div class="line">  lifecycleMixin(Vue);</div><div class="line">  renderMixin(Vue);</div><div class="line">  initGlobalAPI(Vue);</div><div class="line">  Vue.compile = compileToFunctions;</div><div class="line"></div><div class="line">  return Vue;</div><div class="line"></div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
<p>å½“ä»£ç è¿è¡Œåˆ°new vueæ—¶ï¼Œä»£ç å°±ä¼šè°ƒç”¨function Vue<br>function Vue ä¸­ä¼šã€è°ƒç”¨ã€‘è‡ªå·±çš„_init()æ–¹æ³•ï¼Œ<br>å¯¹å³å°†ç”Ÿæˆçš„vueå¯¹è±¡åšåˆå§‹åŒ–å·¥ä½œï¼Œå³å¼€å§‹ç”Ÿæˆvueå¯¹è±¡</p>
<p>_initæ–¹æ³•å®šä¹‰åœ¨initMixinå‡½æ•°ä¸­<br>åœ¨è°ƒç”¨initMixinç”Ÿæˆæ„é€ å‡½æ•°æµç¨‹ä¸­è¢«æŒ‚åˆ°vueä¸Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._init = function (options) &#123;</div><div class="line">  var vm = this;</div><div class="line">  vm._uid = uid$3++;</div><div class="line"></div><div class="line">  var startTag, endTag;</div><div class="line">  vm._isVue = true;// a flag to avoid this being observed</div><div class="line">  // åˆå¹¶é€‰é¡¹,å°†é…ç½®é¡¹ä»¥å†…ç½®é€‰é¡¹è¿›è¡Œåˆå¹¶</div><div class="line">  if (options &amp;&amp; options._isComponent) &#123;</div><div class="line">    //ä¼˜åŒ–å†…éƒ¨ç»„ä»¶å®ä¾‹åŒ–è¿‡ç¨‹</div><div class="line">    // ç”±äºåŠ¨æ€é€‰é¡¹åˆå¹¶éå¸¸æ…¢ï¼Œå¹¶ä¸”å†…éƒ¨ç»„ä»¶é€‰é¡¹å‡ä¸éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚</div><div class="line">    initInternalComponent(vm, options);</div><div class="line">  &#125; else &#123;</div><div class="line">    vm.$options = mergeOptions(</div><div class="line">      resolveConstructorOptions(vm.constructor),</div><div class="line">      options || &#123;&#125;,</div><div class="line">      vm</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">  /* istanbul ignore else */</div><div class="line">  &#123;</div><div class="line">    initProxy(vm);</div><div class="line">  &#125;</div><div class="line">  // expose real self</div><div class="line">  vm._self = vm;</div><div class="line">  initLifecycle(vm);</div><div class="line">  initEvents(vm);</div><div class="line">  initRender(vm);</div><div class="line">  callHook(vm, &apos;beforeCreate&apos;);//è¿è¡Œè®¢é˜…äº†beforecreateé’©å­çš„ç›¸å…³æ–¹æ³•</div><div class="line">  initInjections(vm); // resolve injections before data/props</div><div class="line">  initState(vm);</div><div class="line">  initProvide(vm); // resolve provide after data/props</div><div class="line">  callHook(vm, &apos;created&apos;);</div><div class="line">  if (vm.$options.el) &#123;//å¦‚æœé…ç½®äº†el,å°±è¿›è¡ŒæŒ‚è½½å¤„ç†æŒ‚è½½</div><div class="line">    vm.$mount(vm.$options.el);//ä¼šç»™ç»™optionæŒ‚ä¸Šrenderï¼ŒstaticRenderFnså±æ€§</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;new-vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#new-vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;new vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;new vueæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ&lt;/h1&gt;&lt;p&gt;å¹³å¸¸ç»ƒä¹ æ—¶ä½¿ç”¨vueé¡ºåºæ˜¯ï¼Œå°†vue.jså¼•å…¥htm
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue æºç å­¦ä¹ ä¸‰</title>
    <link href="http://yoohannah.github.io/post/vue/src3.html"/>
    <id>http://yoohannah.github.io/post/vue/src3.html</id>
    <published>2020-01-27T02:48:15.000Z</published>
    <updated>2020-03-11T07:29:22.895Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vue-component"><a href="#vue-component" class="headerlink" title="vue.component"></a>vue.component</h1><p>templateé…ç½®é¡¹çš„å¤„ç†ï¼Œä¸ç¼–è¯‘æ—¶çš„åˆ¤æ–­åšå¯¹æ¯”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">function _createElement (context,tag,data,children,normalizationType) &#123;</div><div class="line">  //è¿™é‡Œçœç•¥ä¸€ç³»åˆ—è¾¹ç•Œåˆ¤æ–­</div><div class="line">  var vnode, ns;</div><div class="line">  if (typeof tag === &apos;string&apos;) &#123;</div><div class="line">    var Ctor;</div><div class="line">    ns = (context.$vnode &amp;&amp; context.$vnode.ns) || config.getTagNamespace(tag);</div><div class="line">    if (config.isReservedTag(tag)) &#123; //æ ‡ç­¾åæ˜¯ä¸€èˆ¬çš„htmlæ ‡ç­¾</div><div class="line">      vnode = new VNode(</div><div class="line">        config.parsePlatformTagName(tag), data, children,</div><div class="line">        undefined, undefined, context</div><div class="line">      );</div><div class="line">    &#125; else if ((!data || !data.pre) &amp;&amp; isDef(Ctor = resolveAsset(context.$options, &apos;components&apos;, tag))) &#123; //æ ‡ç­¾åæ˜¯ç»„ä»¶æ ‡ç­¾å</div><div class="line">      vnode = createComponent(Ctor, data, context, children, tag);</div><div class="line">    &#125; else &#123;</div><div class="line">      //æœªçŸ¥æˆ–æœªåˆ—å‡ºçš„å‘½åç©ºé—´å…ƒç´ åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œ</div><div class="line">      //å› ä¸ºå½“å…¶çˆ¶é¡¹æ ‡å‡†åŒ–å­å…ƒç´ æ—¶å¯èƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªå‘½åç©ºé—´</div><div class="line">      vnode = new VNode(</div><div class="line">        tag, data, children,</div><div class="line">        undefined, undefined, context</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">    // direct component options / constructor</div><div class="line">    vnode = createComponent(tag, data, context, children);</div><div class="line">  &#125;</div><div class="line">  if (Array.isArray(vnode)) &#123;</div><div class="line">    return vnode</div><div class="line">  &#125; else if (isDef(vnode)) &#123;</div><div class="line">    if (isDef(ns)) &#123; applyNS(vnode, ns); &#125;</div><div class="line">    if (isDef(data)) &#123; registerDeepBindings(data); &#125;</div><div class="line">    return vnode</div><div class="line">  &#125; else &#123;</div><div class="line">    return createEmptyVNode()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">  function createFunctionalComponent (</div><div class="line">    Ctor,</div><div class="line">    propsData,</div><div class="line">    data,</div><div class="line">    contextVm,</div><div class="line">    children</div><div class="line">  ) &#123;</div><div class="line">    var options = Ctor.options;</div><div class="line">    var props = &#123;&#125;;</div><div class="line">    var propOptions = options.props;</div><div class="line">    if (isDef(propOptions)) &#123;</div><div class="line">      for (var key in propOptions) &#123;</div><div class="line">        props[key] = validateProp(key, propOptions, propsData || emptyObject);</div><div class="line">      &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">      if (isDef(data.attrs)) &#123; mergeProps(props, data.attrs); &#125;</div><div class="line">      if (isDef(data.props)) &#123; mergeProps(props, data.props); &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var renderContext = new FunctionalRenderContext(</div><div class="line">      data,</div><div class="line">      props,</div><div class="line">      children,</div><div class="line">      contextVm,</div><div class="line">      Ctor</div><div class="line">    );</div><div class="line"></div><div class="line">    var vnode = options.render.call(null, renderContext._c, renderContext);</div><div class="line"></div><div class="line">    if (vnode instanceof VNode) &#123;</div><div class="line">      return cloneAndMarkFunctionalResult(vnode, data, renderContext.parent, options, renderContext)</div><div class="line">    &#125; else if (Array.isArray(vnode)) &#123;</div><div class="line">      var vnodes = normalizeChildren(vnode) || [];</div><div class="line">      var res = new Array(vnodes.length);</div><div class="line">      for (var i = 0; i &lt; vnodes.length; i++) &#123;</div><div class="line">        res[i] = cloneAndMarkFunctionalResult(vnodes[i], data, renderContext.parent, options, renderContext);</div><div class="line">      &#125;</div><div class="line">      return res</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h1 id="ç”Ÿå‘½å‘¨æœŸåˆå¹¶ç­–ç•¥"><a href="#ç”Ÿå‘½å‘¨æœŸåˆå¹¶ç­–ç•¥" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸåˆå¹¶ç­–ç•¥"></a>ç”Ÿå‘½å‘¨æœŸåˆå¹¶ç­–ç•¥</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var strats = config.optionMergeStrategies;</div><div class="line">LIFECYCLE_HOOKS.forEach(function (hook) &#123;</div><div class="line">    strats[hook] = mergeHook;</div><div class="line">  &#125;);</div><div class="line">function mergeHook (</div><div class="line">    parentVal,</div><div class="line">    childVal</div><div class="line">  ) &#123;</div><div class="line">    var res = childVal</div><div class="line">      ? parentVal</div><div class="line">        ? parentVal.concat(childVal)</div><div class="line">        : Array.isArray(childVal)</div><div class="line">          ? childVal</div><div class="line">          : [childVal]</div><div class="line">      : parentVal;</div><div class="line">    return res</div><div class="line">      ? dedupeHooks(res)</div><div class="line">      : res</div><div class="line">  &#125;</div><div class="line"></div><div class="line">function mergeOptions (</div><div class="line">    parent,</div><div class="line">    child,</div><div class="line">    vm</div><div class="line">  ) &#123;</div><div class="line">    &#123;</div><div class="line">      checkComponents(child);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (typeof child === &apos;function&apos;) &#123;</div><div class="line">      child = child.options;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    normalizeProps(child, vm);</div><div class="line">    normalizeInject(child, vm);</div><div class="line">    normalizeDirectives(child);</div><div class="line"></div><div class="line">    // Apply extends and mixins on the child options,</div><div class="line">    // but only if it is a raw options object that isn&apos;t</div><div class="line">    // the result of another mergeOptions call.</div><div class="line">    // Only merged options has the _base property.</div><div class="line">    if (!child._base) &#123;</div><div class="line">      if (child.extends) &#123;</div><div class="line">        parent = mergeOptions(parent, child.extends, vm);</div><div class="line">      &#125;</div><div class="line">      if (child.mixins) &#123;</div><div class="line">        for (var i = 0, l = child.mixins.length; i &lt; l; i++) &#123;</div><div class="line">          parent = mergeOptions(parent, child.mixins[i], vm);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var options = &#123;&#125;;</div><div class="line">    var key;</div><div class="line">    for (key in parent) &#123;</div><div class="line">      mergeField(key);</div><div class="line">    &#125;</div><div class="line">    for (key in child) &#123;</div><div class="line">      if (!hasOwn(parent, key)) &#123;</div><div class="line">        mergeField(key);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    function mergeField (key) &#123;</div><div class="line">      var strat = strats[key] || defaultStrat;</div><div class="line">      options[key] = strat(parent[key], child[key], vm, key);</div><div class="line">    &#125;</div><div class="line">    return options</div><div class="line">  &#125;</div><div class="line"> function initMixin$1 (Vue) &#123;</div><div class="line">    Vue.mixin = function (mixin) &#123;</div><div class="line">      this.options = mergeOptions(this.options, mixin);</div><div class="line">      return this</div><div class="line">    &#125;;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;vue-component&quot;&gt;&lt;a href=&quot;#vue-component&quot; class=&quot;headerlink&quot; title=&quot;vue.component&quot;&gt;&lt;/a&gt;vue.component&lt;/h1&gt;&lt;p&gt;templateé…ç½®é¡¹çš„å¤„ç†ï¼Œä¸ç¼–è¯‘æ—¶çš„åˆ¤æ–­åšå¯¹æ¯”&lt;
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›å…³äºvueçš„é›¶æ•£ç¬”è®°</title>
    <link href="http://yoohannah.github.io/post/vue/usual.html"/>
    <id>http://yoohannah.github.io/post/vue/usual.html</id>
    <published>2020-01-27T02:48:15.000Z</published>
    <updated>2020-02-05T15:16:11.445Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼"><a href="#é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼" class="headerlink" title="é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼"></a>é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼</h1><p>é€šè¿‡åˆ›å»ºä¸­é—´å¯¹è±¡æŒ‚è½½åˆ°å®ä¾‹ä¸Šï¼Œé€šè¿‡ä¸­é—´å¯¹è±¡çš„setæ–¹æ³•è¿›è¡Œæ‹¦æˆª<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function initGlobalAPI (Vue) &#123;</div><div class="line">  var configDef = &#123;&#125;;</div><div class="line">  configDef.get = function () &#123; return config; &#125;; //configå¯¹è±¡æ˜¯vueå¯¹è±¡æ„å»ºè¿‡ç¨‹çš„å†…éƒ¨å¯¹è±¡ï¼Œå­˜å‚¨å…¨å±€é…ç½®é¡¹</div><div class="line">  &#123;</div><div class="line">    configDef.set = function () &#123;</div><div class="line">      warn(</div><div class="line">        &apos;Do not replace the Vue.config object, set individual fields instead.&apos;</div><div class="line">      );</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line">  Object.defineProperty(Vue, &apos;config&apos;, configDef);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="https://cn.vuejs.org/v2/api/#optionMergeStrategies" target="_blank" rel="external">Vue.config.optionMergeStrategies</a> åº”ç”¨ä¸­<br>Vue.configå¯ä»¥get,å¾—åˆ°çš„å³å†…éƒ¨çš„configï¼Œä½†å¦‚æœè¿›è¡ŒVue.config = xxxx setæ“ä½œå°±ä¼šæŠ¥é”™<br>é€šè¿‡Vue.configå¯ä»¥è·å¾—å†…éƒ¨configï¼Œä»è€Œå¯ä»¥ä¿®æ”¹å†…éƒ¨configå¯¹è±¡ä¸Šçš„å±æ€§ï¼Œä»è€Œä¿®æ”¹åˆ°å…¨å±€é…ç½®</p>
<h1 id="å…³äº3-0çš„æ€è€ƒ"><a href="#å…³äº3-0çš„æ€è€ƒ" class="headerlink" title="å…³äº3.0çš„æ€è€ƒ"></a>å…³äº3.0çš„æ€è€ƒ</h1><p>å¦‚ä½•æ›´å¿«<br>Object.definePropertyâ€“&gt;Proxy<br>Virtual Domé‡æ„<br>æ›´å¤šç¼–è¯‘ä¼˜åŒ–ï¼š<br>Sloté»˜è®¤ç¼–è¯‘ä¸ºå‡½æ•°<br>é‡æ„vnode factoryï¼Œç»Ÿä¸€è¾“å…¥å‚æ•°ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ç¼–è¯‘å¤„ç†å‡½æ•°(Monomorphic vnode factory)<br>ç¼–è¯‘æ—¶å¢åŠ vnode/children ç±»å‹ä¿¡æ¯æ ‡è¯†ï¼Œä»è€Œåšè¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆCompiler-generated flags for vnode/children typesï¼‰</p>
<p>Function based API å¯¹æ¯”Class API å¥½å¤„<br>æ›´å¥½çš„TSç±»å‹æ¨å¯¼æ”¯æŒ<br>æ›´çµæ´»çš„é€»è¾‘å¤ç”¨èƒ½åŠ›<br>Tree-shaking å‹å¥½<br>ä»£ç æ›´å®¹æ˜“å‹ç¼©</p>
<p>ç°æœ‰é€»è¾‘å¤ç”¨æ¨¡å¼<br>Mixins<br>é«˜é˜¶ç»„ä»¶<br>åŸºäºscoped slots/ä½œç”¨åŸŸæ’æ§½å°è£…é€»è¾‘çš„ç»„ä»¶<br>å­˜åœ¨é—®é¢˜<br>æ•°æ®æ¥æºä¸æ¸…æ™° ï¼ˆFunction based API æ•°æ®æ¥æºæ¸…æ™°ï¼‰<br>å‘½åå†²çªï¼ˆFunction based API æ²¡æœ‰å‘½åå†²çªï¼‰<br>æ— è°“çš„é¢å¤–ç»„ä»¶çš„æ€§èƒ½æ¶ˆè€— ï¼ˆFunction based API æ²¡æœ‰é¢å¤–ç»„ä»¶æ€§èƒ½æ¶ˆè€—ï¼‰</p>
<p>å¯¹æ¯”React Hooks<br>åŒæ ·çš„é€»è¾‘ç»„åˆï¼Œå¤ç”¨èƒ½åŠ›æ›´å¼º<br>åªè°ƒç”¨ä¸€æ¬¡<br>ç¬¦åˆJSç›´è§‰<br>æ²¡æœ‰é—­åŒ…å˜é‡é—®é¢˜<br>æ²¡æœ‰å†…å­˜/GCå‹åŠ›<br>ä¸å­˜åœ¨å†…è”å›è°ƒå¯¼è‡´å­ç»„ä»¶æ°¸è¿œæ›´æ–°é—®é¢˜</p>
<p>2.0<br>mergeOption é€‰é¡¹ç­–ç•¥å¤„ç†<br>æ’ä»¶å¼€å‘ï¼šä»¥é»˜è®¤é…ç½®ä¼˜å…ˆï¼›ä»¥ç”¨æˆ·é…ç½®ä¸ºè¦†ç›–<br>ç­–ç•¥ï¼šå¬è¿‡JS å¢å¼ºé…ç½®é€‰é¡¹çš„è¡¨è¾¾åŠ›<br>{}==&gt;function(){}  el===æ ¹å®ä¾‹</p>
<p>æ•°æ®åŠ«æŒvue3.0æ”¹ç”¨proxyåŸå› <br>definePropertyåªèƒ½ç›‘å¬æŸä¸ªå±æ€§ï¼Œä¸èƒ½å¯¹å…¨å¯¹è±¡ç›‘å¬ï¼Œä½¿ç”¨proxyå¯ä»¥çœå»for inæå‡æ•ˆç‡<br>å¯ä»¥ç›‘å¬æ•°ç»„ï¼Œä¸ç”¨å†å»å•ç‹¬çš„å¯¹æ•°ç»„åšç‰¹å¼‚æ€§æ“ä½œ</p>
<p>vue2.0 vdomæ€§èƒ½ç“¶é¢ˆ<br>è™½ç„¶èƒ½å¤Ÿä¿è¯è§¦å‘æ›´æ–°çš„ç»„ä»¶æœ€å°åŒ–ï¼Œä½†åœ¨å•ä¸ªç»„ä»¶å†…éƒ¨ä¾ç„¶éœ€è¦éå†è¯¥ç»„ä»¶çš„æ•´ä¸ªVdomæ ‘<br>vdomçš„æ€§èƒ½è·Ÿæ¨¡æ¿å¤§å°æ­£ç›¸å…³ï¼Œè·ŸåŠ¨æ€èŠ‚ç‚¹çš„æ•°é‡æ— å…³ã€‚<br>åœ¨ä¸€äº›ç»„ä»¶æ•´ä¸ªæ¨¡æ¿å†…åªæœ‰å°‘é‡åŠ¨æ€èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œè¿™äº›éå†éƒ½æ˜¯æ€§èƒ½çš„æµªè´¹</p>
<h1 id="ç¼–è¯‘3æ­¥éª¤"><a href="#ç¼–è¯‘3æ­¥éª¤" class="headerlink" title="ç¼–è¯‘3æ­¥éª¤"></a>ç¼–è¯‘3æ­¥éª¤</h1><p>parseï¼šAST<br>optimize:æ ‡è®°é™æ€èŠ‚ç‚¹<br>generate ç”Ÿæˆç›®æ ‡å¹³å°æ‰€éœ€çš„ä»£ç  å°†ASTè½¬åŒ–æˆrender functionå­—ç¬¦ä¸²</p>
<h1 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h1><p>v-model.lazy ä»inputäº‹ä»¶ä¸­è½¬å˜ä¸ºåœ¨changeäº‹ä»¶ä¸­åŒæ­¥æ•°æ®<br>v-model.number å¯ä»¥å°†è¾“å…¥è½¬æ¢ä¸ºNumberç±»å‹<br>v-model.trim å¯ä»¥è‡ªåŠ¨è¿‡æ»¤è¾“å…¥çš„é¦–å°¾ç©ºæ ¼</p>
<p>v-for å¾ªç¯æ—¶ï¼Œkeyå°½é‡èµ‹å€¼ä¸ºä¸å˜çš„å€¼ï¼Œå³é™æ€å€¼ï¼Œå¦‚item.id ,å¦åˆ™åˆ—è¡¨å¢åˆ æ—¶ï¼Œä¼šæ›´æ–°æ¯ä¸€é¡¹</p>
<p>å½“å­ç»„ä»¶éœ€è¦å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®æ—¶ï¼Œå°±è¦ç”¨åˆ°è‡ªå®šä¹‰äº‹ä»¶<br>å­ç»„ä»¶ç”¨$emitæ¥è§¦å‘äº‹ä»¶ï¼Œçˆ¶ç»„ä»¶ç”¨$on()æ¥ç›‘å¬å­ç»„ä»¶çš„äº‹ä»¶<br>è‡ªå®šä¹‰ç»„ä»¶çš„v-model ï¼šä¸€ä¸ªç»„ä»¶ä¸Šçš„v-model é»˜è®¤ä¼šåˆ©ç”¨åä¸ºvalueçš„propå’Œåä¸ºinputçš„äº‹ä»¶<br>å°†åŸç”Ÿäº‹ä»¶ç»‘å®šåˆ°ç»„ä»¶ï¼š ä½¿ç”¨v-onçš„.nativeä¿®é¥°ç¬¦ç›‘å¬åŸç”Ÿäº‹ä»¶<br>.syncä¿®é¥°ç¬¦ï¼šçˆ¶ç»„ä»¶ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶æŒ‰éœ€æ›´æ–°æ•°æ®</p>
<h1 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h1><p>åŠ¨æ€ç»„ä»¶ï¼šVUE æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„å…ƒç´ &lt;component&gt;ç”¨æ¥åŠ¨æ€çš„æŒ‚è½½ä¸åŒçš„ç»„ä»¶ï¼Œä½¿ç”¨isç‰¹æ€§æ¥é€‰æ‹©è¦æŒ‚è½½çš„ç»„ä»¶ï¼Œ è¿˜å¯ä»¥ä½¿ç”¨&lt;keep-alive&gt;æ ‡ç­¾ä½¿ç»„ä»¶è¿›è¡Œç¼“å­˜</p>
<p>å¼‚æ­¥ç»„ä»¶ï¼šVUEå…è®¸å°†ç»„ä»¶å®šä¹‰ä¸ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼ŒåŠ¨æ€åœ°è§£æç»„ä»¶ã€‚VUEåªåœ¨ç»„ä»¶éœ€è¦æ¸²æŸ“æ—¶è§¦å‘å·¥å‚å‡½æ•°ï¼Œå¹¶ä¸”æŠŠç»“æœç¼“å­˜èµ·æ¥ç”¨äºåé¢åœ°å†æ¬¡æ¸²æŸ“</p>
<h2 id="ç»„ä»¶åˆ›å»ºæ–¹å¼"><a href="#ç»„ä»¶åˆ›å»ºæ–¹å¼" class="headerlink" title="ç»„ä»¶åˆ›å»ºæ–¹å¼"></a>ç»„ä»¶åˆ›å»ºæ–¹å¼</h2><p>1.è°ƒç”¨Vue.extend(),åˆ›å»ºåä¸ºxxçš„ç»„ä»¶ï¼Œtemplateå®šä¹‰æ¨¡æ¿çš„æ ‡ç­¾ï¼Œæ¨¡æ¿çš„å†…å®¹éœ€è¦å†™åœ¨è¯¥æ ‡ç­¾ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var xx = Vue.extend(&#123;</div><div class="line">    template:&apos;&lt;div&gt;this is a component&lt;/div&gt;&apos;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>2.ä½¿ç”¨&lt;template&gt;æ ‡ç­¾åˆ›å»ºï¼Œéœ€è¦åŠ ä¸Šidå±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;template id = &apos;mycom&apos;&gt;</div><div class="line">  &lt;div&gt;this is a component&lt;/div&gt;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure></p>
<p>3.ä½¿ç”¨&lt;script&gt;æ ‡ç­¾åˆ›å»ºï¼Œéœ€è¦åŠ idå±æ€§ï¼ŒåŒæ—¶è¿˜å¾—åŠ type=â€™text/x-templateâ€™ ä¸æ‰§è¡Œç¼–è¯‘é‡Œé¢çš„ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&apos;text/x-template&apos; id = &apos;mycom&apos;&gt;</div><div class="line">  &lt;div&gt;this is a component&lt;/div&gt;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<h2 id="ç»„ä»¶å…¨å±€æ³¨å†Œæ–¹å¼"><a href="#ç»„ä»¶å…¨å±€æ³¨å†Œæ–¹å¼" class="headerlink" title="ç»„ä»¶å…¨å±€æ³¨å†Œæ–¹å¼"></a>ç»„ä»¶å…¨å±€æ³¨å†Œæ–¹å¼</h2><p>1.è°ƒç”¨Vue.extend(),åˆ›å»ºåä¸ºmyComçš„ç»„ä»¶å…¨å±€æ³¨å†Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Vue.component(&apos;my-com&apos;,myCom)</div></pre></td></tr></table></figure></p>
<p>2.templateåŠscriptæ ‡ç­¾æ„å»ºçš„ç»„ä»¶å…¨å±€æ³¨å†Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vue.component(&apos;my-comp&apos;,&#123;</div><div class="line">    template:&apos;#mycom&apos;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="ç»„ä»¶å±€éƒ¨æ³¨å†Œ"><a href="#ç»„ä»¶å±€éƒ¨æ³¨å†Œ" class="headerlink" title="ç»„ä»¶å±€éƒ¨æ³¨å†Œ"></a>ç»„ä»¶å±€éƒ¨æ³¨å†Œ</h2><p>1.è°ƒç”¨Vue.extend(),åˆ›å»ºåä¸ºmyComçš„ç»„ä»¶å±€éƒ¨æ³¨å†Œï¼ˆåªèƒ½åœ¨æ³¨å†Œè¯¥ç»„ä»¶çš„å®ä¾‹ä¸­ä½¿ç”¨ï¼Œä¸€å¤„æ³¨å†Œï¼Œä¸€å¤„ä½¿ç”¨ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var app = new Vue(&#123;</div><div class="line">    el:&apos;#app&apos;,</div><div class="line">    components:&#123;</div><div class="line">        &apos;my-com&apos;:myCom</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>2.templateåŠscriptæ„å»ºçš„ç»„ä»¶å±€éƒ¨æ³¨å†Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var app = new Vue(&#123;</div><div class="line">    el:&apos;#app&apos;</div><div class="line">    componnets:&#123;</div><div class="line">        &apos;my-com&apos;:&#123;</div><div class="line">            template:&apos;#myCom&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="ç»„ä»¶åŒ–å¤„ç†è¾¹ç•Œæƒ…å†µ"><a href="#ç»„ä»¶åŒ–å¤„ç†è¾¹ç•Œæƒ…å†µ" class="headerlink" title="ç»„ä»¶åŒ–å¤„ç†è¾¹ç•Œæƒ…å†µ"></a>ç»„ä»¶åŒ–å¤„ç†è¾¹ç•Œæƒ…å†µ</h2><p>1.è®¿é—®æ ¹å®ä¾‹ this.$root.xxx<br>2.è®¿é—®çˆ¶ç»„ä»¶å®ä¾‹ï¼šthis.$parent.xxx<br>3.è®¿é—®å­ç»„ä»¶å®ä¾‹æˆ–å­å…ƒç´ ï¼š&lt;child ref=â€™xxxâ€™&gt;&lt;/child &gt; =&gt;this.$refs.xxx<br>4.ä¾èµ–æ³¨å…¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">provide:function()&#123; //çˆ¶ç»„ä»¶</div><div class="line">    return&#123;</div><div class="line">        getMap:this.getMap</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">inject:[getMap]//å­ç»„ä»¶</div></pre></td></tr></table></figure></p>
<p>ç„¶è€Œï¼Œä¾èµ–æ³¨å…¥è¿˜æ˜¯æœ‰è´Ÿé¢å½±å“çš„ã€‚å®ƒå°†ä½ åº”ç”¨ç¨‹åºä¸­çš„ç»„ä»¶ä¸å®ƒä»¬å½“å‰çš„ç»„ç»‡æ–¹å¼è€¦åˆèµ·æ¥ï¼Œä½¿é‡æ„å˜å¾—æ›´åŠ å›°éš¾ã€‚åŒæ—¶æ‰€æä¾›çš„å±æ€§æ˜¯éå“åº”å¼çš„ã€‚è¿™æ˜¯å‡ºäºè®¾è®¡çš„è€ƒè™‘ï¼Œå› ä¸ºä½¿ç”¨å®ƒä»¬æ¥åˆ›å»ºä¸€ä¸ªä¸­å¿ƒåŒ–è§„æ¨¡åŒ–çš„æ•°æ®è·Ÿä½¿ç”¨ $rootåšè¿™ä»¶äº‹éƒ½æ˜¯ä¸å¤Ÿå¥½çš„ã€‚å¦‚æœä½ æƒ³è¦å…±äº«çš„è¿™ä¸ªå±æ€§æ˜¯ä½ çš„åº”ç”¨ç‰¹æœ‰çš„ï¼Œè€Œä¸æ˜¯é€šç”¨åŒ–çš„ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åœ¨ç¥–å…ˆç»„ä»¶ä¸­æ›´æ–°æ‰€æä¾›çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ„å‘³ç€ä½ å¯èƒ½éœ€è¦æ¢ç”¨ä¸€ä¸ªåƒ Vuex è¿™æ ·çœŸæ­£çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆäº†</p>
<p>5.ç»Ÿä¸€å¤„ç†äº‹ä»¶ä¾¦å¬å™¨æ—¶ï¼Œåœ¨ç»„ä»¶å¸è½½å‰ï¼Œç»Ÿä¸€æ¸…é™¤ç›‘å¬å™¨<br>6.ç»„ä»¶å¾ªç¯å¼•ç”¨ï¼ŒVue.componentæ³¨å†Œçš„ç»„ä»¶å…è®¸ï¼Œä½†æ˜¯æ¨¡å—åŒ–å¯¼å…¥çš„ä¸å…è®¸<br>7.æ¨¡æ¿å®šä¹‰çš„æ›¿ä»£å“ï¼š<br>A:å†…è”æ¨¡æ¿ï¼šå½“inline-templateè¿™ä¸ªç‰¹æ®Šçš„ç‰¹æ€§å‡ºç°åœ¨ä¸€ä¸ªå­ç»„ä»¶ä¸Šæ—¶ï¼Œè¿™ä¸ªç»„ä»¶å°†ä¼šä½¿ç”¨å…¶é‡Œé¢çš„å†…å®¹ä½œä¸ºæ¨¡æ¿<br>è€Œä¸æ˜¯å°†å…¶ä½œä¸ºè¢«åˆ†å‘çš„å†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;myCom inline-template&gt;&lt;div&gt;&lt;p&gt;these are compiled as the component&apos;s own template&lt;/p&gt;&lt;/div&gt;&lt;/myCom&gt;</div></pre></td></tr></table></figure></p>
<p>B:x-template<br>åœ¨scriptæ ‡ç­¾é‡Œä½¿ç”¨text/x-templateï¼Œå¹¶ä¸”æŒ‡å®šid,å°†è¿™ä¸ªidèµ‹å€¼ç»™template<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&apos;text/x-template&apos; id = &apos;mycom&apos;&gt;</div><div class="line">  &lt;div&gt;this is a component&lt;/div&gt;</div><div class="line">&lt;/script&gt;</div><div class="line">Vue.component(&apos;my-comp&apos;,&#123;</div><div class="line">    template:&apos;#mycom&apos;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>8.å¼ºåˆ¶æ›´æ–°<br>Aï¼šä½¿ç”¨this.$forceUpdate<br>Bï¼šä½¿ç”¨v-onceåˆ›å»ºä½å¼€é”€é™æ€ç»„ä»¶ï¼Œç»„ä»¶åŒ…å«å¤§é‡é™æ€å†…å®¹å¯ä»¥åœ¨æ ¹å…ƒç´ ä¸Šæ·»åŠ v-onceç‰¹æ€§ä»¥ç¡®ä¿è¿™äº›å†…å®¹åªè®¡ç®—ä¸€æ¬¡ç„¶åç¼“å­˜èµ·æ¥</p>
<h2 id="ç»„ä»¶é€šä¿¡ç±»å‹"><a href="#ç»„ä»¶é€šä¿¡ç±»å‹" class="headerlink" title="ç»„ä»¶é€šä¿¡ç±»å‹"></a>ç»„ä»¶é€šä¿¡ç±»å‹</h2><p>çˆ¶å­ç»„ä»¶é€šä¿¡<br>1.ä½¿ç”¨propså’Œ$emitçˆ¶å­ç»„ä»¶ç›¸äº’é€šä¿¡<br>2.çˆ¶ç»„ä»¶ç”¨$childrenæˆ–è€…åˆ©ç”¨refæ“ä½œå­ç»„ä»¶<br>3.å­ç»„ä»¶$parentè®¿é—®çˆ¶ç»„ä»¶</p>
<p>éçˆ¶å­ç»„ä»¶é€šä¿¡<br>1.ä½¿ç”¨ä¸­å¤®äº‹ä»¶æ€»çº¿(eventbusæ¥å¤„ç†éçˆ¶å­ç»„ä»¶é—´çš„é€šä¿¡)<br>2.ç¥–å…ˆå…ƒç´ é€šè¿‡provideæä¾›æ•°æ®ï¼Œåä»£é€šè¿‡injectè·å–è¯¥æ•°æ®<br>3.ä½¿ç”¨$attrså’Œ$listenerså®ç°ç¥–å­™ç»„ä»¶é€šä¿¡<br>4.$rootç›´æ¥è®¿é—®æ ¹ç»„ä»¶</p>
<h1 id="Vue-use"><a href="#Vue-use" class="headerlink" title="Vue.use"></a>Vue.use</h1><p>Vue.use(myPlugin)æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨myPlugin.install(VUE)<br>ä½¿ç”¨æ’ä»¶å¿…é¡»åœ¨new vue()å¯åŠ¨åº”ç”¨ä¹‹å‰å®Œæˆï¼Œå®ä¾‹åŒ–ä¹‹å‰å°±è¦é…ç½®å¥½<br>ä½¿ç”¨Vue.useå¤šæ¬¡æ³¨å†Œç›¸åŒæ’ä»¶ï¼Œé‚£åªä¼šæ³¨å†ŒæˆåŠŸä¸€æ¬¡<br>ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">import Vue from &apos;vue&apos;</div><div class="line">import &#123;expect&#125; from &apos;chai&apos;</div><div class="line">import Counter from &apos;@/counter.vue&apos;</div><div class="line"></div><div class="line">describe(&apos;æµ‹è¯•Counter.vue&apos;,()=&gt;&#123;</div><div class="line">    const Constructor = Vue.extend(Counter)</div><div class="line">    const vm = new Constructor().$mount()</div><div class="line">    const button = vm.$el.querySelector(&apos;button&apos;)</div><div class="line">    const clickE = new window.Event(&apos;click&apos;)</div><div class="line">    button.dispatchEvent(clickE)</div><div class="line">    vm._watcher.run()</div><div class="line">    expect(Number(vm.$el.querySelector(&apos;span&apos;).textContent)).to.equal(1)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p>é»˜è®¤çš„äº”ç§åŸºæœ¬å¯¹è±¡<br>state:å­˜å‚¨çŠ¶æ€(å¯¹è±¡)<br>getters:å¯¹æ•°æ®è·å–ä¹‹å‰çš„å†æ¬¡ç¼–è¯‘ï¼Œå¯ä»¥ç†è§£ä¸ºstateçš„è®¡ç®—å±æ€§ï¼Œå¯¹stateçš„æ•°æ®è¿›è¡Œç­›é€‰ï¼Œè¿‡æ»¤<br>mutations:åŒæ­¥ä¿®æ”¹çŠ¶æ€ï¼Œå¹¶ä¸”æ˜¯åŒæ­¥çš„ã€‚åœ¨ç»„ä»¶ä¸­ä½¿ç”¨$store.commit(â€˜â€™,params)<br>actions:å¼‚æ­¥ä¿®æ”¹çŠ¶æ€ï¼Œåœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ˜¯$store.dispatch(â€˜â€™)<br>modules:storeçš„å­æ¨¡å—ï¼Œä¸ºäº†å¼€å‘å¤§å‹é¡¹ç›®ï¼Œæ–¹ä¾¿çŠ¶æ€ç®¡ç†è€Œä½¿ç”¨çš„</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼&quot;&gt;&lt;a href=&quot;#é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼&quot;&gt;&lt;/a&gt;é‡Šæ”¾å†…éƒ¨å¯¹è±¡ä¸”èƒ½é˜²æ­¢å¤–éƒ¨ä¿®æ”¹çš„æ–¹å¼&lt;/h1&gt;&lt;p&gt;é€šè¿‡åˆ›å»ºä¸­é—´å¯¹è±¡æŒ‚è½½
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›å…³äºH5çš„çŸ¥è¯†</title>
    <link href="http://yoohannah.github.io/post/knowledge/h5.html"/>
    <id>http://yoohannah.github.io/post/knowledge/h5.html</id>
    <published>2020-01-27T02:33:58.000Z</published>
    <updated>2020-01-27T12:08:30.880Z</updated>
    
    <content type="html"><![CDATA[<p>h5 æ–°å¢è¯­ä¹‰åŒ–å¸ƒå±€æ ‡ç­¾ï¼šheader,nav,section,aside,article,footerï¼Œå‡è¡¨ç°ä¸ºå—çº§<br>canvas,video,audio,sessionStorage,localStorage,<br>æ‹–æ”¾API(æºå¯¹è±¡ï¼šondragstart,ondrag,ondragendï¼›æºå¯¹è±¡æ ‡ç­¾å±æ€§è¦è®¾ç½®ä¸ºdraggable=true<br>ç›®æ ‡å¯¹è±¡ï¼šondragenter,ondragover,ondragleave,ondrop;<br>ondragoveräº‹ä»¶é»˜è®¤ä¼šå±è”½ondropäº‹ä»¶,<br>å¦‚æœè¦è§¦å‘ondropäº‹ä»¶ï¼Œéœ€è¦åœ¨ondragoveräº‹ä»¶å‡½æ•°ä¸­é˜»æ­¢é»˜è®¤å±è”½è¡Œä¸º<br>event.preventDefault()<br>)<br>//è°·æ­Œæµè§ˆå™¨v56 ä¹‹åï¼Œwindow,document,bodyçš„touchstart,touchmoveäº‹ä»¶ä¼šè¢«é»˜è®¤ä¸ºpssive:true<br>//è§£å†³æ–¹æ³•ä¸€ï¼šwindow.addEventListener(â€˜touchstartâ€™,func,{passive:false})<br>//è§£å†³æ–¹æ³•äºŒï¼Œæ·»åŠ æ ·å¼ï¼š*{touch-action:none} å–æ¶ˆæ‰€æœ‰å…ƒç´ é»˜è®¤äº‹ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//å®ç°æŠŠAæ ‡ç­¾æ‹–åˆ°Bæ ‡ç­¾</div><div class="line">1.Aæ ‡ç­¾å¼€å§‹æ‹–åŠ¨æ—¶</div><div class="line">ondragstart(event)&#123;</div><div class="line">  event.dataTransfer.setData(&apos;source&apos;,event.target.id)</div><div class="line">&#125;</div><div class="line">2.Bæ ‡ç­¾ç›‘å¬æ‹–æ‹½ç»“æŸå</div><div class="line">ondrop(event)&#123;</div><div class="line">  var source = document.getElementById(event.dataTransfer.getData(&apos;source&apos;))</div><div class="line">  event.target.appendChild(source)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Historyå¸¸ç”¨åœºæ™¯<br>å•é¡µåº”ç”¨ä¸­ï¼šå®ç°ç½‘é¡µæ— åˆ·æ–°æ›´æ–°æ•°æ®çš„åŒæ—¶ï¼Œè§£å†³æµè§ˆå™¨æ— æ³•å‰è¿›/åé€€çš„é—®é¢˜<br>pushState:æ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šå¢åŠ ä¸€æ¡å†å²è®°å½•ï¼Œæµè§ˆå™¨åœ¨è¿”å›æ—¶ï¼Œå°±ä¸ä¼šè¿”å›å‰ä¸€ä¸ªé¡µé¢ï¼Œå¹¶ä¸”ä¸ä¼šåˆ·æ–°æµè§ˆå™¨<br>replaceStateï¼šç”¨æ¥ä¿®æ”¹å½“å‰å†å²è®°å½•ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å†å²è®°å½•ï¼Œç‚¹å‡»è¿”å›æŒ‰é’®ç…§æ ·ä¼šè¿”å›ä¸Šä¸€ä¸ªé¡µé¢<br>onpopstateï¼šç‚¹å‡»åé€€ï¼Œå‰è¿›æˆ–è€…è°ƒç”¨history.back()ï¼Œhistory.forward(),history.go()æ–¹æ³•</p>
<h1 id="è·¨æ–‡æ¡£é€šè®¯"><a href="#è·¨æ–‡æ¡£é€šè®¯" class="headerlink" title="è·¨æ–‡æ¡£é€šè®¯"></a>è·¨æ–‡æ¡£é€šè®¯</h1><p>å®šä¹‰ï¼šè·¨æ–‡æ¡£æ¶ˆæ¯ä¼ é€ï¼Œæ¥è‡ªä¸åŒåŸŸçš„é¡µé¢é—´ä¼ é€’æ¶ˆæ¯<br>ä½¿ç”¨åœºæ™¯ï¼šå†…åµŒæ¡†æ¶å’Œå…¶çˆ¶æ–‡æ¡£ç›¸äº’è¿›è¡Œæ•°æ®ä¼ è¾“æˆ–è€…é€šè®¯</p>
<h2 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h2><p>window.postMessage(message,origin,transfer)<br>message:å‘é€åˆ°å­æ–‡æ¡£çš„ä¿¡æ¯ï¼Œä¸€èˆ¬è½¬æˆå­—ç¬¦ä¸²ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æµè§ˆå™¨ä¸å…¼å®¹<br>origin:åŸŸä¿¡æ¯ï¼Œå‘Šè¯‰å­æ–‡æ¡£ï¼Œæ¶ˆæ¯æ¥æºï¼Œç”¨äºåˆ¤æ–­æ¥æºæ˜¯å¦åŒ¹é…ï¼Œç„¶åæ‰è¿›è¡Œç›¸å…³æ“ä½œ<br>transfer:è½¬ç§»æ¶ˆæ¯å¯¹è±¡ï¼Œå¯é€‰å‚æ•°ï¼Œæ˜¯ä¸€ä¸²å’ŒmessageåŒæ—¶ä¼ é€’çš„Transferableå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒ</p>
<h2 id="onmessage"><a href="#onmessage" class="headerlink" title="onmessage"></a>onmessage</h2><p>onmessageäº‹ä»¶å›è°ƒå‡½æ•°å‚æ•°eventäº‹ä»¶å¯¹è±¡<br>event.data:postMessageä¼ è¾“è¿‡æ¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé€šå¸¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹ï¼Œä½†å¯èƒ½å‡ºç°æµè§ˆå™¨ä¸å…¼å®¹æƒ…å†µï¼Œæ‰€ä»¥ä¸€èˆ¬è½¬æˆå­—ç¬¦ä¸²ä¼ é€’ï¼‰<br>event.origin:postMessageä¼ è¾“è¿‡æ¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ç”¨æ¥åŒ¹é…æ¥æºæ–¹çš„åŸŸ<br>event.source:æ¥æºæ–¹ç›®æ ‡æ–‡æ¡£çš„windowå¼•ç”¨ï¼Œé€šå¸¸ç”¨ä½œå•æ¬¡æ¡æ‰‹å›åº”æ•°æ®ï¼ˆevent.source.postMessage()ï¼‰<br>event.ports:MessageEventæ¥å£ç‰¹æœ‰å±æ€§ï¼Œç”¨äºè·å–æ¶ˆæ¯ç«¯å£é›†åˆå¯¹è±¡</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>çˆ¶æ–‡æ¡£Aé€šè¿‡iframeå†…åµŒæ¡†æ¶åŠ è½½Bå­æ–‡æ¡£<br>é€šè¿‡iframeå†…åµŒæ¡†æ¶çš„onloadäº‹ä»¶å›è°ƒçˆ¶æ–‡æ¡£çš„sendMsgå‡½æ•°<br>å†sendMsgå‡½æ•°ä¸­é€šè¿‡postMessage()å‡½æ•°å‘å­æ–‡æ¡£Bå‘é€æ¶ˆæ¯</p>
<p>å­æ–‡æ¡£Bç›‘å¬onmessageäº‹ä»¶ï¼Œå½“æ–‡æ¡£æ”¶åˆ°æ¶ˆæ¯åä¼šæ‰§è¡Œè¯¥äº‹ä»¶å›è°ƒå‡½æ•°<br>å›è°ƒå‡½æ•°å†…é€šè¿‡eventå¯¹è±¡åˆ¤æ–­åŸŸæ˜¯å¦å®‰å…¨ï¼Œç„¶åå¤„ç†æ¨é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œ<br>å¯ä»¥å†é€šè¿‡è°ƒç”¨event.source.postMessageå‘çˆ¶æ–‡æ¡£å‘é€æ¶ˆæ¯</p>
<h1 id="åœ°ç†ä½ç½®"><a href="#åœ°ç†ä½ç½®" class="headerlink" title="åœ°ç†ä½ç½®"></a>åœ°ç†ä½ç½®</h1><p>navigator.geolocation.getCurrentPosition(success,error,option)<br>success:æˆåŠŸå¾—åˆ°ä½ç½®æ—¶çš„å›è°ƒå‡½æ•°ï¼Œä½¿ç”¨Positionå¯¹è±¡ä½œä¸ºå”¯ä¸€çš„å‚æ•°<br>error:å¤±è´¥æ—¶å›è°ƒï¼Œä½¿ç”¨PositionErrorå¯¹è±¡ä½œä¸ºå”¯ä¸€å‚æ•°<br>optionsï¼šå¯é€‰å‚æ•°ï¼Œå¯¹è¯·æ±‚åšä¸€äº›é…ç½®</p>
<h1 id="ç¦»çº¿å­˜å‚¨ä¼˜åŠ¿"><a href="#ç¦»çº¿å­˜å‚¨ä¼˜åŠ¿" class="headerlink" title="ç¦»çº¿å­˜å‚¨ä¼˜åŠ¿"></a>ç¦»çº¿å­˜å‚¨ä¼˜åŠ¿</h1><p>ç¦»çº¿æµè§ˆï¼šå½“ç”¨æˆ·ç½‘ç»œæ–­å¼€æ—¶ï¼Œå¯ä»¥ç»§ç»­è®¿é—®é¡µé¢<br>è®¿é—®é€Ÿåº¦å¿«ï¼šå°†èµ„æºç¼“å­˜åˆ°æœ¬åœ°ï¼Œå·²ç¼“å­˜èµ„æºåŠ è½½æ›´å¿«<br>å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼šæµè§ˆå™¨å°†åªä¼šä»æœåŠ¡å™¨ä¸‹è½½æ›´æ–°è¿‡æˆ–è€…æ›´æ”¹è¿‡çš„èµ„æº</p>
<h1 id="è§†é¢‘æ’­æ”¾å…¼å®¹"><a href="#è§†é¢‘æ’­æ”¾å…¼å®¹" class="headerlink" title="è§†é¢‘æ’­æ”¾å…¼å®¹"></a>è§†é¢‘æ’­æ”¾å…¼å®¹</h1><h2 id="Flv-js"><a href="#Flv-js" class="headerlink" title="Flv.js"></a>Flv.js</h2><p>H5 Flash(FLV)æ’­æ”¾å™¨,çº¯åŸç”Ÿjså¼€å‘ï¼Œä½¿H5èƒ½å¤Ÿæ”¯æŒFLVæ ¼å¼çš„è§†é¢‘<br>åŸç†ï¼šå°†FLVæ–‡ä»¶æµè½¬ç å¤ç”¨ä¸ºISO BMFF(MP4ç¢ç‰‡)ç‰‡æ®µï¼Œç„¶åé€šè¿‡Media Source Extensionå°†MP4ç‰‡æ®µæ±‡è¿›æµè§ˆå™¨<br>ä½¿ç”¨es6ç¼–å†™ï¼Œé€šè¿‡Babel Compilerç¼–è¯‘æˆes5èƒ½å¤Ÿæ”¯æŒFLVæ ¼å¼çš„è§†é¢‘</p>
<h2 id="Video-js"><a href="#Video-js" class="headerlink" title="Video.js"></a>Video.js</h2><p>å‡ ä¹å…¼å®¹æ‰€æœ‰æµè§ˆå™¨,ä¸”ä¼˜å…ˆä½¿ç”¨H5ï¼Œåœ¨ä¸æ”¯æŒçš„æµè§ˆå™¨ä¸­è‡ªåŠ¨ä½¿ç”¨Flashæ’­æ”¾<br>æ„å»ºè§†é¢‘æ’­æ”¾é¡µé¢è€—æ—¶çŸ­ï¼Œç•Œé¢å¯å®šåˆ¶ï¼Œå¼€æºï¼Œçº¯JSå’Œcsså®ç°ï¼Œæ–‡æ¡£è¯¦ç»†</p>
<p>#Canvasç»˜åˆ¶åŠ¨ç”»æ­¥éª¤<br>1.æ¸…ç©ºcanvas<br>é™¤éæ¥ä¸‹æ¥è¦ç”»çš„å†…å®¹ä¼šå®Œå…¨å……æ»¡canvas(ä¾‹å¦‚èƒŒæ™¯å›¾)ï¼Œå¦åˆ™éœ€è¦æ¸…ç©ºæ‰€æœ‰ï¼Œæœ€ç®€å•<br>çš„åšæ³•å°±æ˜¯clearRectæ–¹æ³•<br>2.ä¿å­˜canvasçŠ¶æ€<br>å¦‚æœéœ€è¦æ”¹å˜ä¸€äº›ä¼šæ”¹å˜canvasçŠ¶æ€çš„è®¾ç½®(æ ·å¼ï¼Œå˜å½¢ä¹‹ç±»çš„)ï¼Œåˆè¦åœ¨æ¯ç”»ä¸€å¸§ä¹‹æ—¶ï¼Œéƒ½æ˜¯åŸå§‹çŠ¶æ€çš„è¯ï¼Œéœ€è¦å…ˆä¿å­˜ä¸€ä¸‹<br>3.ç»˜åˆ¶åŠ¨ç”»å›¾å½¢<br>é‡ç»˜åŠ¨ç”»å¸§<br>4.æ¢å¤canvasçŠ¶æ€<br>å¦‚æœå·²ç»ä¿å­˜äº†canvasçš„çŠ¶æ€ï¼Œå¯ä»¥å…ˆæ¢å¤å®ƒï¼Œç„¶åé‡ç»˜ä¸‹ä¸€å¸§</p>
<h1 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h1><p>2DåŠŸèƒ½å‡½æ•°ç»„åˆä½¿ç”¨æ—¶ï¼Œå…ˆå†™çš„åæ‰§è¡Œ<br>perspectiveï¼š100px å¯ä»¥è®¾ç½®3dæ—‹è½¬æ—¶çš„æ™¯æ·±<br>transform-origin:å¯ä»¥æ”¹å˜ä¸­å¿ƒç‚¹</p>
<h1 id="å“åº”å¼å¸ƒå±€"><a href="#å“åº”å¼å¸ƒå±€" class="headerlink" title="å“åº”å¼å¸ƒå±€"></a>å“åº”å¼å¸ƒå±€</h1><p>å¯ä»¥é€šè¿‡linkæ ‡ç­¾é…ç½®mediaå»ä½¿ç”¨ä¸åŒæ¯”ä¾‹çš„CSSæ ·å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;link rel=&apos;stylesheet&apos; media=&apos;screen and (max-device-width:480px)&apos; href=&apos;./css1.css&apos;&gt;</div><div class="line">&lt;link rel=&apos;stylesheet&apos; media=&apos;screen and (min-device-width:480px)&apos; href=&apos;./css2.css&apos;&gt;</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/YooHannah/algorithm/blob/master/baseJs/touchEvent.js" target="_blank" rel="external">ä¸€äº›è§¦æ‘¸äº‹ä»¶çš„å®ç°</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;h5 æ–°å¢è¯­ä¹‰åŒ–å¸ƒå±€æ ‡ç­¾ï¼šheader,nav,section,aside,article,footerï¼Œå‡è¡¨ç°ä¸ºå—çº§&lt;br&gt;canvas,video,audio,sessionStorage,localStorage,&lt;br&gt;æ‹–æ”¾API(æºå¯¹è±¡ï¼šondragstart,o
    
    </summary>
    
    
      <category term="html" scheme="http://yoohannah.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›vueRouterå®˜æ–¹æ–‡æ¡£çœ‹åˆ°çš„</title>
    <link href="http://yoohannah.github.io/post/vue/vueRouter.html"/>
    <id>http://yoohannah.github.io/post/vue/vueRouter.html</id>
    <published>2019-11-28T15:06:15.000Z</published>
    <updated>2019-11-28T15:06:16.058Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¤ç”¨ç»„ä»¶"><a href="#å¤ç”¨ç»„ä»¶" class="headerlink" title="å¤ç”¨ç»„ä»¶"></a>å¤ç”¨ç»„ä»¶</h2><p>å½“ä½¿ç”¨è·¯ç”±å‚æ•°æ—¶ï¼Œä¾‹å¦‚ä» /user/foo å¯¼èˆªåˆ° /user/barï¼ŒåŸæ¥çš„ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚<br>å› ä¸ºä¸¤ä¸ªè·¯ç”±éƒ½æ¸²æŸ“åŒä¸ªç»„ä»¶ï¼Œæ¯”èµ·é”€æ¯å†åˆ›å»ºï¼Œå¤ç”¨åˆ™æ˜¾å¾—æ›´åŠ é«˜æ•ˆã€‚ä¸è¿‡ï¼Œè¿™ä¹Ÿæ„å‘³ç€ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ä¼šå†è¢«è°ƒç”¨ã€‚</p>
<p>å¤ç”¨ç»„ä»¶æ—¶ï¼Œæƒ³å¯¹è·¯ç”±å‚æ•°çš„å˜åŒ–ä½œå‡ºå“åº”çš„è¯ï¼Œå¯ä»¥ç®€å•åœ° watch (ç›‘æµ‹å˜åŒ–) $route å¯¹è±¡</p>
<p>å‚æ•°æˆ–æŸ¥è¯¢çš„æ”¹å˜å¹¶ä¸ä¼šè§¦å‘è¿›å…¥/ç¦»å¼€çš„å¯¼èˆªå®ˆå«ã€‚<br>å¯ä»¥é€šè¿‡è§‚å¯Ÿ $route å¯¹è±¡æ¥åº”å¯¹è¿™äº›å˜åŒ–ï¼Œæˆ–ä½¿ç”¨ beforeRouteUpdate çš„ç»„ä»¶å†…å®ˆå«ã€‚</p>
<h2 id="å‚æ•°ç»„åˆ"><a href="#å‚æ•°ç»„åˆ" class="headerlink" title="å‚æ•°ç»„åˆ"></a>å‚æ•°ç»„åˆ</h2><p>å¦‚æœæä¾›äº† pathï¼Œparams ä¼šè¢«å¿½ç•¥ï¼Œquery å¹¶ä¸ä¼šè¢«å¿½ç•¥ã€‚ä½ éœ€è¦æä¾›è·¯ç”±çš„ name æˆ–æ‰‹å†™å®Œæ•´çš„å¸¦æœ‰å‚æ•°çš„ path<br> pathâ€”â€“query   nameâ€”â€“params</p>
<h2 id="beforeRouteUpdate"><a href="#beforeRouteUpdate" class="headerlink" title="beforeRouteUpdate"></a>beforeRouteUpdate</h2><p>å¦‚æœç›®çš„åœ°å’Œå½“å‰è·¯ç”±ç›¸åŒï¼Œåªæœ‰å‚æ•°å‘ç”Ÿäº†æ”¹å˜ (æ¯”å¦‚ä»ä¸€ä¸ªç”¨æˆ·èµ„æ–™åˆ°å¦ä¸€ä¸ª /users/1 -&gt; /users/2)ï¼Œä½ éœ€è¦ä½¿ç”¨ beforeRouteUpdate æ¥å“åº”è¿™ä¸ªå˜åŒ– (æ¯”å¦‚æŠ“å–ç”¨æˆ·ä¿¡æ¯)</p>
<h2 id="router-viewæ ‡ç­¾"><a href="#router-viewæ ‡ç­¾" class="headerlink" title="router-viewæ ‡ç­¾"></a>router-viewæ ‡ç­¾</h2><p><router-view> æ²¡æœ‰è®¾ç½®åå­—ï¼Œé‚£ä¹ˆé»˜è®¤ä¸º defaultï¼›å¦‚æœè®¾ç½®äº†nameï¼Œé‚£ä¹ˆè¯¥è§†å›¾æ˜¾ç¤ºè·¯ç”±ä¸­componentsä¸­é…ç½®çš„nameå€¼å¯¹åº”çš„ç»„ä»¶</router-view></p>
<h2 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h2><p>é‡å®šå‘ä¸‰ç§å½¢å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">1.</div><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/a&apos;, redirect: &apos;/b&apos; &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line">2.å‘½åçš„è·¯ç”±</div><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/a&apos;, redirect: &#123; name: &apos;foo&apos; &#125;&#125;</div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line">3.æ–¹æ³•ï¼ŒåŠ¨æ€è¿”å›é‡å®šå‘ç›®æ ‡ï¼š</div><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/a&apos;, redirect: to =&gt; &#123;</div><div class="line">      // æ–¹æ³•æ¥æ”¶ ç›®æ ‡è·¯ç”± ä½œä¸ºå‚æ•°</div><div class="line">      // return é‡å®šå‘çš„ å­—ç¬¦ä¸²è·¯å¾„/è·¯å¾„å¯¹è±¡</div><div class="line">    &#125;&#125;</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>å¯¼èˆªå®ˆå«å¹¶æ²¡æœ‰åº”ç”¨åœ¨è·³è½¬è·¯ç”±ä¸Šï¼Œè€Œä»…ä»…åº”ç”¨åœ¨å…¶ç›®æ ‡ä¸Š,ä¸º /a è·¯ç”±æ·»åŠ ä¸€ä¸ª beforeEach æˆ– beforeLeave å®ˆå«å¹¶ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœ</p>
<p>â€œé‡å®šå‘â€çš„æ„æ€æ˜¯ï¼Œå½“ç”¨æˆ·è®¿é—® /aæ—¶ï¼ŒURL å°†ä¼šè¢«æ›¿æ¢æˆ /bï¼Œç„¶ååŒ¹é…è·¯ç”±ä¸º /bï¼Œ<br>/a çš„åˆ«åæ˜¯ /bï¼Œæ„å‘³ç€ï¼Œå½“ç”¨æˆ·è®¿é—® /b æ—¶ï¼ŒURL ä¼šä¿æŒä¸º /bï¼Œä½†æ˜¯è·¯ç”±åŒ¹é…åˆ™ä¸º /aï¼Œå°±åƒç”¨æˆ·è®¿é—® /a ä¸€æ ·ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/a&apos;, component: A, alias: &apos;/b&apos; &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>é€šè¿‡é…ç½®propså±æ€§å®ç°å¤šè·¯ç”±å¤ç”¨ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">1.å¦‚æœ props è¢«è®¾ç½®ä¸º trueï¼Œroute.params å°†ä¼šè¢«è®¾ç½®ä¸ºç»„ä»¶å±æ€§ã€‚</div><div class="line">const User = &#123;</div><div class="line">  props: [&apos;id&apos;],</div><div class="line">  template: &apos;&lt;div&gt;User &#123;&#123; id &#125;&#125;&lt;/div&gt;&apos;</div><div class="line">&#125;</div><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/user/:id&apos;, component: User, props: true &#125;,</div><div class="line"></div><div class="line">    // å¯¹äºåŒ…å«å‘½åè§†å›¾çš„è·¯ç”±ï¼Œä½ å¿…é¡»åˆ†åˆ«ä¸ºæ¯ä¸ªå‘½åè§†å›¾æ·»åŠ  `props` é€‰é¡¹ï¼š</div><div class="line">    &#123;</div><div class="line">      path: &apos;/user/:id&apos;,</div><div class="line">      components: &#123; default: User, sidebar: Sidebar &#125;,</div><div class="line">      props: &#123; default: true, sidebar: false &#125;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line">2.å¦‚æœ props æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¼šè¢«æŒ‰åŸæ ·è®¾ç½®ä¸ºç»„ä»¶å±æ€§ã€‚å½“ props æ˜¯é™æ€çš„æ—¶å€™æœ‰ç”¨</div><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/promotion/from-newsletter&apos;, component: Promotion, props: &#123; newsletterPopup: false &#125; &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line">3.åˆ›å»ºä¸€ä¸ªå‡½æ•°è¿”å› props</div><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123; path: &apos;/search&apos;, component: SearchUser, props: (route) =&gt; (&#123; query: route.query.q &#125;) &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line">URL /search?q=vue ä¼šå°† &#123;query: &apos;vue&apos;&#125; ä½œä¸ºå±æ€§ä¼ é€’ç»™ SearchUser ç»„ä»¶</div></pre></td></tr></table></figure></p>
<p>è¯·å°½å¯èƒ½ä¿æŒ props å‡½æ•°ä¸ºæ— çŠ¶æ€çš„ï¼Œå› ä¸ºå®ƒåªä¼šåœ¨è·¯ç”±å‘ç”Ÿå˜åŒ–æ—¶èµ·ä½œç”¨ã€‚å¦‚æœä½ éœ€è¦çŠ¶æ€æ¥å®šä¹‰ propsï¼Œè¯·ä½¿ç”¨åŒ…è£…ç»„ä»¶ï¼Œè¿™æ · Vue æ‰å¯ä»¥å¯¹çŠ¶æ€å˜åŒ–åšå‡ºååº”</p>
<h2 id="è·¯ç”±ç”Ÿå‘½å‘¨æœŸ"><a href="#è·¯ç”±ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="è·¯ç”±ç”Ÿå‘½å‘¨æœŸ"></a>è·¯ç”±ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><p>router.beforeEach:å½“ä¸€ä¸ªå¯¼èˆªè§¦å‘æ—¶ï¼Œå…¨å±€å‰ç½®å®ˆå«æŒ‰ç…§åˆ›å»ºé¡ºåºè°ƒç”¨ã€‚å®ˆå«æ˜¯å¼‚æ­¥è§£ææ‰§è¡Œï¼Œæ­¤æ—¶å¯¼èˆªåœ¨æ‰€æœ‰å®ˆå« resolve å®Œä¹‹å‰ä¸€ç›´å¤„äº ç­‰å¾…ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ä¸‰ä¸ªå‚æ•°</div><div class="line">to: å³å°†è¦è¿›å…¥çš„ç›®æ ‡ è·¯ç”±å¯¹è±¡</div><div class="line">from: å½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„è·¯ç”±çš„è·¯ç”±å¯¹è±¡</div><div class="line">nextï¼šä¸€å®šè¦è°ƒç”¨è¯¥æ–¹æ³•æ¥ resolve è¿™ä¸ªé’©å­ã€‚æ‰§è¡Œæ•ˆæœä¾èµ– next æ–¹æ³•çš„è°ƒç”¨å‚æ•°</div><div class="line">      next(): è¿›è¡Œç®¡é“ä¸­çš„ä¸‹ä¸€ä¸ªé’©å­ã€‚å¦‚æœå…¨éƒ¨é’©å­æ‰§è¡Œå®Œäº†ï¼Œåˆ™å¯¼èˆªçš„çŠ¶æ€å°±æ˜¯ confirmed (ç¡®è®¤çš„)ã€‚</div><div class="line">      next(false): ä¸­æ–­å½“å‰çš„å¯¼èˆªã€‚å¦‚æœæµè§ˆå™¨çš„ URL æ”¹å˜äº† (å¯èƒ½æ˜¯ç”¨æˆ·æ‰‹åŠ¨æˆ–è€…æµè§ˆå™¨åé€€æŒ‰é’®)ï¼Œé‚£ä¹ˆ URL åœ°å€ä¼šé‡ç½®åˆ° from è·¯ç”±å¯¹åº”çš„åœ°å€ã€‚</div><div class="line">      next(&apos;/&apos;) æˆ–è€… next(&#123; path: &apos;/&apos; &#125;): è·³è½¬åˆ°ä¸€ä¸ªä¸åŒçš„åœ°å€ã€‚å½“å‰çš„å¯¼èˆªè¢«ä¸­æ–­ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªæ–°çš„å¯¼èˆªã€‚</div><div class="line">      next(error): å¦‚æœä¼ å…¥ next çš„å‚æ•°æ˜¯ä¸€ä¸ª Error å®ä¾‹ï¼Œåˆ™å¯¼èˆªä¼šè¢«ç»ˆæ­¢ä¸”è¯¥é”™è¯¯ä¼šè¢«ä¼ é€’ç»™ router.onError() æ³¨å†Œè¿‡çš„å›è°ƒ</div></pre></td></tr></table></figure></p>
<p>router.beforeResolve:åœ¨å¯¼èˆªè¢«ç¡®è®¤ä¹‹å‰ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰ç»„ä»¶å†…å®ˆå«å’Œå¼‚æ­¥è·¯ç”±ç»„ä»¶è¢«è§£æä¹‹åï¼Œè§£æå®ˆå«å°±è¢«è°ƒç”¨</p>
<p>router.afterEach:ä¸ä¼šæ¥å— next å‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜å¯¼èˆªæœ¬èº«</p>
<h3 id="è·¯ç”±é…ç½®"><a href="#è·¯ç”±é…ç½®" class="headerlink" title="è·¯ç”±é…ç½®"></a>è·¯ç”±é…ç½®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [</div><div class="line">    &#123;</div><div class="line">      path: &apos;/foo&apos;,</div><div class="line">      component: Foo,</div><div class="line">      beforeEnter: (to, from, next) =&gt; &#123;</div><div class="line">        // ...</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="ç»„ä»¶å†…"><a href="#ç»„ä»¶å†…" class="headerlink" title="ç»„ä»¶å†…"></a>ç»„ä»¶å†…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">const Foo = &#123;</div><div class="line">  template: `...`,</div><div class="line">  beforeRouteEnter (to, from, next) &#123;</div><div class="line">    // åœ¨æ¸²æŸ“è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±è¢« confirm å‰è°ƒç”¨</div><div class="line">    // ä¸ï¼èƒ½ï¼è·å–ç»„ä»¶å®ä¾‹ `this` </div><div class="line">    // å› ä¸ºå®ˆå«åœ¨å¯¼èˆªç¡®è®¤å‰è¢«è°ƒç”¨,å› æ­¤å³å°†ç™»åœºçš„æ–°ç»„ä»¶è¿˜æ²¡è¢«åˆ›å»ºã€‚</div><div class="line">    //å¯ä»¥é€šè¿‡ä¼ ä¸€ä¸ªå›è°ƒç»™ nextæ¥è®¿é—®ç»„ä»¶å®ä¾‹ã€‚åœ¨å¯¼èˆªè¢«ç¡®è®¤çš„æ—¶å€™æ‰§è¡Œå›è°ƒï¼Œå¹¶ä¸”æŠŠç»„ä»¶å®ä¾‹ä½œä¸ºå›è°ƒæ–¹æ³•çš„å‚æ•°ã€‚</div><div class="line">    next(vm =&gt; &#123; //æ˜¯æ”¯æŒç»™ next ä¼ é€’å›è°ƒçš„å”¯ä¸€é’©å­ï¼ŒbeforeRouteUpdateï¼ŒbeforeRouteLeaveéƒ½ä¸æ”¯æŒï¼Œå› ä¸ºå¯ä»¥è®¿é—®çš„åˆ°</div><div class="line">      // é€šè¿‡ `vm` è®¿é—®ç»„ä»¶å®ä¾‹</div><div class="line">    &#125;)</div><div class="line">  &#125;,</div><div class="line">  beforeRouteUpdate (to, from, next) &#123;</div><div class="line">    // åœ¨å½“å‰è·¯ç”±æ”¹å˜ï¼Œä½†æ˜¯è¯¥ç»„ä»¶è¢«å¤ç”¨æ—¶è°ƒç”¨</div><div class="line">    // ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå¸¦æœ‰åŠ¨æ€å‚æ•°çš„è·¯å¾„ /foo/:idï¼Œåœ¨ /foo/1 å’Œ /foo/2 ä¹‹é—´è·³è½¬çš„æ—¶å€™ï¼Œ</div><div class="line">    // ç”±äºä¼šæ¸²æŸ“åŒæ ·çš„ Foo ç»„ä»¶ï¼Œå› æ­¤ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚è€Œè¿™ä¸ªé’©å­å°±ä¼šåœ¨è¿™ä¸ªæƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚</div><div class="line">    // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`</div><div class="line">  &#125;,</div><div class="line">  beforeRouteLeave (to, from, next) &#123;</div><div class="line">    // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</div><div class="line">    // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹"><a href="#å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹" class="headerlink" title="å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹"></a>å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹</h3><ol>
<li>å¯¼èˆªè¢«è§¦å‘ã€‚</li>
<li>åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ç¦»å¼€å®ˆå«ã€‚</li>
<li>è°ƒç”¨å…¨å±€çš„ beforeEach å®ˆå«ã€‚</li>
<li>åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteUpdate å®ˆå« (2.2+)ã€‚</li>
<li>åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ beforeEnterã€‚</li>
<li>è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚</li>
<li>åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteEnterã€‚</li>
<li>è°ƒç”¨å…¨å±€çš„ beforeResolve å®ˆå« (2.5+)ã€‚</li>
<li>å¯¼èˆªè¢«ç¡®è®¤ã€‚</li>
<li>è°ƒç”¨å…¨å±€çš„ afterEach é’©å­ã€‚</li>
<li>è§¦å‘ DOM æ›´æ–°ã€‚</li>
<li>ç”¨åˆ›å»ºå¥½çš„å®ä¾‹è°ƒç”¨ beforeRouteEnter å®ˆå«ä¸­ä¼ ç»™ next çš„å›è°ƒå‡½æ•°ã€‚</li>
</ol>
<h2 id="æ•°æ®è·å–"><a href="#æ•°æ®è·å–" class="headerlink" title="æ•°æ®è·å–"></a>æ•°æ®è·å–</h2><h3 id="å¯¼èˆªå®Œæˆåè·å–æ•°æ®"><a href="#å¯¼èˆªå®Œæˆåè·å–æ•°æ®" class="headerlink" title="å¯¼èˆªå®Œæˆåè·å–æ•°æ®"></a>å¯¼èˆªå®Œæˆåè·å–æ•°æ®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">created () &#123;</div><div class="line">  // ç»„ä»¶åˆ›å»ºå®Œåè·å–æ•°æ®ï¼Œ</div><div class="line">  // æ­¤æ—¶ data å·²ç»è¢« observed äº†</div><div class="line">  this.fetchData()</div><div class="line">&#125;,</div><div class="line">watch: &#123;</div><div class="line">  // å¦‚æœè·¯ç”±æœ‰å˜åŒ–ï¼Œä¼šå†æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•</div><div class="line">  &apos;$route&apos;: &apos;fetchData&apos;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<h3 id="åœ¨å¯¼èˆªå®Œæˆå‰è·å–æ•°æ®"><a href="#åœ¨å¯¼èˆªå®Œæˆå‰è·å–æ•°æ®" class="headerlink" title="åœ¨å¯¼èˆªå®Œæˆå‰è·å–æ•°æ®"></a>åœ¨å¯¼èˆªå®Œæˆå‰è·å–æ•°æ®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">beforeRouteEnter (to, from, next) &#123;</div><div class="line">  getPost(to.params.id, (err, post) =&gt; &#123;</div><div class="line">    next(vm =&gt; vm.setData(err, post))</div><div class="line">  &#125;)</div><div class="line">&#125;,</div><div class="line">// è·¯ç”±æ”¹å˜å‰ï¼Œç»„ä»¶å°±å·²ç»æ¸²æŸ“å®Œäº†</div><div class="line">// é€»è¾‘ç¨ç¨ä¸åŒ</div><div class="line">beforeRouteUpdate (to, from, next) &#123;</div><div class="line">  this.post = null</div><div class="line">  getPost(to.params.id, (err, post) =&gt; &#123;</div><div class="line">    this.setData(err, post)</div><div class="line">    next()</div><div class="line">  &#125;)</div><div class="line">&#125;,</div><div class="line">methods: &#123;</div><div class="line">  setData (err, post) &#123;</div><div class="line">    if (err) &#123;</div><div class="line">      this.error = err.toString()</div><div class="line">    &#125; else &#123;</div><div class="line">      this.post = post</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æ»šåŠ¨è¡Œä¸º"><a href="#æ»šåŠ¨è¡Œä¸º" class="headerlink" title="æ»šåŠ¨è¡Œä¸º"></a>æ»šåŠ¨è¡Œä¸º</h2><p>scrollBehavior è¿™ä¸ªåŠŸèƒ½åªåœ¨æ”¯æŒ history.pushState çš„æµè§ˆå™¨ä¸­å¯ç”¨ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">const router = new VueRouter(&#123;</div><div class="line">  routes: [...],</div><div class="line">  scrollBehavior (to, from, savedPosition) &#123;</div><div class="line"></div><div class="line">    // return æœŸæœ›æ»šåŠ¨åˆ°å“ªä¸ªçš„ä½ç½®</div><div class="line">    if (to.hash) &#123;</div><div class="line">      return &#123;</div><div class="line">        selector: to.hash //æ¨¡æ‹Ÿâ€œæ»šåŠ¨åˆ°é”šç‚¹â€çš„è¡Œä¸º</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    if (savedPosition) &#123;</div><div class="line">      return savedPosition //è¿”å› savedPositionï¼Œåœ¨æŒ‰ä¸‹ åé€€/å‰è¿› æŒ‰é’®æ—¶ï¼Œå°±ä¼šåƒæµè§ˆå™¨çš„åŸç”Ÿè¡¨ç°é‚£æ ·</div><div class="line">    &#125; else &#123;</div><div class="line">      return &#123; x: 0, y: 0 &#125; //è®©é¡µé¢æ»šåŠ¨åˆ°é¡¶éƒ¨</div><div class="line">    &#125;</div><div class="line">    return new Promise((resolve, reject) =&gt; &#123; //è¿”å›ä¸€ä¸ª Promise æ¥å¾—å‡ºé¢„æœŸçš„ä½ç½®æè¿°</div><div class="line">      setTimeout(() =&gt; &#123;</div><div class="line">        resolve(&#123; x: 0, y: 0 &#125;)</div><div class="line">      &#125;, 500)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¤ç”¨ç»„ä»¶&quot;&gt;&lt;a href=&quot;#å¤ç”¨ç»„ä»¶&quot; class=&quot;headerlink&quot; title=&quot;å¤ç”¨ç»„ä»¶&quot;&gt;&lt;/a&gt;å¤ç”¨ç»„ä»¶&lt;/h2&gt;&lt;p&gt;å½“ä½¿ç”¨è·¯ç”±å‚æ•°æ—¶ï¼Œä¾‹å¦‚ä» /user/foo å¯¼èˆªåˆ° /user/barï¼ŒåŸæ¥çš„ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚&lt;br&gt;å› ä¸ºä¸¤ä¸ªè·¯ç”±éƒ½æ¸²æŸ“
    
    </summary>
    
    
      <category term="vue" scheme="http://yoohannah.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ä¸¤ä¸ªcssé—®é¢˜è§£å†³</title>
    <link href="http://yoohannah.github.io/post/knowledge/calcApprence.html"/>
    <id>http://yoohannah.github.io/post/knowledge/calcApprence.html</id>
    <published>2019-11-28T14:58:58.000Z</published>
    <updated>2020-01-27T12:38:29.572Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å­å…ƒç´ -position-fixed-ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´"><a href="#å­å…ƒç´ -position-fixed-ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´" class="headerlink" title="å­å…ƒç´  position:fixed ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´"></a>å­å…ƒç´  position:fixed ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>çˆ¶å…ƒç´ å®½åº¦éšå±å¹•å¤§å°å˜åŒ–ï¼Œè€Œä¸”margin-leftæœ‰ä¸€ä¸ªå›ºå®šå€¼ï¼Œå‡è®¾ä¸º320px<br>å­å…ƒç´ position:fixed<br>å¦‚æœç›´æ¥è®¾ç½®å­å…ƒç´ å®½åº¦ä¸º100%<br>åˆ™ä¼šå¯¼è‡´å­å…ƒç´ æœ‰320pxçš„å®½åº¦åœ¨å¯è§†åŒºåŸŸå¤–<br><img src="/image/calc.png" alt="calc.png"></p>
<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p>css3çš„å‡½æ•°calc() å¯ä»¥ç”¨æ¥è®¡ç®—å±æ€§å€¼<br>ç‰¹ç‚¹ï¼š<br>1.æµè§ˆå™¨è§£æcalc()ç»“æœè¿˜æ˜¯calc(),ä¸ä¼šè®¡ç®—å‚æ•°è¡¨è¾¾å¼çš„å€¼ï¼Œ<br>  æ„å‘³ç€æµè§ˆå™¨ä¸­çš„å€¼å¯ä»¥æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿå“åº”è§†å£çš„æ”¹å˜ï¼Œå³å®é™…æ¸²æŸ“ç»“æœå§‹ç»ˆè°ƒç”¨calcè®¡ç®—ç»“æœ<br>2.å¯ä»¥ä½¿ç”¨åŠ å‡ä¹˜é™¤ï¼Œå¯ä»¥å¥—åµŒä½¿ç”¨ï¼Œå³calcå‚æ•°è¡¨è¾¾å¼ä¸­å¯ä»¥åŒ…å«calcå‡½æ•°è°ƒç”¨<br>3.å¯ä»¥è¿›è¡Œä¸åŒå•ä½é—´çš„è®¡ç®—,å¯ä»¥æ··åˆç»å¯¹å•ä½(å¦‚ç™¾åˆ†æ¯”ä¸è§†å£å•å…ƒ)ä¸ç›¸å¯¹å•å…ƒ(æ¯”å¦‚åƒç´ )<br>åº”ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">1.å±…ä¸­</div><div class="line">//å±…ä¸­è®¾ç½®åŸæ¥</div><div class="line">.center &#123;</div><div class="line">  position: absolute</div><div class="line">  top: 50%;</div><div class="line">  left: 50%;</div><div class="line">  marging-top: -150px;</div><div class="line">  margin-left: -150px;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//ä½¿ç”¨calc</div><div class="line">.center &#123;</div><div class="line">  position: absolute</div><div class="line">  top: calc(50% - 150px);</div><div class="line">  left: calc(50% - 150px);</div><div class="line">&#125;</div><div class="line"></div><div class="line">2.è®¾ç½®å­—ä½“ï¼Œåœ¨é¡µé¢ä¸Šçš„ä»»ä½•æ–‡æœ¬ï¼Œå°†ä¼šæ ¹æ®è§†å£è‡ªåŠ¨ç¼©æ”¾ï¼Œ</div><div class="line">ç›¸åŒæ¯”ä¾‹çš„è§†å£æ€»ä¼šæ˜¾ç¤ºç›¸åŒçš„æ–‡æœ¬æ•°é‡ï¼Œä¸ç®¡è§†å£çš„çœŸå®å°ºå¯¸æ˜¯å¤šå°‘ã€‚</div><div class="line">html &#123;  </div><div class="line">    font-size: calc(100vw / 30);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">width:calc(100%-320px)</div></pre></td></tr></table></figure>
<h1 id="inputæ ·å¼å…¼å®¹"><a href="#inputæ ·å¼å…¼å®¹" class="headerlink" title="inputæ ·å¼å…¼å®¹"></a>inputæ ·å¼å…¼å®¹</h1><p>åœ¨safariæµè§ˆå™¨ä¸­ç»™inputè®¾ç½®æ ·å¼ä¸èƒ½ç›´æ¥è¢«ä½¿ç”¨ï¼Œä¼šä¾æ—§ä½¿ç”¨æµè§ˆå™¨é»˜è®¤æ ·å¼ï¼Œ<br>æ­¤æ—¶éœ€è¦ç»™æ ·å¼æ·»åŠ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-webkit-appearance: none;/*å»é™¤ç³»ç»Ÿé»˜è®¤appearanceçš„æ ·å¼*/</div><div class="line">line-height: normal;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å­å…ƒç´ -position-fixed-ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´&quot;&gt;&lt;a href=&quot;#å­å…ƒç´ -position-fixed-ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´&quot; class=&quot;headerlink&quot; title=&quot;å­å…ƒç´  position:fixed ï¼Œä½†å®½åº¦è¦å’Œçˆ¶å…ƒç´ ä¸€è‡´&quot;&gt;
    
    </summary>
    
    
      <category term="css" scheme="http://yoohannah.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºä»£ç†proxy</title>
    <link href="http://yoohannah.github.io/post/js/proxy.html"/>
    <id>http://yoohannah.github.io/post/js/proxy.html</id>
    <published>2019-11-08T14:19:37.000Z</published>
    <updated>2019-12-18T14:34:42.882Z</updated>
    
    <content type="html"><![CDATA[<p>ä»£ç†æ˜¯JS es6ä¸­å¼•å…¥ï¼Œå¯ç”¨äºæ§åˆ¶å¯¹è±¡<br>â€”ä»£ç†å¯ä»¥å®šåˆ¶å¯¹è±¡äº¤äº’æ—¶è¡ŒåŠ¨ï¼ˆä¾‹å¦‚ï¼Œå½“è¯»å–å±æ€§æˆ–è°ƒç”¨æ–¹æ³•ï¼‰<br>â€” æ‰€æœ‰äº¤äº’è¡Œä¸ºéƒ½å¿…é¡»é€šè¿‡ä»£ç†ï¼ŒæŒ‡å®šçš„è¡Œä¸ºå‘ç”Ÿæ—¶ä¼šè°ƒç”¨ä»£ç†æ–¹æ³•<br>ä½¿ç”¨ä»£ç†å¯ä»¥ä¼˜é›…å®ç°ä»¥ä¸‹å†…å®¹</p>
<ul>
<li>æ—¥å¿—è®°å½•</li>
<li>æ€§èƒ½æµ‹è¯•</li>
<li>æ•°æ®æ ¡éªŒ</li>
<li>è‡ªåŠ¨å¡«å……å¯¹è±¡å±æ€§</li>
<li>æ•°ç»„è´Ÿç´¢å¼•</li>
</ul>
<p>ä½¿ç”¨ä»£ç†å¯¹å¯¹è±¡è®¿é—®æ·»åŠ æ—¥å¿— â€” report å‡½æ•°ç”¨äºæ·»åŠ æ—¥å¿—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function makeLoggable(target)&#123;</div><div class="line">	return new Proxy(target,&#123;</div><div class="line">		get:(target,property)=&gt;&#123;</div><div class="line">			report(&apos;READING:&apos;+property)</div><div class="line">			return target[property]</div><div class="line">		&#125;,</div><div class="line">		set:(target,property,value)=&gt;&#123;</div><div class="line">			report(&apos;writing value&apos; +value +&apos;to&apos;+&apos;property&apos;)</div><div class="line">			target[property] = value</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>proxy ç”¨äºæ•°æ®æ ¡éªŒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">var personValidator = &#123;</div><div class="line">    name(val)&#123;</div><div class="line">        return typeof val === &apos;string&apos;</div><div class="line">    &#125;</div><div class="line">    age(val)&#123;</div><div class="line">        return typeof val === &apos;number&apos; &amp;&amp; val&gt;18</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">class person&#123;</div><div class="line">    constructor(name,age)&#123;</div><div class="line">        this.name = name;</div><div class="line">        this.age = age;</div><div class="line">        return createValidator(this,personValidator)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">function createValidator(target,validator)&#123;</div><div class="line">    return new Proxy(target,&#123;</div><div class="line">        _validator:validator,</div><div class="line">        set(target,key,value,proxy)&#123;</div><div class="line">            if(target.hasOwnproperty(key))&#123;</div><div class="line">                var validator = this._validator[key]</div><div class="line">                if(validator(value))&#123;</div><div class="line">                    return Reflect.set(target,key,value,proxy)</div><div class="line">                &#125;else&#123;</div><div class="line">                    throw Error(&apos;type error&apos;)</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä»£ç†è‡ªåŠ¨å¡«å……å±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">function Folder()&#123;</div><div class="line">	return new Proxy(&#123;&#125;,&#123;</div><div class="line">		get:(target,property)=&gt;&#123;</div><div class="line">			if(!(property in target))&#123;</div><div class="line">				target[property] = new Folder()</div><div class="line">			&#125;</div><div class="line">			return target[property]</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">const rootFolder = new Folder()</div><div class="line">try &#123;</div><div class="line">	rootFolder.ninjasDir.firstNinjaDir.ninjaFile = &apos;yoshi.txt&apos;</div><div class="line">&#125;catch(e)&#123;</div><div class="line">	console.log(e)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ä»£ç†å®ç°æ•°ç»„è´Ÿå¼•ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">function creatNegativeArrayProxy(array)&#123;</div><div class="line">	if(!Array.isArray(array))&#123;</div><div class="line">		throw new TypeError(&apos;expected an array&apos;)</div><div class="line">	&#125;</div><div class="line">	return new Proxy(array,&#123;</div><div class="line">		get:(target,index)=&gt;&#123;</div><div class="line">			index = +index</div><div class="line">			return target[index&lt;0?target.length+index:index]</div><div class="line">		&#125;,</div><div class="line">		set:(target,index,val)=&gt;&#123;</div><div class="line">			index = +index</div><div class="line">			return target[index&lt;0?target.length+index:index] = val</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">const ninja = [1,2,3]</div><div class="line">const proxi = creatNegativeArrayProxy(ninja)</div><div class="line">console.log(proxi[-1]) //==&gt; 3</div><div class="line">proxi[-2] = 22 // ninja ==&gt;1,22,3</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»£ç†æ˜¯JS es6ä¸­å¼•å…¥ï¼Œå¯ç”¨äºæ§åˆ¶å¯¹è±¡&lt;br&gt;â€”ä»£ç†å¯ä»¥å®šåˆ¶å¯¹è±¡äº¤äº’æ—¶è¡ŒåŠ¨ï¼ˆä¾‹å¦‚ï¼Œå½“è¯»å–å±æ€§æˆ–è°ƒç”¨æ–¹æ³•ï¼‰&lt;br&gt;â€” æ‰€æœ‰äº¤äº’è¡Œä¸ºéƒ½å¿…é¡»é€šè¿‡ä»£ç†ï¼ŒæŒ‡å®šçš„è¡Œä¸ºå‘ç”Ÿæ—¶ä¼šè°ƒç”¨ä»£ç†æ–¹æ³•&lt;br&gt;ä½¿ç”¨ä»£ç†å¯ä»¥ä¼˜é›…å®ç°ä»¥ä¸‹å†…å®¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¥å¿—è®°å½•&lt;/li&gt;
&lt;li&gt;æ€§èƒ½æµ‹
    
    </summary>
    
    
      <category term="js" scheme="http://yoohannah.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>absoluteåº”ç”¨</title>
    <link href="http://yoohannah.github.io/post/knowledge/cssPosition.html"/>
    <id>http://yoohannah.github.io/post/knowledge/cssPosition.html</id>
    <published>2019-09-22T23:54:58.000Z</published>
    <updated>2019-09-23T15:19:25.905Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜-èƒŒæ™¯"><a href="#é—®é¢˜-èƒŒæ™¯" class="headerlink" title="é—®é¢˜/èƒŒæ™¯"></a>é—®é¢˜/èƒŒæ™¯</h1><p>table çš„ td å†…å®¹åœ¨å†…å®¹è¾ƒå¤šæ—¶ä¼šè‡ªåŠ¨è¿›è¡Œçœç•¥å¤„ç†ï¼Œç„¶åé¼ æ ‡æ»‘è¿‡å¼¹å±‚æ˜¾ç¤ºå…·ä½“å†…å®¹</p>
<p>tdå†…å®¹è¿˜å¯ä»¥é…ç½®åœ¨çº¿ç¼–è¾‘ï¼Œé¼ æ ‡æ»‘è¿‡ï¼Œå¯ä»¥æ˜¾ç¤ºå°ç¬”å›¾æ ‡ï¼Œç‚¹å‡»å°ç¬”å›¾æ ‡æˆ–è€…tdå—éƒ½å¯ä»¥è¿›è¡Œåœ¨çº¿ç¼–è¾‘ç„¶åå›è½¦æˆ–è€…é¼ æ ‡ç‚¹å‡»è¾“å…¥æ¡†ä¹‹å¤–çš„åœ°æ–¹éƒ½å¯ä»¥æäº¤å‘é€ç»™åå°</p>
<p>tableè¢«åŒ…è£¹åœ¨ä¸€ä¸ªdiv1ä¸­,åªå…è®¸å‡ºç°æ°´å¹³æ–¹å‘æ»šåŠ¨æ¡ï¼Œä¸å‡ºç°å‚ç›´æ–¹å‘æ»šåŠ¨æ¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">.div1&#123;</div><div class="line">  overflow-x: auto;</div><div class="line">  overflow-y: hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å‡ºç°çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚æœæœ€åå‡ è¡Œçš„å†…å®¹è¿‡å¤šï¼Œå¼¹å±‚æ˜¾ç¤ºå…·ä½“å†…å®¹æ—¶å¼¹å±‚ä¼šè¢«é®æŒ¡ï¼Œä¸èƒ½æ­£å¸¸é£˜å‡ºæ¥<br><img src="/image/position1.png" alt="position1.png"></p>
<h1 id="åŸç†çŸ¥è¯†"><a href="#åŸç†çŸ¥è¯†" class="headerlink" title="åŸç†çŸ¥è¯†"></a>åŸç†çŸ¥è¯†</h1><p>çˆ¶å…ƒç´ è®¾ç½®position:relative,å­å…ƒç´ è®¾ç½®position:absolute,é…å¥—ä½¿ç”¨æ—¶ï¼Œå­å…ƒç´ æ‰ä¼šä¼šåœ¨zè½´ä¸Šç›¸å¯¹çˆ¶å…ƒç´ è¿›è¡Œxyé¢çš„å®šä½<br>å¦‚æœæœ€è¿‘çˆ¶å…ƒç´ æ²¡æœ‰è®¾ç½®position:relativeï¼Œé‚£ä¹ˆä¼šå¾€çˆ¶å…ƒç´ çš„çˆ¶å…ƒç´ æ‰¾ï¼Œçœ‹æ˜¯å¦è®¾ç½®ï¼Œå¦‚æœè®¾ç½®ï¼Œåˆ™ç›¸å¯¹çˆ·çˆ·å…ƒç´ è¿›è¡ŒXYé¢å®šä½ï¼Œå¦‚æœæ²¡æœ‰ç»§ç»­å¾€ä¸Šæ‰¾ï¼Œä»¥æ­¤ç±»æ¨<br>å³ä¼šç›¸å¯¹çˆ¶å…ƒç´ åŠä»¥ä¸Šå…ƒç´ ä¸­é è¿‘è‡ªå·±æœ€è¿‘çš„ï¼Œè®¾ç½®äº†position:relativeçš„é•¿è¾ˆå…ƒç´ è¿›è¡Œç›¸å¯¹å®šä½</p>
<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>å¼¹å±‚æ²¡æœ‰æŒ‰ç…§é¢„æœŸå¯ä»¥å¼¹åˆ°div1ä»¥å¤–çš„åœ°æ–¹,è¢«å›°åœ¨div1é‡Œé¢ï¼ŒåŠ ä¸Šdiv1ä¸èƒ½å‚ç›´æ–¹å‘æ»šåŠ¨ï¼Œè¯´æ˜å¼¹å±‚æ²¡æœ‰ç›¸å¯¹div1å®šä½,<br>è§£é™¤div1å‚ç›´æ–¹å‘çš„æ»šåŠ¨é™åˆ¶ï¼Œå¼¹å±‚æŠŠdiv1åœ¨å‚ç›´æ–¹å‘ä¸Šæ’‘èµ·æ¥äº†ï¼Œæ»šåŠ¨æ»šåŠ¨æ¡ï¼Œå¯ä»¥çœ‹å®Œæ•´çš„å¼¹å±‚å†…å®¹ï¼Œè¯´æ˜å¼¹å±‚ç›¸å¯¹div1çš„å­å…ƒç´ å®šä½äº†ï¼Œ<br>å³ä»ç››è£…çœç•¥å†…å®¹çš„æ ‡ç­¾åˆ°div1çš„æ ‡ç­¾ä¸­ï¼Œæœ‰æ ‡ç­¾è®¾ç½®äº†position:relativeï¼Œ</p>
<p>é€šè¿‡æŸ¥æ‰¾å‘ç°ï¼Œåœ¨çº¿ç¼–è¾‘åŠŸèƒ½çš„å°ç¬”å›¾æ ‡ä½¿ç”¨äº†position:absoluteç›¸å¯¹å®šä½ï¼Œåœ¨å®ƒæœ€è¿‘çš„div2æ ‡ç­¾ä¸Šè®¾ç½®äº†position:relativeï¼Œ<br>è€Œdiv2æ ‡ç­¾åŒ…å«äº†å¼¹å±‚æ‰€åœ¨æ ‡ç­¾ï¼Œå±äºdiv1å­å…ƒç´ ï¼Œæ‰€ä»¥å¼¹å±‚å°±ä¼šç›¸å¯¹div2å®šä½ï¼Œæ²¿Zè½´é£˜åœ¨div2è¿™ä¸€å±‚ä¸Šé¢ï¼Œå°±å¼¹ä¸åˆ°div1ä»¥å¤–äº†</p>
<h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><p>å°†div2ä¸Šposition:relativeå»æ‰ï¼Œç»™åœ¨çº¿ç¼–è¾‘åŠŸèƒ½çš„å°ç¬”å›¾æ ‡è®¾ç½®position:absoluteçš„æ ‡ç­¾div3å¤–åŠ div4,è®¾ç½®position:relative</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">è§£å†³å‰ï¼š</div><div class="line">&lt;div1 style=&apos;position:relative&apos;&gt;</div><div class="line">  &lt;table&gt;</div><div class="line">    &lt;tbody&gt;</div><div class="line">    &lt;tr&gt;</div><div class="line">      &lt;td&gt;</div><div class="line">      &lt;div2 style=&apos;position:relative&apos;&gt;</div><div class="line">        &lt;div3 style=&quot;position:absolute&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot; &gt;&lt;/i&gt;&lt;/div3&gt;</div><div class="line">        &lt;popwindow&gt;å…·ä½“å†…å®¹&lt;/popwindow&gt; /** ç»„ä»¶å¼¹çª—divè®¾ç½®æœ‰position:absolute**/</div><div class="line">      &lt;/div2&gt;</div><div class="line">      &lt;/td&gt;</div><div class="line">    &lt;/tr&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div1&gt;</div><div class="line"></div><div class="line">è§£å†³åï¼š</div><div class="line">&lt;div1 style=&apos;position:relative&apos;&gt;</div><div class="line">  &lt;table&gt;</div><div class="line">    &lt;tbody&gt;</div><div class="line">    &lt;tr&gt;</div><div class="line">      &lt;td&gt;</div><div class="line">      &lt;div2&gt;</div><div class="line">        &lt;div4 style=&apos;position:relative&apos;&gt;</div><div class="line">          &lt;div3 style=&quot;position:absolute&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot; &gt;&lt;/i&gt;&lt;/div3&gt;</div><div class="line">        &lt;/div4&gt;</div><div class="line">        &lt;popwindow&gt;å…·ä½“å†…å®¹&lt;/popwindow&gt; /** ç»„ä»¶å¼¹çª—divè®¾ç½®æœ‰position:absolute**/</div><div class="line">      &lt;/div2&gt;</div><div class="line">      &lt;/td&gt;</div><div class="line">    &lt;/tr&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div1&gt;</div></pre></td></tr></table></figure>
<p>æ™®é€šçœç•¥å†…å®¹é¼ æ ‡æ»‘è¿‡<br><img src="/image/position2.png" alt="position2.png"><br>åœ¨çº¿ç¼–è¾‘å†…å®¹çœç•¥æ—¶ï¼Œé¼ æ ‡æ»‘è¿‡<br><img src="/image/position3.png" alt="position3.png"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é—®é¢˜-èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#é—®é¢˜-èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜/èƒŒæ™¯&quot;&gt;&lt;/a&gt;é—®é¢˜/èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;table çš„ td å†…å®¹åœ¨å†…å®¹è¾ƒå¤šæ—¶ä¼šè‡ªåŠ¨è¿›è¡Œçœç•¥å¤„ç†ï¼Œç„¶åé¼ æ ‡æ»‘è¿‡å¼¹å±‚æ˜¾ç¤ºå…·ä½“å†…å®¹&lt;/p&gt;
&lt;p&gt;tdå†…å®¹è¿˜å¯ä»¥
    
    </summary>
    
    
      <category term="css" scheme="http://yoohannah.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>webpackåŸç†</title>
    <link href="http://yoohannah.github.io/post/performance/webpackTheory.html"/>
    <id>http://yoohannah.github.io/post/performance/webpackTheory.html</id>
    <published>2019-07-14T09:17:02.000Z</published>
    <updated>2019-07-20T02:50:32.008Z</updated>
    
    <content type="html"><![CDATA[<p>bundle.jsèƒ½ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„åŸå› æ˜¯ï¼š<br>åœ¨è¾“å‡ºæ–‡ä»¶ä¸­é€šè¿‡<strong>webpack_require</strong>å‡½æ•°ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„åŠ è½½å‡½æ•°ï¼Œæ¥æ¨¡æ‹ŸNodejsä¸­çš„requireè¯­å¥</p>
<p><strong>webpack_require</strong> å‡½æ•°å°†æ‰€æœ‰æ¨¡å—æŒ‚è½½ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œé€šè¿‡åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦å­˜åœ¨è¯¥æ¨¡å—å®ç°æ¨¡å—ç¼“å­˜ï¼Œé˜²æ­¢äºŒæ¬¡åŠ è½½</p>
<p>åŸæ¥ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æ¨¡å—æ–‡ä»¶è¢«åˆå¹¶åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„bundle.jsçš„åŸå› æ˜¯<br>æµè§ˆå™¨ä¸èƒ½åƒNodejsé‚£æ ·å¿«é€Ÿçš„åœ¨æœ¬åœ°åŠ è½½ä¸€ä¸ªä¸ªæ¨¡å—æ–‡ä»¶ï¼Œè€Œå¿…é¡»é€šè¿‡ç½‘ç»œè¯·æ±‚å»åŠ è½½è¿˜æœªå¾—åˆ°çš„æ–‡ä»¶ï¼Œ<br>å¦‚æœæ¨¡å—çš„æ•°é‡å¾ˆå¤šï¼Œåˆ™åŠ è½½æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå› æ­¤å°†æ‰€æœ‰æ¨¡å—éƒ½å­˜æ”¾åœ¨äº†æ•°ç»„ä¸­ï¼Œæ‰§è¡Œä¸€æ¬¡ç½‘ç»œåŠ è½½<br><a href="https://github.com/YooHannah/algorithm/blob/master/webpack/outputFile.js" target="_blank" rel="external">è¾“å‡ºæ–‡ä»¶åˆ†æ</a></p>
<h1 id="ç¼–å†™loader"><a href="#ç¼–å†™loader" class="headerlink" title="ç¼–å†™loader"></a>ç¼–å†™loader</h1><h2 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h2><h3 id="è·å–loaderé…ç½®çš„options"><a href="#è·å–loaderé…ç½®çš„options" class="headerlink" title="è·å–loaderé…ç½®çš„options"></a>è·å–loaderé…ç½®çš„options</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const loaderUtils = require(&apos;loader-utils&apos;)</div><div class="line">module.exports = function(source)&#123;</div><div class="line">	//è·å–ç”¨æˆ·ä¸ºå½“å‰loaderä¼ å…¥çš„options</div><div class="line">	const options = loaderUtils.getOptions(this)</div><div class="line">	return source</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="è¿”å›é™¤äº†å†…å®¹ä¹‹å¤–çš„ä¸œè¥¿"><a href="#è¿”å›é™¤äº†å†…å®¹ä¹‹å¤–çš„ä¸œè¥¿" class="headerlink" title="è¿”å›é™¤äº†å†…å®¹ä¹‹å¤–çš„ä¸œè¥¿"></a>è¿”å›é™¤äº†å†…å®¹ä¹‹å¤–çš„ä¸œè¥¿</h3><p>this.callback æ˜¯ Webpack ç»™ Loader æ³¨å…¥çš„ APIï¼Œä»¥æ–¹ä¾¿ Loader å’Œ Webpack ä¹‹é—´é€šä¿¡ã€‚ this.callback çš„è¯¦ç»†ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">this.callback( </div><div class="line">    // å½“æ— æ³•è½¬æ¢åŸå†…å®¹æ—¶ï¼Œç»™ Webpack è¿”å›ä¸€ä¸ª Error </div><div class="line">    err: Error | null, </div><div class="line">    // åŸå†…å®¹è½¬æ¢åçš„å†…å®¹ </div><div class="line">    content: string | Buffer, </div><div class="line">    // ç”¨äºæŠŠè½¬æ¢åçš„å†…å®¹å¾—å‡ºåŸå†…å®¹çš„ Source Mapï¼Œæ–¹ä¾¿è°ƒè¯• </div><div class="line">    sourceMap?: SourceMap, </div><div class="line">    // å¦‚æœæœ¬æ¬¡è½¬æ¢ä¸ºåŸå†…å®¹ç”Ÿæˆäº† AST è¯­æ³•æ ‘ï¼Œå¯ä»¥æŠŠè¿™ä¸ª AST è¿”å›ï¼Œ </div><div class="line">    // ä»¥æ–¹ä¾¿ä¹‹åéœ€è¦ AST çš„ Loader å¤ç”¨è¯¥ ASTï¼Œä»¥é¿å…é‡å¤ç”Ÿæˆ ASTï¼Œæå‡æ€§èƒ½ </div><div class="line">    abstractSyntaxTree?: AST </div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>å®ä¾‹ï¼šç”¨ babel-loader è½¬æ¢ ES6 ä»£ç ä¸ºä¾‹ï¼Œå®ƒè¿˜éœ€è¦è¾“å‡ºè½¬æ¢åçš„ ES5 ä»£ç å¯¹åº”çš„ Source Mapï¼Œä»¥æ–¹ä¾¿è°ƒè¯•æºç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">module.exports = function(source) &#123; </div><div class="line">  // é€šè¿‡ this.callback å‘Šè¯‰ Webpack è¿”å›çš„ç»“æœ </div><div class="line">  this.callback(null, source, sourceMaps); </div><div class="line">  // å½“ä½ ä½¿ç”¨ this.callback è¿”å›å†…å®¹æ—¶ï¼Œè¯¥ Loader å¿…é¡»è¿”å› undefinedï¼Œ </div><div class="line">  // ä»¥è®© Webpack çŸ¥é“è¯¥ Loader è¿”å›çš„ç»“æœåœ¨ this.callback ä¸­ï¼Œè€Œä¸æ˜¯ return ä¸­  </div><div class="line">  return; </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>Source Map çš„ç”Ÿæˆå¾ˆè€—æ—¶ï¼Œé€šå¸¸åœ¨å¼€å‘ç¯å¢ƒä¸‹æ‰ä¼šç”Ÿæˆ Source Mapï¼Œå…¶å®ƒç¯å¢ƒä¸‹ä¸ç”¨ç”Ÿæˆï¼Œä»¥åŠ é€Ÿæ„å»ºã€‚ ä¸ºæ­¤ Webpack ä¸º Loader æä¾›äº† this.sourceMap API å»å‘Šè¯‰ Loader å½“å‰æ„å»ºç¯å¢ƒä¸‹ç”¨æˆ·æ˜¯å¦éœ€è¦ Source Mapã€‚</p>
<h3 id="å¤„ç†å¼‚æ­¥æµç¨‹"><a href="#å¤„ç†å¼‚æ­¥æµç¨‹" class="headerlink" title="å¤„ç†å¼‚æ­¥æµç¨‹"></a>å¤„ç†å¼‚æ­¥æµç¨‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">module.exports = function(source) &#123; </div><div class="line">    // å‘Šè¯‰ Webpack æœ¬æ¬¡è½¬æ¢æ˜¯å¼‚æ­¥çš„ï¼ŒLoader ä¼šåœ¨ callback ä¸­å›è°ƒç»“æœ </div><div class="line">    var callback = this.async(); </div><div class="line">    someAsyncOperation(source, function(err, result, sourceMaps, ast) &#123; </div><div class="line">        // é€šè¿‡ callback è¿”å›å¼‚æ­¥æ‰§è¡Œåçš„ç»“æœ </div><div class="line">        callback(err, result, sourceMaps, ast); </div><div class="line">    &#125;); </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="å¤„ç†äºŒè¿›åˆ¶æ•°æ®"><a href="#å¤„ç†äºŒè¿›åˆ¶æ•°æ®" class="headerlink" title="å¤„ç†äºŒè¿›åˆ¶æ•°æ®"></a>å¤„ç†äºŒè¿›åˆ¶æ•°æ®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">module.exports = function(source) &#123; </div><div class="line">    // åœ¨ exports.raw === true æ—¶ï¼ŒWebpack ä¼ ç»™ Loader çš„ source æ˜¯ Buffer ç±»å‹çš„ </div><div class="line">    source instanceof Buffer === true; </div><div class="line">    // Loader è¿”å›çš„ç±»å‹ä¹Ÿå¯ä»¥æ˜¯ Buffer ç±»å‹çš„ </div><div class="line">    // åœ¨ exports.raw !== true æ—¶ï¼ŒLoader ä¹Ÿå¯ä»¥è¿”å› Buffer ç±»å‹çš„ç»“æœ </div><div class="line">    return source; </div><div class="line">&#125;; </div><div class="line">// é€šè¿‡ exports.raw å±æ€§å‘Šè¯‰ Webpack è¯¥ Loader æ˜¯å¦éœ€è¦äºŒè¿›åˆ¶æ•°æ®  </div><div class="line">module.exports.raw = true; //æ²¡æœ‰è¯¥è¡Œ Loader åªèƒ½æ‹¿åˆ°å­—ç¬¦ä¸²ã€‚</div></pre></td></tr></table></figure>
<h3 id="ç¼“å­˜åŠ é€Ÿ"><a href="#ç¼“å­˜åŠ é€Ÿ" class="headerlink" title="ç¼“å­˜åŠ é€Ÿ"></a>ç¼“å­˜åŠ é€Ÿ</h3><p>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œæœ‰äº›è½¬æ¢æ“ä½œéœ€è¦å¤§é‡è®¡ç®—éå¸¸è€—æ—¶ï¼Œå¦‚æœæ¯æ¬¡æ„å»ºéƒ½é‡æ–°æ‰§è¡Œé‡å¤çš„è½¬æ¢æ“ä½œï¼Œæ„å»ºå°†ä¼šå˜å¾—éå¸¸ç¼“æ…¢ã€‚ ä¸ºæ­¤ï¼ŒWebpack ä¼šé»˜è®¤ç¼“å­˜æ‰€æœ‰ Loader çš„å¤„ç†ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨éœ€è¦è¢«å¤„ç†çš„æ–‡ä»¶æˆ–è€…å…¶ä¾èµ–çš„æ–‡ä»¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ æ˜¯ä¸ä¼šé‡æ–°è°ƒç”¨å¯¹åº”çš„ Loader å»æ‰§è¡Œè½¬æ¢æ“ä½œçš„ã€‚<br>å¦‚æœæƒ³è®©Webpack ä¸ç¼“å­˜è¯¥ Loader çš„å¤„ç†ç»“æœï¼Œå¯ä»¥è¿™æ ·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">module.exports = function(source) &#123; </div><div class="line">  // å…³é—­è¯¥ Loader çš„ç¼“å­˜åŠŸèƒ½ </div><div class="line">  this.cacheable(false); </div><div class="line">  return source; </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="å…¶ä»–API"><a href="#å…¶ä»–API" class="headerlink" title="å…¶ä»–API"></a>å…¶ä»–API</h3><p>this.contextï¼šå½“å‰å¤„ç†æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•ï¼Œå‡å¦‚å½“å‰ Loader å¤„ç†çš„æ–‡ä»¶æ˜¯ /src/main.jsï¼Œåˆ™ this.context å°±ç­‰äº /srcã€‚</p>
<p>this.resourceï¼šå½“å‰å¤„ç†æ–‡ä»¶çš„å®Œæ•´è¯·æ±‚è·¯å¾„ï¼ŒåŒ…æ‹¬ querystringï¼Œä¾‹å¦‚ /src/main.js?name=1ã€‚</p>
<p>this.resourcePathï¼šå½“å‰å¤„ç†æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ /src/main.jsã€‚</p>
<p>this.resourceQueryï¼šå½“å‰å¤„ç†æ–‡ä»¶çš„ querystringã€‚</p>
<p>this.targetï¼šç­‰äº Webpack é…ç½®ä¸­çš„ Targetã€‚</p>
<p>this.loadModuleï¼šå½“ Loader åœ¨å¤„ç†ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¦‚æœä¾èµ–å…¶å®ƒæ–‡ä»¶çš„å¤„ç†ç»“æœæ‰èƒ½å¾—å‡ºå½“å‰æ–‡ä»¶çš„ç»“æœæ—¶ï¼Œ å°±å¯ä»¥é€šè¿‡ this.loadModule(request: string, callback: function(err, source, sourceMap, module)) å»è·å¾— request å¯¹åº”æ–‡ä»¶çš„å¤„ç†ç»“æœã€‚</p>
<p>this.resolveï¼šåƒ require è¯­å¥ä¸€æ ·è·å¾—æŒ‡å®šæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œä½¿ç”¨æ–¹æ³•ä¸º resolve(context: string, request: string, callback: function(err, result: string))ã€‚</p>
<p>this.addDependencyï¼šç»™å½“å‰å¤„ç†æ–‡ä»¶æ·»åŠ å…¶ä¾èµ–çš„æ–‡ä»¶ï¼Œä»¥ä¾¿å†å…¶ä¾èµ–çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé‡æ–°è°ƒç”¨ Loader å¤„ç†è¯¥æ–‡ä»¶ã€‚ä½¿ç”¨æ–¹æ³•ä¸º addDependency(file: string)ã€‚</p>
<p>this.addContextDependencyï¼šå’Œ addDependency ç±»ä¼¼ï¼Œä½† addContextDependency æ˜¯æŠŠæ•´ä¸ªç›®å½•åŠ å…¥åˆ°å½“å‰æ­£åœ¨å¤„ç†æ–‡ä»¶çš„ä¾èµ–ä¸­ã€‚ä½¿ç”¨æ–¹æ³•ä¸º addContextDependency(directory: string)ã€‚</p>
<p>this.clearDependenciesï¼šæ¸…é™¤å½“å‰æ­£åœ¨å¤„ç†æ–‡ä»¶çš„æ‰€æœ‰ä¾èµ–ï¼Œä½¿ç”¨æ–¹æ³•ä¸º clearDependencies()ã€‚</p>
<p>this.emitFileï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨æ–¹æ³•ä¸º emitFile(name: string, content: Buffer|string, sourceMap: {â€¦})ã€‚</p>
<h2 id="åŠ è½½æœ¬åœ°loader"><a href="#åŠ è½½æœ¬åœ°loader" class="headerlink" title="åŠ è½½æœ¬åœ°loader"></a>åŠ è½½æœ¬åœ°loader</h2><h3 id="æ–¹æ³•ä¸€-Npm-link"><a href="#æ–¹æ³•ä¸€-Npm-link" class="headerlink" title="æ–¹æ³•ä¸€ Npm link"></a>æ–¹æ³•ä¸€ Npm link</h3><p>Npm link ä¸“é—¨ç”¨äºå¼€å‘å’Œè°ƒè¯•æœ¬åœ° Npm æ¨¡å—ï¼Œèƒ½åšåˆ°åœ¨ä¸å‘å¸ƒæ¨¡å—çš„æƒ…å†µä¸‹ï¼ŒæŠŠæœ¬åœ°çš„ä¸€ä¸ªæ­£åœ¨å¼€å‘çš„æ¨¡å—çš„æºç é“¾æ¥åˆ°é¡¹ç›®çš„ node_modules ç›®å½•ä¸‹ï¼Œè®©é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„ Npm æ¨¡å—ã€‚ ç”±äºæ˜¯é€šè¿‡è½¯é“¾æ¥çš„æ–¹å¼å®ç°çš„ï¼Œç¼–è¾‘äº†æœ¬åœ°çš„ Npm æ¨¡å—ä»£ç ï¼Œåœ¨é¡¹ç›®ä¸­ä¹Ÿèƒ½ä½¿ç”¨åˆ°ç¼–è¾‘åçš„ä»£ç ã€‚</p>
<p>å®Œæˆ Npm link çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1.ç¡®ä¿æ­£åœ¨å¼€å‘çš„æœ¬åœ° Npm æ¨¡å—ï¼ˆä¹Ÿå°±æ˜¯æ­£åœ¨å¼€å‘çš„ Loaderï¼‰çš„ package.json å·²ç»æ­£ç¡®é…ç½®å¥½ï¼›<br>2.åœ¨æœ¬åœ° Npm æ¨¡å—æ ¹ç›®å½•ä¸‹æ‰§è¡Œ npm linkï¼ŒæŠŠæœ¬åœ°æ¨¡å—æ³¨å†Œåˆ°å…¨å±€ï¼›<br>3.åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ npm link loader-nameï¼ŒæŠŠç¬¬2æ­¥æ³¨å†Œåˆ°å…¨å±€çš„æœ¬åœ° Npm æ¨¡å—é“¾æ¥åˆ°é¡¹ç›®çš„ node_moduels ä¸‹ï¼Œå…¶ä¸­çš„ loader-name æ˜¯æŒ‡åœ¨ç¬¬1æ­¥ä¸­çš„ package.json æ–‡ä»¶ä¸­é…ç½®çš„æ¨¡å—åç§°ã€‚</p>
<p>é“¾æ¥å¥½ Loader åˆ°é¡¹ç›®åå°±å¯ä»¥åƒä½¿ç”¨ä¸€ä¸ªçœŸæ­£çš„ Npm æ¨¡å—ä¸€æ ·ä½¿ç”¨æœ¬åœ°çš„ Loader äº†ã€‚</p>
<h3 id="æ–¹æ³•äºŒ-ResolveLoader"><a href="#æ–¹æ³•äºŒ-ResolveLoader" class="headerlink" title="æ–¹æ³•äºŒ ResolveLoader"></a>æ–¹æ³•äºŒ ResolveLoader</h3><p>ResolveLoaderç”¨äºé…ç½® Webpack å¦‚ä½•å¯»æ‰¾ Loader,é»˜è®¤æƒ…å†µä¸‹åªä¼šå» node_modules ç›®å½•ä¸‹å¯»æ‰¾ï¼Œä¸ºäº†è®© Webpack åŠ è½½æ”¾åœ¨æœ¬åœ°é¡¹ç›®ä¸­çš„ Loader éœ€è¦ä¿®æ”¹ resolveLoader.modulesã€‚<br>å‡å¦‚æœ¬åœ°çš„ Loader åœ¨é¡¹ç›®ç›®å½•ä¸­çš„ ./loaders/loader-name ä¸­ï¼Œåˆ™éœ€è¦å¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123; </div><div class="line">  resolveLoader:&#123; </div><div class="line">    // å»å“ªäº›ç›®å½•ä¸‹å¯»æ‰¾ Loaderï¼Œæœ‰å…ˆåé¡ºåºä¹‹åˆ† </div><div class="line">    modules: [&apos;node_modules&apos;,&apos;./loaders/&apos;], </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="ç¼–å†™plugin"><a href="#ç¼–å†™plugin" class="headerlink" title="ç¼–å†™plugin"></a>ç¼–å†™plugin</h1><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p>pluginå†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">class BasicPlugin&#123; </div><div class="line">  // åœ¨æ„é€ å‡½æ•°ä¸­è·å–ç”¨æˆ·ç»™è¯¥æ’ä»¶ä¼ å…¥çš„é…ç½® </div><div class="line">  constructor(options)&#123; </div><div class="line">  &#125; </div><div class="line"> </div><div class="line">  // Webpack ä¼šè°ƒç”¨ BasicPlugin å®ä¾‹çš„ apply æ–¹æ³•ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡ </div><div class="line">  apply(compiler)&#123; </div><div class="line">    compiler.plugin(&apos;compilation&apos;,function(compilation) &#123; </div><div class="line">    &#125;) </div><div class="line">  &#125; </div><div class="line">&#125; </div><div class="line"> </div><div class="line">// å¯¼å‡º Plugin </div><div class="line">module.exports = BasicPlugin;</div></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const BasicPlugin = require(&apos;./BasicPlugin.js&apos;); </div><div class="line">module.export = &#123; </div><div class="line">  plugins:[ </div><div class="line">    new BasicPlugin(options), </div><div class="line">  ] </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Webpack å¯åŠ¨åï¼Œåœ¨è¯»å–é…ç½®çš„è¿‡ç¨‹ä¸­ä¼šå…ˆæ‰§è¡Œ new BasicPlugin(options) åˆå§‹åŒ–ä¸€ä¸ª BasicPlugin è·å¾—å…¶å®ä¾‹ã€‚ åœ¨åˆå§‹åŒ– compiler å¯¹è±¡åï¼Œå†è°ƒç”¨ basicPlugin.apply(compiler) ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡ã€‚ æ’ä»¶å®ä¾‹åœ¨è·å–åˆ° compiler å¯¹è±¡åï¼Œå°±å¯ä»¥é€šè¿‡ compiler.plugin(äº‹ä»¶åç§°, å›è°ƒå‡½æ•°) ç›‘å¬åˆ° Webpack å¹¿æ’­å‡ºæ¥çš„äº‹ä»¶ã€‚ å¹¶ä¸”å¯ä»¥é€šè¿‡ compiler å¯¹è±¡å»æ“ä½œ Webpackã€‚</p>
<h2 id="Compiler-å’Œ-Compilation"><a href="#Compiler-å’Œ-Compilation" class="headerlink" title="Compiler å’Œ Compilation"></a>Compiler å’Œ Compilation</h2><p>Compiler å’Œ Compilation çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<p>1.Compiler å¯¹è±¡åŒ…å«äº† Webpack ç¯å¢ƒæ‰€æœ‰çš„çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å« optionsï¼Œloadersï¼Œplugins è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ Webpack å¯åŠ¨æ—¶å€™è¢«å®ä¾‹åŒ–ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¯ä»¥ç®€å•åœ°æŠŠå®ƒç†è§£ä¸º Webpack å®ä¾‹ï¼›</p>
<p>2.Compilation å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚å½“ Webpack ä»¥å¼€å‘æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œä¸€æ¬¡æ–°çš„ Compilation å°†è¢«åˆ›å»ºã€‚Compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šäº‹ä»¶å›è°ƒä¾›æ’ä»¶åšæ‰©å±•ã€‚é€šè¿‡ Compilation ä¹Ÿèƒ½è¯»å–åˆ° Compiler å¯¹è±¡ã€‚</p>
<p>Compiler ä»£è¡¨äº†æ•´ä¸ª Webpack ä»å¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation åªæ˜¯ä»£è¡¨äº†ä¸€æ¬¡æ–°çš„ç¼–è¯‘ã€‚</p>
<h2 id="äº‹ä»¶æµ"><a href="#äº‹ä»¶æµ" class="headerlink" title="äº‹ä»¶æµ"></a>äº‹ä»¶æµ</h2><p>Webpack å°±åƒä¸€æ¡ç”Ÿäº§çº¿ï¼Œè¦ç»è¿‡ä¸€ç³»åˆ—å¤„ç†æµç¨‹åæ‰èƒ½å°†æºæ–‡ä»¶è½¬æ¢æˆè¾“å‡ºç»“æœã€‚ è¿™æ¡ç”Ÿäº§çº¿ä¸Šçš„æ¯ä¸ªå¤„ç†æµç¨‹çš„èŒè´£éƒ½æ˜¯å•ä¸€çš„ï¼Œå¤šä¸ªæµç¨‹ä¹‹é—´æœ‰å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåªæœ‰å®Œæˆå½“å‰å¤„ç†åæ‰èƒ½äº¤ç»™ä¸‹ä¸€ä¸ªæµç¨‹å»å¤„ç†ã€‚ æ’ä»¶å°±åƒæ˜¯ä¸€ä¸ªæ’å…¥åˆ°ç”Ÿäº§çº¿ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºå¯¹ç”Ÿäº§çº¿ä¸Šçš„èµ„æºåšå¤„ç†ã€‚<br>Webpack é€šè¿‡ Tapable æ¥ç»„ç»‡è¿™æ¡å¤æ‚çš„ç”Ÿäº§çº¿ã€‚ Webpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶ï¼Œæ’ä»¶åªéœ€è¦ç›‘å¬å®ƒæ‰€å…³å¿ƒçš„äº‹ä»¶ï¼Œå°±èƒ½åŠ å…¥åˆ°è¿™æ¡ç”Ÿäº§çº¿ä¸­ï¼Œå»æ”¹å˜ç”Ÿäº§çº¿çš„è¿ä½œã€‚ Webpack çš„äº‹ä»¶æµæœºåˆ¶ä¿è¯äº†æ’ä»¶çš„æœ‰åºæ€§ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿæ‰©å±•æ€§å¾ˆå¥½ã€‚</p>
<p>Webpack çš„äº‹ä»¶æµæœºåˆ¶åº”ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå’Œ Node.js ä¸­çš„ EventEmitter éå¸¸ç›¸ä¼¼ã€‚ Compiler å’Œ Compilation éƒ½ç»§æ‰¿è‡ª Tapableï¼Œå¯ä»¥ç›´æ¥åœ¨ Compiler å’Œ Compilation å¯¹è±¡ä¸Šå¹¿æ’­å’Œç›‘å¬äº‹ä»¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/ </div><div class="line"> å¹¿æ’­å‡ºäº‹ä»¶ </div><div class="line"> event-name ä¸ºäº‹ä»¶åç§°ï¼Œæ³¨æ„ä¸è¦å’Œç°æœ‰çš„äº‹ä»¶é‡å </div><div class="line"> params ä¸ºé™„å¸¦çš„å‚æ•° </div><div class="line">/ </div><div class="line">compiler.apply(&apos;event-name&apos;,params); </div><div class="line"> </div><div class="line">/ </div><div class="line"> ç›‘å¬åç§°ä¸º event-name çš„äº‹ä»¶ï¼Œå½“ event-name äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚ </div><div class="line"> åŒæ—¶å‡½æ•°ä¸­çš„ params å‚æ•°ä¸ºå¹¿æ’­äº‹ä»¶æ—¶é™„å¸¦çš„å‚æ•°ã€‚ </div><div class="line">*/ </div><div class="line">compiler.plugin(&apos;event-name&apos;,function(params) &#123; </div><div class="line"> </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>compilation.apply å’Œ compilation.plugin ä½¿ç”¨æ–¹æ³•å’Œä¸Šé¢ä¸€è‡´ã€‚</p>
<p>åœ¨å¼€å‘æ’ä»¶æ—¶ï¼Œè¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<p>1.åªè¦èƒ½æ‹¿åˆ° Compiler æˆ– Compilation å¯¹è±¡ï¼Œå°±èƒ½å¹¿æ’­å‡ºæ–°çš„äº‹ä»¶ï¼Œæ‰€ä»¥åœ¨æ–°å¼€å‘çš„æ’ä»¶ä¸­ä¹Ÿèƒ½å¹¿æ’­å‡ºäº‹ä»¶ï¼Œç»™å…¶å®ƒæ’ä»¶ç›‘å¬ä½¿ç”¨ã€‚<br>2.ä¼ ç»™æ¯ä¸ªæ’ä»¶çš„ Compiler å’Œ Compilation å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€ä¸ªæ’ä»¶ä¸­ä¿®æ”¹äº† Compiler æˆ– Compilation å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œä¼šå½±å“åˆ°åé¢çš„æ’ä»¶ã€‚<br>3.æœ‰äº›äº‹ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œè¿™äº›å¼‚æ­¥çš„äº‹ä»¶ä¼šé™„å¸¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œåœ¨æ’ä»¶å¤„ç†å®Œä»»åŠ¡æ—¶éœ€è¦è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpackï¼Œæ‰ä¼šè¿›å…¥ä¸‹ä¸€å¤„ç†æµç¨‹ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">compiler.plugin(&apos;emit&apos;,function(compilation, callback) &#123; </div><div class="line">    // æ”¯æŒå¤„ç†é€»è¾‘ </div><div class="line"> </div><div class="line">    // å¤„ç†å®Œæ¯•åæ‰§è¡Œ callback ä»¥é€šçŸ¥ Webpack  </div><div class="line">    // å¦‚æœä¸æ‰§è¡Œ callbackï¼Œè¿è¡Œæµç¨‹å°†ä¼šä¸€ç›´å¡åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ  </div><div class="line">    callback(); </div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<h2 id="å¸¸ç”¨API-1"><a href="#å¸¸ç”¨API-1" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h2><h3 id="ç›‘å¬æ–‡ä»¶å˜åŒ–"><a href="#ç›‘å¬æ–‡ä»¶å˜åŒ–" class="headerlink" title="ç›‘å¬æ–‡ä»¶å˜åŒ–"></a>ç›‘å¬æ–‡ä»¶å˜åŒ–</h3><p> Webpack ä¼šä»é…ç½®çš„å…¥å£æ¨¡å—å‡ºå‘ï¼Œä¾æ¬¡æ‰¾å‡ºæ‰€æœ‰çš„ä¾èµ–æ¨¡å—ï¼Œå½“å…¥å£æ¨¡å—æˆ–è€…å…¶ä¾èµ–çš„æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ å°±ä¼šè§¦å‘ä¸€æ¬¡æ–°çš„ Compilationã€‚<br> é€šè¿‡ã€watch-runã€‘ äº‹ä»¶å¯ä»¥çŸ¥é“æ˜¯å“ªä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–å¯¼è‡´äº†æ–°çš„ Compilation<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/ å½“ä¾èµ–çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘ watch-run äº‹ä»¶ </div><div class="line">compiler.plugin(&apos;watch-run&apos;, (watching, callback) =&gt; &#123; </div><div class="line">    // è·å–å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶åˆ—è¡¨ </div><div class="line">    const changedFiles = watching.compiler.watchFileSystem.watcher.mtimes; </div><div class="line">    // changedFiles æ ¼å¼ä¸ºé”®å€¼å¯¹ï¼Œé”®ä¸ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶è·¯å¾„ã€‚ </div><div class="line">    if (changedFiles[filePath] !== undefined) &#123; </div><div class="line">      // filePath å¯¹åº”çš„æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ– </div><div class="line">    &#125; </div><div class="line">    callback(); </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>é»˜è®¤æƒ…å†µä¸‹ Webpack åªä¼šç›‘è§†å…¥å£å’Œå…¶ä¾èµ–çš„æ¨¡å—æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹é¡¹ç›®å¯èƒ½éœ€è¦å¼•å…¥æ–°çš„æ–‡ä»¶ï¼Œä¾‹å¦‚å¼•å…¥ä¸€ä¸ª HTML æ–‡ä»¶ã€‚ ç”±äº JavaScript æ–‡ä»¶ä¸ä¼šå»å¯¼å…¥ HTML æ–‡ä»¶ï¼ŒWebpack å°±ä¸ä¼šç›‘å¬ HTML æ–‡ä»¶çš„å˜åŒ–ï¼Œç¼–è¾‘ HTML æ–‡ä»¶æ—¶å°±ä¸ä¼šé‡æ–°è§¦å‘æ–°çš„ Compilationã€‚ ä¸ºäº†ç›‘å¬ HTML æ–‡ä»¶çš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ HTML æ–‡ä»¶åŠ å…¥åˆ°ä¾èµ–åˆ—è¡¨ä¸­ï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">compiler.plugin(&apos;after-compile&apos;, (compilation, callback) =&gt; &#123; </div><div class="line">  // æŠŠ HTML æ–‡ä»¶æ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ï¼Œå¥½è®© Webpack å»ç›‘å¬ HTML æ¨¡å—æ–‡ä»¶ï¼Œåœ¨ HTML æ¨¡ç‰ˆæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°å¯åŠ¨ä¸€æ¬¡ç¼–è¯‘ </div><div class="line">    compilation.fileDependencies.push(filePath); </div><div class="line">    callback(); </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–"><a href="#è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–" class="headerlink" title="è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–"></a>è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–</h3><p>åœ¨ ã€emitã€‘ äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä»£è¡¨æºæ–‡ä»¶çš„è½¬æ¢å’Œç»„è£…å·²ç»å®Œæˆï¼Œåœ¨è¿™é‡Œå¯ä»¥è¯»å–åˆ°æœ€ç»ˆå°†è¾“å‡ºçš„èµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹è¾“å‡ºèµ„æºçš„å†…å®¹ã€‚ æ’ä»¶ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">class Plugin &#123; </div><div class="line">  apply(compiler) &#123; </div><div class="line">    compiler.plugin(&apos;emit&apos;, function (compilation, callback) &#123; </div><div class="line">      // compilation.chunks å­˜æ”¾æ‰€æœ‰ä»£ç å—ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ </div><div class="line">      compilation.chunks.forEach(function (chunk) &#123; </div><div class="line">        // chunk ä»£è¡¨ä¸€ä¸ªä»£ç å— </div><div class="line">        // ä»£ç å—ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œé€šè¿‡ chunk.forEachModule èƒ½è¯»å–ç»„æˆä»£ç å—çš„æ¯ä¸ªæ¨¡å— </div><div class="line">        chunk.forEachModule(function (module) &#123; </div><div class="line">          // module ä»£è¡¨ä¸€ä¸ªæ¨¡å— </div><div class="line">          // module.fileDependencies å­˜æ”¾å½“å‰æ¨¡å—çš„æ‰€æœ‰ä¾èµ–çš„æ–‡ä»¶è·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ </div><div class="line">          module.fileDependencies.forEach(function (filepath) &#123; </div><div class="line">          &#125;); </div><div class="line">        &#125;); </div><div class="line"> </div><div class="line">        // Webpack ä¼šæ ¹æ® Chunk å»ç”Ÿæˆè¾“å‡ºçš„æ–‡ä»¶èµ„æºï¼Œæ¯ä¸ª Chunk éƒ½å¯¹åº”ä¸€ä¸ªåŠå…¶ä»¥ä¸Šçš„è¾“å‡ºæ–‡ä»¶ </div><div class="line">        // ä¾‹å¦‚åœ¨ Chunk ä¸­åŒ…å«äº† CSS æ¨¡å—å¹¶ä¸”ä½¿ç”¨äº† ExtractTextPlugin æ—¶ï¼Œ </div><div class="line">        // è¯¥ Chunk å°±ä¼šç”Ÿæˆ .js å’Œ .css ä¸¤ä¸ªæ–‡ä»¶ </div><div class="line">        chunk.files.forEach(function (filename) &#123; </div><div class="line">          // compilation.assets å­˜æ”¾å½“å‰æ‰€æœ‰å³å°†è¾“å‡ºçš„èµ„æº </div><div class="line">          // è°ƒç”¨ä¸€ä¸ªè¾“å‡ºèµ„æºçš„ source() æ–¹æ³•èƒ½è·å–åˆ°è¾“å‡ºèµ„æºçš„å†…å®¹ </div><div class="line">          let source = compilation.assets[filename].source(); </div><div class="line">        &#125;); </div><div class="line">      &#125;); </div><div class="line"> </div><div class="line">      // è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶ï¼Œè¦è®°å¾—è°ƒç”¨ callback é€šçŸ¥ Webpack æœ¬æ¬¡äº‹ä»¶ç›‘å¬å¤„ç†ç»“æŸã€‚ </div><div class="line">      // å¦‚æœå¿˜è®°äº†è°ƒç”¨ callbackï¼ŒWebpack å°†ä¸€ç›´å¡åœ¨è¿™é‡Œè€Œä¸ä¼šå¾€åæ‰§è¡Œã€‚ </div><div class="line">      callback(); </div><div class="line">    &#125;) </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ä¿®æ”¹è¾“å‡ºèµ„æº"><a href="#ä¿®æ”¹è¾“å‡ºèµ„æº" class="headerlink" title="ä¿®æ”¹è¾“å‡ºèµ„æº"></a>ä¿®æ”¹è¾“å‡ºèµ„æº</h3><p>æœ‰äº›åœºæ™¯ä¸‹æ’ä»¶éœ€è¦ä¿®æ”¹ã€å¢åŠ ã€åˆ é™¤è¾“å‡ºçš„èµ„æºï¼Œè¦åšåˆ°è¿™ç‚¹éœ€è¦ç›‘å¬ emit äº‹ä»¶ï¼Œå› ä¸ºå‘ç”Ÿ emit äº‹ä»¶æ—¶æ‰€æœ‰æ¨¡å—çš„è½¬æ¢å’Œä»£ç å—å¯¹åº”çš„æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½ï¼Œ éœ€è¦è¾“å‡ºçš„èµ„æºå³å°†è¾“å‡ºï¼Œå› æ­¤ emit äº‹ä»¶æ˜¯ä¿®æ”¹ Webpack è¾“å‡ºèµ„æºçš„æœ€åæ—¶æœºã€‚</p>
<p>æ‰€æœ‰éœ€è¦è¾“å‡ºçš„èµ„æºä¼šå­˜æ”¾åœ¨ compilation.assets ä¸­ï¼Œcompilation.assets æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®ä¸ºéœ€è¦è¾“å‡ºçš„æ–‡ä»¶åç§°ï¼Œå€¼ä¸ºæ–‡ä»¶å¯¹åº”çš„å†…å®¹ã€‚</p>
<p>è®¾ç½® compilation.assets çš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">compiler.plugin(&apos;emit&apos;, (compilation, callback) =&gt; &#123; </div><div class="line">  // è®¾ç½®åç§°ä¸º fileName çš„è¾“å‡ºèµ„æº </div><div class="line">  compilation.assets[fileName] = &#123; </div><div class="line">    // è¿”å›æ–‡ä»¶å†…å®¹ </div><div class="line">    source: () =&gt; &#123; </div><div class="line">      // fileContent æ—¢å¯ä»¥æ˜¯ä»£è¡¨æ–‡æœ¬æ–‡ä»¶çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£è¡¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ Buffer </div><div class="line">      return fileContent; </div><div class="line">      &#125;, </div><div class="line">    // è¿”å›æ–‡ä»¶å¤§å° </div><div class="line">      size: () =&gt; &#123; </div><div class="line">      return Buffer.byteLength(fileContent, &apos;utf8&apos;); </div><div class="line">    &#125; </div><div class="line">  &#125;; </div><div class="line">  callback(); </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>è¯»å– compilation.assets çš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">compiler.plugin(&apos;emit&apos;, (compilation, callback) =&gt; &#123; </div><div class="line">  // è¯»å–åç§°ä¸º fileName çš„è¾“å‡ºèµ„æº </div><div class="line">  const asset = compilation.assets[fileName]; </div><div class="line">  // è·å–è¾“å‡ºèµ„æºçš„å†…å®¹ </div><div class="line">  asset.source(); </div><div class="line">  // è·å–è¾“å‡ºèµ„æºçš„æ–‡ä»¶å¤§å° </div><div class="line">  asset.size(); </div><div class="line">  callback(); </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="åˆ¤æ–­-Webpack-ä½¿ç”¨äº†å“ªäº›æ’ä»¶"><a href="#åˆ¤æ–­-Webpack-ä½¿ç”¨äº†å“ªäº›æ’ä»¶" class="headerlink" title="åˆ¤æ–­ Webpack ä½¿ç”¨äº†å“ªäº›æ’ä»¶"></a>åˆ¤æ–­ Webpack ä½¿ç”¨äº†å“ªäº›æ’ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// åˆ¤æ–­å½“å‰é…ç½®æ˜¯å¦ä½¿ç”¨äº† ExtractTextPluginï¼Œ </div><div class="line">// compiler å‚æ•°å³ä¸º Webpack åœ¨ apply(compiler) ä¸­ä¼ å…¥çš„å‚æ•° </div><div class="line">function hasExtractTextPlugin(compiler) &#123; </div><div class="line">  // å½“å‰é…ç½®æ‰€æœ‰ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ </div><div class="line">  const plugins = compiler.options.plugins; </div><div class="line">  // å» plugins ä¸­å¯»æ‰¾æœ‰æ²¡æœ‰ ExtractTextPlugin çš„å®ä¾‹ </div><div class="line">  return plugins.find(plugin=&gt;plugin.proto.constructor === ExtractTextPlugin) != null; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">class EndWebpackPlugin &#123; </div><div class="line"> </div><div class="line">  constructor(doneCallback, failCallback) &#123; </div><div class="line">    // å­˜ä¸‹åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„å›è°ƒå‡½æ•° </div><div class="line">    this.doneCallback = doneCallback; </div><div class="line">    this.failCallback = failCallback; </div><div class="line">  &#125; </div><div class="line"> </div><div class="line">  apply(compiler) &#123; </div><div class="line">    //doneï¼šåœ¨æˆåŠŸæ„å»ºå¹¶ä¸”è¾“å‡ºäº†æ–‡ä»¶åï¼ŒWebpack å³å°†é€€å‡ºæ—¶å‘ç”Ÿï¼›</div><div class="line">    compiler.plugin(&apos;done&apos;, (stats) =&gt; &#123; </div><div class="line">        // åœ¨ done äº‹ä»¶ä¸­å›è°ƒ doneCallback </div><div class="line">        this.doneCallback(stats); </div><div class="line">    &#125;); </div><div class="line">    //failedï¼šåœ¨æ„å»ºå‡ºç°å¼‚å¸¸å¯¼è‡´æ„å»ºå¤±è´¥ï¼ŒWebpack å³å°†é€€å‡ºæ—¶å‘ç”Ÿï¼›</div><div class="line">    compiler.plugin(&apos;failed&apos;, (err) =&gt; &#123; </div><div class="line">        // åœ¨ failed äº‹ä»¶ä¸­å›è°ƒ failCallback </div><div class="line">        this.failCallback(err); </div><div class="line">    &#125;); </div><div class="line">  &#125; </div><div class="line">&#125; </div><div class="line">// å¯¼å‡ºæ’ä»¶  </div><div class="line">module.exports = EndWebpackPlugin; </div><div class="line"></div><div class="line">//ä½¿ç”¨</div><div class="line">module.exports = &#123; </div><div class="line">  plugins:[ </div><div class="line">    // åœ¨åˆå§‹åŒ– EndWebpackPlugin æ—¶ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯åœ¨æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°å’Œå¤±è´¥æ—¶çš„å›è°ƒå‡½æ•°ï¼› </div><div class="line">    new EndWebpackPlugin(() =&gt; &#123; </div><div class="line">      // Webpack æ„å»ºæˆåŠŸï¼Œå¹¶ä¸”æ–‡ä»¶è¾“å‡ºäº†åä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œåœ¨è¿™é‡Œå¯ä»¥åšå‘å¸ƒæ–‡ä»¶æ“ä½œ </div><div class="line">    &#125;, (err) =&gt; &#123; </div><div class="line">      // Webpack æ„å»ºå¤±è´¥ï¼Œerr æ˜¯å¯¼è‡´é”™è¯¯çš„åŸå›  </div><div class="line">      console.error(err);    &#125;) </div><div class="line">  ] </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><h2 id="æµç¨‹æ¦‚æ‹¬"><a href="#æµç¨‹æ¦‚æ‹¬" class="headerlink" title="æµç¨‹æ¦‚æ‹¬"></a>æµç¨‹æ¦‚æ‹¬</h2><p>Webpack çš„è¿è¡Œæµç¨‹æ˜¯ä¸€ä¸ªä¸²è¡Œçš„è¿‡ç¨‹ï¼Œä»å¯åŠ¨åˆ°ç»“æŸä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š</p>
<p>1.åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–ä¸åˆå¹¶å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„å‚æ•°ï¼›<br>ï¼ˆå¯åŠ¨æ„å»ºï¼Œè¯»å–ä¸åˆå¹¶é…ç½®å‚æ•°ï¼ŒåŠ è½½ Pluginï¼Œå®ä¾‹åŒ– Compilerã€‚ï¼‰<br>2.å¼€å§‹ç¼–è¯‘ï¼šç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compiler å¯¹è±¡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ï¼›<br>3.ç¡®å®šå…¥å£ï¼šæ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ï¼›<br>4.ç¼–è¯‘æ¨¡å—ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œç¿»è¯‘ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ï¼›<br>5.å®Œæˆæ¨¡å—ç¼–è¯‘ï¼šåœ¨ç»è¿‡ç¬¬4æ­¥ä½¿ç”¨ Loader ç¿»è¯‘å®Œæ‰€æœ‰æ¨¡å—åï¼Œå¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„æœ€ç»ˆå†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼›<br>6.è¾“å‡ºèµ„æºï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunkï¼Œå†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ï¼Œè¿™æ­¥æ˜¯å¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼šï¼›<br>7.è¾“å‡ºå®Œæˆï¼šåœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¹¿æ’­å‡ºç‰¹å®šçš„äº‹ä»¶ï¼Œæ’ä»¶åœ¨ç›‘å¬åˆ°æ„Ÿå…´è¶£çš„äº‹ä»¶åä¼šæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¹¶ä¸”æ’ä»¶å¯ä»¥è°ƒç”¨ Webpack æä¾›çš„ API æ”¹å˜ Webpack çš„è¿è¡Œç»“æœã€‚</p>
<h2 id="æµç¨‹ç»†èŠ‚"><a href="#æµç¨‹ç»†èŠ‚" class="headerlink" title="æµç¨‹ç»†èŠ‚"></a>æµç¨‹ç»†èŠ‚</h2><p>1.åˆå§‹åŒ–ï¼šå¯åŠ¨æ„å»ºï¼Œè¯»å–ä¸åˆå¹¶é…ç½®å‚æ•°ï¼ŒåŠ è½½ Pluginï¼Œå®ä¾‹åŒ– Compilerã€‚<br>2.ç¼–è¯‘ï¼šä» Entry å‘å‡ºï¼Œé’ˆå¯¹æ¯ä¸ª Module ä¸²è¡Œè°ƒç”¨å¯¹åº”çš„ Loader å»ç¿»è¯‘æ–‡ä»¶å†…å®¹ï¼Œå†æ‰¾åˆ°è¯¥ Module ä¾èµ–çš„ Moduleï¼Œé€’å½’åœ°è¿›è¡Œç¼–è¯‘å¤„ç†ã€‚<br>3.è¾“å‡ºï¼šå¯¹ç¼–è¯‘åçš„ Module ç»„åˆæˆ Chunkï¼ŒæŠŠ Chunk è½¬æ¢æˆæ–‡ä»¶ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<h2 id="åˆå§‹åŒ–é˜¶æ®µäº‹"><a href="#åˆå§‹åŒ–é˜¶æ®µäº‹" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µäº‹"></a>åˆå§‹åŒ–é˜¶æ®µäº‹</h2><table><thead><tr><th>äº‹ä»¶å</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–å‚æ•°</td><td>ä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–ä¸åˆå¹¶å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„å‚æ•°ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜ä¼šæ‰§è¡Œé…ç½®æ–‡ä»¶ä¸­çš„æ’ä»¶å®ä¾‹åŒ–è¯­å¥ <code>new Plugin()</code>ã€‚</td></tr><tr><td>å®ä¾‹åŒ– Compiler</td><td>ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compiler å®ä¾‹ï¼ŒCompiler è´Ÿè´£æ–‡ä»¶ç›‘å¬å’Œå¯åŠ¨ç¼–è¯‘ã€‚Compiler å®ä¾‹ä¸­åŒ…å«äº†å®Œæ•´çš„ Webpack é…ç½®ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ª Compiler å®ä¾‹ã€‚</td></tr><tr><td>åŠ è½½æ’ä»¶</td><td>ä¾æ¬¡è°ƒç”¨æ’ä»¶çš„ apply æ–¹æ³•ï¼Œè®©æ’ä»¶å¯ä»¥ç›‘å¬åç»­çš„æ‰€æœ‰äº‹ä»¶èŠ‚ç‚¹ã€‚åŒæ—¶ç»™æ’ä»¶ä¼ å…¥ compiler å®ä¾‹çš„å¼•ç”¨ï¼Œä»¥æ–¹ä¾¿æ’ä»¶é€šè¿‡ compiler è°ƒç”¨ Webpack æä¾›çš„ APIã€‚</td></tr><tr><td>environment</td><td>å¼€å§‹åº”ç”¨ Node.js é£æ ¼çš„æ–‡ä»¶ç³»ç»Ÿåˆ° compiler å¯¹è±¡ï¼Œä»¥æ–¹ä¾¿åç»­çš„æ–‡ä»¶å¯»æ‰¾å’Œè¯»å–ã€‚</td></tr><tr><td>entry-option</td><td>è¯»å–é…ç½®çš„ Entrysï¼Œä¸ºæ¯ä¸ª Entry å®ä¾‹åŒ–ä¸€ä¸ªå¯¹åº”çš„ EntryPluginï¼Œä¸ºåé¢è¯¥ Entry çš„é€’å½’è§£æå·¥ä½œåšå‡†å¤‡ã€‚</td></tr><tr><td>after-plugins</td><td>è°ƒç”¨å®Œæ‰€æœ‰å†…ç½®çš„å’Œé…ç½®çš„æ’ä»¶çš„ apply æ–¹æ³•ã€‚</td></tr><tr><td>after-resolvers</td><td>æ ¹æ®é…ç½®åˆå§‹åŒ–å®Œ resolverï¼Œresolver è´Ÿè´£åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å¯»æ‰¾æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ã€‚</td></tr></tbody></table>

<h2 id="ç¼–è¯‘é˜¶æ®µäº‹ä»¶"><a href="#ç¼–è¯‘é˜¶æ®µäº‹ä»¶" class="headerlink" title="ç¼–è¯‘é˜¶æ®µäº‹ä»¶"></a>ç¼–è¯‘é˜¶æ®µäº‹ä»¶</h2><table><thead><tr><th>äº‹ä»¶å</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>build-module</td><td>ä½¿ç”¨å¯¹åº”çš„ Loader å»è½¬æ¢ä¸€ä¸ªæ¨¡å—ã€‚</td></tr><tr><td>normal-module-loader</td><td>åœ¨ç”¨ Loader å¯¹ä¸€ä¸ªæ¨¡å—è½¬æ¢å®Œåï¼Œä½¿ç”¨ acorn è§£æè½¬æ¢åçš„å†…å®¹ï¼Œè¾“å‡ºå¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œä»¥æ–¹ä¾¿ Webpack åé¢å¯¹ä»£ç çš„åˆ†æã€‚</td></tr><tr><td>program</td><td>ä»é…ç½®çš„å…¥å£æ¨¡å—å¼€å§‹ï¼Œåˆ†æå…¶ ASTï¼Œå½“é‡åˆ° <code>require</code> ç­‰å¯¼å…¥å…¶å®ƒæ¨¡å—è¯­å¥æ—¶ï¼Œä¾¿å°†å…¶åŠ å…¥åˆ°ä¾èµ–çš„æ¨¡å—åˆ—è¡¨ï¼ŒåŒæ—¶å¯¹æ–°æ‰¾å‡ºçš„ä¾èµ–æ¨¡å—é€’å½’åˆ†æï¼Œæœ€ç»ˆææ¸…æ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»</td></tr><tr><td>seal</td><td>æ‰€æœ‰æ¨¡å—åŠå…¶ä¾èµ–çš„æ¨¡å—éƒ½é€šè¿‡ Loader è½¬æ¢å®Œæˆåï¼Œæ ¹æ®ä¾èµ–å…³ç³»å¼€å§‹ç”Ÿæˆ Chunk</td></tr></tbody></table>

<h2 id="è¾“å‡ºé˜¶æ®µäº‹ä»¶"><a href="#è¾“å‡ºé˜¶æ®µäº‹ä»¶" class="headerlink" title="è¾“å‡ºé˜¶æ®µäº‹ä»¶"></a>è¾“å‡ºé˜¶æ®µäº‹ä»¶</h2><table><thead><tr><th>äº‹ä»¶å</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>should-emit</td><td>æ‰€æœ‰éœ€è¦è¾“å‡ºçš„æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½ï¼Œè¯¢é—®æ’ä»¶å“ªäº›æ–‡ä»¶éœ€è¦è¾“å‡ºï¼Œå“ªäº›ä¸éœ€è¦ã€‚</td></tr><tr><td>emit</td><td>ç¡®å®šå¥½è¦è¾“å‡ºå“ªäº›æ–‡ä»¶åï¼Œæ‰§è¡Œæ–‡ä»¶è¾“å‡ºï¼Œå¯ä»¥åœ¨è¿™é‡Œè·å–å’Œä¿®æ”¹è¾“å‡ºå†…å®¹ã€‚</td></tr><tr><td>after-emit</td><td>æ–‡ä»¶è¾“å‡ºå®Œæ¯•ã€‚</td></tr><tr><td>done</td><td>æˆåŠŸå®Œæˆä¸€æ¬¡å®Œæˆçš„ç¼–è¯‘å’Œè¾“å‡ºæµç¨‹ã€‚</td></tr><tr><td>failed</td><td>å¦‚æœåœ¨ç¼–è¯‘å’Œè¾“å‡ºæµç¨‹ä¸­é‡åˆ°å¼‚å¸¸å¯¼è‡´ Webpack é€€å‡ºæ—¶ï¼Œå°±ä¼šç›´æ¥è·³è½¬åˆ°æœ¬æ­¥éª¤ï¼Œæ’ä»¶å¯ä»¥åœ¨æœ¬äº‹ä»¶ä¸­è·å–åˆ°å…·ä½“çš„é”™è¯¯åŸå› ã€‚</td></tr></tbody></table>

<p>åœ¨è¾“å‡ºé˜¶æ®µå·²ç»å¾—åˆ°äº†å„ä¸ªæ¨¡å—ç»è¿‡è½¬æ¢åçš„ç»“æœå’Œå…¶ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æŠŠç›¸å…³æ¨¡å—ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªä¸ª Chunkã€‚ åœ¨è¾“å‡ºé˜¶æ®µä¼šæ ¹æ® Chunk çš„ç±»å‹ï¼Œä½¿ç”¨å¯¹åº”çš„æ¨¡ç‰ˆç”Ÿæˆæœ€ç»ˆè¦è¦è¾“å‡ºçš„æ–‡ä»¶å†…å®¹</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;bundle.jsèƒ½ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„åŸå› æ˜¯ï¼š&lt;br&gt;åœ¨è¾“å‡ºæ–‡ä»¶ä¸­é€šè¿‡&lt;strong&gt;webpack_require&lt;/strong&gt;å‡½æ•°ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„åŠ è½½å‡½æ•°ï¼Œæ¥æ¨¡æ‹ŸNodejsä¸­çš„requireè¯­å¥&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;webpack_re
    
    </summary>
    
    
      <category term="performance" scheme="http://yoohannah.github.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>webpackä¼˜åŒ–</title>
    <link href="http://yoohannah.github.io/post/performance/webpackOptimization.html"/>
    <id>http://yoohannah.github.io/post/performance/webpackOptimization.html</id>
    <published>2019-06-29T08:21:02.000Z</published>
    <updated>2019-07-20T02:07:21.615Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¼˜åŒ–å¼€å‘ä½“éªŒ"><a href="#ä¼˜åŒ–å¼€å‘ä½“éªŒ" class="headerlink" title="ä¼˜åŒ–å¼€å‘ä½“éªŒ"></a>ä¼˜åŒ–å¼€å‘ä½“éªŒ</h1><p>ç›®çš„æ˜¯æå‡å¼€å‘æ•ˆç‡</p>
<h2 id="ä¼˜åŒ–æ„å»ºé€Ÿåº¦"><a href="#ä¼˜åŒ–æ„å»ºé€Ÿåº¦" class="headerlink" title="ä¼˜åŒ–æ„å»ºé€Ÿåº¦"></a>ä¼˜åŒ–æ„å»ºé€Ÿåº¦</h2><p>è§£å†³é¡¹ç›®åºå¤§æ—¶æ„å»ºçš„è€—æ—¶åŠ é•¿çš„é—®é¢˜</p>
<h3 id="ç¼©å°æ–‡ä»¶æŸ¥æ‰¾èŒƒå›´"><a href="#ç¼©å°æ–‡ä»¶æŸ¥æ‰¾èŒƒå›´" class="headerlink" title="ç¼©å°æ–‡ä»¶æŸ¥æ‰¾èŒƒå›´"></a>ç¼©å°æ–‡ä»¶æŸ¥æ‰¾èŒƒå›´</h3><p>1.ç”±äºLoaderå¯¹æ–‡ä»¶è½¬æ¢å¾ˆè€—æ—¶ï¼Œæ‰€ä»¥åº”è¯¥è®©å°½å¯èƒ½å°‘çš„æ–‡ä»¶è¢«å¤„ç†ï¼Œé€‚å½“è°ƒæ•´é¡¹ç›®ç›®å½•ç»“æ„ï¼Œåœ¨é…ç½®loaderæ—¶é€šè¿‡ã€includeã€‘å±æ€§ç¼©å°å¤„ç†å‘½ä¸­æ–‡ä»¶èŒƒå›´<br>2.å½“å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„./node_moduleç›®å½•ä¸‹æ—¶ï¼Œé€šè¿‡æŒ‡æ˜ã€resolve.modulesã€‘ä¸ºå­˜æ”¾ç¬¬ä¸‰æ–¹æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œå‡å°‘å¯»æ‰¾ç¬¬ä¸‰æ–¹æ¨¡å—çš„é€’å½’æŸ¥æ‰¾<br>3.åœ¨é¡¹ç›®ä¸­æ‰€æœ‰ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½é‡‡ç”¨mainå­—æ®µå»æè¿°å…¥å£æ–‡ä»¶æ—¶ï¼Œåªç»™ã€resolve.mainFiledsã€‘é…ç½®mainå­—æ®µï¼Œä¸ä½¿ç”¨é»˜è®¤å€¼ï¼Œå‡å°‘æœç´¢æ­¥éª¤<br>4.ä½¿ç”¨ã€resolve.aliasã€‘è¿›è¡Œè·¯å¾„æ˜ å°„æ—¶ï¼Œå°†å¯¼å…¥æ¨¡å—çš„è¯­å¥ï¼Œæ›¿æ¢æˆç›´æ¥ä½¿ç”¨æ¨¡å—ä¸­å®Œæ•´æ–‡ä»¶çš„è¯­å¥ï¼Œå‡å°‘è€—æ—¶çš„å¯¹äºlibä¸­æ–‡ä»¶çš„è§£æå·¥ä½œ<br>5.ä¼˜åŒ–ã€resolve.extensionã€‘é…ç½®ï¼Œå‡å°‘å°è¯•æ¬¡æ•°<br>a.åç¼€åˆ—è¡¨å°½å¯èƒ½å°ï¼Œä¸è¦å°†é¡¹ç›®ä¸­ä¸å¯èƒ½å­˜åœ¨çš„æƒ…å†µå†™åˆ°åç¼€åˆ—è¡¨ä¸­<br>b.é¢‘ç‡å‡ºç°æœ€é«˜çš„æ–‡ä»¶åç¼€è¦ä¼˜å…ˆæ”¾åœ¨æœ€å‰é¢ï¼Œä»¥åšåˆ°å°½å¿«é€€å‡ºå¯»æ‰¾è¿‡ç¨‹<br>c.åœ¨æºç ä¸­å†™å¯¼å…¥è¯­å¥æ—¶ï¼Œå°½å¯èƒ½å¸¦ä¸Šåç¼€ï¼Œä»è€Œé¿å…å¯»æ‰¾è¿‡ç¨‹<br>6.åˆç†ä½¿ç”¨ã€module.noparseã€‘å±æ€§ï¼Œæ’é™¤ä¸éœ€è¦è¿›è¡Œæ¨¡å—è§£æå¤„ç†çš„æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">1.</div><div class="line">rules:&#123;</div><div class="line">	//åªå¯¹é¡¹ç›®æ ¹ç›®å½•ä¸‹srcç›®å½•ä¸­æ–‡ä»¶é‡‡ç”¨é…ç½®çš„loader</div><div class="line">	include:path.resolve(__dirname,&apos;src&apos;)</div><div class="line">&#125;</div><div class="line">2.</div><div class="line">resolve:&#123;</div><div class="line">	//ä½¿ç”¨ç»å¯¹è·¯å¾„æŒ‡æ˜ç¬¬ä¸‰æ–¹æ¨¡å—å­˜æ”¾çš„ä½ç½®ï¼Œå‡å°‘æœç´¢æ­¥éª¤</div><div class="line">	modules:[path.resolve(__dirname,&apos;node_module&apos;)]</div><div class="line">&#125;</div><div class="line">3.</div><div class="line">resolve:&#123;</div><div class="line">	//å‡å°‘å…¥å£æŸ¥æ‰¾</div><div class="line">	mainFilds:[&apos;main&apos;]</div><div class="line">&#125;</div><div class="line">4.</div><div class="line">resolve:&#123;</div><div class="line">	//å‡å°‘ç¬¬ä¸‰æ–¹æ¨¡å—é€’å½’è§£æ</div><div class="line">	alias:&#123; </div><div class="line">		&apos;react&apos;:path.resolve(__dirname,&apos;./node_module/react/dist/react.min.js&apos;)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ä½¿ç”¨DLLPlugin"><a href="#ä½¿ç”¨DLLPlugin" class="headerlink" title="ä½¿ç”¨DLLPlugin"></a>ä½¿ç”¨DLLPlugin</h3><p>ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶å¯ä»¥åŒ…å«ä¸ºå…¶ä»–æ¨¡å—è°ƒç”¨çš„å‡½æ•°å’Œæ•°æ®<br>æå‡æ„å»ºé€Ÿåº¦çš„åŸç†ï¼š<br>åŒ…å«å¤§é‡å¤ç”¨æ¨¡å—çš„åŠ¨æ€é“¾æ¥åº“åªéœ€è¢«ç¼–è¯‘ä¸€æ¬¡ï¼Œåœ¨ä¹‹åçš„æ„å»ºè¿‡ç¨‹ä¸­è¢«åŠ¨æ€é“¾æ¥åº“åŒ…å«çš„æ¨¡å—å°†ä¸ä¼šé‡æ–°ç¼–è¯‘ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“çš„ä»£ç ï¼Œ<br>ç”±äºåŠ¨æ€é“¾æ¥åº“ä¸­å¤§å¤šæ•°åŒ…å«çš„æ˜¯å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œä¾‹å¦‚react,react-dom,æ‰€ä»¥åªè¦ä¸å‡çº§è¿™äº›æ¨¡å—çš„ç‰ˆæœ¬ï¼ŒåŠ¨æ€è¿æ¥åº“å°±ä¸ç”¨é‡æ–°ç¼–è¯‘</p>
<p>DllPlugin:æ‰“åŒ…å‡ºä¸€ä¸ªä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶<br>DllReferencePlugin:ç”¨äºåœ¨ä¸»è¦çš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥DllPluginæ‰“åŒ…å¥½çš„åŠ¨æ€è¿æ¥åº“æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">//webpack_dll.config.js</div><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const DllPlugin = require(&apos;webpack/lib/DllPlugin&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  // JS æ‰§è¡Œå…¥å£æ–‡ä»¶</div><div class="line">  entry: &#123;</div><div class="line">    // æŠŠ React ç›¸å…³çš„æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“</div><div class="line">    react: [&apos;react&apos;, &apos;react-dom&apos;],</div><div class="line">    // æŠŠé¡¹ç›®éœ€è¦æ‰€æœ‰çš„ polyfill æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“</div><div class="line">    polyfill: [&apos;core-js/fn/object/assign&apos;, &apos;core-js/fn/promise&apos;, &apos;whatwg-fetch&apos;],</div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    // è¾“å‡ºçš„åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶åç§°ï¼Œ[name] ä»£è¡¨å½“å‰åŠ¨æ€é“¾æ¥åº“çš„åç§°ï¼Œä¹Ÿå°±æ˜¯ entry ä¸­é…ç½®çš„ react å’Œ polyfill</div><div class="line">    filename: &apos;[name].dll.js&apos;,</div><div class="line">    // è¾“å‡ºçš„æ–‡ä»¶éƒ½æ”¾åˆ° dist ç›®å½•ä¸‹</div><div class="line">    path: path.resolve(__dirname, &apos;dist&apos;),</div><div class="line">    // å­˜æ”¾åŠ¨æ€é“¾æ¥åº“çš„å…¨å±€å˜é‡åç§°ï¼Œä¾‹å¦‚å¯¹åº” react æ¥è¯´å°±æ˜¯ _dll_react</div><div class="line">    // ä¹‹æ‰€ä»¥åœ¨å‰é¢åŠ ä¸Š _dll_ æ˜¯ä¸ºäº†é˜²æ­¢å…¨å±€å˜é‡å†²çª</div><div class="line">    library: &apos;_dll_[name]&apos;,</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    // æ¥å…¥ DllPlugin</div><div class="line">    new DllPlugin(&#123;</div><div class="line">      // åŠ¨æ€é“¾æ¥åº“çš„å…¨å±€å˜é‡åç§°ï¼Œéœ€è¦å’Œ output.library ä¸­ä¿æŒä¸€è‡´</div><div class="line">      // è¯¥å­—æ®µçš„å€¼ä¹Ÿå°±æ˜¯è¾“å‡ºçš„ manifest.json æ–‡ä»¶ ä¸­ name å­—æ®µçš„å€¼</div><div class="line">      // ä¾‹å¦‚ react.manifest.json ä¸­å°±æœ‰ &quot;name&quot;: &quot;_dll_react&quot;</div><div class="line">      name: &apos;_dll_[name]&apos;,</div><div class="line">      // æè¿°åŠ¨æ€é“¾æ¥åº“çš„ manifest.json æ–‡ä»¶è¾“å‡ºæ—¶çš„æ–‡ä»¶åç§°</div><div class="line">      path: path.join(__dirname, &apos;dist&apos;, &apos;[name].manifest.json&apos;),</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div><div class="line"></div><div class="line">webpack_dll.config.jsæ–‡ä»¶ä¸­ï¼ŒDllPluginä¸­çš„nameå‚æ•°å¿…é¡»å’Œoutput</div><div class="line"></div><div class="line">//webpack.config.js</div><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const DllReferencePlugin = require(&apos;webpack/lib/DllReferencePlugin&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  entry: &#123;</div><div class="line">    // å®šä¹‰ å…¥å£ Chunk</div><div class="line">    main: &apos;./main.js&apos;</div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    // è¾“å‡ºæ–‡ä»¶çš„åç§°</div><div class="line">    filename: &apos;[name].js&apos;,</div><div class="line">    // è¾“å‡ºæ–‡ä»¶éƒ½æ”¾åˆ° dist ç›®å½•ä¸‹</div><div class="line">    path: path.resolve(__dirname, &apos;dist&apos;),</div><div class="line">  &#125;,</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      &#123;</div><div class="line">        // é¡¹ç›®æºç ä½¿ç”¨äº† ES6 å’Œ JSX è¯­æ³•ï¼Œéœ€è¦ä½¿ç”¨ babel-loader è½¬æ¢</div><div class="line">        test: /\.js$/,</div><div class="line">        use: [&apos;babel-loader&apos;],</div><div class="line">        exclude: path.resolve(__dirname, &apos;node_modules&apos;),</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    // å‘Šè¯‰ Webpack ä½¿ç”¨äº†å“ªäº›åŠ¨æ€é“¾æ¥åº“</div><div class="line">    new DllReferencePlugin(&#123;</div><div class="line">      // æè¿° react åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶å†…å®¹</div><div class="line">      manifest: require(&apos;./dist/react.manifest.json&apos;),</div><div class="line">    &#125;),</div><div class="line">    new DllReferencePlugin(&#123;</div><div class="line">      // æè¿° polyfill åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶å†…å®¹</div><div class="line">      manifest: require(&apos;./dist/polyfill.manifest.json&apos;),</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">  devtool: &apos;source-map&apos;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ„å»ºæµç¨‹ï¼š<br>å…ˆç¼–è¯‘å‡ºåŠ¨æ€é“¾æ¥åº“ç›¸å…³çš„æ–‡ä»¶ï¼Œæ‰§è¡Œwebpack â€“config webpack_dll.config.js<br>åœ¨ç¡®ä¿åŠ¨æ€é“¾æ¥åº“å­˜åœ¨æ—¶æ‰èƒ½æ­£å¸¸ç¼–è¯‘å…¥å£æ–‡ä»¶ï¼Œwebpack.config.jsä¸­çš„DllReferencePluginä¼šä¾èµ–åŠ¨æ€é“¾æ¥åº“ç›¸å…³æ–‡ä»¶ï¼Œæ‰§è¡Œwebpackå‘½ä»¤</p>
<h3 id="ä½¿ç”¨HappyPack"><a href="#ä½¿ç”¨HappyPack" class="headerlink" title="ä½¿ç”¨HappyPack"></a>ä½¿ç”¨HappyPack</h3><p>æå‡æ„å»ºé€Ÿåº¦åŸç†ï¼š<br>å°†ä»»åŠ¡åˆ†è§£ç»™å¤šä¸ªå­è¿›ç¨‹å»å¹¶å‘æ‰§è¡Œï¼Œå­è¿›ç¨‹å¤„ç†å®Œåå†å°†ç»“æœå‘é€ç»™ä¸»è¿›ç¨‹ï¼Œä»è€Œè®©webpackåœ¨åŒä¸€æ—¶åˆ»å¤„ç†å¤šä¸ªä»»åŠ¡<br>å®é™…è¡¨ç°å°±æ˜¯<br>æ‰€æœ‰é€šè¿‡Loaderå¤„ç†çš„æ–‡ä»¶éƒ½å…ˆäº¤ç»™happypack/loaderå»å¤„ç†ï¼Œåœ¨æ”¶é›†åˆ°è¿™äº›æ–‡ä»¶çš„å¤„ç†æƒåï¼ŒHappyPackå°±å¯ä»¥ç»Ÿä¸€åˆ†é…äº†<br>æ¯é€šè¿‡new HappyPack() å»å®ä¾‹åŒ–ä¸€ä¸ªHappyPack,å…¶å®å°±æ˜¯å‘Šè¯‰HappyPackæ ¸å¿ƒè°ƒåº¦å™¨å¦‚ä½•é€šè¿‡ä¸€ç³»åˆ—Loaderå»è½¬æ¢ä¸€ç±»æ–‡ä»¶ï¼Œ<br>å¹¶ä¸”å¯ä»¥æŒ‡å®šå¦‚ä½•ä¸ºè¿™ç±»è½¬æ¢æ“ä½œåˆ†é…å­è¿›ç¨‹<br>æ ¸å¿ƒè°ƒåº¦å™¨çš„é€»è¾‘ä»£ç åœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œç€webpackçš„è¿›ç¨‹ä¸­ï¼Œæ ¸å¿ƒè°ƒåº¦å™¨ä¼šå°†ä¸€ä¸ªä¸ªä»»åŠ¡åˆ†é…ç»™å½“å‰ç©ºé—²çš„å­è¿›ç¨‹ï¼Œ<br>å­è¿›ç¨‹å¤„ç†å®Œæ¯•åå°†ç»“æœå‘é€ç»™æ ¸å¿ƒè°ƒåº¦ï¼Œä»–ä»¬ä¹‹é—´çš„æ•°æ®äº¤æ¢æ˜¯é€šè¿‡è¿›ç¨‹é—´çš„é€šä¿¡APIå®ç°çš„<br>æ ¸å¿ƒè°ƒåº¦å™¨æ”¶åˆ°æ¥è‡ªå­è¿›ç¨‹å¤„ç†å®Œæ¯•çš„ç»“æœåï¼Œä¼šé€šçŸ¥WebPackè¯¥æ–‡ä»¶å·²å¤„ç†å®Œæ¯•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;);</div><div class="line">const HappyPack = require(&apos;happypack&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  // JS æ‰§è¡Œå…¥å£æ–‡ä»¶</div><div class="line">  entry: &#123;</div><div class="line">    main: &apos;./main.js&apos;,</div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    // æŠŠæ‰€æœ‰ä¾èµ–çš„æ¨¡å—åˆå¹¶è¾“å‡ºåˆ°ä¸€ä¸ª bundle.js æ–‡ä»¶</div><div class="line">    filename: &apos;[name].js&apos;,</div><div class="line">    // è¾“å‡ºæ–‡ä»¶éƒ½æ”¾åˆ° dist ç›®å½•ä¸‹</div><div class="line">    path: path.resolve(__dirname, &apos;./dist&apos;),</div><div class="line">  &#125;,</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      &#123;</div><div class="line">        test: /\.js$/,</div><div class="line">        // æŠŠå¯¹ .js æ–‡ä»¶çš„å¤„ç†è½¬äº¤ç»™ id ä¸º babel çš„ HappyPack å®ä¾‹</div><div class="line">        use: [&apos;happypack/loader?id=babel&apos;],</div><div class="line">        // æ’é™¤ node_modules ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œnode_modules ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯é‡‡ç”¨çš„ ES5 è¯­æ³•ï¼Œæ²¡å¿…è¦å†é€šè¿‡ Babel å»è½¬æ¢</div><div class="line">        exclude: path.resolve(__dirname, &apos;node_modules&apos;),</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        // æŠŠå¯¹ .css æ–‡ä»¶çš„å¤„ç†è½¬äº¤ç»™ id ä¸º css çš„ HappyPack å®ä¾‹</div><div class="line">        test: /\.css$/,</div><div class="line">        use: ExtractTextPlugin.extract(&#123;</div><div class="line">          use: [&apos;happypack/loader?id=css&apos;],</div><div class="line">        &#125;),</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    new HappyPack(&#123;</div><div class="line">      // ç”¨å”¯ä¸€çš„æ ‡è¯†ç¬¦ id æ¥ä»£è¡¨å½“å‰çš„ HappyPack æ˜¯ç”¨æ¥å¤„ç†ä¸€ç±»ç‰¹å®šçš„æ–‡ä»¶</div><div class="line">      id: &apos;babel&apos;,</div><div class="line">      // å¦‚ä½•å¤„ç† .js æ–‡ä»¶ï¼Œç”¨æ³•å’Œ Loader é…ç½®ä¸­ä¸€æ ·</div><div class="line">      loaders: [&apos;babel-loader?cacheDirectory&apos;],</div><div class="line">    &#125;),</div><div class="line">    new HappyPack(&#123;</div><div class="line">      id: &apos;css&apos;,</div><div class="line">      // å¦‚ä½•å¤„ç† .css æ–‡ä»¶ï¼Œç”¨æ³•å’Œ Loader é…ç½®ä¸­ä¸€æ ·</div><div class="line">      loaders: [&apos;css-loader&apos;],</div><div class="line">    &#125;),</div><div class="line">    new ExtractTextPlugin(&#123;</div><div class="line">      filename: `[name].css`,</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">  devtool: &apos;source-map&apos; // è¾“å‡º source-map æ–¹ä¾¿ç›´æ¥è°ƒè¯• ES6 æºç </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>åœ¨å®ä¾‹åŒ– HappyPack æ’ä»¶çš„æ—¶å€™ï¼Œé™¤äº†å¯ä»¥ä¼ å…¥ id å’Œ loaders ä¸¤ä¸ªå‚æ•°å¤–ï¼ŒHappyPack è¿˜æ”¯æŒå¦‚ä¸‹å‚æ•°ï¼š<br>threads: ä»£è¡¨å¼€å¯å‡ ä¸ªå­è¿›ç¨‹å»å¤„ç†è¿™ä¸€ç±»å‹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯3ä¸ªï¼Œç±»å‹å¿…é¡»æ˜¯æ•´æ•°ã€‚<br>verbose: æ˜¯å¦å…è®¸ HappyPack è¾“å‡ºæ—¥å¿—ï¼Œé»˜è®¤æ˜¯ trueã€‚<br>threadPool :ä»£è¡¨å…±äº«è¿›ç¨‹æ± ï¼Œå³å¤šä¸ª HappyPack å®ä¾‹éƒ½ä½¿ç”¨åŒä¸€ä¸ªå…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡ï¼Œä»¥é˜²æ­¢èµ„æºå ç”¨è¿‡å¤š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">const HappyPack = require(&apos;happypack&apos;);</div><div class="line">// æ„é€ å‡ºå…±äº«è¿›ç¨‹æ± ï¼Œè¿›ç¨‹æ± ä¸­åŒ…å«5ä¸ªå­è¿›ç¨‹</div><div class="line">const happyThreadPool = HappyPack.ThreadPool(&#123; size: 5 &#125;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  plugins: [</div><div class="line">    new HappyPack(&#123;</div><div class="line">      // ç”¨å”¯ä¸€çš„æ ‡è¯†ç¬¦ id æ¥ä»£è¡¨å½“å‰çš„ HappyPack æ˜¯ç”¨æ¥å¤„ç†ä¸€ç±»ç‰¹å®šçš„æ–‡ä»¶</div><div class="line">      id: &apos;babel&apos;,</div><div class="line">      // å¦‚ä½•å¤„ç† .js æ–‡ä»¶ï¼Œç”¨æ³•å’Œ Loader é…ç½®ä¸­ä¸€æ ·</div><div class="line">      loaders: [&apos;babel-loader?cacheDirectory&apos;],</div><div class="line">      // ä½¿ç”¨å…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡</div><div class="line">      threadPool: happyThreadPool,</div><div class="line">    &#125;),</div><div class="line">    new HappyPack(&#123;</div><div class="line">      id: &apos;css&apos;,</div><div class="line">      // å¦‚ä½•å¤„ç† .css æ–‡ä»¶ï¼Œç”¨æ³•å’Œ Loader é…ç½®ä¸­ä¸€æ ·</div><div class="line">      loaders: [&apos;css-loader&apos;],</div><div class="line">      // ä½¿ç”¨å…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡</div><div class="line">      threadPool: happyThreadPool,</div><div class="line">     &#125;),</div><div class="line">    new ExtractTextPlugin(&#123;</div><div class="line">      filename: `[name].css`,</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="ä½¿ç”¨ParallelUglifyPlugin"><a href="#ä½¿ç”¨ParallelUglifyPlugin" class="headerlink" title="ä½¿ç”¨ParallelUglifyPlugin"></a>ä½¿ç”¨ParallelUglifyPlugin</h3><p>æå‡æ„å»ºé€Ÿåº¦åŸç†ï¼š<br>å½“webpackæœ‰å¤šä¸ªJSæ–‡ä»¶éœ€è¦è¾“å‡ºå’Œå‹ç¼©æ—¶ï¼ŒåŸæœ¬ä¼šä½¿ç”¨UglifyJSå»ä¸€ä¸ªä¸€ä¸ªå‹ç¼©å†è¾“å‡ºï¼Œä½†æ˜¯ParallelUglifyPluginä¼šå¼€å¯å¤šä¸ªå­è¿›ç¨‹ï¼Œ<br>å°†å¯¹å¤šä¸ªæ–‡ä»¶çš„å‹ç¼©å·¥ä½œåˆ†é…ç»™å¤šä¸ªå­è¿›ç¨‹å®Œæˆï¼Œæ¯ä¸ªå­è¿›ç¨‹å…¶å®è¿˜æ˜¯é€šè¿‡UglifyJSå»å‹ç¼©ä»£ç ï¼Œå•å˜æˆäº†å¹¶è¡Œæ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">const path = require(â€˜pathâ€™);</div><div class="line">const DefinePlugin = require(â€˜webpack/lib/DefinePluginâ€™);</div><div class="line">const ParallelUglifyPlugin = require(â€˜webpack-parallel-uglify-pluginâ€™);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  plugins: [</div><div class="line">    // ä½¿ç”¨ ParallelUglifyPlugin å¹¶è¡Œå‹ç¼©è¾“å‡ºçš„ JS ä»£ç </div><div class="line">    new ParallelUglifyPlugin(&#123;</div><div class="line">      // ä¼ é€’ç»™ UglifyJS çš„å‚æ•°</div><div class="line">      uglifyJS: &#123;</div><div class="line">        output: &#123;</div><div class="line">          // æœ€ç´§å‡‘çš„è¾“å‡º</div><div class="line">          beautify: false,</div><div class="line">          // åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š</div><div class="line">          comments: false,</div><div class="line">        &#125;,</div><div class="line">        compress: &#123;</div><div class="line">          // åœ¨UglifyJsåˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç æ—¶ä¸è¾“å‡ºè­¦å‘Š</div><div class="line">          warnings: false,</div><div class="line">          // åˆ é™¤æ‰€æœ‰çš„ console è¯­å¥ï¼Œå¯ä»¥å…¼å®¹ieæµè§ˆå™¨</div><div class="line">          drop_console: true,</div><div class="line">          // å†…åµŒå®šä¹‰äº†ä½†æ˜¯åªç”¨åˆ°ä¸€æ¬¡çš„å˜é‡</div><div class="line">          collapse_vars: true,</div><div class="line">          // æå–å‡ºå‡ºç°å¤šæ¬¡ä½†æ˜¯æ²¡æœ‰å®šä¹‰æˆå˜é‡å»å¼•ç”¨çš„é™æ€å€¼</div><div class="line">          reduce_vars: true,</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>åœ¨é€šè¿‡ new ParallelUglifyPlugin() å®ä¾‹åŒ–æ—¶ï¼Œæ”¯æŒä»¥ä¸‹å‚æ•°ï¼š<br>testï¼šä½¿ç”¨æ­£åˆ™å»åŒ¹é…å“ªäº›æ–‡ä»¶éœ€è¦è¢« ParallelUglifyPlugin å‹ç¼©ï¼Œé»˜è®¤æ˜¯ /.js$/ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤å‹ç¼©æ‰€æœ‰çš„ .js æ–‡ä»¶ã€‚<br>includeï¼šä½¿ç”¨æ­£åˆ™å»å‘½ä¸­éœ€è¦è¢« ParallelUglifyPlugin å‹ç¼©çš„æ–‡ä»¶ã€‚é»˜è®¤ä¸º []ã€‚<br>excludeï¼šä½¿ç”¨æ­£åˆ™å»å‘½ä¸­ä¸éœ€è¦è¢« ParallelUglifyPlugin å‹ç¼©çš„æ–‡ä»¶ã€‚é»˜è®¤ä¸º []ã€‚<br>cacheDirï¼šç¼“å­˜å‹ç¼©åçš„ç»“æœï¼Œä¸‹æ¬¡é‡åˆ°ä¸€æ ·çš„è¾“å…¥æ—¶ç›´æ¥ä»ç¼“å­˜ä¸­è·å–å‹ç¼©åçš„ç»“æœå¹¶è¿”å›ã€‚cacheDir ç”¨äºé…ç½®ç¼“å­˜å­˜æ”¾çš„ç›®å½•è·¯å¾„ã€‚é»˜è®¤ä¸ä¼šç¼“å­˜ï¼Œæƒ³å¼€å¯ç¼“å­˜è¯·è®¾ç½®ä¸€ä¸ªç›®å½•è·¯å¾„ã€‚<br>workerCountï¼šå¼€å¯å‡ ä¸ªå­è¿›ç¨‹å»å¹¶å‘çš„æ‰§è¡Œå‹ç¼©ã€‚é»˜è®¤æ˜¯å½“å‰è¿è¡Œç”µè„‘çš„ CPU æ ¸æ•°å‡å»1ã€‚<br>sourceMapï¼šæ˜¯å¦è¾“å‡º Source Mapï¼Œè¿™ä¼šå¯¼è‡´å‹ç¼©è¿‡ç¨‹å˜æ…¢ã€‚<br>uglifyJSï¼šç”¨äºå‹ç¼© ES5 ä»£ç æ—¶çš„é…ç½®ï¼ŒObject ç±»å‹ï¼Œç›´æ¥é€ä¼ ç»™ UglifyJS çš„å‚æ•°ã€‚</p>
<p>å…¶ä¸­çš„ testã€includeã€exclude ä¸é…ç½® Loader æ—¶çš„æ€æƒ³å’Œç”¨æ³•ä¸€æ ·<br>UglifyES æ˜¯ UglifyJS çš„å˜ç§ï¼Œä¸“é—¨ç”¨äºå‹ç¼© ES6 ä»£ç ï¼Œå®ƒä»¬ä¸¤éƒ½å‡ºè‡ªäºåŒä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸”å®ƒä»¬ä¸¤ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚<br>UglifyES ä¸€èˆ¬ç”¨äºç»™æ¯”è¾ƒæ–°çš„ JavaScript è¿è¡Œç¯å¢ƒå‹ç¼©ä»£ç ï¼Œä¾‹å¦‚ç”¨äº ReactNative çš„ä»£ç è¿è¡Œåœ¨å…¼å®¹æ€§è¾ƒå¥½çš„ JavaScriptCore å¼•æ“ä¸­ï¼Œä¸ºäº†å¾—åˆ°æ›´å¥½çš„æ€§èƒ½å’Œå°ºå¯¸ï¼Œé‡‡ç”¨ UglifyES å‹ç¼©æ•ˆæœä¼šæ›´å¥½ã€‚<br>ParallelUglifyPlugin åŒæ—¶å†…ç½®äº† UglifyJS å’Œ UglifyESï¼Œä¹Ÿå°±æ˜¯è¯´ ParallelUglifyPlugin æ”¯æŒå¹¶è¡Œå‹ç¼© ES6 ä»£ç ã€‚<br>å¦‚æœè®¾ç½® cacheDir å¼€å¯äº†ç¼“å­˜ï¼Œåœ¨ä¹‹åçš„æ„å»ºä¸­ä¼šå˜çš„æ›´å¿«ã€‚</p>
<h2 id="ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ"><a href="#ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ" class="headerlink" title="ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ"></a>ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ</h2><p>é€šè¿‡è‡ªåŠ¨åŒ–æ‰‹æ®µå®Œæˆä¸€äº›é‡å¤å·¥ä½œï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºè§£å†³é—®é¢˜æœ¬èº«</p>
<h3 id="ä¼˜åŒ–æ–‡ä»¶ç›‘å¬"><a href="#ä¼˜åŒ–æ–‡ä»¶ç›‘å¬" class="headerlink" title="ä¼˜åŒ–æ–‡ä»¶ç›‘å¬"></a>ä¼˜åŒ–æ–‡ä»¶ç›‘å¬</h3><p>é€šè¿‡é…ç½®watchOptionè¿›è¡Œä¼˜åŒ–<br>ignored:/node_module/ ä¸ç›‘å¬node_moduleä¸‹æ–‡ä»¶ ç›‘å¬æ›´å°‘æ–‡ä»¶<br>agregatetionTimeout:å€¼è¶Šå¤§ï¼Œé™ä½æ„å»ºé¢‘ç‡<br>poll:å€¼è¶Šå°ï¼Œé™ä½æ£€æŸ¥é¢‘ç‡<br>åé¢ä¸¤é¡¹çš„é…ç½®ä¼šä½¿ç›‘å¬æ¨¡å¼çš„ååº”å’Œçµæ•åº¦é™ä½</p>
<h3 id="ä¼˜åŒ–è‡ªåŠ¨åˆ·æ–°æ€§èƒ½"><a href="#ä¼˜åŒ–è‡ªåŠ¨åˆ·æ–°æ€§èƒ½" class="headerlink" title="ä¼˜åŒ–è‡ªåŠ¨åˆ·æ–°æ€§èƒ½"></a>ä¼˜åŒ–è‡ªåŠ¨åˆ·æ–°æ€§èƒ½</h3><p>1.ä½¿ç”¨devserverå¼€å¯inlineæ—¶ï¼Œdevserverå› ä¸ºä¸çŸ¥é“æŸä¸ªç½‘é¡µä¾èµ–å“ªå‡ ä¸ªChunk,æ‰€ä»¥ä¼šå‘æ¯ä¸ªè¾“å‡ºçš„chunkä¸­æ³¨å…¥ä»£ç†å®¢æˆ·ç«¯ä»£ç <br>å½“é¡¹ç›®è¾“å‡ºå¤šä¸ªchunkæ—¶ï¼Œå°±ä¼šå¯¼è‡´æ„å»ºç¼“æ…¢ï¼Œå› æ­¤å…³é—­inlineè¿›è¡Œä¼˜åŒ–<br>å¦‚æœä¸æƒ³ä»¥iframeæ–¹å¼å»è®¿é—®ï¼Œä½†åŒæ—¶æƒ³è®©ç½‘é¡µä¿æŒè‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å‘ç½‘é¡µä¸­æ³¨å…¥ä»£ç†å®¢æˆ·ç«¯çš„è„šæœ¬ï¼Œ<br>å‘index.htmlä¸­æ³¨å…¥webpack-dev-server.js,ä½†è¦æ³¨æ„å‘å¸ƒåˆ°çº¿ä¸Šæ—¶è¦åˆ æ‰è¿™æ®µç”¨äºå¼€å‘çš„ä»£ç </p>
<p>2.å¼€å¯çƒ­æ›¿æ¢æ—¶ï¼Œæ§åˆ¶å°æ‰“å°ä¿¡æ¯ä¸èƒ½æ ‡æ˜æ¨¡å—ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨NameModulesPluginæ’ä»¶è§£å†³ï¼Œä»è€Œåœ¨æ§åˆ¶å°æ‰“å°å‡ºè¢«ä¿®æ”¹çš„æ¨¡å—åç§°<br>æ³¨æ„å…³é—­é»˜è®¤inlineæ¨¡å¼å¹¶æ‰‹åŠ¨æ³¨å…¥å®¢æˆ·ç«¯çš„æ–¹æ³•ï¼Œä¸èƒ½ç”¨äºæ¨¡å—çƒ­æ›¿æ¢çš„æƒ…å†µï¼ŒåŸå› åœ¨äºæ¨¡å—çƒ­æ›¿æ¢çš„è¿è¡Œä¾èµ–æ¯ä¸ªchunkä¸­éƒ½åŒ…å«ä»£ç†å®¢æˆ·ç«¯çš„ä»£ç </p>
<h1 id="ä¼˜åŒ–è¾“å‡ºè´¨é‡"><a href="#ä¼˜åŒ–è¾“å‡ºè´¨é‡" class="headerlink" title="ä¼˜åŒ–è¾“å‡ºè´¨é‡"></a>ä¼˜åŒ–è¾“å‡ºè´¨é‡</h1><p>ç›®çš„æ˜¯ä¸ºç”¨æˆ·å‘ˆç°ä½“éªŒæ›´å¥½çš„ç½‘é¡µ</p>
<h2 id="å‡å°‘ç”¨æˆ·èƒ½å¤Ÿæ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´-é¦–å±æ—¶é—´"><a href="#å‡å°‘ç”¨æˆ·èƒ½å¤Ÿæ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´-é¦–å±æ—¶é—´" class="headerlink" title="å‡å°‘ç”¨æˆ·èƒ½å¤Ÿæ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´(é¦–å±æ—¶é—´)"></a>å‡å°‘ç”¨æˆ·èƒ½å¤Ÿæ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´(é¦–å±æ—¶é—´)</h2><h3 id="åŒºåˆ†ç¯å¢ƒ"><a href="#åŒºåˆ†ç¯å¢ƒ" class="headerlink" title="åŒºåˆ†ç¯å¢ƒ"></a>åŒºåˆ†ç¯å¢ƒ</h3><p>é—®é¢˜ï¼š<br>å¼€å‘è¿‡ç¨‹ä¼šæ¶‰åŠåˆ°è°ƒè¯•çš„ä»£ç ,æ²¡å¿…è¦å‘åˆ°çº¿ä¸Šç»™åˆ°ç”¨æˆ·<br>å¼€å‘ç¯å¢ƒå’Œçº¿ä¸Šæ¥å£åœ°å€ä¸åŒï¼Œä½¿ç”¨ä¸åŒç¯å¢ƒæ•°æ®<br>çº¿ä¸Šä»£ç ä¼šè¿›è¡Œå‹ç¼©ï¼Œå¼€å‘ä»£ç ä¸éœ€è¦ã€</p>
<p>è§£å†³ï¼š<br>å½“ä»£ç ä¸­ä½¿ç”¨äº†processæ¨¡å—çš„è¯­å¥æ—¶ï¼Œwebpackä¼šè‡ªåŠ¨æ‰“åŒ…åŠ å…¥processæ¨¡å—ä»£ç æ¥æ”¯æŒénodejsè¿è¡Œç¯å¢ƒ<br>å½“ä»£ç ä¸­æ²¡æœ‰ä½¿ç”¨æ—¶ï¼Œå°±ä¸ä¼šæ‰“åŒ…åŠ å…¥<br>å¯ä»¥åœ¨æºç ä¸­ä½¿ç”¨process.env.NODE_ENVç¯å¢ƒå˜é‡å»åˆ¤æ–­æ‰§è¡Œå¼€å‘/çº¿ä¸Šç¯å¢ƒçš„ä»£ç <br>ç¯å¢ƒå˜é‡çš„è®¾ç½®é€šè¿‡DefinePluginè®¾ç½®<br>è®¾ç½®åï¼Œç¯å¢ƒå˜é‡çš„å€¼åœ¨webpackå¤„ç†è¿‡ç¨‹ä¸­ä¼šè¢«ä»£å…¥æºç ä¸­ï¼Œæ›¿æ¢æ‰process.env.NODE_ENV<br>è®¿é—®procesçš„è¯­å¥è¢«æ›¿æ¢ï¼Œwebpackä¹Ÿå°±ä¸ä¼šåœ¨æ‰“åŒ…æ—¶åŠ å…¥processæ¨¡å—äº†</p>
<p>æ³¨æ„ï¼šDefinedPluginå®šä¹‰çš„ç¯å¢ƒå˜é‡åªå¯¹Webpackéœ€è¦å¤„ç†çš„ä»£ç æœ‰æ•ˆï¼Œè€Œä¸ä¼šå½±å“Nodejsè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">const DefinePlugin = require(&apos;webpack/lib/DefinePlugin&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  plugins: [</div><div class="line">    new DefinePlugin(&#123;</div><div class="line">      // å®šä¹‰ NODE_ENV ç¯å¢ƒå˜é‡ä¸º production </div><div class="line">      &apos;process.env&apos;: &#123;</div><div class="line">        NODE_ENV: JSON.stringify(&apos;production&apos;)//ç¯å¢ƒå˜é‡çš„å€¼éœ€è¦ä¸€ä¸ªç”±åŒå¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²&apos;&quot;production&quot;&apos;</div><div class="line">      &#125;</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="å‹ç¼©ä»£ç "><a href="#å‹ç¼©ä»£ç " class="headerlink" title="å‹ç¼©ä»£ç "></a>å‹ç¼©ä»£ç </h3><p>æå‡ç½‘é¡µåŠ è½½é€Ÿåº¦ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“æµé‡ï¼Œæ··æ·†ä»£ç ä»¥é˜²æœ‰äººä¸‹è½½ä»£ç è¿›è¡Œä»£ç åˆ†æå’Œæ”¹é€ <br>é€šè¿‡æ’ä»¶å½¢å¼å¼•å…¥UglifyJsï¼Œåˆ©ç”¨UglifyJsåˆ†æJSä»£ç è¯­æ³•æ ‘ï¼Œç†è§£ä»£ç å«ä¹‰ï¼Œ<br>ä»è€Œå»æ‰æ— æ•ˆä»£ç ï¼Œå»æ‰æ—¥å¿—è¾“å‡ºä»£ç ï¼Œç¼©çŸ­å˜é‡åç­‰ä¼˜åŒ–,ä»…ç”¨äºes5<br>UglifyJsPlugin:å°è£…UglifyJså®ç°å‹ç¼©<br>ParallelUglifyPluginï¼šå¤šè¿›è¡Œå¹¶è¡Œå¤„ç†å‹ç¼©<br>uglifyjsWebpackPlugin:å¼•å…¥UglifyESï¼Œå‹ç¼©es6ï¼Œè¦å»æ‰.babelrcæ–‡ä»¶ä¸­çš„babel-preset-envï¼Œå¦åˆ™ä¼šå°†es6è½¬es5<br>css-loader?minimize:å‹ç¼©CSS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">1.UglifyJsPlugin</div><div class="line">const UglifyJSPlugin = require(&apos;webpack/lib/optimize/UglifyJsPlugin&apos;);//ä½¿ç”¨å†…ç½®æ’ä»¶</div><div class="line">module.exports = &#123;</div><div class="line">  plugins: [</div><div class="line">     new UglifyJSPlugin(&#123;</div><div class="line">      compress: &#123;</div><div class="line">        // åœ¨ UglifyES åˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç æ—¶ä¸è¾“å‡ºè­¦å‘Š</div><div class="line">        warnings: false,</div><div class="line">        // åˆ é™¤æ‰€æœ‰çš„ `console` è¯­å¥ï¼Œå¯ä»¥å…¼å®¹ieæµè§ˆå™¨</div><div class="line">        drop_console: true,</div><div class="line">        // å†…åµŒå®šä¹‰äº†ä½†æ˜¯åªç”¨åˆ°ä¸€æ¬¡çš„å˜é‡</div><div class="line">        collapse_vars: true,</div><div class="line">        // æå–å‡ºå‡ºç°å¤šæ¬¡ä½†æ˜¯æ²¡æœ‰å®šä¹‰æˆå˜é‡å»å¼•ç”¨çš„é™æ€å€¼</div><div class="line">        reduce_vars: true,</div><div class="line">      &#125;,</div><div class="line">      output: &#123;</div><div class="line">        // æœ€ç´§å‡‘çš„è¾“å‡ºï¼Œé»˜è®¤ä¼šä¿ç•™ç©ºæ ¼</div><div class="line">        beautify: false,</div><div class="line">        // åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š</div><div class="line">        comments: false,</div><div class="line">      &#125;</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div><div class="line"></div><div class="line">2.uglifyjs-webpack-plugin</div><div class="line">const UglifyESPlugin = require(&apos;uglifyjs-webpack-plugin&apos;);</div><div class="line">module.exports = &#123;</div><div class="line">  plugins: [</div><div class="line">     new UglifyESPlugin(&#123;</div><div class="line">      uglifyOptions: &#123;//ç›¸æ¯”UglifyJSPlugin å¤šäº†ä¸€å±‚</div><div class="line">        compress: &#123;</div><div class="line">          // åœ¨ UglifyES åˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç æ—¶ä¸è¾“å‡ºè­¦å‘Š</div><div class="line">          warnings: false,</div><div class="line">          // åˆ é™¤æ‰€æœ‰çš„ `console` è¯­å¥ï¼Œå¯ä»¥å…¼å®¹ieæµè§ˆå™¨</div><div class="line">          drop_console: true,</div><div class="line">          // å†…åµŒå®šä¹‰äº†ä½†æ˜¯åªç”¨åˆ°ä¸€æ¬¡çš„å˜é‡</div><div class="line">          collapse_vars: true,</div><div class="line">          // æå–å‡ºå‡ºç°å¤šæ¬¡ä½†æ˜¯æ²¡æœ‰å®šä¹‰æˆå˜é‡å»å¼•ç”¨çš„é™æ€å€¼</div><div class="line">          reduce_vars: true,</div><div class="line">        &#125;,</div><div class="line">        output: &#123;</div><div class="line">          // æœ€ç´§å‡‘çš„è¾“å‡º</div><div class="line">          beautify: false,</div><div class="line">          // åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š</div><div class="line">          comments: false,</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div><div class="line"></div><div class="line">3.å‹ç¼©CSS</div><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const &#123;WebPlugin&#125; = require(&apos;web-webpack-plugin&apos;);</div><div class="line">const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      &#123;</div><div class="line">        test: /\.css/,// å¢åŠ å¯¹ CSS æ–‡ä»¶çš„æ”¯æŒ</div><div class="line">        // æå–å‡º Chunk ä¸­çš„ CSS ä»£ç åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­</div><div class="line">        use: ExtractTextPlugin.extract(&#123;</div><div class="line">          use: [&apos;css-loader?minimize&apos;] // å‹ç¼© CSS ä»£ç </div><div class="line">        &#125;),</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    // ç”¨ WebPlugin ç”Ÿæˆå¯¹åº”çš„ HTML æ–‡ä»¶</div><div class="line">    new WebPlugin(&#123;</div><div class="line">      template: &apos;./template.html&apos;, // HTML æ¨¡ç‰ˆæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„</div><div class="line">      filename: &apos;index.html&apos; // è¾“å‡ºçš„ HTML çš„æ–‡ä»¶åç§°</div><div class="line">    &#125;),</div><div class="line">    new ExtractTextPlugin(&#123;</div><div class="line">      filename: `[name]_[contenthash:8].css`,// ç»™è¾“å‡ºçš„ CSS æ–‡ä»¶åç§°åŠ ä¸Š hash å€¼</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="ä½¿ç”¨CDNåŠ é€Ÿ"><a href="#ä½¿ç”¨CDNåŠ é€Ÿ" class="headerlink" title="ä½¿ç”¨CDNåŠ é€Ÿ"></a>ä½¿ç”¨CDNåŠ é€Ÿ</h3><p>webpackæ¥å…¥CDNéœ€è¦æ»¡è¶³ï¼š<br>1.é™æ€èµ„æºçš„å¯¼å…¥URLéœ€è¦å˜æˆæŒ‡å‘CDNæœåŠ¡çš„ç»å¯¹è·¯å¾„URLï¼Œè€Œä¸æ˜¯ç›¸å¯¹äºHTMLæ–‡ä»¶çš„URL<br>2.é™æ€èµ„æºçš„æ–‡ä»¶åéœ€è¦å¸¦ä¸Šç”±æ–‡ä»¶å†…å®¹ç®—å‡ºæ¥çš„Hashå€¼ï¼Œä»¥é˜²æ­¢è¢«ç¼“å­˜<br>3.å°†ä¸åŒç±»å‹èµ„æºæ”¾åˆ°ä¸åŒåŸŸåCDNæœåŠ¡ä¸Šï¼Œä»¥é˜²æ­¢èµ„æºçš„å¹¶è¡ŒåŠ è½½é˜»å¡<br>å®ç°ä¸»è¦ä¾èµ–publicPathè®¾ç½®å­˜æ”¾é™æ€èµ„æºçš„CDNç›®å½•URL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const UglifyJsPlugin = require(&apos;webpack/lib/optimize/UglifyJsPlugin&apos;);</div><div class="line">const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;);</div><div class="line">const DefinePlugin = require(&apos;webpack/lib/DefinePlugin&apos;);</div><div class="line">const &#123;WebPlugin&#125; = require(&apos;web-webpack-plugin&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  entry: &#123;</div><div class="line">    // Chunk app çš„ JS æ‰§è¡Œå…¥å£æ–‡ä»¶</div><div class="line">    app: &apos;./main.js&apos;</div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    // ç»™è¾“å‡ºçš„ JavaScript æ–‡ä»¶åç§°åŠ ä¸Š Hash å€¼</div><div class="line">    filename: &apos;[name]_[chunkhash:8].js&apos;,</div><div class="line">    path: path.resolve(__dirname, &apos;./dist&apos;),</div><div class="line">    // æŒ‡å®šå­˜æ”¾ JavaScript æ–‡ä»¶çš„çº¿ä¸Šç›®å½•</div><div class="line">    publicPath: &apos;//js.cdn.com/id/&apos;,</div><div class="line">  &#125;,</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      &#123;</div><div class="line">        test: /\.js$/,</div><div class="line">        use: [&apos;babel-loader&apos;],</div><div class="line">        // æ’é™¤ node_modules ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œnode_modules ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯é‡‡ç”¨çš„ ES5 è¯­æ³•ï¼Œæ²¡å¿…è¦å†é€šè¿‡ Babel å»è½¬æ¢</div><div class="line">        exclude: path.resolve(__dirname, &apos;node_modules&apos;),</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        // å¢åŠ å¯¹ CSS æ–‡ä»¶çš„æ”¯æŒ</div><div class="line">        test: /\.css/,</div><div class="line">        // æå–å‡º Chunk ä¸­çš„ CSS ä»£ç åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­</div><div class="line">        use: ExtractTextPlugin.extract(&#123;</div><div class="line">          // å‹ç¼© CSS ä»£ç </div><div class="line">          use: [&apos;css-loader?minimize&apos;],</div><div class="line">          // æŒ‡å®šå­˜æ”¾ CSS ä¸­å¯¼å…¥çš„èµ„æºï¼ˆä¾‹å¦‚å›¾ç‰‡ï¼‰çš„çº¿ä¸Šç›®å½•</div><div class="line">          publicPath: &apos;//img.cdn.com/id/&apos;</div><div class="line">        &#125;),</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        // å¢åŠ å¯¹ PNG æ–‡ä»¶çš„æ”¯æŒ</div><div class="line">        test: /\.png/,</div><div class="line">        // ç»™è¾“å‡ºçš„ PNG æ–‡ä»¶åç§°åŠ ä¸Š Hash å€¼</div><div class="line">        use: [&apos;file-loader?name=[name]_[hash:8].[ext]&apos;],</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    // ä½¿ç”¨ WebPlugin è‡ªåŠ¨ç”Ÿæˆ HTMLï¼Œä¼šæ ¹æ®publicPathç”¨çº¿ä¸Šåœ°å€æ›¿æ¢åŸæ¥ç›¸å¯¹åœ°å€</div><div class="line">    new WebPlugin(&#123;</div><div class="line">      // HTML æ¨¡ç‰ˆæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„</div><div class="line">      template: &apos;./template.html&apos;,</div><div class="line">      // è¾“å‡ºçš„ HTML çš„æ–‡ä»¶åç§°</div><div class="line">      filename: &apos;index.html&apos;,</div><div class="line">      // æŒ‡å®šå­˜æ”¾ CSS æ–‡ä»¶çš„çº¿ä¸Šç›®å½•</div><div class="line">      stylePublicPath: &apos;//css.cdn.com/id/&apos;,</div><div class="line">    &#125;),</div><div class="line">    new ExtractTextPlugin(&#123;</div><div class="line">      // ç»™è¾“å‡ºçš„ CSS æ–‡ä»¶åç§°åŠ ä¸Š Hash å€¼</div><div class="line">      filename: `[name]_[contenthash:8].css`,</div><div class="line">    &#125;),</div><div class="line">    new DefinePlugin(&#123;</div><div class="line">      // å®šä¹‰ NODE_ENV ç¯å¢ƒå˜é‡ä¸º production å»é™¤å¼€å‘æ—¶æ‰éœ€è¦çš„éƒ¨åˆ†</div><div class="line">      &apos;process.env&apos;: &#123;</div><div class="line">        NODE_ENV: JSON.stringify(&apos;production&apos;)</div><div class="line">      &#125;</div><div class="line">    &#125;),</div><div class="line">    // å‹ç¼©è¾“å‡ºçš„ JS ä»£ç </div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨tree-Shakingå‰”é™¤ç”¨ä¸ä¸Šçš„ä»£ç "><a href="#ä½¿ç”¨tree-Shakingå‰”é™¤ç”¨ä¸ä¸Šçš„ä»£ç " class="headerlink" title="ä½¿ç”¨tree Shakingå‰”é™¤ç”¨ä¸ä¸Šçš„ä»£ç "></a>ä½¿ç”¨tree Shakingå‰”é™¤ç”¨ä¸ä¸Šçš„ä»£ç </h2><p>Tree Shakingå¯ä»¥åˆ†æå‡ºé‚£äº›ä»£ç è¢«ç”¨ä¸Šäº†ï¼Œå“ªäº›æ²¡æœ‰<br>Tree Shakingæ­£å¸¸å·¥ä½œçš„å‰ææ˜¯ï¼Œæäº¤ç»™webpackçš„jsä»£ç å¿…é¡»é‡‡ç”¨äº†ES6çš„æ¨¡å—åŒ–è¯­æ³•ï¼Œå› ä¸ºes6æ¨¡å—åŒ–è¯­æ³•æ˜¯é™æ€çš„<br>ï¼ˆåœ¨å¯¼å…¥ï¼Œå¯¼å‡ºè¯­å¥ä¸­çš„è·¯å¾„å¿…é¡»æ˜¯é™æ€å­—ç¬¦ä¸²ï¼Œè€Œä¸”ä¸èƒ½æ”¾å…¥å…¶ä»–ä»£ç å—ä¸­ï¼‰ï¼Œè¿™è®©webpackå¯ä»¥ç®€å•åœ°åˆ†æå‡ºé‚£äº›exportè¢«importäº†ã€‚<br>å®ç°ï¼š<br>1.ä¿®æ”¹.babelrcæ–‡ä»¶ï¼Œä¿ç•™ES6è¯­æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;presets&quot;:[</div><div class="line">    [</div><div class="line">      &quot;env&quot;,</div><div class="line">      &#123;</div><div class="line">        &quot;module&quot;:false//å…³é—­æ¨¡å—è½¬æ¢åŠŸèƒ½ï¼Œä¿ç•™ES6è¯­æ³•</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥ä½¿ç”¨webpack â€“display-used-exportsæŸ¥çœ‹åˆ†æç»“æœ<br>2.ä½¿ç”¨uglifyJSå‰”é™¤ç”¨ä¸ä¸Šçš„ä»£ç <br>å¯ä»¥åœ¨ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®<br>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ‰§è¡Œ<br>webpack â€“display-used-exports â€“optimize-minimize</p>
<p>å¤„ç†ä½†ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œåˆ©ç”¨mainFieldå‘Šè¯‰webpacké‡‡ç”¨é‚£ä»½å…¥å£æ–‡ä»¶ï¼Œ<br>å½“æŒ‡å®šå…¥å£äºæ–‡ä»¶é‡‡ç”¨es6æ¨¡å—åŒ–è¯­æ³•æ—¶ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨treeShakingè¿›è¡Œä»£ç ä¼˜åŒ–</p>
<h3 id="æå–å…¬å…±ä»£ç "><a href="#æå–å…¬å…±ä»£ç " class="headerlink" title="æå–å…¬å…±ä»£ç "></a>æå–å…¬å…±ä»£ç </h3><p>é—®é¢˜ï¼š<br>ç›¸åŒèµ„æºè¢«é‡å¤åŠ è½½ï¼Œæµªè´¹ç”¨æˆ·çš„æµé‡å’ŒæœåŠ¡å™¨æˆæœ¬<br>æ¯ä¸ªé¡µé¢éœ€è¦åŠ è½½çš„èµ„æºå¤ªå¤§ï¼Œå¯¼è‡´ç½‘é¡µé¦–å±åŠ è½½ç¼“æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</p>
<p>è§£å†³ï¼š<br>å°†å¤šä¸ªé¡µé¢å…¬å…±ä»£ç éƒ¨åˆ†æŠ½ç¦»æˆå•ç‹¬æ–‡ä»¶ï¼Œç”¨æˆ·åœ¨ç¬¬ä¸€æ¬¡è®¿é—®åï¼Œå…¬å…±æ–‡ä»¶ä»£ç è¢«æµè§ˆå™¨ç¼“å­˜<br>åœ¨ç”¨æˆ·åˆ‡æ¢å…¶ä»–é¡µé¢æ—¶ï¼Œåˆ™ä¸ä¼šå†é‡æ–°åŠ è½½å­˜æ”¾å…¬å…±ä»£ç çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥ä»ç¼“å­˜ä¸­è·å–<br>ä»è€Œ<br>å‡å°‘ç½‘ç»œä¼ è¾“æµé‡ï¼Œé™ä½æœåŠ¡å™¨æˆæœ¬<br>è™½ç„¶ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰“å¼€ç½‘ç«™çš„é€Ÿåº¦å¾—ä¸åˆ°ä¼˜åŒ–ï¼Œä½†ä¹‹åè®¿é—®å…¶ä»–é¡µé¢çš„é€Ÿåº¦å°†æé«˜</p>
<p>å®ç°ï¼š<br>â€“æ ¹æ®ç½‘ç«™æ‰€ä½¿ç”¨çš„æŠ€æœ¯æ ˆï¼Œæ‰¾å‡ºç½‘ç«™æ‰€æœ‰é¡µé¢éƒ½éœ€è¦ç”¨åˆ°çš„åŸºç¡€åº“(ç¬¬ä¸‰æ–¹åº“)ï¼Œå°†ä»–ä»¬æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶base.jsä¸­<br>è¯¥æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰ç½‘é¡µçš„åŸºç¡€è¿è¡Œç¯å¢ƒï¼Œç”¨äºé•¿æœŸç¼“å­˜ï¼Œæé«˜å“åº”é€Ÿåº¦</p>
<p>â€“å‰”é™¤äº†å„ä¸ªé¡µé¢ä¸­è¢«base.jsåŒ…å«çš„éƒ¨åˆ†ä»£ç åï¼Œå†æ‰¾å‡ºæ‰€æœ‰é¡µé¢éƒ½ä¾èµ–çš„å…¬å…±éƒ¨åˆ†çš„ä»£ç ï¼Œå°†ä»–ä»¬æå–åˆ°commom.js</p>
<p>â€“å†ä¸ºæ¯ä¸ªç½‘é¡µéƒ½ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œä¸åŒ…å«base.jså’Œcommon.jsä¸­åŒ…å«çš„éƒ¨åˆ†ï¼ŒåªåŒ…å«å„é¡µé¢å•ç‹¬éœ€è¦çš„éƒ¨åˆ†ä»£ç </p>
<p>â€“ ä¾èµ–CommonsChunkPluginæ’ä»¶<br>CommonsChunkPluginå®ä¾‹ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Chunkï¼Œè¿™ä¸ªchunkä¸­åŒ…å«äº†è¢«æå–çš„ä»£ç <br>é€šè¿‡nameå±æ€§å‘Šè¯‰æ’ä»¶æ–°ç”Ÿæˆçš„chunkçš„åç§°ï¼Œchunkså±æ€§æŒ‡æ˜ä»å“ªäº›å·²æœ‰chunkä¸­æå–å…¬å…±éƒ¨åˆ†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const UglifyJsPlugin = require(&apos;webpack/lib/optimize/UglifyJsPlugin&apos;);</div><div class="line">const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;);</div><div class="line">const DefinePlugin = require(&apos;webpack/lib/DefinePlugin&apos;);</div><div class="line">const CommonsChunkPlugin = require(&apos;webpack/lib/optimize/CommonsChunkPlugin&apos;);</div><div class="line">const &#123;AutoWebPlugin&#125; = require(&apos;web-webpack-plugin&apos;);</div><div class="line"></div><div class="line">// ä½¿ç”¨ AutoWebPluginï¼Œè‡ªåŠ¨å¯»æ‰¾ pages ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•ï¼ŒæŠŠæ¯ä¸€ä¸ªç›®å½•çœ‹æˆä¸€ä¸ªå•é¡µåº”ç”¨</div><div class="line">const autoWebPlugin = new AutoWebPlugin(&apos;pages&apos;, &#123;</div><div class="line">  template: &apos;./template.html&apos;, // HTML æ¨¡ç‰ˆæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„</div><div class="line">  // æå–å‡ºæ‰€æœ‰é¡µé¢å…¬å…±çš„ä»£ç </div><div class="line">  commonsChunk: &#123;</div><div class="line">    name: &apos;common&apos;,// æå–å‡ºå…¬å…±ä»£ç  Chunk çš„åç§°</div><div class="line">  &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  // AutoWebPlugin ä¼šæ‰¾ä¸ºå¯»æ‰¾åˆ°çš„æ‰€æœ‰å•é¡µåº”ç”¨ï¼Œç”Ÿæˆå¯¹åº”çš„å…¥å£é…ç½®ï¼Œ</div><div class="line">  // autoWebPlugin.entry æ–¹æ³•å¯ä»¥è·å–åˆ°ç”Ÿæˆå…¥å£é…ç½®</div><div class="line">  entry: autoWebPlugin.entry(&#123;</div><div class="line">    // è¿™é‡Œå¯ä»¥åŠ å…¥ä½ é¢å¤–éœ€è¦çš„ Chunk å…¥å£</div><div class="line">    base: &apos;./base.js&apos;</div><div class="line">  &#125;),</div><div class="line">  output: &#123;</div><div class="line">    filename: &apos;[name]_[chunkhash:8].js&apos;,// ç»™è¾“å‡ºçš„æ–‡ä»¶åç§°åŠ ä¸Š hash å€¼</div><div class="line">    path: path.resolve(__dirname, &apos;./dist&apos;),</div><div class="line">  &#125;,</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      &#123;</div><div class="line">        test: /\.js$/,</div><div class="line">        use: [&apos;babel-loader&apos;],</div><div class="line">        // æ’é™¤ node_modules ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œnode_modules ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯é‡‡ç”¨çš„ ES5 è¯­æ³•ï¼Œæ²¡å¿…è¦å†é€šè¿‡ Babel å»è½¬æ¢</div><div class="line">        exclude: path.resolve(__dirname, &apos;node_modules&apos;),</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        test: /\.css/,// å¢åŠ å¯¹ CSS æ–‡ä»¶çš„æ”¯æŒ</div><div class="line">        // æå–å‡º Chunk ä¸­çš„ CSS ä»£ç åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­</div><div class="line">        use: ExtractTextPlugin.extract(&#123;</div><div class="line">          use: [&apos;css-loader?minimize&apos;] // å‹ç¼© CSS ä»£ç </div><div class="line">        &#125;),</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    autoWebPlugin,</div><div class="line">    // ä¸ºäº†ä» common ä¸­æå–å‡º base ä¹ŸåŒ…å«çš„éƒ¨åˆ†,å‡å°commonä½“ç§¯</div><div class="line">    new CommonsChunkPlugin(&#123;</div><div class="line">      // ä» common å’Œ base ä¸¤ä¸ªç°æˆçš„ Chunk ä¸­æå–å…¬å…±çš„éƒ¨åˆ†</div><div class="line">      chunks: [&apos;common&apos;, &apos;base&apos;],</div><div class="line">      // æŠŠå…¬å…±çš„éƒ¨åˆ†æ”¾åˆ° base ä¸­</div><div class="line">      name: &apos;base&apos;</div><div class="line">    &#125;),</div><div class="line">    new ExtractTextPlugin(&#123;</div><div class="line">      filename: `[name]_[contenthash:8].css`,// ç»™è¾“å‡ºçš„ CSS æ–‡ä»¶åç§°åŠ ä¸Š hash å€¼</div><div class="line">    &#125;),</div><div class="line">    new DefinePlugin(&#123;</div><div class="line">      // å®šä¹‰ NODE_ENV ç¯å¢ƒå˜é‡ä¸º production å»é™¤ react ä»£ç ä¸­çš„å¼€å‘æ—¶æ‰éœ€è¦çš„éƒ¨åˆ†</div><div class="line">      &apos;process.env&apos;: &#123;</div><div class="line">        NODE_ENV: JSON.stringify(&apos;production&apos;)</div><div class="line">      &#125;</div><div class="line">    &#125;),</div><div class="line">    // å‹ç¼©è¾“å‡ºçš„ JS ä»£ç </div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>common.jsæ²¡æœ‰å†…å®¹çš„æ—¶å€™è§£å†³<br>1.CommonsChunkPluginçš„minChunkså±æ€§è¡¨ç¤ºæ–‡ä»¶è¦è¢«æå–å‡ºæ¥æ—¶éœ€è¦åœ¨æŒ‡å®šçš„Chunksä¸­å‡ºç°çš„æœ€å°æ¬¡æ•°ï¼Œå€¼è¶Šå°ï¼Œè¢«æåˆ°commonä¸­çš„æ–‡ä»¶è¶Šå¤š<br>2.æ ¹æ®å„ä¸ªé¡µé¢ä¹‹é—´çš„ç›¸å…³æ€§é€‰å–å…¶ä¸­çš„éƒ¨åˆ†é¡µé¢æ—¶ï¼Œå¯ç”¨CommonChunkPluginæå–è¿™éƒ¨åˆ†è¢«é€‰å‡ºçš„é¡µé¢çš„å…¬å…±éƒ¨åˆ†ï¼Œ<br>è€Œä¸æ˜¯æå–æ‰€æœ‰é¡µé¢çš„å…¬å…±éƒ¨åˆ†ï¼Œè€Œä¸”è¿™æ ·çš„æ“ä½œå¯ä»¥å åŠ å¤šæ¬¡ï¼Œç¼ºç‚¹æ˜¯é…ç½®å¤æ‚ï¼Œéœ€è¦æ ¹æ®é¡µé¢ä¹‹é—´å…³ç³»å»æ€è€ƒå¦‚ä½•é…ç½®<br>ä½†è¯¥æ–¹æ³•ä¸é€šç”¨</p>
<h3 id="åˆ†å‰²ä»£ç æŒ‰éœ€åŠ è½½"><a href="#åˆ†å‰²ä»£ç æŒ‰éœ€åŠ è½½" class="headerlink" title="åˆ†å‰²ä»£ç æŒ‰éœ€åŠ è½½"></a>åˆ†å‰²ä»£ç æŒ‰éœ€åŠ è½½</h3><p>é—®é¢˜<br>å•é¡µé¢åº”ç”¨ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åŠŸèƒ½ä»£ç ï¼Œå®é™…åœ¨æ¯ä¸ªé˜¶æ®µåªå¯èƒ½ä½¿ç”¨å…¶ä¸­ä¸€éƒ¨åˆ†</p>
<p>è§£å†³<br>å°†æ•´ä¸ªç½‘ç«™åˆ’åˆ†æˆä¸€ä¸ªä¸ªå°åŠŸèƒ½ï¼Œå†æŒ‰ç…§æ¯ä¸ªåŠŸèƒ½çš„ç›¸å…³ç¨‹åº¦å°†ä»–ä»¬åˆ†æˆå‡ ç±»<br>å°†æ¯ä¸€ç±»åˆå¹¶æˆä¸€ä¸ªChunk,æŒ‰éœ€åŠ è½½å¯¹åº”çš„Chunk<br>ä¸è¦æŒ‰éœ€åŠ è½½ç”¨æˆ·é¦–æ¬¡æ‰“å¼€ç½‘ç«™æ—¶éœ€è¦çœ‹åˆ°çš„ç”»é¢æ‰€å¯¹åº”çš„åŠŸèƒ½ï¼Œå°†å…¶æ”¾åˆ°æ‰§è¡Œå…¥å£æ‰€åœ¨çš„chunkä¸­ï¼Œ<br>ä»¥å‡å°‘ç”¨æˆ·èƒ½æ„ŸçŸ¥çš„ç½‘é¡µåŠ è½½æ—¶é—´<br>å¯¹äºä¸ä¾èµ–å¤§é‡ä»£ç çš„åŠŸèƒ½ç‚¹ï¼Œå¯å¯¹å…¶è¿›è¡ŒæŒ‰éœ€åŠ è½½</p>
<p>å®ç°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//oneName.js</div><div class="line">module.exports= function()&#123;&#125;</div><div class="line"></div><div class="line">//åŠ è½½è¯­å¥</div><div class="line">import(/* webpackChunkName:&quot;oneName&quot; */ &apos;./oneName&apos;).then((oneName)=&gt;&#123;</div><div class="line">  oneName()</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>webpackå†…ç½®äº†å¯¹import(*)è¯­å¥çš„æ”¯æŒï¼Œå½“webpacké‡åˆ°ç±»ä¼¼çš„è¯­å¥æ—¶ä¼šè¿™æ ·å¤„ç†<br>ä»¥oneName.jsä¸ºå…¥å£é‡æ–°ç”Ÿæˆä¸€ä¸ªChunk<br>å½“ä»£ç æ‰§è¡Œåˆ°importæ‰€åœ¨çš„è¯­å¥æ—¶æ‰å»åŠ è½½ç”±Chunkå¯¹åº”ç”Ÿæˆçš„æ–‡ä»¶<br>importè¿”å›ä¸€ä¸ªPromise,å½“æ–‡ä»¶åŠ è½½æˆåŠŸæ—¶å¯ä»¥åœ¨Promiseçš„thenæ–¹æ³•ä¸­è·å–oneName.jså¯¼å‡ºçš„å†…å®¹</p>
<p>/* webpackChunkName:â€oneNameâ€ */ å«ä¹‰æ˜¯ä¸ºåŠ¨æ€ç”Ÿæˆçš„Chunkèµ‹äºˆä¸€ä¸ªåç§°ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬è¿½è¸ªå’Œè°ƒè¯•ä»£ç <br>å¦‚æœä¸æŒ‡å®šï¼Œåˆ™å…¶é»˜è®¤çš„åç§°å°†ä¼šæ˜¯[id].js<br>åŒæ ·éœ€è¦åœ¨webpackä¸­é…ç½®chunkFilenameå±æ€§ï¼Œæ¥æŒ‡å®šåŠ¨æ€ç”Ÿæˆçš„Chunkåœ¨è¾“å‡ºæ—¶æ–‡ä»¶åç§°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line">const path = require(&apos;path&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  // JS æ‰§è¡Œå…¥å£æ–‡ä»¶</div><div class="line">  entry: &#123;</div><div class="line">    main: &apos;./main.js&apos;,</div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    // ä¸ºä» entry ä¸­é…ç½®ç”Ÿæˆçš„ Chunk é…ç½®è¾“å‡ºæ–‡ä»¶çš„åç§°</div><div class="line">    filename: &apos;[name].js&apos;,</div><div class="line">    // ä¸ºåŠ¨æ€åŠ è½½çš„ Chunk é…ç½®è¾“å‡ºæ–‡ä»¶çš„åç§°</div><div class="line">    chunkFilename: &apos;[name].js&apos;,</div><div class="line">    path: path.resolve(__dirname, &apos;./dist&apos;),</div><div class="line">  &#125;,</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      &#123;</div><div class="line">        test: /\.js$/,</div><div class="line">        use: [&apos;babel-loader&apos;],</div><div class="line">        exclude: path.resolve(__dirname, &apos;node_modules&apos;),</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  devtool: &apos;source-map&apos; // è¾“å‡º source-map æ–¹ä¾¿ç›´æ¥è°ƒè¯• ES6 æºç </div><div class="line">&#125;;</div><div class="line"></div><div class="line">//åœ¨.babellrcä¸­éœ€è¦å¼•å…¥ç»„ä»¶æ¥è¯†åˆ«import(*)è¯­æ³•</div><div class="line">&#123;</div><div class="line">  &quot;presets&quot;:[</div><div class="line">    &quot;env&quot;,</div><div class="line">    &quot;react&quot;</div><div class="line">  ],</div><div class="line">  &quot;plugins&quot;:[</div><div class="line">    &quot;syntax-dynamic-import&quot;</div><div class="line">  ]</div><div class="line">&#125;</div><div class="line">//å®é™…åº”ç”¨</div><div class="line">import React, &#123;PureComponent, createElement&#125; from &apos;react&apos;;</div><div class="line">import &#123;render&#125; from &apos;react-dom&apos;;</div><div class="line">import &#123;HashRouter, Route, Link&#125; from &apos;react-router-dom&apos;;</div><div class="line">import PageHome from &apos;./pages/home&apos;;</div><div class="line"></div><div class="line">/**</div><div class="line"> * å¼‚æ­¥åŠ è½½ç»„ä»¶</div><div class="line"> * @param load ç»„ä»¶åŠ è½½å‡½æ•°ï¼Œload å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œåœ¨æ–‡ä»¶åŠ è½½å®Œæˆæ—¶ resolve</div><div class="line"> * @returns &#123;AsyncComponent&#125; è¿”å›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ç”¨äºå°è£…éœ€è¦å¼‚æ­¥åŠ è½½çš„ç»„ä»¶</div><div class="line"> */</div><div class="line">function getAsyncComponent(load) &#123;</div><div class="line">  return class AsyncComponent extends PureComponent &#123;</div><div class="line"></div><div class="line">    componentDidMount() &#123;</div><div class="line">      // åœ¨é«˜é˜¶ç»„ä»¶ DidMount æ—¶æ‰å»æ‰§è¡Œç½‘ç»œåŠ è½½æ­¥éª¤</div><div class="line">      load().then((&#123;default: component&#125;) =&gt; &#123;</div><div class="line">        // ä»£ç åŠ è½½æˆåŠŸï¼Œè·å–åˆ°äº†ä»£ç å¯¼å‡ºçš„å€¼ï¼Œè°ƒç”¨ setState é€šçŸ¥é«˜é˜¶ç»„ä»¶é‡æ–°æ¸²æŸ“å­ç»„ä»¶</div><div class="line">        this.setState(&#123;</div><div class="line">          component,</div><div class="line">        &#125;)</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render() &#123;</div><div class="line">      const &#123;component&#125; = this.state || &#123;&#125;;</div><div class="line">      // component æ˜¯ React.Component ç±»å‹ï¼Œéœ€è¦é€šè¿‡ React.createElement ç”Ÿäº§ä¸€ä¸ªç»„ä»¶å®ä¾‹</div><div class="line">      return component ? createElement(component) : null;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ ¹ç»„ä»¶</div><div class="line">function App() &#123;</div><div class="line">  return (</div><div class="line">    &lt;HashRouter&gt;</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;nav&gt;</div><div class="line">          &lt;Link to=&apos;/&apos;&gt;Home&lt;/Link&gt; | &lt;Link to=&apos;/about&apos;&gt;About&lt;/Link&gt; | &lt;Link to=&apos;/login&apos;&gt;Login&lt;/Link&gt;</div><div class="line">        &lt;/nav&gt;</div><div class="line">        &lt;hr/&gt;</div><div class="line">        &lt;Route exact path=&apos;/&apos; component=&#123;PageHome&#125;/&gt;</div><div class="line">        &lt;Route path=&apos;/about&apos; component=&#123;getAsyncComponent(</div><div class="line">          // å¼‚æ­¥åŠ è½½å‡½æ•°ï¼Œå¼‚æ­¥åœ°åŠ è½½ PageAbout ç»„ä»¶</div><div class="line">          () =&gt; import(/* webpackChunkName: &apos;page-about&apos; */&apos;./pages/about&apos;)</div><div class="line">        )&#125;</div><div class="line">        /&gt;</div><div class="line">        &lt;Route path=&apos;/login&apos; component=&#123;getAsyncComponent(</div><div class="line">          // å¼‚æ­¥åŠ è½½å‡½æ•°ï¼Œå¼‚æ­¥åœ°åŠ è½½ PageAbout ç»„ä»¶</div><div class="line">          () =&gt; import(/* webpackChunkName: &apos;page-login&apos; */&apos;./pages/login&apos;)</div><div class="line">        )&#125;</div><div class="line">        /&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    &lt;/HashRouter&gt;</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ¸²æŸ“æ ¹ç»„ä»¶</div><div class="line">render(&lt;App/&gt;, window.document.getElementById(&apos;app&apos;));</div></pre></td></tr></table></figure></p>
<h2 id="æå‡æµç•…åº¦"><a href="#æå‡æµç•…åº¦" class="headerlink" title="æå‡æµç•…åº¦"></a>æå‡æµç•…åº¦</h2><p>æå‡ä»£ç æ€§èƒ½<br>1.ä½¿ç”¨prepackä¼˜åŒ–ä»£ç è¿è¡Œæ—¶æ•ˆç‡<br>é€šè¿‡åœ¨ç¼–è¯‘é˜¶æ®µé¢„å…ˆæ‰§è¡Œæºç æ¥å¾—åˆ°æ‰§è¡Œç»“æœï¼Œå†ç›´æ¥å°†è¿è¡Œç»“æœæ”¾åˆ°ç¼–è¯‘åçš„ä»£ç ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç è¿è¡Œæ—¶æ‰å»æ±‚å€¼</p>
<p>prepackå·¥ä½œåŸç†å’Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š<br>é€šè¿‡Babelå°†JSæºç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘(AST)ï¼Œä»¥æ›´ç»†ç²’åº¦åœ°åˆ†ææºç <br>PrePackå®ç°äº†ä¸€ä¸ªJSè§£é‡Šå™¨ï¼Œç”¨äºæ‰§è¡Œæºç ï¼Œå€ŸåŠ©è¿™ä¸ªè§£é‡Šå™¨ï¼ŒPrepackæ‰èƒ½ç†è§£æºç å…·ä½“æ˜¯å¦‚ä½•æ‰§è¡Œçš„<br>å¹¶å°†æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç»“æœè¿”å›åˆ°è¾“å‡ºä¸­</p>
<p>å› ä¸ºè¿˜å¤„äºå¼€å‘é˜¶æ®µï¼Œä¸èƒ½è¯†åˆ«DOM apiå’Œéƒ¨åˆ†nodejs API ä»£ç ï¼Œä¼˜åŒ–åæ–‡ä»¶å°ºå¯¸å¯èƒ½å¤§å¤§å¢åŠ ï¼Œæ€§èƒ½å¯èƒ½æ›´å·®æ‰€ä»¥ç›®å‰è¿˜ä¸é€‚åˆç”¨äºå¤„ç†çº¿ä¸Šä»£ç </p>
<p>2.å¼€å¯Scope Hoisting<br>åˆ†ææ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°½å¯èƒ½å°†è¢«æ‰“æ•£çš„æ¨¡å—åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå¤§å‰ææ˜¯ä¸èƒ½é€ æˆä»£ç å†—ä½™ï¼Œ<br>å› æ­¤åªæœ‰é‚£äº›è¢«å¼•ç”¨äº†ä¸€æ¬¡çš„æ¨¡å—æ‰èƒ½è¢«åˆå¹¶<br>ç”±äºScope Hostingéœ€è¦åˆ†ææ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå› æ­¤æºç å¿…é¡»é‡‡ç”¨ES6è¯­å¥ï¼Œä¸ç„¶å®ƒå°†æ— æ³•ç”Ÿæ•ˆ<br>å¯¹äºéES6æ¨¡å—åŒ–è¯­æ³•çš„ä»£ç ï¼Œwebpackä¼šé™çº§å¤„ç†ä¸”ä¸ä½¿ç”¨Scope Hoistingä¼˜åŒ–ã€‚<br>ä¸ºäº†çŸ¥é“webpackå¯¹å“ªäº›ä»£ç åšäº†é™çº§å¤„ç†ï¼Œå¯ä»¥åœ¨å¯åŠ¨webpackæ—¶å¸¦ä¸Šâ€“display-optimization-bailoutå‚æ•°<br>è¿™æ ·è¾“å‡ºçš„æ—¥å¿—å°±ä¼šå‘ŠçŸ¥æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´äº†é™çº§å¤„ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">const path = require(&apos;path&apos;);</div><div class="line">const ModuleConcatenationPlugin = require(&apos;webpack/lib/optimize/ModuleConcatenationPlugin&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  // JS æ‰§è¡Œå…¥å£æ–‡ä»¶</div><div class="line">  entry: &apos;./main.js&apos;,</div><div class="line">  output: &#123;</div><div class="line">    // æŠŠæ‰€æœ‰ä¾èµ–çš„æ¨¡å—åˆå¹¶è¾“å‡ºåˆ°ä¸€ä¸ª bundle.js æ–‡ä»¶</div><div class="line">    filename: &apos;bundle.js&apos;,</div><div class="line">    // è¾“å‡ºæ–‡ä»¶éƒ½æ”¾åˆ° dist ç›®å½•ä¸‹</div><div class="line">    path: path.resolve(__dirname, &apos;./dist&apos;),</div><div class="line">  &#125;,</div><div class="line">  resolve: &#123;</div><div class="line">    // é’ˆå¯¹ Npm ä¸­çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¼˜å…ˆé‡‡ç”¨ jsnext:main ä¸­æŒ‡å‘çš„ ES6 æ¨¡å—åŒ–è¯­æ³•çš„æ–‡ä»¶</div><div class="line">    mainFields: [&apos;jsnext:main&apos;, &apos;browser&apos;, &apos;main&apos;]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    // å¼€å¯ Scope Hoisting</div><div class="line">    new ModuleConcatenationPlugin(),</div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å¥½å¤„ï¼š<br>ä»£ç ä½“ç§¯æ›´å°ï¼Œå› ä¸ºå‡½æ•°ç”³æ˜è¯­å¥ä¼šäº§ç”Ÿå¤§é‡ä»£ç <br>ä»£ç åœ¨è¿è¡Œæ—¶å› ä¸ºåˆ›å»ºçš„å‡½æ•°ä½œç”¨åŸŸå˜å°‘ï¼Œæ‰€ä»¥å†…å­˜å¼€é”€ä¹Ÿå˜å°äº†</p>
<h1 id="è¾“å‡ºåˆ†æ"><a href="#è¾“å‡ºåˆ†æ" class="headerlink" title="è¾“å‡ºåˆ†æ"></a>è¾“å‡ºåˆ†æ</h1><p>æ‰§è¡Œå‘½ä»¤<br>webpack â€“profile â€“json &gt;stats.json<br>å¯ä»¥å°†æ„å»ºç›¸å…³çš„ä¿¡æ¯è¾“å‡ºåˆ°stats.jsonæ–‡ä»¶ä¸­<br>1.æ‰“å¼€http:\//webpack.github.io/analyse/ ä¸Šä¼ statsæ–‡ä»¶ï¼Œä½¿ç”¨å®˜æ–¹Webpack Analyseåˆ†æè¾“å‡ºç»“æœ<br>2.ä½¿ç”¨webpack-bundle-analyzerè¿›è¡Œåˆ†æ<br>å®‰è£…webpack-bundle-analyzeråˆ°å…¨å±€<br>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ‰§è¡Œwebpack-bundle-analyzerï¼Œæµè§ˆå™¨ä¼šæ‰“å¼€å¯¹åº”ç½‘é¡µå¹¶å±•ç°æ‰“åŒ…ç»“æœ</p>
<p><a href="https://github.com/YooHannah/algorithm/blob/master/webpack-dist.config.js" target="_blank" rel="external">ä¾§é‡ä¼˜åŒ–è¾“å‡ºè´¨é‡çš„é…ç½®</a><br><a href="https://github.com/YooHannah/algorithm/blob/master/webpack.config.js" target="_blank" rel="external">ä¾§é‡ä¼˜åŒ–å¼€å‘ä½“éªŒçš„é…ç½®</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä¼˜åŒ–å¼€å‘ä½“éªŒ&quot;&gt;&lt;a href=&quot;#ä¼˜åŒ–å¼€å‘ä½“éªŒ&quot; class=&quot;headerlink&quot; title=&quot;ä¼˜åŒ–å¼€å‘ä½“éªŒ&quot;&gt;&lt;/a&gt;ä¼˜åŒ–å¼€å‘ä½“éªŒ&lt;/h1&gt;&lt;p&gt;ç›®çš„æ˜¯æå‡å¼€å‘æ•ˆç‡&lt;/p&gt;
&lt;h2 id=&quot;ä¼˜åŒ–æ„å»ºé€Ÿåº¦&quot;&gt;&lt;a href=&quot;#ä¼˜åŒ–æ„å»ºé€Ÿåº¦&quot; class=
    
    </summary>
    
    
      <category term="performance" scheme="http://yoohannah.github.io/tags/performance/"/>
    
  </entry>
  
</feed>
